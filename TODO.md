# SRE 平台實作任務總覽 (重構版)

## 🎯 專案總覽
基於 `prototype.html` 設計系統和 `pages.md` 功能規格，將現有 React 前端應用完整實作為符合原型設計的 SRE 平台界面，並整合 Mock Server API 進行功能驗證。

## 📋 核心契約文件 (SSOT)
⚠️ **重要：以下文件為專案的唯一真實來源**

### 數據契約
- **`db_schema.sql`** - 數據庫架構的唯一真實來源 (v3.0)
- **`openapi.yaml`** - API 規格的唯一真實來源 (v3.0.0)

### 📌 開發原則
- 所有實現必須遵循 SSOT 文件定義
- 完成項目時須添加「📋 實現摘要」
- 優先級標記：⭐⭐⭐ (最高) → ⭐⭐ (高) → ⭐ (中)

## 📊 環境狀態
- ✅ Mock Server: http://localhost:8080 (運行中)
- ✅ Frontend: http://localhost:5174 (運行中)
- ✅ 基礎架構：React 18 + TypeScript + Ant Design v5 + ECharts

---

## 📋 快速導航

### 🎯 [Phase 1: 核心架構奠基](#phase-1-核心架構奠基)
### 🏗️ [Phase 2: 功能開發主體](#phase-2-功能開發主體)
### ⚡ [Phase 3: 高級功能實現](#phase-3-高級功能實現)
### 🎨 [Phase 4: 優化與完善](#phase-4-優化與完善)

### 📋 [技術要求](#技術要求)
### ✅ [已完成任務](#已完成任務)
### 🚀 [驗收標準](#驗收標準)

---

## 🎯 Phase 1: 核心架構奠基
*目標：建立系統核心架構，確保可擴展性和一致性*

### 🤖 AI Agent F: 系統架構核心 ⭐⭐⭐
**負責領域**: 動態 CMDB、智慧輸入系統、Grafana 整合

#### F1. 動態 CMDB 架構實現
**核心價值**: 將靜態資源清單轉化為動態、可觀測、可操作的基礎設施管理中樞
- [x] **統一資料模型設計**
  - 多源數據聚合架構 (PostgreSQL + VictoriaMetrics + 事件系統)
  - 自動化探索工具整合 (Ansible playbooks、雲端 API 掃描)
  - 資源屬性動態更新機制

- [x] **高效能資源 API 實現**
  - `GET /api/v1/resources` 動態聚合多源數據
  - 即時指標與延遲快取的平衡策略
  - 資源統計預先計算 (每分鐘背景作業)

- [x] **資源趨勢圖與健康狀態**
  - CPU/記憶體迷你趨勢圖 (過去一小時變化)
  - 可點擊標籤系統 (標籤作為篩選超連結)
  - 健康狀態解釋工具提示 (具體觸發原因)

📋 **實現摘要**：mock server 新增聚合資源模型（含健康診斷、迷你趨勢、行動建議），前端以 `useResources` 及資源頁整合聚合 API、健康 Tooltip 與可點標籤，完成動態 CMDB 基礎。

#### F2. 智慧輸入系統
**核心價值**: 根據數據特性動態切換最適合的輸入元件
- [x] **動態輸入元件切換**
  - 標籤鍵分類邏輯 (枚舉型 vs 動態型 vs 自定義型)
  - 下拉選單實現 (severity, env, team 等固定枚舉)
  - 自動完成實現 (instance, pod_name 等動態數據)

- [x] **運算子聯動邏輯**
  - `in`/`not_in` 時自動切換為多選標籤輸入
  - 正則表達式運算子的即時驗證
  - 輸入值範圍檢查和錯誤提示

- [x] **標籤值高效查詢 API**
  - `GET /api/v1/tags/{key}/values` 實現
  - Prometheus/VictoriaMetrics 元數據整合
  - 查詢結果快取和性能優化

📋 **實現摘要**：完成 `SmartFilterBuilder` 組件和 `useTagMetadata` hook，實現根據標籤鍵類型自動切換輸入元件，支持 6 種運算子聯動，包含正則表達式即時驗證和多值標籤輸入功能。

#### F3. Grafana 整合代理模式
**核心價值**: 作為 Grafana 的增值代理，提供更好的用戶體驗
- [x] **接觸點管理代理**
  - `GET /api/v1/notification-channels` Grafana API 代理
  - 管道配置 CRUD 操作的完整代理實現
  - API 請求/響應的格式轉換

- [x] **健康檢查與統計系統**
  - 背景排程作業 (每15分鐘測試所有管道)
  - 測試結果儲存 (`channel_health_checks` 表)
  - 使用統計預先計算和 Redis 快取

📋 **實現摘要**：完成 `useNotificationChannels` hook，實現 Grafana 通知管道的完整代理功能，包含健康狀態監控、回應時間追蹤和使用統計，支持完整的 fallback 機制。

#### F4. 背景作業與排程系統
**核心價值**: 提升系統效能和用戶體驗
- [x] **統計指標預計算作業**
  - 資源 KPI 指標每分鐘更新
  - 通知統計數據背景計算
  - Redis 快取策略和過期管理

- [x] **健康監控排程任務**
  - 通知管道定期健康檢查
  - 資源狀態監控更新
  - 異常情況的告警機制

📋 **實現摘要**：mock server 建立背景作業模擬框架與 `/background-jobs` API，涵蓋資源 KPI 預計算與通知管道健康檢查，前端資源頁新增背景作業面板呈現狀態、告警與手動重跑。

### 🤖 AI Agent A: 設計系統與核心組件 ⭐⭐⭐
**負責領域**: 設計系統實作、共享組件開發

#### A1. 設計系統提取與實作
- [x] **分析 prototype.html 設計系統**
- [x] **創建設計系統文件**
- [x] **實作核心 UI 組件**
- [x] **佈局系統重構**
- [x] **導航系統**

### 🤖 AI Agent D: 身份與存取管理 ⭐⭐⭐
**負責領域**: 全域組件、身份認證基礎

#### D1. 全域組件與認證基礎
- [ ] **登入頁面** ([images/00-頁面-登入.png](images/00-頁面-登入.png))
- [ ] **使用者選單** ([images/01-彈窗-使用者選單.png](images/01-彈窗-使用者選單.png))
- [ ] **通知中心** ([images/02-彈窗-通知中心.png](images/02-彈窗-通知中心.png))
- [ ] **身份認證整合** - Keycloak 整合實現

---

## 🏗️ Phase 2: 功能開發主體
*目標：實現核心業務功能模組*

### 🤖 AI Agent B: 事件管理模組 ⭐⭐⭐
**負責領域**: 事件管理相關所有功能

#### B1. 事件列表與詳情系統
- [x] **事件列表主頁面** ([images/10-頁面-事件列表.png](images/10-頁面-事件列表.png))
- [x] **事件詳情彈窗系統** ([images/13-彈窗-事件列表-事件詳情1-基本資訊.png](images/13-彈窗-事件列表-事件詳情1-基本資訊.png))
- [x] **事件詳情自動化頁籤** ([images/16-彈窗-事件列表-事件詳情4-自動化.png](images/16-彈窗-事件列表-事件詳情4-自動化.png))
- [x] **AI 事件分析報告** ([images/17-彈窗-事件列表-AI事件分析報告.png](images/17-彈窗-事件列表-AI事件分析報告.png))

#### B2. 事件規則管理
- [x] **事件規則頁面** ([images/11-頁面-事件規則.png](images/11-頁面-事件規則.png))
- [x] **事件規則編輯彈窗**
- [ ] **建立靜音規則** ([images/18-彈窗-事件規則-建立靜音.png](images/18-彈窗-事件規則-建立靜音.png))

#### B3. 靜音規則管理
- [x] **靜音規則頁面** ([images/12-頁面-靜音規則.png](images/12-頁面-靜音規則.png))
- [x] **靜音規則編輯彈窗**

### 🤖 AI Agent C: 資源管理與儀表板 ⭐⭐⭐
**負責領域**: 資源管理、儀表板系統

#### C1. 資源管理模組
- [ ] **資源列表頁面** ([images/30-頁面-資源列表.png](images/30-頁面-資源列表.png))
- [ ] **資源群組管理** ([images/31-頁面-資源群組.png](images/31-頁面-資源群組.png))
- [ ] **拓撲視圖** ([images/32-頁面-拓撲視圖.png](images/32-頁面-拓撲視圖.png))

#### C2. 儀表板系統
- [x] **儀表板管理** ([images/40-頁面-儀表板管理.png](images/40-頁面-儀表板管理.png))
- [x] **基礎設施洞察** ([images/41-頁面-基礎設施洞察.png](images/41-頁面-基礎設施洞察.png))
- [x] **SRE 戰情室** ([images/42-頁面-SRE戰情室.png](images/42-頁面-SRE戰情室.png))

---

## ⚡ Phase 3: 高級功能實現
*目標：實現自動化、通知等高級功能*

### 🤖 AI Agent C: 自動化中心 ⭐⭐⭐
**負責領域**: 容量規劃、腳本庫、排程管理、執行日誌

#### C3. 自動化中心
- [ ] **容量規劃** ([images/50-頁面-容量規劃.png](images/50-頁面-容量規劃.png))
- [x] **腳本庫管理** ([images/51-頁面-腳本庫.png](images/51-頁面-腳本庫.png))
- [x] **排程管理** ([images/52-頁面-排程管理.png](images/52-頁面-排程管理.png))
- [x] **執行日誌** ([images/53-頁面-執行日誌.png](images/53-頁面-執行日誌.png))

### 🤖 AI Agent E: 通知與平台管理 ⭐⭐⭐
**負責領域**: 通知管理、平台管理、個人資料

#### E1. 通知管理
- [ ] **通知策略** ([images/70-頁面-通知策略.png](images/70-頁面-通知策略.png))
- [ ] **通知管道** ([images/71-頁面-通知管道.png](images/71-頁面-通知管道.png))
- [ ] **通知歷史** ([images/72-頁面-通知歷史.png](images/72-頁面-通知歷史.png))

#### E2. 平台管理
- [ ] **標籤管理頁面** ([images/80-頁面-標籤管理.png](images/80-頁面-標籤管理.png))
- [ ] **郵件設定** ([images/81-頁面-郵件設定.png](images/81-頁面-郵件設定.png))
- [ ] **身份驗證** ([images/82-頁面-身份驗證.png](images/82-頁面-身份驗證.png))

#### E3. 個人資料模組
- [ ] **個人資訊** ([images/90-頁面-個人資料-個人資訊.png](images/90-頁面-個人資料-個人資訊.png))
- [ ] **偏好設定** ([images/91-頁面-個人資料-偏好設定.png](images/91-頁面-個人資料-偏好設定.png))
- [ ] **密碼安全** ([images/92-頁面-個人資料-密碼安全.png](images/92-頁面-個人資料-密碼安全.png))

---

## 🎨 Phase 4: 優化與完善
*目標：系統優化、用戶體驗提升、最終驗收*

### 🤖 AI Agent D: 身份與存取管理完善 ⭐⭐
**負責領域**: 人員管理、團隊管理、角色管理、審計日誌

#### D2. 身份與存取管理
- [ ] **人員管理** ([images/60-頁面-人員管理.png](images/60-頁面-人員管理.png))
- [ ] **團隊管理** ([images/61-頁面-團隊管理.png](images/61-頁面-團隊管理.png))
- [ ] **角色管理** ([images/62-頁面-角色管理.png](images/62-頁面-角色管理.png))
- [ ] **審計日誌** ([images/63-頁面-審計日誌.png](images/63-頁面-審計日誌.png))
- [ ] **設定頁面** ([images/64-頁面-設定.png](images/64-頁面-設定.png))

### 🎯 系統優化與用戶體驗 ⭐⭐

#### 效能優化
- [ ] **API 效能優化** - 響應時間優化至 <200ms
- [ ] **圖表渲染優化** - ECharts 性能提升
- [ ] **數據加載優化** - 虛擬滾動和分頁優化

#### 用戶體驗提升
- [ ] **響應式設計完善** - 移動端適配
- [ ] **加載狀態優化** - 骨架屏和進度指示器
- [ ] **錯誤處理完善** - 用戶友好的錯誤提示
- [ ] **鍵盤導航支援** - 可及性優化

---

## 📋 技術要求
*確保代碼品質和系統一致性*

### 共通技術規範
1. **設計系統一致性**
   - 完全採用 prototype.html 的 CSS 變量
   - 保持 dark theme 設計風格
   - 應用玻璃效果 (glass morphism) 設計

2. **API 整合規範**
   - 所有 API 調用使用統一的 hooks
   - 正確處理 loading/error 狀態
   - 確保與 openapi.yaml 契約一致

3. **代碼品質要求**
   - TypeScript 嚴格模式
   - 所有組件需要 prop types
   - 使用 modern React patterns
   - 確保可維護性

4. **架構設計要求**
   - 動態 CMDB 作為單一事實來源 (SSOT)
   - 多源數據聚合和智慧快取策略
   - 背景作業與排程系統的效能優化
   - Grafana 整合代理模式的實現
   - 智慧輸入系統的動態元件切換
   - 情境化操作系統的靈活設計

---

## ✅ 已完成任務
*記錄重要的完成項目和實現細節*

### Phase 1 核心架構
- [x] **設計系統提取與實作**
  - 📋 實現摘要：已完成 prototype.html 設計系統的完整提取，包括 CSS 變量、玻璃效果、圓角陰影等

- [x] **核心 UI 組件實作**
  - 📋 實現摘要：實作了 PageHeader、ContextualKPICard、StatusBadge、GlassModal、DataTable 等核心組件

- [x] **佈局系統重構**
  - 📋 實現摘要：更新 Layout.tsx，實作玻璃效果側邊欄和頂部導航，確保響應式設計

- [x] **導航系統實作**
  - 📋 實現摘要：實作了用戶選單和通知中心，支援玻璃效果和麵包屑導航

- [x] **動態 CMDB 架構實現 (AI Agent F)**
  - 📋 實現摘要：完成 `useResources` hook 和 `resourceTransforms.ts`，實現多源數據聚合、健康診斷、指標計算和資源統計功能，支援標籤篩選和完整的 fallback 機制

- [x] **智慧輸入系統 (AI Agent F)**
  - 📋 實現摘要：完成 `SmartFilterBuilder` 組件和 `useTagMetadata` hook，實現根據標籤鍵類型自動切換輸入元件，支援 6 種運算子聯動，包含正則表達式即時驗證和多值標籤輸入功能

- [x] **Grafana 整合代理模式 (AI Agent F)**
  - 📋 實現摘要：完成 `useNotificationChannels` hook，實現 Grafana 通知管道的完整代理功能，包含健康狀態監控、回應時間追蹤和使用統計，支援完整的 fallback 機制

- [x] **背景作業與排程系統 (AI Agent F)**
  - 📋 實現摘要：完成 `useBackgroundJobs` hook，實現背景作業管理框架，包含資源 KPI 預計算、通知管道健康檢查、作業狀態監控和統計功能

### Phase 2 功能開發
- [x] **儀表板系統**
  - 📋 實現摘要：整合新的儀表板資料 hook，改用共用 KPI 卡＋分類卡片＋資料表格，保留 fallback 資料模式

- [x] **自動化中心**
  - 📋 實現摘要：腳本庫、排程管理、執行日誌都已完成，使用統一 hook 和 fallback 策略

---

## 🚀 驗收標準
*最終交付目標和驗收流程*

### 最終交付目標
1. **🎯 視覺完全匹配**: 前端界面 100% 符合 prototype.html 設計規範
2. **🏗️ 功能完整實現**: pages.md 中核心功能模組全部實作
3. **🔗 API 完美整合**: 與 Mock Server 無縫對接，數據流通暢
4. **👥 用戶體驗優良**: 操作流程順暢，響應速度快
5. **💻 代碼品質優秀**: TypeScript 嚴格，結構清晰，可維護性高
6. **🏛️ 架構完整實現**: 動態 CMDB、智慧輸入、Grafana 整合全部完成
7. **⚡ 效能指標達成**: API 響應時間 <200ms，頁面載入 <1s，智慧輸入即時響應
8. **🔧 系統可擴展性**: 情境化操作系統靈活擴展，背景作業高效運行

### 驗收流程
1. **環境準備**: 啟動 Mock Server (localhost:8080) 和 Frontend (localhost:5174)
2. **功能測試**: 測試完整用戶操作流程，確認所有功能模組正常運作
3. **性能檢查**: 檢查代碼品質和性能指標，確保符合技術要求
4. **用戶體驗驗證**: 驗證界面一致性、操作流暢性和響應速度
5. **架構驗證**: 確認系統架構的完整性和可擴展性

---

## 📞 協作指引
*AI 協作原則和共享資源*

### AI 之間的協作原則
1. **模組化開發**: 各 AI 專注自己的領域，避免代碼衝突
2. **接口標準化**: 共享組件需要明確的 props 接口定義
3. **狀態管理**: 使用統一的狀態管理方案 (Context/hooks)
4. **代碼審查**: 相互檢查代碼品質和設計一致性

### 共享資源
- `src/styles/`: 設計系統 CSS (AI Agent A 負責)
- `src/components/common/`: 共享組件 (AI Agent A 負責)
- `src/hooks/`: API hooks (各 AI 根據需要實作)
- `src/types/`: TypeScript 類型定義 (各 AI 維護自己模組)

### 進度同步
- 每個 AI 使用 TodoWrite 工具追蹤自己的進度
- 完成重要里程碑後，更新此 TODO.md 文件
- 遇到跨模組依賴問題時，與相關 AI 協調解決

---

**🚀 開始實作！讓我們將 SRE 平台打造成一個世界級的企業解決方案！**
