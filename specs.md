# **SRE 平台前端開發規格書 (SSOT)**

版本: 3.0
最後更新: 2025-09-10

---

## **目錄**

- [0. 網站地圖 (Sitemap)](#0-網站地圖-sitemap)
- [1. 總覽 (Overview)](#1-總覽-overview)
- [2. 全局開發原則 (Global Principles)](#2-全局開發原則-global-principles)
- [3. 全局佈局與導航 (Global Layout & Navigation)](#3-全局佈局與導航-global-layout--navigation)
- [4. 登入與登出 (Login & Logout)](#4-登入與登出-login--logout)
- [5. 總覽儀表板 (Overview Dashboard)](#5-儀表板-dashboard)
- [6. 資源列表 (Resources List)](#6-資源管理-resource-management)
- [7. 資源群組 (Resource Groups)](#7-資源群組-resource-groups)
- [8. 事件列表 (Incidents List)](#8-事件列表-incidents)
- [9. 告警列表 (Alerts List)](#9-告警列表-alerts-list)
- [10. 事件規則 (Incident Rules)](#10-事件規則-incident-rules)
- [11. 靜音規則 (Incident Silences)](#11-靜音規則-incidents-silences)
- [12. 容量規劃 (Capacity Planning)](#12-容量規劃頁面-capacity-planning-page)
- [13. 腳本庫 (Automation Scripts)](#13-腳本庫-scripts)
- [14. 排程管理 (Automation Schedules)](#14-排程管理-schedules)
- [15. 執行日誌 (Automation Executions)](#15-執行日誌-executions)
- [16. 團隊管理 (Administration Teams)](#16-團隊管理-team-management)
- [17. 角色管理 (Administration Roles)](#17-角色管理-role-management)
- [18. 通知管道 (Administration Channels)](#18-通知管道-notification-channels)
- [19. 系統設定 (Administration Settings)](#19-系統設定-system-settings)
- [20. 平台診斷 (Administration Diagnostics)](#20-平台診斷-platform-diagnostics)
- [21. 審計日誌 (Administration Audit)](#21-審計日誌-administration-audit)
- [22. 個人資料 (Profile)](#22-個人資料與設定-profile--settings)

---

## **0. 網站地圖 (Sitemap)**

以下為 SRE 平台的整體頁面結構與導航路徑，以樹狀圖呈現:

```bash
SRE 平台  
├── /auth (權限管理) 
├── /login (登入) 
├── /logout (登出) 
└── / (主應用)  
    ├── /dashboard (總覽儀表板)
    ├── /resources  (資源)
    │   ├── /resources (資源列表 - 根路徑)
    │   └── /resources/groups (資源群組)  
    ├── /incidents  (事件)
    │   ├── /incidents (事件列表 - 根路徑)
    │   ├── /incidents/alerts (告警列表)
    │   ├── /incidents/rules (事件規則)
    │   └── /incidents/silences (靜音規則)
    ├── /analyzing  (分析)
    │   └── /analyzing/capacity (容量規劃)
    ├── /automation  (自動化)
    │   ├── /automation/scripts (腳本庫)  
    │   ├── /automation/schedules (排程管理)  
    │   └── /automation/executions (執行日誌)  
    ├── /admin (管理)
    │   ├── /admin/teams (團隊管理)  
    │   ├── /admin/roles (角色管理)  
    │   ├── /admin/channels (通知管道)  
    │   ├── /admin/settings (系統設定)  
    │   ├── /admin/diagnostics (平台診斷)  
    │   └── /admin/audit (審計日誌)  
    └── /profile (個人資料)  
        ├── /profile (個人偏好設定 - 根路徑)  
        ├── /profile/security (密碼安全)  
        └── /profile/notifications (通知設定)
```
### **功能目標**
提供清晰的功能定位和目標描述。


### **功能規格**
詳細的功能規格說明。


### **開發規格**
- **核心元件**: 相關元件列表
- **API 端點**: 相關 API 端點
- **權限**: 權限要求說明


### **驗收條件**
- [ ] 功能正常運作
- [ ] 符合設計要求

---

## **1. 總覽 (Overview)**

本文件為 SRE 平台前端專案的**唯一、權威的開發規格來源 (Single Source of Truth)**。其目標是定義一個清晰、完整且可執行的開發藍圖，足以讓任何一位工程師能夠獨立、準確地完成整個專案的實作。

### **1.1. 專案目標與範圍**

- **目標**：構建一個現代化的 SRE 平台前端，提供資源監控、事件管理、自動化運維等功能
- **使用者**：內部 SRE 團隊和開發人員
- **核心價值**：提升系統可靠性、簡化運維操作、提供直觀的用戶體驗

### **1.2. 技術選型 (Technology Stack)**

| 類別 | 技術選型 |
| :--- | :--- |
| **核心框架** | `React` |
| **UI 元件庫** | `Ant Design (AntD)` |
| **狀態管理** | `Redux Toolkit (RTK)` |
| **資料視覺化** | `ECharts for React` |
| **前端路由** | `React Router` |
| **開發與建構** | `Vite` |

### **1.3. 文件結構與導航**

本規格書按以下結構組織，便於快速查找和理解：

1. **總覽與全局原則** - 項目目標、技術選型和開發原則
2. **基礎框架與核心互動** - 全局佈局、認證、搜索和通知中心
3. **核心功能模組** - 儀表板、資源管理、事件管理、分析和自動化
4. **管理中心** - 組織、角色、通知管道、系統設定、平台診斷和審計日誌
5. **個人資料** - 個人設置和偏好
6. **附錄** - 非功能性需求、錯誤處理規範等

### **1.4. 開發原則**

- **單一真實來源**：所有開發規格以此文件為準
- **模組化設計**：採用 features 為主的目錄結構
- **組件化開發**：遵循容器與展示組件分離模式
- **響應式設計**：支援多種設備尺寸
- **可訪問性**：確保鍵盤導航和輔助技術支援

### **1.5. 基礎設施 API 端點**

本平台提供以下基礎設施監控端點，主要用於健康檢查和系統監控：

#### **健康檢查端點**
- **`GET /api/v1/healthz`** - 應用程式健康檢查，用於確認應用程式是否正常運行
- **`GET /api/v1/readyz`** - 應用程式就緒檢查，用於確認應用程式是否準備好接收流量

#### **指標端點**
- **`GET /api/v1/metrics`** - 系統指標數據，用於監控系統性能和資源使用情況
- **`GET /api/v1/metrics/definitions`** - 指標定義列表，用於動態獲取可用的監控指標類型
- **`POST /api/v1/metrics/query`** - 多資源指標時序查詢，用於進階分析與圖表繪製

> **注意**：這些端點主要由監控系統（如 Prometheus）調用，前端通常不會直接使用。

### **1.6. 開發規格**

#### **核心元件**
- **App.tsx** - 應用程式主入口
- **Router** - 路由配置
- **Layout** - 主佈局元件
- **ErrorBoundary** - 錯誤邊界處理

#### **API 端點**
- `GET /api/v1/healthz` - 應用程式健康檢查
- `GET /api/v1/readyz` - 應用程式就緒檢查
- `GET /api/v1/metrics` - 系統指標數據
- `GET /api/v1/metrics/definitions` - 指標定義列表

#### **權限**
- **訪問權限**: 所有登入使用者均可訪問總覽頁面
- **功能權限**: 依據各功能模組的具體權限設定

#### **驗收條件**
- [ ] 應用程式能正常啟動並顯示總覽頁面
- [ ] 技術選型文檔完整準確
- [ ] 基礎設施端點運行正常
- [ ] 文檔結構清晰易懂

---

## **2. 全局開發原則 (Global Principles)**

### **2.1. 目錄結構規範**

- `src/components`: 存放可在多個頁面間複用的展示型元件。
- `src/features`: 存放與特定功能模組相關的所有檔案 (e.g., `features/Dashboard`)。
- `src/services`: 存放自動生成的 API 客戶端 (RTK Query)。
- `src/store`: 存放 Redux store。
- `src/layouts`: 存放應用程式的主體佈局元件。
- `src/pages`: 存放頁面級元件，負責組合 layout 和 features。

### **2.2. 元件設計原則**

- **容器與展示元件分離**：遵循「容器(Container)與展示(Presentational)元件」分離的模式。
- **單一職責**：每個元件應只負責一個功能點。
- **可複用性**：元件設計應考慮在多個場景下的複用。

### **2.3. 狀態管理規範**

- **Redux (RTK)**: 用於管理全域狀態、伺服器快取 (RTK Query)。
- **本地狀態 (useState/useReducer)**: 用於管理單一元件內部 UI 狀態（如表單輸入、Modal 開關）。

### **2.4. API 整合規範**

- **RTK Query**：用於 API 請求和伺服器狀態管理
- **錯誤處理**：統一的錯誤處理機制
- **載入狀態**：明確的 loading 狀態指示

### **2.5. 術語標準化規範**

為了確保文檔的一致性和可讀性，應遵循以下術語使用標準：

#### **核心術語對應表**
| 英文術語 | 標準中文譯名 | 備註 |
|:---|:---|:---|
| **Alert** | **告警** | 由監控系統根據預設規則自動觸發的**原始信號**。通常是自動化的、大量的，作為「事件」的輸入源。對應 `GET /api/v1/alerts`。 |
| **Incident** | **事件** | 由一個或多個「告警」觸發，或由人工建立的**需處理工單**。具有生命週期（如：待確認、處理中、已解決），需要人為介入與追蹤。對應 `GET /api/v1/incidents`。 |
| Resource | 資源 | 監控對象，如伺服器、服務。 |
| Group | 群組 | 資源的邏輯分組。 |
| Script | 腳本 | 自動化腳本。 |
| Schedule | 排程 | 任務的定時執行計畫。 |
| Execution | 執行 | 腳本或任務的單次執行實例。 |
| Channel | 通知管道 | 發送通知的媒介，如 Email、Slack。 |
| Notification | 通知 | 發送給使用者的系統訊息。 |
| Setting | 設定 | 系統配置參數。 |
| User | 使用者 | 系統用戶。 |
| Role | 角色 | 用戶的角色與權限集合。 |
| Permission | 權限 | 具體的操作許可。 |
| Silence | 靜音規則 | 在特定期間抑制告警或事件通知的規則，常用於計畫性維護。 |

#### **術語使用原則**
1. **優先使用標準中文譯名**：在 UI 和中文文檔中，應優先使用本表定義的「標準中文譯名」。
2. **概念區分**：務必清晰區分 **告警 (Alert)** 與 **事件 (Incident)**。前者是因，後者是果。
3. **技術術語保留英文**：在討論 API 路徑、Schema 或程式碼時，應直接使用英文術語（如 `incidentId`, `AlertRule` schema）。
4. **一致性優先**：在所有開發交付項目中，應維持術語的一致性。

### **2.6. 國際化規範**

- 建立語言資源檔結構 (src/locales/zh-TW.json, src/locales/en-US.json)
- 所有 UI 靜態文字都必須使用 i18n key
- 提供語言切換器

### **2.7. 可訪問性規範**

- 所有互動元件都必須可以透過 Tab 鍵聚焦
- 為非語意化元件提供正確的 ARIA 角色和屬性
- 為常用操作提供快捷鍵 (如 Ctrl+K 搜尋)

### **2.8. 效能優化規範**

- 所有網路請求操作都必須有明確的 loading 狀態指示器
- 複雜表單應實作自動儲存草稿至 sessionStorage
- 所有大量數據列表都必須實作後端分頁

### **2.9. 響應式設計規範**

- 佈局應能自動適應螢幕寬度，避免水平滾動
- 優化觸控目標的大小
- 在小屏幕上側邊導航可收起或轉換為頂部漢堡選單

### **2.10. API 錯誤處理的具體 UI 呈現方式**

本節詳細定義不同 HTTP 錯誤狀態碼在前端的統一視覺呈現和互動方式，以確保使用者在遇到問題時能獲得清晰、一致的指引。

#### **通用錯誤提示**

- **`Message` 元件**: 對於非阻塞性的、操作級的錯誤（例如，儲存失敗），應在頁面頂部中間彈出一個 Ant Design `message.error()` 提示。
    - **內容**: 包含一個錯誤圖標和簡潔的錯誤文案（來自 i18n key）。
    - **持續時間**: 預設 3 秒後自動消失。
- **`事件` 元件**: 對於需要使用者注意但不完全阻塞頁面內容的錯誤（例如，某個圖表載入失敗），在對應的卡片或區域內顯示一個 Ant Design `事件` 元件。
    - **樣式**: `type="error"`。
    - **內容**: 包含錯誤標題 (`message`) 和詳細描述 (`description`)，以及一個可選的「重試」按鈕。

#### **特定 HTTP 狀態碼的 UI 呈現**

-   **400 Bad Request (請求錯誤)**
    - **場景**: 通常發生在表單提交時，由於使用者輸入的數據未通過後端驗證。
    - **UI 呈現**:
        - 觸發 `message.error("請檢查輸入內容")` 全局提示。
        - 在對應的 `Form.Item`下方顯示具體的錯誤訊息（例如「此電子郵件已被註冊」）。該 `Form.Item` 的輸入框邊框會變為紅色。
        - 提交按鈕的 `loading` 狀態應解除。

-   **401 Unauthorized (未授權)**
    - **場景**: Token 過期或無效，使用者需要重新登入。
    - **UI 呈現**:
        - 不應只顯示錯誤訊息。應攔截此響應，清除本地所有使用者狀態和 Token。
        - **強制重導**: 自動將頁面重導至 `/login` 登入頁。
        - 可以在重導後的登入頁 URL 中附加一個參數（如 `?session_expired=true`），以便在登入頁頂部顯示一個 `事件`提示：「您的登入已過期，請重新登入」。

-   **403 Forbidden (禁止訪問)**
    - **場景**: 使用者已登入，但其角色沒有權限執行某項操作或訪問某個頁面。
    - **UI 呈現**:
        - **操作級**: 如果是點擊某個按鈕（如「刪除」）觸發，則按鈕應立即恢復原狀，並彈出 `message.error("您沒有權限執行此操作")`。理想情況下，無權限的按鈕應該在一開始就被禁用或隱藏。
        - **頁面級**: 如果是訪問整個頁面，則不應顯示頁面內容，而是渲染一個 Ant Design `Result` 元件。
            - `status="403"`
            - `title="403"`
            - `subTitle="抱歉，您無權訪問此頁面。"`
            - `extra`: 提供一個藍色的「返回首頁」按鈕 (`<Button type="primary">`)。

-   **404 Not Found (未找到)**
    - **場景**: 訪問的資源 ID 不存在（例如 `.../resources/一個不存在的ID`），或訪問了一個無效的路由。
    - **UI 呈現**:
        - 渲染一個 Ant Design `Result` 元件。
            - `status="404"`
            - `title="404"`
            - `subTitle="抱歉，您訪問的頁面不存在。"`
            - `extra`: 提供一個藍色的「返回首頁」按鈕。

-   **409 Conflict (衝突)**
    - **場景**: 操作因狀態衝突而無法完成（例如，刪除一個仍有關聯資源的群組）。
    - **UI 呈現**:
        - 使用 Ant Design `Modal.confirm()` 或 `Modal.warning()` 彈出一個對話框，清楚地向使用者解釋衝突原因和解決步驟。
        - `title`: "操作無法完成"
        - `content`: "無法刪除此群組，因為它仍包含 X 個資源。請先將資源移轉至其他群組。"
        - `okText`: "我知道了" (通常只有一個確認按鈕)
        - `cancelButtonProps`: `{ style: { display: 'none' } }`

-   **429 Too Many Requests (請求過於頻繁)**
    - **場景**: 在短時間內發送過多請求，觸發後端速率限制。
    - **UI 呈現**: 彈出 `message.warning("請求過於頻繁，請稍後再試")`，並在技術上實現客戶端的請求退避機制。

-   **500 Internal Server Error (伺服器內部錯誤)**
    - **場景**: 後端發生了非預期的錯誤。
    - **UI 呈現**:
        - **頁面級**: 如果是頁面載入時發生，應渲染 `Result` 元件。
            - `status="500"`
            - `title="500"`
            - `subTitle="抱歉，伺服器發生錯誤，請稍後再試。"`
            - `extra`: 提供一個「重試」按鈕，點擊後重新觸發頁面數據的 API 請求。
        - **操作級**: 如果是某個按鈕操作觸發，則彈出 `message.error("系統發生錯誤，請稍後再試")`。

### **2.11. 錯誤碼語意與前端文案對照**

以下為 ErrorResponse.error 常見值、對應 HTTP 狀態與建議前端文案（可作為 i18n key 與預設文案基礎）。

- BAD_REQUEST（400）
  - i18n key：errors.badRequest
  - 建議文案：請檢查輸入內容
  - 使用時機：欄位驗證失敗、缺少必要參數
- UNAUTHORIZED（401）
  - i18n key：errors.unauthorized
  - 建議文案：請重新登入
  - 使用時機：Token 過期/無效、尚未登入
- FORBIDDEN（403）
  - i18n key：errors.forbidden
  - 建議文案：您沒有權限執行此操作
  - 使用時機：角色或範圍不足（需 super_admin / team_manager）
- NOT_FOUND（404）
  - i18n key：errors.notFound
  - 建議文案：找不到資源或已被移除
  - 使用時機：ID 不存在、路由錯誤
- CONFLICT（409）
  - i18n key：errors.conflict
  - 建議文案：操作衝突，請先處理關聯項目
  - 使用時機：刪除使用者前需移轉任務、重名衝突
- RATE_LIMITED（429）
  - i18n key：errors.rateLimited
  - 建議文案：請稍後再試（請求過於頻繁）
  - 使用時機：後端節流/速率限制（如需採用，請於 API 補 429）
- INTERNAL_ERROR（500）
  - i18n key：errors.internal
  - 建議文案：系統發生錯誤，請稍後再試
  - 使用時機：非預期伺服器錯誤

### **2.12. i18n key 建議結構**
- errors.badRequest / errors.unauthorized / errors.forbidden / errors.notFound / errors.conflict / errors.rateLimited / errors.internal
- 可擴充：errors.field.required、errors.field.format、errors.network、errors.timeout

### **2.13. 與後端對齊建議**
- 後端統一 ErrorResponse.error 值；前端以 mapping 渲染文案與操作建議（重試/回首頁/檢視說明）。

### **2.14. Mock（MSW）開發指南**
- 目錄：`src/mocks/`
- 內容：
  - `src/mocks/data/*.json`：各域假資料
  - `src/mocks/handlers.ts`：Mock 路由清單
  - `src/mocks/browser.ts` / `src/mocks/server.ts`：瀏覽器/Node 啟動
- 啟用方式：
  - 前端入口（main.tsx）在開發模式動態匯入 `src/mocks/browser` 後 `worker.start()`；在測試環境匯入 `src/mocks/server`。
- 原則：
  - 偽資料與 openapi.yaml 的 examples 對齊；遇缺未支援的端點可先回傳空集合或最小結構。

### **2.15. 全局 UX 細節補充**
- **空狀態（Empty States）**
  - 結構：圖示 + 標題 + 次標 + 主操作（如「建立第一個資源」）。
  - 行為：首次進入功能且資料為空時顯示；過濾器導致為空時顯示「清除過濾條件」輔助操作。
- **載入骨架（Skeleton vs Spin）**
  - 優先 Skeleton 呈現版面（列表、卡片、表單）；Spin 用於區塊覆蓋或短暫等待（<600ms）。
  - 多區塊並行載入時，逐塊完成即解除骨架，避免整頁閃爍。
- **錯誤文案（Microcopy）**
  - 來自 i18n key（errors.*）；描述具體解法（如檢查欄位、重試、回首頁）。
  - 批次操作以逐項結果顯示（BatchOperationResult），提供「重試失敗項目」按鈕。
- **權限 Gating**
  - 無權限操作的入口預設隱藏；必要時以 disabled 並附 Tooltip 說明。
  - 命中 403：操作級以 message.error 呈現；頁面級顯示 Result 403 並提供返回 CTA。
- **即時更新（SSE/WS）**
  - SSE 自動重連：指數退避（初始 1s，上限 30s）；顯示輕量 Banner 狀態（連線中/已離線）。
  - 透過 Last-Event-Id 續傳；使用事件類型分頻道（alerts, incidents, automation, notifications）。
  - WS 僅在需要雙向互動時採用，否則以 SSE 為主。

---

## **3. 全局佈局與導航 (Global Layout & Navigation)**

### **3.1. 功能目標**
建立一個一致性的應用框架，包含頂部導航、側邊選單和主內容區，為所有功能頁面提供統一的導航體驗。

### **3.2. 功能規格**
- **頂部 Header**:
    - **左側**: SRE 平台 Logo 和應用名稱。
    - **右側**:
        - **全局搜索框**: 支援 `Ctrl+K` 快捷鍵，能夠跨越多種資源類型進行搜尋。
        - **通知中心**: 鈴鐺圖標，圖標上的紅點 (`Badge`) 應顯示未讀通知數量。點擊後彈出通知列表。
        - **用戶選單**: 包含「個人設置」、「登出」等選項。
- **側邊導航 (Sidebar)**:
    - **可收合**: 提供按鈕進行側邊導航的收縮和展開。
    - **選單項**: 
      - 儀表板
      - 資源
        - 資源列表
        - 資源群組
      - 事件
        - 事件列表
        - 事件規則
        - 靜音規則
      - 分析
        - 容量規劃
      - 自動化
        - 腳本庫
        - 排程管理
        - 執行日誌
      - 管理
        - 團隊管理
        - 角色管理
        - 通知管道
        - 系統設定
        - 平台診斷
        - 審計日誌

#### **3.3. 視覺設計**

* **核心風格**: 整體採用 Ant Design 的經典專業後台佈局，確保資訊架構的清晰與操作的一致性。
* **設計重點**:
  * **側邊導航欄 (Sidebar Navigation)**: 固定在左側，提供主要功能模組的入口。選中狀態清晰可辨，方便用戶快速切換。使用圖標配合文字，提升辨識度。
  * **頂部導航欄 (Top Navigation Bar)**: 包含平台Logo、搜索框、通知、用戶頭像/選單等常用功能。搜索框設計突出，便於用戶快速查找信息。
  * **內容區域 (Content Area)**: 佔據主要部分，根據不同功能模組顯示相應的內容。保持整體佈局簡潔，留有足夠的留白。
  * **響應式設計 (Responsive Design)**: 考慮到不同設備的適配性，確保在不同屏幕尺寸下也能提供良好的用戶體驗（例如，在小屏幕上側邊導航可收起或轉換為頂部漢堡選單）。
  * **品牌色與輔助色 (Brand & Accent Colors)**: 運用品牌主色調（如藍色）點綴導航選中狀態、按鈕等，提升品牌統一性。輔助色用於提示、警告等信息。
* **頁面說明**:  
  * **[通知中心]**: 此圖展示了點擊頂部 Header 右側鈴鐺圖標後彈出的 Popover。Popover 內部分為頂部的標題「通知中心」和下方的滾動列表。每條通知包含一個代表狀態的圖標、通知標題和時間戳。未讀通知會有藍點提示，整體風格緊湊且資訊清晰。

### **3.4. 開發規格**
- **核心元件**: `MainLayout.tsx`, `Header.tsx`, `Sidebar.tsx`
- **API 端點**:
    - `GET /api/v1/search`: 用於全局搜尋（結果）。
    - `GET /api/v1/autocomplete`: 用於全局搜尋的即時建議（支援 type=all）。
    - `GET /api/v1/notifications/summary`: 用於獲取未讀通知數。
    - `GET /api/v1/notifications`: 用於獲取通知列表。
- **驗收條件**:
    - [ ] 頁面佈局在各種螢幕尺寸下保持穩定。
    - [ ] 側邊欄選單能正確導航至對應頁面，並高亮顯示當前頁面。
    - [ ] 通知中心的未讀數量能正確顯示。

### **3.5. 通知中心功能閉環設計**

#### **3.5.1. 功能完整性**
通知中心形成了完整的用戶體驗閉環：
```
觸發 → 顯示 → 操作 → 反饋 → 跳轉
```

#### **3.5.2. 具體閉環流程**

**觸發環節**：
- 用戶點擊頂部鈴鐺圖標
- 系統顯示 Popover 通知列表

**顯示環節**：
- 展示最近通知（帶未讀標記）
- 顯示未讀計數 Badge

**操作環節**：
- 單擊通知項目可跳轉到相關頁面
- 「全部標為已讀」按鈕
- 「查看所有」連結（導向完整通知歷史）

**反饋環節**：
- 未讀計數實時更新
- 操作結果即時反映

**跳轉環節**：
- 點擊通知項目跳轉到對應資源頁面
- 「查看所有」可進入完整通知管理頁面

#### **3.5.3. API 端點支持**
```bash
GET /api/v1/notifications/summary  # 獲取未讀計數
GET /api/v1/notifications          # 獲取通知列表
```

#### **3.5.4. 用戶體驗閉環**
- **即時性**：隨時查看最新通知
- **完整性**：提供完整歷史訪問入口
- **操作性**：支持批量操作和單項處理
- **反饋性**：操作結果即時可見

### **3.6. 全局搜索 (Global Search)**

#### **3.6.1. 功能目標**
提供一個快速、跨模組的搜索入口，讓使用者可以透過關鍵字迅速定位到平台內的任何資源、腳本或事件。

#### **3.6.2. 功能規格**
- **觸發**:
    - 點擊頂部 Header 的搜索框。
    - 使用快捷鍵 `Ctrl+K` (macOS 上為 `Cmd+K`)。
- **互動**:
    - 觸發後，螢幕中央彈出一個 `Modal` 或類似 Spotlight 的搜索框。
    - 輸入關鍵字時，即時調用 `autocomplete` API 顯示建議。
    - 按下 Enter 或點擊搜索按鈕後，調用 `search` API 展示完整結果。
- **結果展示**: 搜索結果應按資源類型分組（例如：資源、事件、自動化腳本）。

#### **3.6.3. 視覺設計**
* **核心風格**: 快速、聚焦、高效。靈感來源於 VS Code 的命令面板或 macOS 的 Spotlight 搜尋。
* **視覺設計描述**:
    - **觸發器**: Header 中的搜索框，或鍵盤快捷鍵。
    - **搜索模態框 (Modal)**:
        - 觸發後，螢幕中央彈出一個無邊框、帶有柔和陰影的 `Modal`。背景會被半透明的遮罩覆蓋，讓使用者的焦點完全集中在搜索上。
        - **頂部**: 一個大的、無邊框的 `Input` 輸入框，帶有搜索圖標。
        - **結果列表**: 輸入框下方是滾動的結果列表。
            - **分組**: 結果使用 Ant Design `List` 顯示，並帶有分組標題 (例如 `Divider` 標示的「資源」、「事件」)。
            - **列表項**: 每個結果項都包含：
                - **圖標**: 代表資源類型的圖標。
                - **標題**: 資源名稱，其中與關鍵字匹配的部分會**高亮**顯示。
                - **描述**: 簡短的描述或路徑，例如資源的 IP 地址或事件的狀態。
            - **互動**: 可以使用鍵盤上下鍵導航，Enter 鍵或滑鼠點擊可跳轉到對應的詳情頁。
* **設計重點**：快速、聚焦、高效。靈感來源於 VS Code 的命令面板或 macOS 的 Spotlight 搜尋。
  * **全局搜索模態框**: 點擊頂部 Header 的搜尋框或按下 `Ctrl+K` 後，螢幕中央彈出一個簡潔的 Modal。Modal 頂部是一個大的搜尋輸入框，旁邊提示快捷鍵「Cmd+K」。下方是按類型分組的搜尋結果列表。
  * **結果分組**: 搜尋結果分為「資源」、「事件」、「自動化腳本」等區塊，每個區塊由一個分隔線和標題隔開。
  * **列表項**: 每條結果都包含一個代表類型的圖標、標題（與關鍵字匹配的部分高亮顯示）和簡要描述（如資源 IP 或事件狀態）。列表底部有鍵盤導航提示。

#### **3.6.4. 開發規格**
- **核心元件**: `GlobalSearch.tsx`, `SearchModal.tsx`
- **API 端點**:
    - `GET /api/v1/autocomplete`: 用於即時搜尋建議。
    - `GET /api/v1/search`: 用於獲取完整的搜尋結果。
- **驗收條件**:
    - [ ] 能通過點擊搜索框或快捷鍵觸發搜索
    - [ ] 輸入關鍵字時能顯示自動完成建議
    - [ ] 搜索結果能按類型分組顯示
    - [ ] 能通過鍵盤或鼠標選擇搜索結果並跳轉

### **3.7. 通知中心 (Notification Center)**

#### **3.7.1. 功能目標**
在不離開當前頁面的情況下，提供一個快速查閱、管理個人通知的入口。

#### **3.7.2. 功能規格**
- **觸發**: 點擊頂部 Header 右側的鈴鐺圖標 (`BellOutlined`)。
- **未讀計數**: 鈴鐺圖標上應有 Ant Design `Badge` 元件，顯示未讀通知總數 (`unread_count`)。
- **列表展示**: 彈出一個 `Popover` 或 `Dropdown`，內部使用 `List` 元件展示最近的通知。
- **操作**:
    - 點擊單則通知可跳轉至相關頁面（如事件詳情）。
    - 提供「全部標為已讀」按鈕。
    - 提供「查看所有通知」的連結，導向獨立的通知歷史頁面。

#### **3.7.3. 視覺設計**
* **核心風格**: 輕量、快速、不打擾。設計目標是讓使用者能迅速掃描最新動態，並決定是否需要進一步操作。
* **視覺設計描述**:
    - **觸發器**: 頂部 Header 右側的鈴鐺圖標。當 `unread_count` > 0 時，圖標右上角會顯示一個紅色的 `Badge`。
    - **彈出層 (Popover)**:
        - 點擊鈴鐺後，下方會彈出一個固定寬度的 Popover。
        - **頂部**: 標題為「通知中心」，右側有一個「全部標為已讀」的文字按鈕。
        - **中間 (列表)**: 使用 Ant Design `List` 元件，每則通知 (`List.Item`) 包含：
            - **左側**: 一個代表通知類型的圖標 (例如：`error` 用紅色 `ExclamationCircleOutlined`，`system` 用藍色 `InfoCircleOutlined`)。
            - **中間**: 通知標題和摘要訊息。未讀通知的標題會**加粗**顯示。
            - **右側**: 顯示通知的相對時間（例如「5 分鐘前」）。
        - **底部**: 一個置中的「查看所有通知」連結，點擊後跳轉到完整的通知歷史頁面。
* **設計重點**：輕量、快速、不打擾。設計目標是讓使用者能迅速掃描最新動態，並決定是否需要進一步操作。
  * **通知中心 Popover**: 此圖展示了點擊頂部 Header 右側鈴鐺圖標後彈出的 Popover。Popover 內部分為頂部的標題「通知中心」和下方的滾動列表。每條通知包含一個代表狀態的圖標（例如，紅色感嘆號表示錯誤，藍色資訊圖標表示普通通知）、通知標題（未讀會加粗）和時間戳（如「5分鐘前」）。未讀通知會有一顆藍點提示。底部有一個「全部標為已讀」按鈕和「查看所有通知」的連結。整體風格緊湊且資訊清晰。

#### **3.7.4. 開發規格**
- **核心元件**: `NotificationCenter.tsx` (在 `Header.tsx` 中使用)
- **API 端點**:
    - `GET /api/v1/notifications`: 獲取通知列表。
    - `GET /api/v1/notifications/summary`: 獲取 `unread_count`。
    - `GET /api/v1/notifications?page_size=5`: 獲取最近 5 則通知。
    - `POST /api/v1/notifications/mark-all-as-read`: 標記全部已讀。
    - `PUT /api/v1/notifications/{notificationId}/mark-as-read`: 標記單個通知為已讀。
- **驗收條件**:
    - [ ] 鈴鐺圖標能正確顯示未讀數量
    - [ ] 點擊鈴鐺能彈出通知列表
    - [ ] 未讀通知在列表中能正確加粗顯示
    - [ ] 能成功標記所有通知為已讀
    - [ ] 能跳轉到通知詳情頁面

---

## **4. 登入與登出 (Login & Logout)**

### **4.1. 登入頁面 (Login Page)**

#### **4.1.1. 功能目標**
作為系統入口，提供統一的身份驗證界面。

#### **4.1.2. 功能規格**
* **用戶輸入**: 用戶名/郵箱輸入框、密碼輸入框  
* **操作按鈕**: 登入按鈕  
* **其他功能**: 忘記密碼連結、註冊帳號連結（如適用）  
* **安全性**: 密碼輸入框應隱藏輸入內容，支持回車鍵提交

#### **4.1.3. 視覺設計**
* **核心風格**: 提供一個置中的登入表單，背景通常為簡潔的深色或帶有科技感的漸層，旨在營造專業且安全的氛圍。  
* **頁面說明**:  
  * **[登入頁面]**: 畫面中央是一個清晰的白色表單框，包含 SRE 平台 Logo、標題「登入您的帳號」、用戶名/郵箱輸入框、密碼輸入框，以及一個藍色的「登入」主操作按鈕。表單下方提供「忘記密碼」等次要連結。整體佈局對稱且焦點集中，引導使用者快速完成登入操作。

#### **4.1.4. 開發規格**
* **核心元件**: LoginPage, LoginForm  
* **認證模式**:  
  * **正式（Option A - OIDC/Keycloak）**：點擊登入 → 導向 IdP（Keycloak） → 回跳攜帶 code → 交換 Token（由 BFF 或前端 + 控制平面完成）→ 設定 bearer token。無 `/api/v1/auth/login` API。  
  * **開發（Option B - 本地帳密）**：呼叫 `POST /api/v1/auth/login`，取得 `access_token`、`refresh_token`、`expires_in`。  
* **API 端點（開發模式）**: `POST /api/v1/auth/login`  
* **狀態管理**: 登入表單狀態為本地狀態；成功後儲存 access token（記憶體 + sessionStorage）並跳轉至儀表板；啟用自動刷新。  
* **驗收條件**:  
  * [ ] 正確顯示登入表單  
  * [ ] 輸入驗證（用戶名和密碼必填）  
  * [ ]（開發）正確呼叫登入 API 並儲存 Token  
  * [ ]（正式）可透過 OIDC 流程成功回跳並設置 Token  
  * [ ] 登入成功後跳轉至儀表板  
  * [ ] 登入失敗時顯示錯誤訊息

### **4.2. 登出功能 (Logout Functionality)**

#### **4.2.1. 功能目標**
提供安全的用戶登出機制，清除用戶會話並返回登入頁面。

#### **4.2.2. 功能規格**
* **登出觸發**: 通過點擊頂部導航欄中的用戶選單並選擇「登出」選項來觸發登出操作  
* **確認機制**: 點擊登出後，顯示確認對話框以防止誤操作  
* **會話清除**: 清除用戶的認證令牌和本地存儲的用戶相關數據  
* **頁面跳轉**: 登出成功後自動跳轉到登入頁面  
* **安全性**: 確保登出後無法通過瀏覽器的返回按鈕訪問受保護的頁面

#### **4.2.3. 視覺設計**
* **核心風格**: 提供一個置中的登入表單，背景通常為簡潔的深色或帶有科技感的漸層，旨在營造專業且安全的氛圍。
* **設計重點**:
  * **簡潔聚焦 (Clean and Focused)**: 登入頁面設計應極簡，將用戶注意力引導至輸入框。背景可選用平台品牌元素或簡潔圖案，但避免過於複雜。
  * **直觀的表單 (Intuitive Form)**: 用戶名/郵箱和密碼輸入框應清晰標識。提供「忘記密碼」和可選的「記住我」功能。
  * **錯誤提示 (Error Messages)**: 錯誤信息（如密碼錯誤）應即時、明確地顯示在輸入框下方或旁邊，避免混淆。
  * **安全性考量 (Security Considerations)**: 考慮提供多因素認證 (MFA) 的入口或提示。
  * **登出確認 (Logout Confirmation)**: 登出時可提供一個簡單的確認彈窗，防止誤操作，並引導回登入頁面。
* **頁面說明**:
  * **[登入頁面]**: 畫面中央是一個清晰的白色表單框，包含 SRE 平台 Logo、標題「登入您的帳號」、用戶名/郵箱輸入框、密碼輸入框，以及一個藍色的「登入」主操作按鈕。表單下方提供「忘記密碼」等次要連結。整體佈局對稱且焦點集中，引導使用者快速完成登入操作。
  * **[登出頁面]**: 畫面中央是一個清晰的白色表單框，包含 SRE 平台 Logo、標題「登出您的帳號」、確認登出按鈕。整體佈局對稱且焦點集中，引導使用者快速完成登出操作。
  
#### **4.2.4. 開發規格**
* **核心元件**: LogoutHandler, LogoutConfirmationModal  
* **認證模式**:  
  * **正式（Option A - OIDC/Keycloak）**：導向 IdP end-session（或後端登出端點）以註銷會話，回跳登入頁。  
  * **開發（Option B - 本地帳密）**：呼叫 `POST /api/v1/auth/logout`，同時清除本地 Token。  
* **API 端點（開發模式）**: `POST /api/v1/auth/logout`  
* **狀態管理**: 登出成功後清除所有用戶資料、RTK Query 快取、路由守衛狀態。  
* **驗收條件**:  
  * [ ] 點擊用戶選單中的登出選項應顯示確認對話框  
  * [ ]（開發）確認登出後應正確呼叫登出 API 並清除 Token  
  * [ ]（正式）成功導向 OIDC end-session 並回跳登入頁  
  * [ ] 登出成功後應清除所有用戶數據  
  * [ ] 登出成功後應跳轉到登入頁面  
  * [ ] 登出後無法通過瀏覽器返回按鈕訪問受保護頁面

### **4.3. Token 刷新與路由保護**
* **自動刷新**：在 Token 將過期（例如剩餘 < 2 分鐘）時，於背景呼叫 `POST /api/v1/auth/refresh`（開發模式）以換取新 Token。  
* **401 攔截**：若 API 回傳 401，先嘗試刷新；仍失敗則導向登入。  
* **路由守衛**：受保護頁面需檢查有效 Token；無效則跳轉登入。  

### **4.4. 環境切換（正式 vs 開發）**
* **設定來源**：以環境變數或設定檔控制（如 `VITE_AUTH_MODE=oidc|local`、`VITE_OIDC_ISSUER`、`VITE_CLIENT_ID`、`VITE_REDIRECT_URI`）。  
* **行為**：  
  * `oidc`：啟用 OIDC 重導流程；不呼叫本地 `/auth/*`。  
  * `local`：使用 `/api/v1/auth/login|refresh|logout`。  

### **4.5. 錯誤處理與 UX**
* **表單錯誤**：必填與格式校驗、API 返回 400/401 的提示。  
* **全局錯誤**：通用錯誤提示（如網路中斷、500）。  

### **4.6. 安全建議**
* 儘量將 `access_token` 放於記憶體；如需持久化，使用 sessionStorage 並設定最小可用範圍。  
* 刷新 Token 使用安全通道（HTTPS），避免在 URL 或 Log 中暴露。  
* 登出後清除所有敏感資訊與快取。

---

## **5. 儀表板 (Dashboard)**

### **5.1. 功能目標**
作為系統首頁，提供一個高層次的視圖，讓使用者能快速掌握系統的整體健康狀況與關鍵指標。

### **5.2. 功能規格**
儀表板以視覺化的圖表和卡片，彙整了系統當前最重要的狀態摘要。主要包含：

* **狀態趨勢卡片**: 顯示「新事件」、「處理中」、「今日已解決」的數量，並與昨日數據比較呈現趨勢。  
* **關鍵績效指標 (KPI)**: 包含「資源妥善率」、「總資源數」等核心指標。  
* **圖表區**: 「資源群組狀態總覽」長條圖與「資源狀態分佈」圓餅圖。  
* **增補功能**:  
  * 趨勢指標加入迷你圖 (Sparkline)。  
  * 允許使用者自訂卡片排列。

### **5.3. 視覺設計**
* **核心風格**: 
  * 強調**一覽性**和**關鍵資訊快速獲取**。  
  * 採用 Ant Design Grid 和 Card 形成卡片式佈局。  
  * 使用不同顏色區分卡片狀態，提升視覺衝擊力。   
* **設計重點**:
  * **概覽性信息 (Overview Information)**: 頂部展示關鍵指標（KPIs），如新事件、進行中事件、已解決事件等，用大數字和趨勢箭頭清晰呈現。
  * **模塊化設計 (Modular Design)**: 將不同類型的數據（如事件狀態、資源組狀態、資源分佈）劃分為獨立的卡片或面板，方便用戶快速掃描。
  * **圖表可視化 (Chart Visualization)**: 使用柱狀圖、餅圖等直觀的圖表展示數據分佈和趨勢，如「資源組狀態概覽」和「資源狀態分佈」。
  * **顏色標識 (Color Coding)**: 運用不同顏色來區分數據狀態（如健康-綠、警告-黃、異常-紅），提高信息辨識度。
  * **可自定義性 (Customizability - Optional)**: 未來可考慮允許用戶自定義儀表板模塊的佈局和顯示內容。
  * **數據更新提示 (Data Refresh Indication)**: 考慮在關鍵數據旁添加最後更新時間或刷新按鈕。
* **頁面說明**:  
  * **[儀表板]**: 畫面由多個卡片組成。頂部是三張並排的 KPI 狀態趨勢卡片（例如：「新事件」、「處理中」、「今日已解決」），使用 Statistic 元件突顯核心數字，並附有與昨日比較的趨勢百分比。下方左側是「資源群組狀態總覽」的長條圖，右側是「資源狀態分佈」的圓餅圖，兩者都使用了 ECharts 進行數據可視化，色彩清晰，圖例明確。

### **5.4. 開發規格**
* **核心元件**: DashboardPage, SummaryCard, KpiCard, ResourceStatusChart, StatusDistributionChart  
* **API 端點**: GET /api/v1/dashboard/summary, GET /api/v1/dashboard/trends, GET /api/v1/dashboard/resource-distribution  
* **狀態管理**: 頁面載入和錯誤狀態由 RTK Query 管理，API 數據由 RTK Query 快取。  
* **驗收條件**:  
  * [ ] 正確呼叫所有 dashboard API。  
  * [ ] 正確渲染所有統計卡片和圖表。  
  * [ ] API 呼叫失敗時顯示錯誤提示。

---

## **6. 資源管理 (Resource Management)**

### **6.1. 功能目標**
提供對所有監控資源的集中管理、探索與高效的批次操作能力，並能快速追溯資源的相關事件與歷史指標。

### **6.2. 功能規格**
- **資源列表**:
    - 應提供基於狀態、類型、群組和關鍵字的篩選功能。
    - 支援複選框 (Checkbox) 進行多選。
    - 當勾選資源後，頁面頂部應動態出現「批次操作欄」，提供批次刪除、加入群組等操作。
- **資源詳情**:
    - 點擊任一資源應能進入其詳情頁面。
    - 詳情頁建議使用由上到下的垂直佈局，區分以下內容：
        - **基本資訊**: 展示資源的詳細屬性。此處應包含一個**關聯靜音規則**的區塊，用以顯示當前所有套用至此資源的靜音規則列表。此數據來自 `GET /api/v1/resources/{resourceId}` API 響應中的 `silences` 陣列。
        - **歷史指標**: 繪製 CPU、記憶體等關鍵指標在過去一段時間的趨勢圖。
        - **關聯事件**: 展示與該資源相關的事件歷史列表。
- **資源探索**:
    - 提供「掃描網段」功能，非同步探索網路中的未知資源。

### **6.3. 視覺設計**
* **核心風格**: 強調列表的**高效篩選**與**批次操作**，是典型的數據驅動管理界面。
* **設計重點**:
  * **列表視圖 (List View)**: 主要採用表格形式展示資源列表，包含名稱、IP地址、標籤、所屬群組、操作等關鍵信息。
  * **搜索與過濾 (Search & Filter)**: 提供頂部搜索框和篩選器，方便用戶快速定位和篩選資源。標籤（如「運行中」、「維護中」）可用不同顏色或樣式區分，提升可讀性。
  * **批量操作 (Batch Operations)**: 支持多選資源進行批量操作（如批量啟動、停止、刪除）。
  * **單個資源詳情 (Single 資源 Details)**: 點擊資源名稱或操作按鈕可導航到其詳細信息頁面，展示更細粒度的數據和操作選項。
  * **分頁控制 (Pagination)**: 當資源數量較多時，提供分頁功能，改善加載速度和用戶體驗。
  * **「添加資源」按鈕 (Add 資源 Button)**: 明確的按鈕用於創建新資源。
* **頁面說明**:  
  * **[資源管理主頁]**: 頁面頂部是操作區，包含一個搜尋框、藍色的「新增資源」按鈕和「掃描網路」按鈕。下方是 Ant Design Table，展示了資源列表。表格的欄位包含資源名稱、IP、狀態（使用不同顏色的 Tag 標示）等。每行末尾都有「編輯」、「刪除」等文字按鈕連結。  
  * **[資源批次操作]**: 此圖展示了當使用者在表格中勾選了多個項目後的介面變化。表格頂部會**動態浮現**一個操作列，明確顯示「已選 X 項」，並提供「批次刪除」、「批次加入群組」等 Button。這個互動設計極大地提升了批次管理的效率。

### **6.4. 開發規格**
- **核心元件**: `ResourcesPage.tsx`, `ResourceTable.tsx`, `ResourceDetailPage.tsx`, `MetricsChart.tsx`, `AssociatedIncidentsTable.tsx`, `ScanNetworkModal.tsx`
- **API 端點**:
    - `GET /api/v1/resources`: 獲取資源列表。
    - `POST /api/v1/resources`: 新增資源。
    - `GET /api/v1/resources/{resourceId}`: 獲取資源詳情。
    - `GET /api/v1/resources/{resourceId}/metrics`: 獲取歷史指標數據，用於繪製圖表（支援 `period` 或 `start_time`/`end_time` 參數）。
    - `GET /api/v1/resources/{resourceId}/incidents`: 獲取資源相關事件列表。
    - `POST /api/v1/resources/batch`: 批次操作資源（如批次更新、批次刪除）。
    - `POST /api/v1/resources/scan`: 啟動網路資源掃描任務。
    - `GET /api/v1/resources/scan/{taskId}`: 查詢掃描任務的狀態和結果。
- **驗收條件**:
    - [ ] 資源列表能正確篩選和分頁。
    - [ ] 批次操作功能運作正常。
    - [ ] 資源詳情頁的三個頁籤（基本資訊、歷史指標、關聯事件）都能正確載入並顯示數據。

---

## **7. 資源群組 (Resource Groups)**

### **7.1. 功能目標**
管理資源的分群，支援階層（可選），並提供群組層級的狀態摘要與成員管理。

### **7.2. 功能規格**
- 列表：顯示名稱、描述、成員數、狀態摘要（healthy/warning/critical）。
- CRUD：建立/編輯/刪除群組。
- 成員管理：以 Transfer 或多選 Select（支援搜尋）新增/移除資源。
- 過濾/排序/分頁：支援後端分頁、sort_by/sort_order。

### **7.3. 視覺設計**
- 標準表格頁，詳情頁可顯示狀態摘要卡片與最近相關事件。
* **設計重點**：強調對資源進行邏輯分組的能力，界面簡潔而功能強大，方便使用者管理群組及其成員。與其他列表管理頁面保持視覺和操作上的一致性。
  * **資源群組列表**: 頁面頂部是搜尋框和「新增群組」按鈕。主體是一個 Ant Design Table，列出所有資源群組。表格欄位包括「群組名稱」、「描述」、「成員數量」、「狀態摘要」（使用不同顏色的 Tag 顯示 `Healthy` / `Warning` / `Critical` 狀態，快速識別群組健康度），以及操作列（編輯、刪除、管理成員）。
  * **新增/編輯群組彈窗**: 點擊「新增群組」或編輯按鈕後彈出 Modal。Modal 內部是 Form，包含「群組名稱」、「描述」等基本資訊。核心互動是「群組成員」選擇器，這裡建議使用 Ant Design 的 `Transfer` (穿梭框) 或支援搜尋的 `Select.Multiple`，讓使用者可以從所有可用資源中，以拖曳、勾選或搜尋的方式，方便地將資源加入或移出群組。

### **7.4. 開發規格**
- 核心元件：`ResourceGroupsPage.tsx`, `ResourceGroupFormModal.tsx`, `GroupMembersModal.tsx`
- API 端點：
  - `GET /api/v1/resources/groups`: 獲取資源群組列表。
  - `POST /api/v1/resources/groups`: 創建新資源群組。
  - `GET /api/v1/resources/groups/{groupId}`: 獲取資源群組詳情。
  - `PUT /api/v1/resources/groups/{groupId}`: 更新資源群組資訊。
  - `DELETE /api/v1/resources/groups/{groupId}`: 刪除資源群組。
  - `POST /api/v1/resources/groups/{groupId}/members`: 管理群組成員（新增或移除資源）。
  - `GET /api/v1/resources?group_id={groupId}`: 獲取群組內的資源列表。
- 權限：`team_manager` 或 `super_admin` 可寫入與成員維護。
- 驗收條件：
  - [ ] 能新增/編輯/刪除群組並即時更新列表。
  - [ ] 成員管理支援搜尋與批次加入/移除。
  - [ ] 列表支援分頁與排序。

---

## **8. 事件列表 (Incidents)**

### **8.1. 功能目標**
提供一個高效的事件處理中心，支援快速篩選、批次處理、關聯分析和自動化追蹤。

### **8.2. 功能規格**
- **列表與篩選**: 提供基於時間、等級、狀態和**資源**的進階篩選功能。
- **批次處理**: 使用者在勾選多筆事件後，可執行「批次確認」和「批次解決」操作。
- **事件詳情**:
    - 彈出視窗中應包含一個「關聯事件」頁籤，用於展示與當前事件相關的其他事件。
    - 如果此事件觸發了自動化腳本，應在詳情中清晰展示**自動化執行紀錄的 ID**，並提供連結跳轉至該紀錄的詳情。

### **8.3. 視覺設計**
* **核心風格**: 為高壓力的事件處理場景設計，強調**資訊的快速過濾**與**上下文的清晰呈現**。  
* **頁面說明**:  
  * **[事件列表主頁]**: 頁面頂部是一個功能強大的篩選區，包含時間範圍選擇器 (DatePicker.RangePicker)、事件等級 (Select) 和處理狀態 (Select) 等多個篩選條件。下方是事件列表 Table，其中「事件等級」和「處理狀態」欄位使用了**不同顏色的 Tag** (例如：Critical 為紅色，Resolved 為綠色) 來高亮顯示，讓維運人員能迅速定位重要事件。
  * **[事件詳情彈窗]**: 點擊單筆紀錄後，彈出的 Modal 內部採用了 Tabs 佈局。  
    * **「詳情」頁籤**：展示事件的所有元數據。  
    * **「處理歷史」頁籤**：顯示確認、解決、指派等操作的歷史紀錄。  
    * **「關聯事件」頁籤**：顯示透過 API 獲取的、與此事件相關的其他事件列表。  
    * 「自動化」頁籤：如果此事件觸發了自動化腳本，這裡會顯示一個或多個可點擊的執行紀錄 ID。  
      這種分頁設計使得大量資訊被清晰地組織起來，避免了介面混亂。  
  * **[AI 輔助報告]**: 當使用者勾選多筆事件並點擊「生成事件報告」後，會彈出一個專門的 Modal。Modal 內以結構化的格式（如標題、摘要、可能原因、建議方案）清晰地展示 AI 生成的報告內容，並提供一鍵複製功能。
* **設計重點**：
  * **事件列表 (事件 List)**：以表格形式展示所有事件，包含事件ID、標題、狀態、嚴重程度、受影響資源、觸發時間、解決時間等。
  * **狀態標識 (Status Indicators)**：使用不同顏色或圖標來明確標識事件的狀態（如「新事件」、「處理中」、「已解決」、「關閉」）和嚴重程度（如「高」、「中」、「低」）。
  * **搜索與篩選 (Search & Filter)**：提供強大的搜索和篩選功能，按狀態、嚴重程度、時間範圍、受影響資源等進行過濾。
  * **事件詳情頁 (事件 Details Page)**：點擊事件後進入詳細頁面，展示事件描述、歷史日誌、相關資源、處理人、評論等。
  * **操作按鈕 (Action Buttons)**：在事件列表或詳情頁提供處理事件的快速操作按鈕（如「分配給」、「更改狀態」、「添加評論」）。
  * **時間軸視圖 (Timeline View - Optional)**：在事件詳情中，以時間軸形式展示事件的處理進度、所有操作和評論，清晰呈現事件的生命週期。


### **8.4. 開發規格**
- **核心元件**: `IncidentsPage.tsx`, `IncidentsTable.tsx`, `IncidentDetailModal.tsx`
- **API 端點**:
    - `GET /api/v1/incidents`: 獲取事件列表（支援 `resource_id` 篩選）。
    - `POST /api/v1/incidents`: 創建新事件。
    - `GET /api/v1/incidents/{incidentId}`: 獲取事件詳情。
    - `PUT /api/v1/incidents/{incidentId}`: 更新事件資訊。
    - `POST /api/v1/incidents/{incidentId}/acknowledge`: 確認事件（標記為已處理）。
    - `POST /api/v1/incidents/{incidentId}/resolve`: 解決事件。
    - `POST /api/v1/incidents/{incidentId}/assign`: 指派事件給指定處理人。
    - `POST /api/v1/incidents/{incidentId}/comments`: 為事件添加評論。
    - `POST /api/v1/incidents/batch`: 執行批次處理（如批次確認、批次解決）。
    - `GET /api/v1/incidents/{incidentId}/correlated`: 獲取關聯事件。
    - `POST /api/v1/incidents/generate-report`: 生成事件分析報告。
- **權限**:
    - 根據 `openapi.yaml` 定義，`team_member`, `team_manager`, `super_admin` 角色可創建事件。
    - 一般登入使用者可檢視與操作自己有權限的事件（依後端授權判斷）。
    - 無權限的操作入口應隱藏或禁用，嘗試操作時以 403 規範回饋。
- **驗收條件**:
    - [ ] 能夠成功對多個事件進行批次確認。
    - [ ] 在事件詳情中，能成功載入並顯示「關聯事件」列表。
    - [ ] 在事件詳情中，能清晰看到其觸發的「自動化執行紀錄」連結。
    - [ ] 無權限操作會有一致的權限不足 UI 提示。

### **8.5. 事件嚴重度與優先級說明**
為統一平台內部的事件定義，`Incident` 物件同時包含語意化的嚴重等級 (`severity`) 和優先級 (`priority`)。
- **嚴重等級 (`severity`)**: 用於 UI 顯示和分類，分為 `critical`, `error`, `warning`, `info`。
- **優先級 (`priority`)**: 用於告警路由和處理，分為 `P0`, `P1`, `P2`, `P3`。
建議前端根據 `severity` 來決定顏色和圖標，兩者對應關係由後端決定。

---

## **9. 告警列表 (Alerts List)**

### **9.1. 功能目標**
提供一個**唯讀**界面，用以查看由監控系統直接觸發的、未經整合的**原始告警 (Alerts)**。此功能主要用於底層問題的追蹤與診斷，輔助 SRE 人員進行根本原因分析。它與處理需要人工介入的「事件 (Incidents)」有明確的職責區分。

### **9.2. 功能規格**
- **列表與篩選**:
    - 以表格形式展示原始告警列表，欄位包含：告警名稱、嚴重性 (Severity)、狀態 (Status)、觸發資源、詳細訊息、觸發時間等。
    - 提供基於時間範圍、嚴重性、狀態和資源名稱的篩選功能。
- **唯讀性質**:
    - 此頁面為純資訊展示，不提供對告警的任何寫入操作（如確認、解決、指派）。所有生命週期管理操作均應在「事件列表」中針對「事件」進行。
- **關聯分析**:
    - (可選) 點擊單筆告警，可彈出其詳細的 JSON payload，供進階分析使用。

### **9.3. 視覺設計**
* **核心風格**: 資訊密集、高效率的數據展示界面，與「事件列表」風格保持一致，但操作按鈕更少，強調其唯讀和分析的特性。
* **頁面說明**:
  * **頁面佈局**: 頂部為篩選區，包含時間範圍選擇器、嚴重性下拉選單等。下方為 Ant Design Table。
  * **表格設計**: 表格欄位清晰，嚴重性與狀態欄位使用帶有顏色的 `Tag` 元件，方便快速識別。無任何行內操作按鈕（如編輯、刪除）。

### **9.4. 開發規格**
- **核心元件**: `AlertsPage.tsx`, `AlertsTable.tsx`
- **API 端點**:
    - `GET /api/v1/alerts`: 獲取原始告警列表。
- **驗收條件**:
    - [ ] 能夠成功載入並以分頁形式顯示原始告警列表。
    - [ ] 所有篩選條件均能正常運作。
    - [ ] 頁面中無任何修改告警狀態的入口點。

---

## **10. 事件規則 (Incident Rules)**

### **10.1. 功能目標**
提供一個強大且靈活的界面，讓使用者可以定義事件觸發條件，並關聯通知管道和自動化腳本。

### **9.2. 功能規格**
- **表單設計**:
    - 在「新增/編輯事件規則」的表單中，「監控指標」的下拉選單選項應從後端動態載入。
    - 表單中應包含一個「自動化響應」區塊，允許使用者：
        1.  選擇一個已存在的自動化腳本。
        2.  將事件事件的變數（如資源 IP、觸發值）映射到腳本所需的參數上。
- **生命週期管理**: 提供對事件規則的啟用、停用和測試功能。

### **9.3. 視覺設計**
* **核心風格**: 強調規則邏輯的清晰配置和可擴展性，特別是在處理複雜表單時，採用了分組和動態渲染的設計。
* **設計重點**:
  * **規則列表 (Rules List)**: 以表格形式展示現有的告警規則，包含規則名稱、監控對象、觸發條件、通知方式、狀態（啟用/禁用）等。
  * **「新建規則」按鈕 (Create New Rule Button)**: 突出顯示，引導用戶創建新的告警規則。
  * **規則配置表單 (Rule Settings Form)**: 創建或編輯規則時，提供清晰的多步驟或分組表單，引導用戶定義監控指標、閾值、時間範圍、通知渠道等。
  * **狀態切換 (Status Toggle)**: 允許用戶方便地啟用或禁用某條規則。
  * **測試規則 (Test Rule - Optional)**: 提供一個「測試規則」功能，讓用戶在保存前預覽告警觸發效果。
  * **搜索與篩選 (Search & Filter)**: 針對規則名稱、監控對象等屬性提供搜索和篩選功能。
* **頁面說明**:  
  * **[新增/編輯規則彈窗]**: 這是此功能的核心視覺。一個寬大的 Modal 內部，使用 Collapse (摺疊面板) 將複雜的表單分成了「基本信息」、「觸發條件」、「事件內容與通知」和「自動化響應」等幾個可獨立展開/收合的區塊。  
  * 在「觸發條件」區塊內，使用了 Form.List，允許使用者動態新增或刪除多組「AND/OR」條件，每組條件內部又可以新增多個具體的監控指標判斷，提供了極高的靈活性。  
  * 在「自動化響應」區塊，當使用者從下拉選單中選擇一個腳本後，下方會**動態生成**該腳本所需的參數輸入框，實現了高度互動的配置體驗。

### **9.4. 開發規格**
- **核心元件**: `AlertRulesPage.tsx`, `RuleFormModal.tsx`
- **API 端點**:
    - `GET /api/v1/incidents/rules`: 獲取事件規則列表。
    - `POST /api/v1/incidents/rules`: 創建新的事件規則。
    - `GET /api/v1/incidents/rules/{ruleId}`: 獲取特定事件規則的詳情。
    - `PUT /api/v1/incidents/rules/{ruleId}`: 更新事件規則。
    - `DELETE /api/v1/incidents/rules/{ruleId}`: 刪除事件規則。
    - `POST /api/v1/incidents/rules/{ruleId}/test`: 測試事件規則是否正常運作。
    - `POST /api/v1/incidents/rules/{ruleId}/enable`: 啟用事件規則。
    - `POST /api/v1/incidents/rules/{ruleId}/disable`: 停用事件規則。
    - `GET /api/v1/metrics/definitions`: 用於動態填充「監控指標」下拉選單。
    - `GET /api/v1/automation/scripts`: 用於獲取可關聯的腳本列表。
- **驗收條件**:
    - [ ] 「監控指標」下拉選單的內容是透過 API 動態載入的。
    - [ ] 能夠成功建立一條關聯了自動化腳本的事件規則。
    - [ ] 規則的啟用/停用功能正常。

### **9.5. 資源健康判定規則**

**真實來源 (Single Source of Truth):** `openapi.yaml`

資源的健康狀態 (`healthy`, `warning`, `critical`) 由後端根據一組規則進行判定。這些規則的**唯一、權威的定義**位於 `openapi.yaml` 文件的 `x-resource-status-rules` 擴展屬性中。

前端**不應**在本地實作此邏輯，而應直接使用從 `GET /api/v1/resources` 等 API 返回的 `status` 欄位來顯示對應的 UI。

> 參考：[openapi.yaml -> x-resource-status-rules](openapi.yaml)

### 9.6. 事件狀態機

**真實來源 (Single Source of Truth):** `openapi.yaml`

事件 (Incident) 的生命週期（狀態轉換、允許的角色、對應的 API 操作）由後端狀態機嚴格控制。其**唯一、權威的定義**位於 `openapi.yaml` 文件的 `x-incident-lifecycle` 擴展屬性中。

前端 UI 應根據事件的當前 `status` 欄位來決定顯示哪些操作按鈕（例如，狀態為 `new` 時顯示「確認」按鈕）。

> 參考：[openapi.yaml -> x-incident-lifecycle](openapi.yaml)

### **9.7. 權限檢查流程**
- 後端：以 x-roles 強制校驗寫入端點
- 前端：
  - 未登入（401）：導向登入頁或彈出登入
  - 權限不足（403）：顯示 Forbidden 狀態，提供返回/申請權限 CTA
  - 批次操作部分成功：以 OperationResult/BatchOperationResult 顯示逐項成功/失敗

### **9.8. 即時更新**
- **首選 SSE**: `GET /api/v1/events`
  - **參數**:
    - `channels`: `alerts`, `incidents`
    - `lastEventId`: (Header) 用於續傳事件流。
  - text/event-stream；內含 ping 心跳，請以退避策略自動重連
  - 使用 lastEventId header 續傳
- 替代 WS：/ws/notifications（記載於 OpenAPI x-websocket）
  - 建議在需要雙向互動時採用（如訂閱管理），否則以 SSE 為主

### **9.9. 資源批次操作**
- 支援動作：delete, move_group, tag_add, tag_remove
- 參數：
  - move_group：parameters.group_id 必填
  - tag_add / tag_remove：parameters.tags 必填
- 回應：BatchOperationResult，前端以逐項呈現成功/失敗與訊息

---

## **11. 靜音規則 (Incident Silences)**

### **11.1. 功能目標**
提供對事件靜音規則的集中管理，確保在計畫性維護或已知問題期間能自動抑制相關事件通知。

### **11.2. 功能規格**
*   **列表與管理**: 提供對已設定靜音規則的列表、新增、編輯和刪除功能。
*   **生命週期管理**: 提供對靜音規則的啟用與停用功能，方便臨時控制規則是否生效。
*   **時間範圍設定**: 使用日期時間選擇器設定靜音的開始和結束時間。
*   **匹配規則**: 可以根據資源、資源群組、事件標籤等條件設定靜音規則的匹配範圍。
*   **重複規則**: 支援設定週期性重複的靜音規則。

### **11.3. 視覺設計**
*   **核心風格**: 這是一個標準的 CRUD (建立、讀取、更新、刪除) 管理界面，設計上強調**資訊的結構化呈現**和**表單設定的直觀性**。整體風格會與「資源管理」、「事件規則」等頁面保持高度一致，以降低管理員的學習成本。
*   **頁面說明**:
    *   **頁面佈局**:
        *   此功能位於事件管理模組下，作為獨立頁面訪問。
        *   頁面頂部是操作區，包含一個**搜尋框**（用於快速查找特定靜音規則）和一個藍色的**「新增靜音規則」按鈕**。
        *   下方主體部分是一個 Ant Design Table，用於展示所有已設定的靜音規則列表。
    *   **表格 (Table) 設計**:
        *   **表格欄位**會清晰地列出靜音規則的關鍵資訊，例如：「名稱」、「描述」、「開始時間」、「結束時間」、「匹配條件」、「創建者」以及「狀態」。
        *   「狀態」欄位建議使用 **Ant Design `Switch` 元件**，讓使用者可以直接在列表上點擊切換規則的啟用 (`active`) 或停用 (`disabled`) 狀態，並即時呼叫對應的 API。對於已過期的規則，則顯示為灰色的「已過期」文字。
        *   每行末尾都會有「編輯」和「刪除」的文字按鈕，用於管理單個項目。
    *   **新增/編輯彈窗 (Modal) 設計**:
        *   點擊「新增」或「編輯」按鈕後，會彈出一個 Modal，內部是一個結構清晰的 Form。
        *   **表單欄位**會包含：
            *   **名稱/描述**: 標準的文字輸入框 (Input, Input.TextArea)。
            *   **時間範圍**: 使用 DatePicker.RangePicker 元件，讓使用者可以方便地選擇開始和結束的日期與時間。
            *   **重複規則**: 可能是一個 Checkbox ("是否重複")，勾選後會出現 Select 元件讓使用者選擇重複頻率（每日、每週、每月）。
            *   **匹配條件**: 這是一個關鍵的互動設計。使用多個條件輸入欄位，允許使用者指定：
                *   資源名稱或標籤匹配
                *   資源群組匹配
                *   事件名稱或標籤匹配
                *   可能使用 Transfer (穿梭框) 或支持搜尋自動完成的多選 Select 元件 (Select.Multiple)，讓管理員可以精確地選擇匹配條件。

### **11.4. 開發規格**
*   **API 端點**:
  * `GET /api/v1/incidents/silences` (獲取靜音規則列表)
  * `POST /api/v1/incidents/silences` (創建靜音規則)
  * `GET /api/v1/incidents/silences/{silenceId}` (獲取單一靜音規則)
  * `PUT /api/v1/incidents/silences/{silenceId}` (更新靜音規則)
  * `DELETE /api/v1/incidents/silences/{silenceId}` (刪除靜音規則)
  * `POST /api/v1/incidents/silences/{silenceId}/enable` (啟用靜音規則)
  * `POST /api/v1/incidents/silences/{silenceId}/disable` (停用靜音規則)
*   **核心元件**: SilencesPage.tsx, SilencesTable.tsx, SilenceFormModal.tsx
*   **權限**:
    - **讀取權限**: 所有登入使用者可查看靜音規則
    - **寫入權限**: `team_manager` 或 `super_admin` 可建立、編輯、刪除靜音規則
    - **權限檢查**: 前端應根據使用者權限動態顯示/隱藏操作按鈕
*   **驗收條件**:
    - [ ] 靜音規則列表能正確顯示所有規則
    - [ ] 使用者能成功建立新的靜音規則
    - [ ] 規則的啟用/停用功能正常運作
    - [ ] 靜音規則能正確過濾匹配的事件
    - [ ] 權限控制正確實施

---

## **12. 容量規劃頁面 (Capacity Planning Page)**

### **12.1. 功能目標**
分析歷史數據，預測未來資源消耗趨勢，從被動事件轉向主動規劃。

### **12.2. 功能規格**
* **輸入**: 選擇「資源群組」和關鍵效能指標。  
* **輸出**:  
  * **關鍵預測指標**: 以卡片形式呈現，如「預計將在 45 天後達到 80% 警戒線」。  
  * **趨勢圖**: 包含歷史數據與未來預測的趨勢線。  
  * **建議措施**: 系統提出的建議，並可觸發對應的自動化腳本。

### **12.3. 視覺設計**
* **核心風格**: 這是一個數據分析與預測導向的頁面，設計上強調**輸入的簡潔性**與**輸出的可視化**，幫助使用者從歷史數據中洞察未來趨勢。  
* **頁面說明**:  
  * **[容量規劃初始頁面]**: 畫面佈局清晰，頂部是一個配置表單 (Form)，包含三個核心的下拉選單：「選擇資源」、「選擇關鍵效能指標」和「預測期間」，旁邊是一個藍色的「開始分析」按鈕。初始狀態下，主內容區會提示使用者進行選擇以開始分析。  
  * **[容量規劃結果頁面]**: 點擊分析後，頁面會動態呈現結果。頂部會出現幾張並排的 Card，用 Statistic 元件醒目地展示關鍵預測指標，例如：「預計將在 **45 天後** 達到 80% 警戒線」。  
  * 下方的主圖表是一個 ECharts 折線圖，圖中用**兩種不同顏色或線型**（例如實線代表歷史，虛線代表預測）清晰地繪製了**歷史數據趨勢**與**未來預測趨勢**，並可能包含一條代表「警戒線」的水平標示線，視覺衝擊力強，結果一目了然。
  * **分析與建議區塊**: 在圖表下方，針對每一條建議進行渲染時：
    * 若該建議的 `actionable` 欄位為 `true`，則應在建議文字的右側顯示一個**主操作按鈕 (Button)**，按鈕文字根據 `action_type` 決定（例如「執行擴容腳本」）。
    * **互動流程**:
      1.  使用者點擊此按鈕。
      2.  系統彈出一個**確認對話框 (Modal)**，標題為「確認執行自動化腳本」。
      3.  對話框中會顯示即將執行的腳本名稱（可透過 `action_target` 的 script_id 查詢 `GET /api/v1/automation/scripts/{scriptId}` 獲得），以及預先填好的目標資源等參數。
      4.  使用者確認後，前端呼叫 `POST /api/v1/analyzing/capacity/execute-recommendation` API，並傳入報告 ID 與建議措施 ID，由後端解析並觸發對應的自動化腳本。

#### **12.4. 輸入區詳細設計**

* **資源ID**: 應為一個支援遠端搜尋的下拉選單(Select)。當使用者輸入關鍵字時，應即時呼叫GET /api/v1/autocomplete?type=resourceAPI 來動態載入符合的資源列表，供使用者從中選擇。

* **監控指標**: 應為一個下拉選單(Select)。其選項應在頁面載入時，透過呼叫GET /api/v1/metrics/definitionsAPI 來一次填入所有可用的指標。

* **預測期間**: 應為一個下拉選單(Select)，提供固定的時間範圍選項（如：未來7 天、未來30 天、未來90 天）。

#### **12.5. 容量預測功能視覺設計**
* **核心風格**: 數據驅動的預測視圖，強調歷史趨勢與未來預測的對比。
* **視覺設計描述**:
  * **頁面佈局**: 可作為容量規劃頁面的一個子功能或獨立頁面。
  * **預測圖表**: 使用 ECharts 折線圖，用不同顏色或線型區分歷史數據（實線）和預測數據（虛線）。
  * **預測指標卡片**: 顯示關鍵預測數據，如預計達到特定使用率的時間點。

#### **12.6. 容量報告功能視覺設計**
* **核心風格**: 報告管理界面，強調內容的結構化呈現。
* **視覺設計描述**:
  * **報告列表頁面**: 使用 Ant Design Table 顯示報告列表，包含報告名稱、生成時間、相關資源等欄位。
  * **報告詳情頁面**: 採用卡片式佈局展示報告的各個部分，包括摘要、圖表、預測指標和建議措施。

### **12.7. 開發規格**
* **核心元件**: CapacityPlanningPage.tsx, CapacityAnalysisForm.tsx, CapacityForecastChart.tsx  
* **API 端點**:
  * `POST /api/v1/analyzing/capacity`: 執行容量分析與預測。
  * `POST /api/v1/analyzing/capacity/execute-recommendation`: 根據報告建議執行自動化動作。
  * `GET /api/v1/analyzing/capacity/reports`: 獲取歷史報告列表。
  * `GET /api/v1/analyzing/capacity/reports/{reportId}`: 獲取單一報告詳情。
  * 備註：若 UI 以「群組」為輸入，前端應先透過 `/api/v1/resources/groups` 或 `/api/v1/resources` 解析並組裝 `resource_ids` 傳入；或待後端支援 `group_id` 參數。
* **狀態管理**: 表單狀態為本地狀態，分析結果由 RTK Query 管理。  
* **驗收條件**:  
  * [ ] 選擇群組或資源與指標後能正確呼叫 API。  
  * [ ] 能正確顯示預測指標卡片和趨勢圖。  
  * [ ] 圖表 Y 軸和 Tooltip 顯示正確單位。  
  * [ ] 建議措施旁的按鈕可被點擊並觸發流程。

---

## **13. 腳本庫 (Scripts)**

### **13.1. 功能目標**
提供自動化腳本的開發與管理界面。

### **13.2. 功能規格**
- 提供對腳本的 CRUD 操作。
- 列表中的每一項腳本都應有「執行」按鈕，允許使用者手動觸發以進行測試。

### **13.3. 視覺設計**
* **核心風格**: 為技術操作人員（如 SRE）設計的專業界面，特別是將專業的代碼編輯器無縫整合進管理流程中。
* **設計重點**:
  * **腳本列表 (Scripts List)**: 展示已配置的腳本，包含腳本名稱、類型、描述、創建者等。
  * **「新建腳本」按鈕 (Create New Script Button)**: 明確的入口用於創建新的腳本。
  * **預設模板 (Predefined Templates)**: 提供一些常用的腳本模板，方便用戶快速上手。
* **頁面說明**:  
  * **[腳本庫頁面]**: 頁面佈局與其他管理頁面類似。表格列出了腳本的名稱、類型、描述、創建者等，操作列包含「編輯」、「執行」、「刪除」按鈕。  
  * **[腳本編輯器彈窗]**: 點擊「新增腳本」或「編輯」後，彈出的 Modal 內部嵌入了 **Monaco Editor** 專業代碼編輯器組件。編輯器區域佔據了 Modal 的大部分空間，支持語法高亮、行號和代碼自動補全，提供了流暢的腳本編寫體驗。編輯器上方是腳本名稱、描述等元數據的輸入表單。

### **13.4. 開發規格**
- **核心元件**: `ScriptsPage.tsx`, `ScriptsTable.tsx`
- **API 端點**:
    - `GET /api/v1/automation/scripts`: 獲取腳本列表。
    - `POST /api/v1/automation/scripts`: 創建新腳本。
    - `GET /api/v1/automation/scripts/{scriptId}`: 獲取特定腳本的詳情。
    - `PUT /api/v1/automation/scripts/{scriptId}`: 更新腳本。
    - `DELETE /api/v1/automation/scripts/{scriptId}`: 刪除腳本。
    - `POST /api/v1/automation/scripts/{scriptId}/run`: 手動執行特定腳本以進行測試或干預。
- **權限**:
    - 腳本寫入：`team_manager` 或 `super_admin`。
    - 手動執行：`team_manager`、`super_admin` 或 `team_member`。
- **驗收條件**:
    - [ ] 能在「腳本庫」頁面中手動執行一個腳本並在「執行日誌」中看到結果。

---

## **14. 排程管理 (Schedules)**

### **14.1. 功能目標**
提供一個強大且直觀的圖形化界面，用於集中管理所有定時執行的自動化任務。此功能旨在將重複性的人工操作轉化為可靠、可追蹤的自動化工作流程，從而提升 SRE 團隊的維運效率，並確保任務執行的準時性與一致性。

### **14.2. 功能規格**
- **完整的生命週期管理**: 提供對排程任務的完整 CRUD（建立、讀取、更新、刪除）操作。
- **排程定義**:
    - **觸發條件**: 允許使用者使用標準的 CRON 表達式來定義任務的執行週期。應提供輔助說明或連結，幫助使用者編寫 CRON 語法。
    - **執行動作**: 允許使用者從「腳本庫」中選擇一個已存在的自動化腳本作為排程的執行內容。
    - **參數映射**: 當選擇的腳本需要參數時，需提供界面讓使用者為這些參數填寫靜態值或映射系統變數。
    - **狀態控制**: 使用者可以獨立地啟用 (Enable) 或停用 (Disable) 任何一個排程任務，而無需將其刪除。
- **執行歷史追蹤**: 列表中應顯示每個排程的「上次執行時間」、「下次預計執行時間」以及「上次執行狀態」，並提供連結快速跳轉至「執行日誌」頁面查看詳細記錄。

### **14.3. 視覺設計**
* **核心風格**: 為技術操作人員（如 SRE）設計的專業界面，特別是將 CRON 排程配置與腳本選擇無縫整合進統一的管理流程中，確保操作的流暢性與準確性。

* **設計重點**:
  * **排程列表 (Schedules List)**:
    - 以 Ant Design `Table` 展示已配置的排程任務。
    - 關鍵欄位包含：任務名稱、**狀態** (使用 `Switch` 元件進行啟停操作)、**執行腳本** (顯示腳本名稱)、**CRON 觸發條件** (以 `<code>` 標籤呈現以示區分)、**上次執行時間**、**下次預計執行時間**、以及**上次執行狀態** (使用 `Tag` 標示成功/失敗)。
  * **「新建排程」按鈕 (Create New 排程 Button)**: 頁面右上角的藍色主操作按鈕，明確引導使用者創建新的排程任務。
  * **新增/編輯排程彈窗 (Modal)**:
    - 點擊「新建排程」或「編輯」後，彈出一個寬敞的 Modal。
    - 內部是一個結構化的 `Form`，包含以下欄位：
        - **任務名稱/描述**: `Input` 和 `Input.TextArea`。
        - **CRON 表達式**: `Input`，右側可帶有一個 `Tooltip` 或圖示，懸浮後顯示常用 CRON 範例（例如 `0 2 * * *` 代表每日凌晨兩點）。
        - **選擇腳本**: 一個支援**搜尋**功能的 `Select` 下拉選單，讓使用者可以從腳本庫中快速找到目標腳本。
        - **腳本參數 (動態生成)**: 當使用者選擇一個需要參數的腳本後，下方會**動態渲染**出該腳本所需的所有參數輸入框，並標示其名稱與類型。
  * **任務啟停 (Task Start/Stop)**: 在列表的「狀態」欄中，使用者可以直接點擊 `Switch` 開關來快速啟用或停用該排程任務，操作結果應有即時反饋。

### **14.4. 開發規格**
- **核心元件**: `SchedulesPage.tsx`, `ScheduleFormModal.tsx`
- **API 端點**:
    - `GET /api/v1/automation/schedules`: 獲取排程任務列表（支援分頁與排序）。
    - `POST /api/v1/automation/schedules`: 創建新排程任務。
    - `GET /api/v1/automation/schedules/{scheduleId}`: 獲取特定排程任務的詳情，用於編輯表單的資料回填。
    - `PUT /api/v1/automation/schedules/{scheduleId}`: 完整更新一個排程任務。
    - `DELETE /api/v1/automation/schedules/{scheduleId}`: 刪除排程任務。
    - `POST /api/v1/automation/schedules/{scheduleId}/enable`: 啟用一個排程。
    - `POST /api/v1/automation/schedules/{scheduleId}/disable`: 停用一個排程。

---

## **15. 執行日誌 (Executions)**

### **15.1. 功能目標**
提供自動化腳本執行歷史的追蹤與查看界面。

### **15.2. 功能規格**
- 列表應清晰展示每次執行的狀態（成功/失敗）、觸發方式（手動/事件）、執行時間等。
- 如果是由事件觸發的，應提供一個可點擊的連結，直接跳轉到該事件的詳情頁。

### **15.3. 視覺設計**
* **核心風格**: 為技術操作人員（如 SRE）設計的專業界面，特別是將執行日誌以終端風格呈現。
* **設計重點**:
  * **執行日誌列表 (Executions List)**: 展示腳本執行歷史，包含執行狀態、觸發方式、執行時間、執行耗時等。
  * **執行日誌詳情 (執行 Log Details)**: 提供詳細的執行輸出信息。
* **頁面說明**:  
  * **[執行日誌頁面]**: 頁面佈局與其他管理頁面類似。表格列出了執行記錄的狀態、觸發方式、執行時間等，操作列包含「查看日誌」按鈕。  
  * **[執行日誌詳情]**: 點擊「執行日誌」表格中的「查看日誌」操作，會彈出一個 Modal。Modal 內部是一個不可編輯的、顯示著黑底白字執行輸出的日誌查看器，支持滾動和一鍵複製，風格類似於終端 (Terminal)，符合開發者的使用習慣。

### **15.4. 開發規格**
- **核心元件**: `ExecutionsPage.tsx`, `ExecutionsTable.tsx`
- **API 端點**:
    - `GET /api/v1/automation/executions`: 獲取執行日誌列表。
    - `GET /api/v1/automation/executions/{executionId}`: 獲取特定執行日誌的詳情。
- **權限**:
    - 執行歷史與詳情：所有登入使用者可讀（依後端授權策略限制範圍）。
- **驗收條件**:
    - [ ] 能從一條由事件觸發的執行紀錄，成功跳轉到對應的事件詳情。

---

## **16. 團隊管理 (Team Management)**

### **16.1. 功能目標**
提供對使用者和團隊的管理功能，並確保在大規模使用者環境下的操作流暢性。

### **16.2. 功能規格**
- **頁面佈局**: 使用**頁籤 (`Tabs`)** 區分「使用者管理」和「團隊管理」。
- **使用者管理**:
    - 提供對使用者的 CRUD 操作。
    - 在設定角色時，應提供提示圖示，懸浮後顯示的角色說明需由後端 API 提供。
- **團隊管理**:
    - 提供對團隊的 CRUD 操作。
    - 在編輯團隊並選擇成員或通知訂閱者時，應使用**搜尋自動完成**的方式，而非一次性載入所有使用者列表。

### **16.3. 視覺設計**
* **核心風格**: 採用頁籤 (Tabs) 佈局，將不同但相關的管理功能（使用者與團隊）清晰地組織在同一頁面內，提供一致的管理體驗。
* **設計重點**:
  * **用戶與團隊列表 (使用者 & Team Lists)**: 提供清晰的用戶和團隊（或部門）列表，顯示關鍵信息如姓名、角色、所屬團隊、狀態等。
  * **層級結構 (Hierarchical Structure)**: 如果組織結構複雜，可考慮樹狀圖或可折疊列表來展示團隊層級關係。
  * **權限管理 (Permission Management)**: 為每個用戶或角色提供詳細的權限配置界面，可通過勾選框或下拉選單進行設定。
  * **邀請與添加 (Invite & Add)**: 明確的「邀請用戶」或「添加團隊」按鈕，引導用戶進行相關操作。
  * **編輯與刪除 (Edit & Delete)**: 提供行級操作按鈕（如編輯圖標、刪除圖標），方便管理單個用戶或團隊。
  * **搜索與篩選 (Search & Filter)**: 針對用戶名、角色、團隊等屬性提供搜索和篩選功能。
* **頁面說明**:  
  * **[使用者管理頁面]**: 畫面頂部是「使用者管理」和「團隊管理」的頁籤，當前選中的是「使用者管理」。頁籤下方是操作區，包含搜尋框和藍色的「新增使用者」按鈕。主體部分是一個 Ant Design Table，列出了用戶 ID、姓名、郵箱、角色（使用不同顏色的 Tag 標示）、所屬團隊等資訊。  
  * **[新增/編輯使用者彈窗]**: 點擊「新增使用者」後，會彈出一個 Modal。Modal 內部是一個 Form，包含了姓名、郵箱、密碼、角色（多選 Select）和所屬團隊（多選 Select）等輸入項。表單佈局簡潔，標籤與輸入框對齊，底部有「取消」和「確定」按鈕。  
  * **[編輯團隊彈窗]**: 在「團隊管理」頁籤中，編輯團隊時會彈出 Modal。此 Modal 的核心是其成員選擇器，使用了 Transfer (穿梭框) 元件。左側框列出了所有可選的人員，右側框列出了已選入該團隊的成員，使用者可以方便地在兩者之間進行勾選和移動，互動非常直觀。

### **16.4. 開發規格**
- **核心元件**: `OrganizationPage.tsx`, `UserTable.tsx`, `TeamTable.tsx`, `TeamFormModal.tsx`
- **API 端點**:
    - `GET /api/v1/admin/users`: 獲取使用者列表。
    - `POST /api/v1/admin/users`: 創建新使用者。
    - `GET /api/v1/admin/users/{userId}`: 獲取特定使用者的詳情。
    - `PUT /api/v1/admin/users/{userId}`: 更新使用者資訊。
    - `DELETE /api/v1/admin/users/{userId}`: 刪除使用者。
    - `GET /api/v1/admin/teams`: 獲取團隊列表。
    - `POST /api/v1/admin/teams`: 創建新團隊。
    - `GET /api/v1/admin/teams/{teamId}`: 獲取特定團隊的詳情。
    - `PUT /api/v1/admin/teams/{teamId}`: 更新團隊資訊。
    - `DELETE /api/v1/admin/teams/{teamId}`: 刪除團隊。
    - `POST /api/v1/admin/teams/{teamId}/members`: 管理團隊成員（新增或移除成員）。
    - `GET /api/v1/admin/roles`: 動態獲取角色定義。
    - `GET /api/v1/autocomplete?type=user&q={keyword}`: 用於團隊成員選擇時的搜尋建議。
- **權限**:
    - 使用者（Users）寫入：僅 `super_admin`。
    - 團隊（Teams）寫入：`team_manager` 或 `super_admin`。
- **驗收條件**:
    - [ ] 能對人員和團隊進行完整的 CRUD 操作（依權限顯示或禁用操作）。
    - [ ] 角色說明是動態載入的。
    - [ ] 編輯團隊時，新增成員的體驗是流暢的搜尋和選擇，而非等待長列表載入。

---

## **17. 角色管理 (Role Management)**

### **17.1. 功能目標**
為 `super_admin` 提供一個管理系統角色與其權限的界面。

### **17.2. 功能規格**
- **權限**: 僅 `super_admin` 可訪問。
- **列表**: 展示所有系統角色，包括內建角色和自定義角色。
- **操作**:
    - **查看**: 點擊角色可查看其擁有的權限列表。
    - **新增/編輯**: 允許創建新的自定義角色，或修改現有自定義角色的權限。
    - **內建角色**: 內建角色（如 `super_admin`, `team_manager`）的權限應為只讀，不可修改。

### **17.3. 視覺設計**
* **核心風格**: 清晰、結構化、安全。設計上要明確區分可編輯和不可編輯的內容，防止誤操作。
* **頁面說明**:
  * **角色管理頁面**: 採用左右分欄佈局。
    * **左側**: 是一個列表，展示所有角色的名稱（如 `super_admin`, `team_manager`, `viewer` 以及自定義角色）。當前選中的角色會高亮顯示。列表頂部有一個「新增角色」按鈕。
    * **右側**: 顯示當前在左側選中角色的詳細權限。
  * **權限詳情 (右側)**:
    * **標題**: 顯示角色名稱，旁邊可能有個標籤指示其為「內建角色」或「自定義角色」。
    * **權限樹 (Tree)**: 使用 Ant Design `Tree` 元件來展示所有權限。權限按模組（如「資源管理」、「事件管理」）進行分組。
    * **互動**:
      * 如果選中的是**自定義角色**，`Tree` 元件會帶有複選框 (`checkable`)，管理員可以勾選或取消勾選來增刪權限。底部會有一個「儲存變更」按鈕。
      * 如果選中的是**內建角色**，`Tree` 的複選框會被禁用 (`disabled`)，純粹用於展示，且沒有「儲存變更」按鈕，以防管理員試圖修改核心角色的權限。

### **17.4. 開發規格**
- **核心元件**: `RoleManagementPage.tsx`, `RoleList.tsx`, `PermissionTree.tsx`
- **API 端點**:
    - `GET /api/v1/admin/roles`: 獲取角色列表（供 UI 顯示角色名稱與描述，所有登入用戶可讀取）。
    - `POST /api/v1/admin/roles`: 創建新角色。
    - `PUT /api/v1/admin/roles/{roleName}`: 更新角色權限。
- **驗收條件**:
    - [ ] 僅 super_admin 能訪問角色管理頁面
    - [ ] 能查看所有角色列表
    - [ ] 能查看角色的權限詳情
    - [ ] 能創建和編輯自定義角色
    - [ ] 內建角色的權限為只讀

### **17.5. 角色定義**

| 角色名稱 | 角色標識 | 說明 |
| :--- | :--- | :--- |
| **超級管理員** | `super_admin` | 擁有系統最高權限，可以執行所有操作，包括系統級設定、用戶管理、審計日誌查看等 |
| **團隊管理員** | `team_manager` | 可以管理團隊成員、資源、事件規則、自動化腳本等團隊範圍內的資源 |
| **團隊成員** | `team_member` | 可以查看團隊資源、處理事件、執行腳本（受限），但不能進行管理級操作 |
| **唯讀用戶** | `viewer` | 僅可查看資源狀態、儀表板、報表，不能進行任何寫入操作 |

### **17.6. 功能模組權限對照表**

|| 功能模組 | 操作 | super_admin | team_manager | team_member | viewer |
|| :--- | :--- | :---: | :---: | :---: | :---: |
|| **儀表板** | 查看 | ✔ | ✔ | ✔ | ✔ |
|| **資源管理** | 查看列表 | ✔ | ✔ | ✔ | ✔ |
|| | 新增資源 | ✔ | ✔ | ✗ | ✗ |
|| | 編輯資源 | ✔ | ✔ | ✗ | ✗ |
|| | 刪除資源 | ✔ | ✔ | ✗ | ✗ |
|| | 批次操作 | ✔ | ✔ | ✗ | ✗ |
|| | 網段掃描 | ✔ | ✔ | ✗ | ✗ |
|| **資源群組** | 查看 | ✔ | ✔ | ✔ | ✔ |
|| | 管理群組 | ✔ | ✔ | ✗ | ✗ |
|| **事件管理** | 查看 | ✔ | ✔ | ✔ | ✔ |
|| | 告警列表 | 查看 | ✔ | ✔ | ✔ | ✔ |
|| | 確認/解決 | ✔ | ✔ | ✔ | ✗ |
|| | 批次處理 | ✔ | ✔ | ✔ | ✗ |
|| | AI 報告 | ✔ | ✔ | ✔ | ✗ |
|| **事件規則** | 查看 | ✔ | ✔ | ✔ | ✔ |
|| | 管理規則 | ✔ | ✔ | ✗ | ✗ |
|| **靜音規則** | 查看 | ✔ | ✔ | ✔ | ✔ |
|| | 管理規則 | ✔ | ✔ | ✗ | ✗ |
|| **容量規劃** | 查看分析 | ✔ | ✔ | ✔ | ✔ |
|| | 執行分析 | ✔ | ✔ | ✔ | ✗ |
|| **自動化** | 查看腳本 | ✔ | ✔ | ✔ | ✔ |
|| | 編輯腳本 | ✔ | ✔ | ✗ | ✗ |
|| | 執行腳本 | ✔ | ✔ | ✔* | ✗ |
|| | 管理排程 | ✔ | ✔ | ✗ | ✗ |
|| | 查看執行日誌 | ✔ | ✔ | ✔ | ✔ |
|| **管理功能** | 查看用戶 | ✔ | ✗ | ✗ | ✗ |
|| | 管理用戶 | ✔ | ✗ | ✗ | ✗ |
|| | 查看團隊 | ✔ | ✔ | ✗ | ✗ |
|| | 管理團隊 | ✔ | ✔ | ✗ | ✗ |
|| | 查看角色 | ✔ | ✔ | ✔ | ✔ |
|| | 管理角色 | ✔ | ✗ | ✗ | ✗ |
|| | 查看通知管道 | ✔ | ✗ | ✗ | ✗ |
|| | 管理通知管道 | ✔ | ✗ | ✗ | ✗ |
|| | 查看系統設定 | ✔ | ✗ | ✗ | ✗ |
|| | 修改系統設定 | ✔ | ✗ | ✗ | ✗ |
|| | 查看平台診斷 | ✔ | ✗ | ✗ | ✗ |
|| | 查看審計日誌 | ✔ | ✗ | ✗ | ✗ |
|| **個人資料** | 查看個人資料 | ✔ | ✔ | ✔ | ✔ |
|| | 修改個人資料 | ✔ | ✔ | ✔ | ✗ |
|| | 修改密碼 | ✔ | ✔ | ✔ | ✗ |
|| | 管理通知偏好 | ✔ | ✔ | ✔ | ✗ |

*註：`team_member` 可執行腳本，但可能受到腳本本身的權限限制

**更新說明：**
此權限映射表已根據 openapi.yaml 中的實際 x-roles 定義進行了完整更新，包含最新的路由路徑和權限設定。

### **17.7. API 端點權限映射 (x-roles)**

**真實來源 (Single Source of Truth):** `openapi.yaml` 的 `x-roles` 屬性。

> **說明**：下表旨在方便前端開發者快速查閱，其內容完全基於 `openapi.yaml` 中各端點的 `x-roles` 擴展屬性。所有權限控制的權威定義以 `openapi.yaml` 為準。在後續的交叉比對步驟中，我們將確保此表與 `openapi.yaml` 的內容完全同步。
>
> 參考：[openapi.yaml](openapi.yaml)

| API 端點 | HTTP 方法 | 需要角色 | 操作說明 |
| :--- | :--- | :--- | :--- |
| `/api/v1/resources` | POST | `team_manager`, `super_admin` | 創建資源 |
| `/api/v1/resources/batch` | POST | `team_manager`, `super_admin` | 批次操作資源 |
| `/api/v1/resources/scan` | POST | `team_manager`, `super_admin` | 掃描網段 |
| `/api/v1/resources/{resourceId}` | PUT | `team_manager`, `super_admin` | 更新資源 |
| `/api/v1/resources/{resourceId}` | DELETE | `team_manager`, `super_admin` | 刪除資源 |
| `/api/v1/resources/groups` | POST | `team_manager`, `super_admin` | 創建群組 |
| `/api/v1/resources/groups/{groupId}` | PUT | `team_manager`, `super_admin` | 更新群組 |
| `/api/v1/resources/groups/{groupId}` | DELETE | `team_manager`, `super_admin` | 刪除群組 |
| `/api/v1/resources/groups/{groupId}/members` | POST | `team_manager`, `super_admin` | 管理群組成員 |
| `/api/v1/incidents` | POST | `team_member`, `team_manager`, `super_admin` | 創建事件 |
| `/api/v1/incidents/batch` | POST | `team_member`, `team_manager`, `super_admin` | 批次處理事件 |
| `/api/v1/incidents/{incidentId}` | PUT | `team_member`, `team_manager`, `super_admin` | 更新事件 |
| `/api/v1/incidents/{incidentId}/acknowledge` | POST | `team_member`, `team_manager`, `super_admin` | 確認事件 |
| `/api/v1/incidents/{incidentId}/resolve` | POST | `team_member`, `team_manager`, `super_admin` | 解決事件 |
| `/api/v1/incidents/{incidentId}/assign` | POST | `team_manager`, `super_admin` | 指派事件 |
| `/api/v1/incidents/{incidentId}/comments` | POST | `team_member`, `team_manager`, `super_admin` | 新增事件註記 |
| `/api/v1/incidents/generate-report` | POST | `team_member`, `team_manager`, `super_admin` | AI 生成事件報告 |
| `/api/v1/incidents/rules` | POST | `team_manager`, `super_admin` | 創建事件規則 |
| `/api/v1/incidents/rules/{ruleId}` | PUT | `team_manager`, `super_admin` | 更新事件規則 |
| `/api/v1/incidents/rules/{ruleId}` | DELETE | `team_manager`, `super_admin` | 刪除事件規則 |
| `/api/v1/incidents/rules/{ruleId}/test` | POST | `team_manager`, `super_admin` | 測試事件規則 |
| `/api/v1/incidents/rules/{ruleId}/enable` | POST | `team_manager`, `super_admin` | 啟用事件規則 |
| `/api/v1/incidents/rules/{ruleId}/disable` | POST | `team_manager`, `super_admin` | 停用事件規則 |
| `/api/v1/incidents/silences` | POST | `team_manager`, `super_admin` | 創建靜音規則 |
| `/api/v1/incidents/silences/{silenceId}` | PUT | `team_manager`, `super_admin` | 更新靜音規則 |
| `/api/v1/incidents/silences/{silenceId}` | DELETE | `team_manager`, `super_admin` | 刪除靜音規則 |
| `/api/v1/incidents/silences/{silenceId}/enable` | POST | `team_manager`, `super_admin` | 啟用靜音規則 |
| `/api/v1/incidents/silences/{silenceId}/disable` | POST | `team_manager`, `super_admin` | 停用靜音規則 |
| `/api/v1/analyzing/capacity` | POST | `team_manager`, `super_admin` | 執行容量分析 |
| `/api/v1/analyzing/capacity/execute-recommendation`| POST | `team_manager`, `super_admin` | 執行容量規劃建議 |
| `/api/v1/analyzing/capacity/reports` | GET | `team_manager`, `super_admin` | 獲取容量報告列表 |
| `/api/v1/analyzing/capacity/reports/{reportId}` | GET | `team_manager`, `super_admin` | 獲取容量報告詳情 |
| `/api/v1/automation/scripts` | POST | `team_manager`, `super_admin` | 創建腳本 |
| `/api/v1/automation/scripts/{scriptId}` | PUT | `team_manager`, `super_admin` | 更新腳本 |
| `/api/v1/automation/scripts/{scriptId}` | DELETE | `team_manager`, `super_admin` | 刪除腳本 |
| `/api/v1/automation/scripts/{scriptId}/run` | POST | `team_member`, `team_manager`, `super_admin` | 手動執行腳本 |
| `/api/v1/automation/schedules` | POST | `team_manager`, `super_admin` | 創建排程 |
| `/api/v1/automation/schedules/{scheduleId}` | PUT | `team_manager`, `super_admin` | 更新排程 |
| `/api/v1/automation/schedules/{scheduleId}` | DELETE | `team_manager`, `super_admin` | 刪除排程 |
| `/api/v1/automation/schedules/{scheduleId}/enable` | POST | `team_manager`, `super_admin` | 啟用排程 |
| `/api/v1/automation/schedules/{scheduleId}/disable` | POST | `team_manager`, `super_admin` | 停用排程 |
| `/api/v1/admin/users` | GET | `super_admin` | 獲取使用者列表 |
| `/api/v1/admin/users` | POST | `super_admin` | 創建使用者 |
| `/api/v1/admin/users/{userId}` | GET | `super_admin` | 獲取使用者詳情 |
| `/api/v1/admin/users/{userId}` | PUT | `super_admin` | 更新使用者 |
| `/api/v1/admin/users/{userId}` | DELETE | `super_admin` | 刪除使用者 |
| `/api/v1/admin/teams` | GET | `team_manager`, `super_admin` | 獲取團隊列表 |
| `/api/v1/admin/teams` | POST | `team_manager`, `super_admin` | 創建團隊 |
| `/api/v1/admin/teams/{teamId}` | GET | `team_manager`, `super_admin` | 獲取團隊詳情 |
| `/api/v1/admin/teams/{teamId}` | PUT | `team_manager`, `super_admin` | 更新團隊 |
| `/api/v1/admin/teams/{teamId}` | DELETE | `team_manager`, `super_admin` | 刪除團隊 |
| `/api/v1/admin/teams/{teamId}/members` | POST | `team_manager`, `super_admin` | 管理團隊成員 |
| `/api/v1/admin/roles` | POST | `super_admin` | 創建自定義角色 |
| `/api/v1/admin/roles/{roleName}` | PUT | `super_admin` | 更新角色權限 |
| `/api/v1/admin/channels` | POST | `super_admin` | 創建通知管道 |
| `/api/v1/admin/channels/{channelId}` | PUT | `super_admin` | 更新通知管道 |
| `/api/v1/admin/channels/{channelId}` | DELETE | `super_admin` | 刪除通知管道 |
| `/api/v1/admin/channels/{channelId}/test` | POST | `super_admin` | 測試通知管道 |
| `/api/v1/admin/settings` | GET | `super_admin` | 獲取系統設定 |
| `/api/v1/admin/settings` | PUT | `super_admin` | 更新系統設定 |
| `/api/v1/admin/diagnostics` | GET | `super_admin` | 獲取平台自身狀態診斷 |
| `/api/v1/admin/audit` | GET | `super_admin` | 查詢審計日誌 |
| `/api/v1/admin/audit/{logId}` | GET | `super_admin` | 獲取審計日誌詳情 |

### **17.8. 前端權限控制實作指引**

#### **17.8.1. 權限檢查工具函數**

` + "`" + `` + "`" + `` + "`" + `typescript
// src/utils/permissions.ts
export const hasRole = (userRoles: string[], requiredRoles: string[]): boolean => {
  return requiredRoles.some(role => userRoles.includes(role));
};

export const canWrite = (userRoles: string[]): boolean => {
  return hasRole(userRoles, ['team_manager', 'super_admin']);
};

export const isAdmin = (userRoles: string[]): boolean => {
  return hasRole(userRoles, ['super_admin']);
};
` + "`" + `` + "`" + `` + "`" + `

#### **17.8.2. UI 元件權限控制**

- **隱藏操作按鈕**：當用戶無權限時，不顯示「新增」、「編輯」、「刪除」等按鈕
- **禁用表單**：在唯讀模式下，表單欄位設為 `disabled`
- **路由守衛**：在路由層級檢查權限，無權限時導向 403 頁面
- **選單過濾**：根據角色動態顯示/隱藏側邊欄選單項

#### **17.8.3. 錯誤處理**

- **401 未授權**：引導用戶重新登入
- **403 無權限**：顯示「您沒有權限執行此操作」提示，提供返回按鈕

### **17.9. 角色管理最佳實踐**

1. **最小權限原則**：預設給予最低必要權限
2. **權限分離**：系統管理與業務操作分離
3. **審計追蹤**：所有權限相關操作都記錄在審計日誌
4. **定期審查**：定期檢查用戶權限是否適當

---

## **18. 通知管道 (Notification Channels)**

### **18.1. 功能目標**
提供系統通知管道（Email/Webhook/Slack/LINE/SMS）的集中管理、測試與狀態追蹤。

### **18.2. 功能規格**
- 列表：顯示名稱、類型、啟用狀態、最近測試結果/時間。
- 建立/編輯：根據類型動態顯示配置欄位（如 Webhook URL、Slack webhook、Email SMTP 設定等）。
- 測試：提供「發送測試」按鈕，顯示成功/失敗與訊息。
- 過濾/排序/分頁：支援後端分頁、sort_by/sort_order。

### **18.3. 視覺設計**
* **核心風格**: 與其他管理頁面一致的表格搭配 Modal 表單模式，並透過 Tag 或 Tooltip 清晰呈現測試結果。
* **頁面說明**:
  * **頁面佈局**: 類似於「資源管理」或「使用者管理」頁面，頂部有搜尋框和「新增通知管道」按鈕。
  * **通知管道列表**: 使用 Ant Design Table，欄位包含「名稱」、「類型」（Email, Webhook, Slack, LINE, SMS 等）、 「啟用狀態」（Switch 元件）、 「最近測試結果」（用不同顏色的 Tag 顯示「成功」或「失敗」，並可能帶有 Tooltip 顯示詳細錯誤訊息）和「最近測試時間」。
  * **新增/編輯彈窗**: 點擊「新增」或「編輯」按鈕後彈出 Modal。Modal 內部是一個 Form，會根據選擇的「管道類型」動態顯示不同的配置欄位。例如：
    * **Email**: SMTP 伺服器、埠號、發件人、密碼。
    * **Webhook**: URL、Header、Body 範本。
    * **Slack**: Webhook URL。
  * **測試功能**: 在新增/編輯 Modal 底部，會有一個「發送測試」按鈕。點擊後，會顯示一個 Message 提示測試結果（成功/失敗）。

### **18.4. 開發規格**
- 核心元件：`NotificationChannelsPage.tsx`, `NotificationChannelFormModal.tsx`
- API 端點：
  - `GET /api/v1/admin/channels`: 獲取通知管道列表。
  - `POST /api/v1/admin/channels`: 創建新通知管道。
  - `GET /api/v1/admin/channels/{channelId}`: 獲取特定通知管道的詳情。
  - `PUT /api/v1/admin/channels/{channelId}`: 更新通知管道。
  - `DELETE /api/v1/admin/channels/{channelId}`: 刪除通知管道。
  - `POST /api/v1/admin/channels/{channelId}/test`: 測試通知管道。
- 權限：僅 `super_admin` 可寫入與測試。
- 驗收條件：
  - [ ] 不同類型的表單欄位可動態切換與驗證。
  - [ ] 測試成功/失敗能清晰回饋並記錄最近結果。
  - [ ] 列表支援分頁與排序。

---

## **19. 系統設定 (System Settings)**

### **19.1. 功能目標**
為 `super_admin` 提供設定平台級別全域參數的界面，位於管理主頁的卡片式導航中。

### **19.2. 功能規格**
- **權限**: 僅 `super_admin` 可訪問。
- **設定類型**:
    - **平台基本設定**: 如平台名稱、Logo、預設語言等。
    - **認證設定**: OIDC 配置參數。
    - **郵件伺服器設定**: SMTP 伺服器配置，用於系統通知。
- **操作**:
    - 提供設定表單供管理員修改各項參數。
    - 提供「儲存」按鈕以持久化設定。
    - 提供「還原預設值」按鈕以恢復系統預設設定。

### **19.3. 視覺設計**
* **核心風格**: 集中式的設定頁面，設計上注重**參數分類的邏輯性**和**操作的明確性**。
* **視覺設計描述**:
    - **頁面佈局**: 
        - 頁面標題為「系統設定」。
        - 使用 `Form` 元件作為主要容器，將設定項按功能分組。
        - 每個設定分組使用 `Card` 元件包裝，便於視覺區分。
    - **設定表單**:
        - **平台基本設定卡片**:
            - 包含平台名稱 (`Input`)、Logo 圖片上傳 (`Upload`)、預設語言選擇 (`Select`) 等欄位。
        - **認證設定卡片**:
            - 包含 OIDC 啟用開關 (`Switch`)、客戶端 ID (`Input`)、客戶端密鑰 (`Input.Password`) 等欄位。
        - **郵件伺服器設定卡片**:
            - 包含 SMTP 伺服器地址 (`Input`)、埠號 (`InputNumber`)、用戶名 (`Input`)、密碼 (`Input.Password`) 等欄位。
    - **操作區域**:
        - 頁面底部固定一個操作欄，包含「儲存」和「還原預設值」按鈕。
        - 「儲存」按鈕為主要操作按鈕，使用藍色主題。
        - 「還原預設值」按鈕為次要操作按鈕，使用默認主題並帶有警告圖標。

### **19.4. 開發規格**
- **核心元件**: `SystemSettingsPage.tsx`, `SettingsForm.tsx`
- **API 端點**:
    - `GET /api/v1/admin/settings`: 獲取當前系統設定。
    - `PUT /api/v1/admin/settings`: 更新系統設定。
- **驗收條件**:
    - [ ] 僅 super_admin 能訪問系統設定頁面
    - [ ] 能正確顯示當前系統設定
    - [ ] 能成功更新系統設定
    - [ ] 能還原系統設定為預設值
    - [ ] 表單驗證能正確提示錯誤

---

## **20. 平台診斷 (Platform Diagnostics)**

### **20.1. 功能目標**
為 `super_admin` 提供一個專門的儀表板，用以監控 SRE 平台自身的健康狀況，快速發現系統瓶頸（如失敗率高的腳本或通知管道）。

### **20.2. 功能規格**
- **權限**: 僅 `super_admin` 可見，在側邊欄選單中顯示。
- **佈局**: 採用與主儀表板類似的卡片式佈局。
- **數據展示**:
    - **自動化健康度**: 以表格形式展示腳本的總執行次數、失敗次數和失敗率。
    - **通知管道健康度**: 以表格形式展示各管道的發送總數、失敗數和失敗率。
- **互動**: 允許按時間範圍（過去 24 小時 / 7 天）篩選數據。

### **20.3. 視覺設計**
* **核心風格**: 數據驅動、異常突顯。設計目標是讓平台管理員能一眼看出系統哪個環節出了問題。
* **頁面說明**:
    * **平台診斷儀表板**: 整個頁面是一個卡片式網格佈局。頁面頂部有標題「平台狀態診斷」和一個用於切換時間範圍的選擇器（如「過去 24 小時 / 7 天」）。
    * **自動化腳本健康度卡片**: 卡片標題為「自動化腳本健康度」。內部是一個 Ant Design Table，列出「腳本名稱」、「總執行次數」、「失敗率」。失敗率一欄是視覺重點，使用 `Progress` 元件視覺化失敗率，並根據閾值改變顏色（例如 > 5% 為紅色）。失敗率高的行也可以用淡紅色背景高亮，強力吸引管理員注意。
    * **通知管道健康度卡片**: 卡片標題為「通知管道健康度」。內部同樣是一個 Table，列出「管道名稱」、「發送總數」、「失敗率」。同樣使用顏色和進度條等視覺元素來突顯失敗率異常的管道。

### **20.4. 開發規格**
- **核心元件**: `PlatformDiagnosticsPage.tsx`, `HealthStatusCard.tsx`
- **API 端點**:
  - `GET /api/v1/admin/diagnostics`: 獲取平台診斷數據。
  - `POST /api/v1/callbacks/diagnosis-complete`: 診斷完成回調（異步處理完成通知）。
- **驗收條件**:
    - [ ] 僅 super_admin 能訪問此頁面
    - [ ] 能正確顯示自動化腳本健康度表格
    - [ ] 能正確顯示通知管道健康度表格
    - [ ] 能按時間範圍篩選數據
    - [ ] 高失敗率項目能正確高亮顯示

---

## **21. 審計日誌 (Audit Logs)**

### **21.1. 功能目標**
追蹤平台重要操作的審計紀錄，用於追溯與合規。

### **21.2. 功能規格**
- 列表欄位：時間、使用者、動作（create/update/delete/execute/login/logout）、資源類型/ID、結果（success/failure）。
- 過濾：時間範圍、使用者、動作、資源類型。
- 詳情：顯示 before/after 差異摘要（若有）。
- 分頁/排序：後端分頁、sort_by/sort_order。

### **21.3. 視覺設計**
- 表格 + 篩選區 + 詳情 Drawer/Modal；失敗行以顏色或圖示凸顯。
* **設計重點**：強調事件的可追溯性和合規性，界面設計需清晰地展示大量時間序列數據，並提供強大的過濾和詳情查看功能。
  * **審計日誌列表**: 頁面頂部是一個複雜的篩選區，包含「時間範圍選擇器」、「使用者」、「動作類型」、「資源類型」等下拉選單。主體是一個 Ant Design Table，展示了審計日誌列表。表格欄位包括「時間」、「操作者」、「動作」、「資源類型」、「資源 ID」、「結果」（使用綠色「成功」或紅色「失敗」的 Tag 顯示）。
  * **審計日誌詳情**: 點擊表格中單筆日誌的「查看詳情」按鈕後，右側會滑出一個 `Drawer`。Drawer 內部清晰地展示了該條日誌的所有詳細資訊，特別是「操作前 (Before)」和「操作後 (After)」的數據差異對比，方便管理員追溯具體的變動內容。失敗的日誌條目會特別醒目，例如整行背景變為淡紅色。

### **21.4. 開發規格**
- 核心元件：`AuditLogsPage.tsx`, `AuditLogDetailDrawer.tsx`
- API 端點：
  - `GET /api/v1/admin/audit`: 獲取審計日誌列表。
  - `GET /api/v1/admin/audit/{logId}`: 獲取特定審計日誌的詳情。
- **驗收條件**:
  - [ ] 可依多條件查詢並分頁顯示。
  - [ ] 可展開單筆檢視重要變更前後的差異摘要。

---

## **22. 個人資料與設定 (Profile & Settings)**

### **22.1. 功能目標**
提供使用者個人化設定的入口。

### **22.2. 功能規格**
- **頁面佈局**: 使用**頁籤 (`Tabs`)** 佈局，包含「個人資料」相關設定。
- **個人資料**:
    - 包含基本資訊修改、密碼變更、通知偏好設定。

### **22.3. 視覺設計**
* **核心風格**: 這是一個純粹的表單驅動的管理界面，設計上注重**分區的邏輯性**和**操作的回饋感**。  
* **頁面說明**:  
  * **[頁面佈局]**: 整個頁面使用頂層的 Tabs 將不同的設定頁面清晰地劃分開來。  
  * **[個人資料頁籤]**: 內部再次使用 Tabs 將「個人資訊」、「密碼安全」和「通知設定」三個部分清晰地劃分開來。  
    * 在「通知設定」頁籤中，每個聯絡方式（Email, SMS）後面都有一個狀態指示器（例如「已驗證」的綠色標籤）和獨立的操作按鈕（「傳送驗證」、「測試」），介面清晰地傳達了每個聯絡渠道的狀態和可用操作。  

### **22.4. 開發規格**
- **核心元件**: `ProfilePage.tsx`, `ProfileForm.tsx`
- **API 端點**:
    - `GET /api/v1/profile`: 獲取個人資料。
    - `PUT /api/v1/profile`: 更新個人資料。
    - `PUT /api/v1/profile/notifications`: 更新通知偏好設定。
    - `POST /api/v1/profile/security`: 變更密碼或其他安全設定。
    - `POST /api/v1/profile/verify-contact`: 驗證聯絡方式（如Email、SMS）。
- **驗收條件**:
    - [ ] 使用者能成功修改個人資料
    - [ ] 使用者能成功變更密碼
    - [ ] 使用者能設定通知偏好