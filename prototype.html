<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SRE 平台互動原型</title>
  <!-- Performance Optimized Dependencies Loading -->

  <!-- Preload Critical Resources -->
  <link rel="preload" href="https://unpkg.com/react@18/umd/react.development.js" as="script">
  <link rel="preload" href="https://unpkg.com/react-dom@18/umd/react-dom.development.js" as="script">

  <!-- DNS Prefetch for External Domains -->
  <link rel="dns-prefetch" href="//unpkg.com">
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">

  <!-- Critical Styles First -->
  <link rel="stylesheet" href="https://unpkg.com/antd@5.19.1/dist/reset.css" />

  <!-- Core Libraries - Load Synchronously -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Utility Libraries - Load with Defer -->
  <script defer src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
  <script defer src="https://unpkg.com/dayjs@1.11.10/dayjs.min.js"></script>
  <script defer src="https://unpkg.com/dayjs@1.11.10/plugin/relativeTime.js"></script>
  <script defer src="https://unpkg.com/dayjs@1.11.10/plugin/isBetween.js"></script>

  <!-- UI Framework - Load with Defer -->
  <script defer src="https://unpkg.com/antd@5.19.1/dist/antd.min.js"></script>
  <script defer src="https://unpkg.com/@ant-design/icons@5.3.7/dist/index.umd.min.js"></script>

  <!-- Charts Library - Load with Defer -->
  <script defer src="https://unpkg.com/echarts@5.5.0/dist/echarts.min.js"></script>

  <!-- Loading State Management -->
  <script>
    // Global loading state manager
    window.SREPlatform = window.SREPlatform || {};
    window.SREPlatform.loadingState = {
      dependencies: {
        react: false,
        reactDOM: false,
        babel: false,
        dayjs: false,
        antd: false,
        icons: false,
        echarts: false
      },
      errors: [],
      ready: false
    };

    // Dependency loading tracker
    function trackDependencyLoad(name, success = true, error = null) {
      const state = window.SREPlatform.loadingState;
      state.dependencies[name] = success;
      if (error) {
        state.errors.push({ name, error, timestamp: Date.now() });
        console.error(`Failed to load ${name}:`, error);
      }

      // Check if all dependencies are loaded
      const allLoaded = Object.values(state.dependencies).every(loaded => loaded);
      if (allLoaded && !state.ready) {
        state.ready = true;
        document.dispatchEvent(new CustomEvent('sre-platform-ready'));
        console.log('🚀 SRE Platform ready!');
      }
    }

    // Mark React as loaded immediately (synchronous load)
    if (window.React) trackDependencyLoad('react');
    if (window.ReactDOM) trackDependencyLoad('reactDOM');

    // Error handlers for deferred scripts
    document.addEventListener('DOMContentLoaded', () => {
      // Check Babel
      const checkBabel = () => window.Babel ? trackDependencyLoad('babel') : setTimeout(checkBabel, 100);
      checkBabel();

      // Check Day.js
      const checkDayjs = () => window.dayjs ? trackDependencyLoad('dayjs') : setTimeout(checkDayjs, 100);
      checkDayjs();

      // Check Ant Design
      const checkAntd = () => window.antd ? trackDependencyLoad('antd') : setTimeout(checkAntd, 100);
      checkAntd();

      // Check Icons
      const checkIcons = () => window.icons ? trackDependencyLoad('icons') : setTimeout(checkIcons, 100);
      checkIcons();

      // Check ECharts
      const checkEcharts = () => window.echarts ? trackDependencyLoad('echarts') : setTimeout(checkEcharts, 100);
      checkEcharts();

      // Timeout handler - if not loaded in 10 seconds, show error
      setTimeout(() => {
        if (!window.SREPlatform.loadingState.ready) {
          console.warn('Some dependencies failed to load within 10 seconds');
          const failedDeps = Object.entries(window.SREPlatform.loadingState.dependencies)
            .filter(([name, loaded]) => !loaded)
            .map(([name]) => name);

          if (failedDeps.length > 0) {
            showLoadingError(failedDeps);
          }
        }
      }, 10000);
    });

    // Show loading error to user
    function showLoadingError(failedDependencies) {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'loading-error-overlay';
      errorDiv.innerHTML = `
        <div class="loading-error-content">
          <div class="loading-error-icon">⚠️</div>
          <h3>載入錯誤</h3>
          <p>以下依賴庫載入失敗：</p>
          <ul>
            ${failedDependencies.map(dep => `<li>${dep}</li>`).join('')}
          </ul>
          <button onclick="location.reload()" class="platform-btn platform-btn-primary">
            重新載入
          </button>
        </div>
      `;
      document.body.appendChild(errorDiv);
    }

    // Resource Loading Manager - Enhanced Progressive Loading Strategy
    window.SREPlatform.resourceManager = {
      retryAttempts: {},
      maxRetries: 3,

      loadScript: function (src, name, timeout = 15000) {
        return new Promise((resolve, reject) => {
          const script = document.createElement('script');
          const timer = setTimeout(() => {
            script.remove();
            this.handleLoadFailure(name, 'Timeout', src, 'script').then(resolve).catch(reject);
          }, timeout);

          script.onload = () => {
            clearTimeout(timer);
            this.markDependencyLoaded(name);
            this.retryAttempts[name] = 0;
            resolve();
          };

          script.onerror = () => {
            clearTimeout(timer);
            script.remove();
            this.handleLoadFailure(name, 'Network Error', src, 'script').then(resolve).catch(reject);
          };

          script.src = src;
          script.crossOrigin = 'anonymous';
          document.head.appendChild(script);
        });
      },

      loadCSS: function (href, name, timeout = 10000) {
        return new Promise((resolve, reject) => {
          const link = document.createElement('link');
          const timer = setTimeout(() => {
            this.handleLoadFailure(name, 'Timeout', href, 'css').then(resolve).catch(reject);
          }, timeout);

          link.onload = () => {
            clearTimeout(timer);
            this.markDependencyLoaded(name);
            this.retryAttempts[name] = 0;
            resolve();
          };

          link.onerror = () => {
            clearTimeout(timer);
            this.handleLoadFailure(name, 'Network Error', href, 'css').then(resolve).catch(reject);
          };

          link.rel = 'stylesheet';
          link.href = href;
          link.crossOrigin = 'anonymous';
          document.head.appendChild(link);
        });
      },

      handleLoadFailure: async function (name, reason, url, type) {
        const attempts = this.retryAttempts[name] || 0;

        if (attempts < this.maxRetries) {
          this.retryAttempts[name] = attempts + 1;
          console.warn(`Retrying ${name} (attempt ${attempts + 1}/${this.maxRetries})`);

          // Wait before retry with exponential backoff
          await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempts) * 1000));

          if (type === 'script') {
            return this.loadScript(url, name);
          } else {
            return this.loadCSS(url, name);
          }
        } else {
          this.markDependencyFailed(name, reason);
          throw new Error(`${type} ${name} failed after ${this.maxRetries} attempts`);
        }
      },

      markDependencyLoaded: function (name) {
        if (window.SREPlatform.loadingState.dependencies[name] !== undefined) {
          window.SREPlatform.loadingState.dependencies[name] = true;
          this.updateProgress();
          this.checkAllLoaded();

          // Show success notification
          this.showLoadingNotification(`${name} 載入成功`, 'success');
        }
      },

      markDependencyFailed: function (name, reason) {
        window.SREPlatform.loadingState.errors.push({
          dependency: name,
          reason: reason,
          timestamp: new Date().toISOString(),
          attempts: this.retryAttempts[name] || 0
        });
        this.updateProgress();
        this.showErrorOverlay();
        this.showLoadingNotification(`${name} 載入失敗: ${reason}`, 'error');
      },

      updateProgress: function () {
        const deps = window.SREPlatform.loadingState.dependencies;
        const total = Object.keys(deps).length;
        const loaded = Object.values(deps).filter(Boolean).length;
        const progress = (loaded / total) * 100;

        const progressBar = document.querySelector('.global-loading-progress-fill');
        if (progressBar) {
          progressBar.style.width = progress + '%';
        }

        const progressText = document.querySelector('.global-loading-progress-text');
        if (progressText) {
          progressText.textContent = `載入中... ${loaded}/${total} (${Math.round(progress)}%)`;
        }

        // Update loading spinner with progress color
        const spinner = document.querySelector('.global-loading-spinner');
        if (spinner) {
          if (progress >= 75) {
            spinner.style.borderTopColor = '#52c41a';
          } else if (progress >= 50) {
            spinner.style.borderTopColor = '#faad14';
          }
        }
      },

      checkAllLoaded: function () {
        const deps = window.SREPlatform.loadingState.dependencies;
        const allLoaded = Object.values(deps).every(Boolean);

        if (allLoaded) {
          window.SREPlatform.loadingState.ready = true;
          this.hideLoadingOverlay();
          this.initializeApplication();
        } else if (window.SREPlatform.loadingState.errors.length > 0) {
          // Check if we can continue with partial loading
          this.evaluatePartialLoading();
        }
      },

      evaluatePartialLoading: function () {
        const criticalDeps = ['react', 'reactDOM'];
        const criticalLoaded = criticalDeps.every(dep =>
          window.SREPlatform.loadingState.dependencies[dep]
        );

        if (criticalLoaded) {
          console.warn('Continuing with partial loading - some non-critical dependencies failed');
          this.initializeApplication();
          this.hideLoadingOverlay();
        }
      },

      showErrorOverlay: function () {
        const overlay = document.querySelector('.loading-error-overlay');
        if (overlay) {
          overlay.style.display = 'flex';
          this.populateErrorDetails();
        }
      },

      populateErrorDetails: function () {
        const errorList = document.querySelector('.error-details-list');
        if (errorList && window.SREPlatform.loadingState.errors.length > 0) {
          errorList.innerHTML = window.SREPlatform.loadingState.errors.map(error => `
            <div class="error-item">
              <div class="error-dependency">
                <i class="error-icon">⚠️</i>
                ${error.dependency}
              </div>
              <div class="error-reason">${error.reason}</div>
              <div class="error-attempts">重試次數: ${error.attempts}</div>
              <div class="error-time">${new Date(error.timestamp).toLocaleTimeString()}</div>
            </div>
          `).join('');
        }
      },

      showLoadingNotification: function (message, type) {
        const notification = document.createElement('div');
        notification.className = `loading-notification loading-notification-${type}`;
        notification.innerHTML = `
          <div class="loading-notification-content">
            <i class="loading-notification-icon">${type === 'success' ? '✅' : '❌'}</i>
            <span class="loading-notification-message">${message}</span>
          </div>
        `;

        document.body.appendChild(notification);

        // Animate in
        setTimeout(() => notification.classList.add('show'), 100);

        // Remove after delay
        setTimeout(() => {
          notification.classList.remove('show');
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      },

      hideLoadingOverlay: function () {
        const overlay = document.querySelector('.global-loading-overlay');
        if (overlay) {
          overlay.style.opacity = '0';
          setTimeout(() => {
            overlay.style.display = 'none';
            document.body.classList.remove('loading');
            document.body.classList.add('dependencies-loaded');
          }, 300);
        }
      },

      retryAllFailed: function () {
        window.SREPlatform.loadingState.errors = [];
        this.retryAttempts = {};

        // Hide error overlay
        const errorOverlay = document.querySelector('.loading-error-overlay');
        if (errorOverlay) {
          errorOverlay.style.display = 'none';
        }

        // Restart loading process
        this.initializeDependencies();
      },

      initializeDependencies: function () {
        // Reset loading state
        Object.keys(window.SREPlatform.loadingState.dependencies).forEach(key => {
          window.SREPlatform.loadingState.dependencies[key] = false;
        });

        // Show loading overlay
        const overlay = document.querySelector('.global-loading-overlay');
        if (overlay) {
          overlay.style.display = 'flex';
          overlay.style.opacity = '1';
        }

        // Start loading critical dependencies first
        this.loadCriticalDependencies();
      },

      loadCriticalDependencies: async function () {
        try {
          // Load critical dependencies sequentially to ensure proper order
          console.log('Loading critical dependencies...');
          await this.loadScript('https://unpkg.com/react@18/umd/react.production.min.js', 'react');
          await this.loadScript('https://unpkg.com/react-dom@18/umd/react-dom.production.min.js', 'reactDOM');
          await this.loadScript('https://unpkg.com/@babel/standalone/babel.min.js', 'babel');

          // Load non-critical dependencies in parallel
          this.loadNonCriticalDependencies();
        } catch (error) {
          console.error('Critical dependency loading failed:', error);
        }
      },

      loadNonCriticalDependencies: function () {
        console.log('Loading non-critical dependencies...');
        const nonCritical = [
          { url: 'https://unpkg.com/dayjs@1.11.10/dayjs.min.js', name: 'dayjs' },
          { url: 'https://unpkg.com/antd@5.19.1/dist/antd.min.js', name: 'antd' },
          { url: 'https://unpkg.com/@ant-design/icons@5.3.7/dist/index.umd.min.js', name: 'icons' },
          { url: 'https://unpkg.com/echarts@5.5.0/dist/echarts.min.js', name: 'echarts' }
        ];

        // CSS is already loaded in HTML head, skip dynamic loading

        // Load scripts in parallel
        nonCritical.forEach(dep => {
          this.loadScript(dep.url, dep.name).catch(error => {
            console.warn(`Non-critical dependency ${dep.name} failed:`, error);
          });
        });
      },

      initializeApplication: function () {
        // Start the main application
        console.log('🚀 Initializing SRE Platform...');

        // Initialize platform features
        this.initializePlatformFeatures();

        // Initialize React components
        if (window.React && window.ReactDOM) {
          this.initializeReactComponents();
        }

        // Initialize Charts
        if (window.echarts) {
          this.initializeCharts();
        }

        // Show success notification
        this.showLoadingNotification('SRE 平台初始化完成', 'success');
      },

      initializeReactComponents: function () {
        console.log('✅ React components initialized');
        // Initialize React-based components here
      },

      initializeCharts: function () {
        console.log('📊 Charts initialized');
        // Initialize ECharts components here
      },

      initializePlatformFeatures: function () {
        // Initialize platform-specific features
        console.log('🔧 Platform features initialized');

        // Initialize font loading optimization
        this.initializeFontLoading();

        // Initialize performance monitoring
        this.initializePerformanceMonitoring();

        // Initialize service worker for offline capability
        this.initializeServiceWorker();
      },

      initializeFontLoading: function () {
        // Optimized font loading with font-display: swap
        if ('fonts' in document) {
          // Load system fonts with fallbacks
          const fontLoadPromises = [
            document.fonts.load('400 16px system-ui'),
            document.fonts.load('600 16px system-ui'),
            document.fonts.load('400 14px system-ui'),
          ];

          Promise.allSettled(fontLoadPromises).then(() => {
            document.body.classList.add('fonts-loaded');
            console.log('📝 System fonts loaded');
          });
        }
      },

      initializePerformanceMonitoring: function () {
        // Monitor performance metrics
        if ('performance' in window && 'mark' in performance) {
          performance.mark('sre-platform-init-start');

          // Measure loading performance
          setTimeout(() => {
            performance.mark('sre-platform-init-end');
            performance.measure('sre-platform-init', 'sre-platform-init-start', 'sre-platform-init-end');

            const measure = performance.getEntriesByName('sre-platform-init')[0];
            console.log(`⚡ Platform initialization took ${Math.round(measure.duration)}ms`);
          }, 100);
        }
      },

      initializeServiceWorker: function () {
        // Register service worker for offline capability
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('/sw.js').then(() => {
            console.log('🔄 Service Worker registered for offline capability');
          }).catch(() => {
            console.log('⚠️ Service Worker registration failed - running without offline capability');
          });
        }
      }
    };

    // Progressive Enhancement: Start loading dependencies when page is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function () {
        setTimeout(() => {
          window.SREPlatform.resourceManager.initializeDependencies();
        }, 100);
      });
    } else {
      setTimeout(() => {
        window.SREPlatform.resourceManager.initializeDependencies();
      }, 100);
    }

    // Global error handler for unhandled dependency failures
    window.addEventListener('error', function (e) {
      console.error('Unhandled error:', e);
      if (window.SREPlatform && window.SREPlatform.resourceManager) {
        window.SREPlatform.resourceManager.showLoadingNotification(
          `全域錯誤: ${e.message || e.filename || 'Unknown'}`,
          'error'
        );
      }
    });
  </script>

  <style>
    /* 🎨 統一設計系統 - Design System */
    :root {
      /* === 核心品牌色系統 === */
      --brand-primary: #1890ff;
      --brand-primary-hover: #40a9ff;
      --brand-primary-active: #096dd9;
      --brand-primary-bg: rgba(24, 144, 255, 0.1);

      --brand-success: #52c41a;
      --brand-success-hover: #73d13d;
      --brand-success-bg: rgba(82, 196, 26, 0.1);

      --brand-warning: #faad14;
      --brand-warning-hover: #ffc53d;
      --brand-warning-bg: rgba(250, 173, 20, 0.1);

      --brand-danger: #ff4d4f;
      --brand-danger-hover: #ff7875;
      --brand-danger-bg: rgba(255, 77, 79, 0.1);

      --brand-info: #722ed1;
      --brand-info-hover: #9254de;
      --brand-info-bg: rgba(114, 46, 209, 0.1);

      /* === 文字層級系統 === */
      --text-primary: rgba(255, 255, 255, 0.95);
      --text-secondary: rgba(255, 255, 255, 0.85);
      --text-tertiary: rgba(255, 255, 255, 0.65);
      --text-quaternary: rgba(255, 255, 255, 0.45);
      --text-disabled: rgba(255, 255, 255, 0.25);

      /* === 背景層級系統 === */
      --bg-page: #0A0B0E;
      --bg-container: #141519;
      --bg-elevated: #1A1D23;
      --bg-overlay: #23262F;
      --bg-hover: rgba(255, 255, 255, 0.08);
      --bg-active: rgba(255, 255, 255, 0.12);
      --bg-selected: rgba(24, 144, 255, 0.15);

      /* === 邊框系統 === */
      --border-base: rgba(255, 255, 255, 0.12);
      --border-light: rgba(255, 255, 255, 0.08);
      --border-focus: var(--brand-primary);
      --border-hover: rgba(255, 255, 255, 0.2);

      /* === 間距系統 (8px 基礎網格) === */
      --spacing-xs: 4px;
      /* 0.5 單位 */
      --spacing-sm: 8px;
      /* 1 單位 */
      --spacing-md: 12px;
      /* 1.5 單位 */
      --spacing-lg: 16px;
      /* 2 單位 */
      --spacing-xl: 24px;
      /* 3 單位 */
      --spacing-2xl: 32px;
      /* 4 單位 */
      --spacing-3xl: 48px;
      /* 6 單位 */

      /* === 圓角系統 === */
      --radius-xs: 4px;
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;

      /* === 陰影系統 === */
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.25);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.35);
      --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.45);

      /* === 按鈕系統 === */
      --btn-height-sm: 28px;
      --btn-height-md: 32px;
      --btn-height-lg: 36px;
      --btn-padding-sm: 0 8px;
      --btn-padding-md: 0 12px;
      --btn-padding-lg: 0 16px;

      /* === 玻璃效果系統 === */
      --glass-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
      --glass-border: 1px solid rgba(255, 255, 255, 0.12);
      --glass-backdrop: blur(20px) saturate(180%);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    /* 頁面標題優化 */
    .page-title {
      font-size: 32px;
      font-weight: 600;
      margin-bottom: var(--spacing-sm);
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }

    .page-subtitle {
      font-size: 14px;
      color: var(--text-tertiary);
      margin-bottom: var(--spacing-2xl);
    }

    .ant-table-row.row-highlight>td {
      background-color: rgba(255, 77, 79, 0.1) !important;
    }


    /* === 🔧 優化表格容器系統 === */

    /* 表格容器 */
    .table-wrapper {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      margin-top: var(--spacing-xl);
      box-shadow: var(--glass-shadow);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
    }

    /* 表格工具列 */
    .table-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--spacing-lg);
      padding: var(--spacing-lg);
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-light);
      min-height: 64px;
      /* 統一工具列高度 */
    }

    /* 表格主體 */
    .table-wrapper .ant-table {
      background: transparent;
    }

    /* === 表頭優化 === */
    .table-wrapper .ant-table-thead>tr>th {
      background: var(--bg-elevated);
      color: var(--text-primary);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      padding: var(--spacing-lg) var(--spacing-lg);
      height: 48px;
      /* 統一表頭高度 */
      line-height: 1.2;
      border-bottom: 2px solid var(--border-base);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* 表頭排序圖標 */
    .table-wrapper .ant-table-thead>tr>th .ant-table-column-sorter {
      opacity: 0.6;
      transition: opacity 0.2s ease;
    }

    .table-wrapper .ant-table-thead>tr>th:hover .ant-table-column-sorter {
      opacity: 1;
    }

    /* === 表格內容優化 === */
    .table-wrapper .ant-table-tbody>tr {
      transition: all 0.2s ease;
      height: 52px;
      /* 統一行高 - 提升資訊密度 */
    }

    .table-wrapper .ant-table-tbody>tr:hover {
      background: var(--bg-hover);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .table-wrapper .ant-table-tbody>tr>td {
      color: var(--text-secondary);
      padding: var(--spacing-md) var(--spacing-lg);
      line-height: 1.4;
      border-bottom: 1px solid var(--border-light);
      vertical-align: middle;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
      /* 防止內容過長 */
    }

    /* 選中行樣式 */
    .table-wrapper .ant-table-row-selected>td {
      background: var(--bg-selected) !important;
      border-left: 3px solid var(--brand-primary);
    }

    .table-wrapper .ant-table-row-selected:hover>td {
      background: var(--bg-selected) !important;
    }

    /* === 表格分頁優化 === */
    .table-wrapper .ant-pagination {
      margin: var(--spacing-lg) 0 !important;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    /* === 表格載入狀態 === */
    .table-wrapper .ant-spin-container {
      min-height: 200px;
    }

    .table-wrapper .ant-table-placeholder {
      border-bottom: none;
    }

    /* === 響應式表格 === */
    @media (max-width: 1200px) {
      .table-wrapper .ant-table-tbody>tr>td {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: 13px;
      }

      .table-wrapper .ant-table-thead>tr>th {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: 11px;
      }
    }

    /* === 表格狀態標籤優化 === */
    .table-status-tag {
      padding: 2px 8px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 1px solid transparent;
    }

    .table-status-tag--success {
      background: var(--brand-success-bg);
      color: var(--brand-success);
      border-color: rgba(82, 196, 26, 0.3);
    }

    .table-status-tag--warning {
      background: var(--brand-warning-bg);
      color: var(--brand-warning);
      border-color: rgba(250, 173, 20, 0.3);
    }

    .table-status-tag--danger {
      background: var(--brand-danger-bg);
      color: var(--brand-danger);
      border-color: rgba(255, 77, 79, 0.3);
    }

    /* === 🏷️ 標籤管理專用樣式 === */

    /* 標籤分類導航 */
    .tag-category-nav {
      display: flex;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-xl);
      flex-wrap: wrap;
    }


    /* 統一分類標籤下拉選項樣式 */
    .ant-select-dropdown .ant-select-item-option {
      padding: 8px 12px !important;
    }

    .ant-select-dropdown .ant-select-item-option:hover {
      background: rgba(255, 255, 255, 0.05) !important;
    }

    .ant-select-dropdown .ant-select-item-option-selected {
      background: rgba(24, 144, 255, 0.1) !important;
    }

    .tag-category-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      padding: var(--spacing-sm) var(--spacing-lg);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
      background: transparent;
      color: var(--text-tertiary);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 13px;
      font-weight: 500;
    }

    .tag-category-item:hover {
      border-color: var(--border-hover);
      background: var(--bg-hover);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    .tag-category-item.active {
      border-color: var(--brand-primary);
      background: var(--brand-primary-bg);
      color: var(--brand-primary);
    }

    .tag-category-count {
      font-size: 12px;
      padding: 2px 6px;
      border-radius: var(--radius-sm);
      background: rgba(255, 255, 255, 0.15);
      margin-left: var(--spacing-xs);
    }

    /* 標籤統計卡片 */
    .tag-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }

    .tag-stat-card {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
      transition: all 0.3s ease;
    }

    .tag-stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .tag-stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
      line-height: 1;
    }

    .tag-stat-label {
      font-size: 13px;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    .tag-stat-icon {
      font-size: 20px;
      color: var(--brand-primary);
      opacity: 0.7;
      margin-bottom: var(--spacing-sm);
    }

    /* 標籤表格優化 */
    .tag-table-wrapper {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
    }

    /* 標籤值顯示 */
    .tag-values-display {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
      max-width: 300px;
    }

    .tag-value-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      font-weight: 500;
      border: 1px solid transparent;
      max-width: 100px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tag-value-count {
      background: var(--bg-elevated);
      color: var(--text-tertiary);
      border-color: var(--border-light);
      font-size: 10px;
      padding: 1px 4px;
      border-radius: var(--radius-xs);
      margin-left: 4px;
    }

    /* 標籤操作按鈕組 */
    .tag-actions {
      display: flex;
      gap: var(--spacing-xs);
      align-items: center;
    }

    .tag-action-btn {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-sm);
      border: none;
      background: transparent;
      color: var(--text-tertiary);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .tag-action-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    .tag-action-btn.primary:hover {
      background: var(--brand-primary-bg);
      color: var(--brand-primary);
    }

    .tag-action-btn.danger:hover {
      background: var(--brand-danger-bg);
      color: var(--brand-danger);
    }

    /* 必需標籤行樣式 */
    .required-tag-row {
      border-left: 3px solid var(--brand-warning) !important;
    }

    .required-tag-row .tag-required-badge {
      background: var(--brand-warning-bg);
      color: var(--brand-warning);
      font-size: 10px;
      padding: 1px 4px;
      border-radius: var(--radius-xs);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* 標籤模態框優化 */
    .tag-modal .ant-modal-content {
      background: var(--bg-elevated);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
    }

    .tag-modal .ant-modal-header {
      background: transparent;
      border-bottom: 1px solid var(--border-light);
      padding: var(--spacing-xl) var(--spacing-xl) var(--spacing-lg);
    }

    .tag-modal .ant-modal-body {
      padding: var(--spacing-xl);
    }

    .tag-modal .ant-form-item-label>label {
      color: var(--text-primary);
      font-weight: 600;
      font-size: 13px;
    }

    /* 顏色選擇器優化 */
    .color-picker-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: var(--spacing-sm);
    }

    .color-option {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-sm);
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }

    .color-option:hover {
      transform: scale(1.1);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .color-option.selected {
      border-color: rgba(255, 255, 255, 0.8);
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
    }

    .color-option.selected::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 14px;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    /* Sidebar 選取效果 - 左側藍色邊框（主色） */
    .ant-menu-dark .ant-menu-item-selected {
      background-color: rgba(24, 144, 255, 0.15) !important;
      color: rgba(255, 255, 255, 0.9) !important;
      border-radius: 0 !important;
      position: relative;
    }

    .ant-menu-dark .ant-menu-item-selected::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: #1890ff !important;
      border-radius: 0 !important;
    }

    .ant-menu-dark .ant-menu-item-selected::after {
      display: none !important;
    }

    /* 子選單展開時，父選單不顯示選取指示器，只有輕微背景色 */
    .ant-menu-dark .ant-menu-submenu-open .ant-menu-submenu-title {
      background-color: rgba(255, 255, 255, 0.05) !important;
      color: rgba(255, 255, 255, 0.8) !important;
      border-radius: 0 !important;
    }

    /* 移除父選單的選取指示器 */
    .ant-menu-dark .ant-menu-submenu-selected .ant-menu-submenu-title::before {
      display: none !important;
    }

    .ant-menu-dark .ant-menu-item:hover {
      background-color: rgba(255, 255, 255, 0.05) !important;
      color: rgba(255, 255, 255, 0.9) !important;
    }

    .ant-menu-dark .ant-menu-submenu-title:hover {
      background-color: rgba(255, 255, 255, 0.05) !important;
      color: rgba(255, 255, 255, 0.9) !important;
    }

    /* 表格滾動條樣式 */
    .table-wrapper .ant-table-container::-webkit-scrollbar {
      height: 8px;
    }

    .table-wrapper .ant-table-container::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }

    .table-wrapper .ant-table-container::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 4px;
    }

    .table-wrapper .ant-table-container::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    .code-editor-like {
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
    }

    .log-viewer {
      background: #1e1e1e;
      color: #d4d4d4;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
      padding: 16px;
      border-radius: 4px;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    .admin-card {
      cursor: pointer;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(200, 200, 200, 0.05) 100%) !important;
      border: 1px solid rgba(255, 255, 255, 0.15) !important;
      border-radius: 12px !important;
      backdrop-filter: blur(20px) saturate(180%) brightness(1.1) !important;
      -webkit-backdrop-filter: blur(20px) saturate(180%) brightness(1.1) !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.1) !important;
      position: relative;
      overflow: hidden;
    }

    .admin-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 12px;
      z-index: -1;
    }

    .admin-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2), inset 0 -1px 0 rgba(0, 0, 0, 0.15) !important;
      border-color: rgba(255, 255, 255, 0.25) !important;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(200, 200, 200, 0.06) 100%) !important;
    }

    /* 圖表容器樣式 */
    .chart-container {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      height: 100%;
    }

    /* 圖表區域的 Card 樣式 */
    .dashboard-chart-card .ant-card-body {
      height: 100%;
      padding: 16px;
    }

    .dashboard-chart-card {
      height: 100%;
    }

    /* 玻璃效果樣式 */
    .glass-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(200, 200, 200, 0.04) 100%) !important;
      border: 1px solid rgba(255, 255, 255, 0.12) !important;
      border-radius: 12px !important;
      backdrop-filter: blur(20px) saturate(180%) !important;
      -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
    }

    .glass-card-subtle {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%) !important;
      border: 1px solid rgba(255, 255, 255, 0.08) !important;
      border-radius: 12px !important;
      backdrop-filter: blur(20px) saturate(180%) !important;
      -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
    }

    .glass-card-colored {
      border-radius: 12px !important;
      backdrop-filter: blur(20px) saturate(180%) !important;
      -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
    }

    /* === 🎯 統一操作按鈕系統 === */

    /* 按鈕容器 */
    .action-buttons {
      display: flex;
      gap: var(--spacing-xs);
      align-items: center;
    }

    /* PlatformButton 基礎樣式 - 按照設計規範更新 */
    .platform-btn {
      height: var(--btn-height-md);
      padding: var(--btn-padding-md);
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 500;
      border: 1px solid transparent;
      background: transparent;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: nowrap;
      outline: none;
      position: relative;
      overflow: hidden;
      text-decoration: none;
      user-select: none;
      min-width: fit-content;
    }

    /* 按鈕變體 */
    .platform-btn--primary {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
      color: white;
    }

    .platform-btn--primary:hover:not(:disabled) {
      background: var(--brand-primary-hover);
      border-color: var(--brand-primary-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .platform-btn--secondary {
      border-color: var(--border-base);
      color: var(--text-secondary);
      background: transparent;
    }

    .platform-btn--secondary:hover:not(:disabled) {
      border-color: var(--border-hover);
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .platform-btn--danger {
      background: var(--brand-danger);
      border-color: var(--brand-danger);
      color: white;
    }

    .platform-btn--danger:hover:not(:disabled) {
      background: var(--brand-danger-hover);
      border-color: var(--brand-danger-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .platform-btn--text {
      border: none;
      color: var(--text-tertiary);
      background: transparent;
      padding: 4px 8px;
    }

    .platform-btn--text:hover:not(:disabled) {
      color: var(--brand-primary);
      background: var(--brand-primary-bg);
    }

    .platform-btn--text.table-action-delete:hover:not(:disabled) {
      color: var(--brand-danger);
      background: var(--brand-danger-bg);
    }

    .platform-btn--ghost {
      border-color: var(--border-light);
      color: var(--text-secondary);
      background: transparent;
    }

    .platform-btn--ghost:hover:not(:disabled) {
      border-color: var(--brand-primary);
      color: var(--brand-primary);
      background: var(--brand-primary-bg);
    }

    /* 尺寸變體 - 按照設計規範標準化 */
    .platform-btn--small {
      height: 28px;
      padding: 0 12px;
      font-size: 12px;
    }

    .platform-btn--large {
      height: 44px;
      padding: 0 32px;
      font-size: 16px;
    }

    /* 純圖標按鈕 */
    .platform-btn--icon-only {
      width: var(--btn-height-md);
      padding: 0;
    }

    .platform-btn--icon-only.platform-btn--small {
      width: var(--btn-height-sm);
    }

    .platform-btn--icon-only.platform-btn--large {
      width: var(--btn-height-lg);
    }

    /* 狀態 */
    .platform-btn--loading,
    .platform-btn--disabled,
    .platform-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .platform-btn--loading:hover,
    .platform-btn--disabled:hover,
    .platform-btn:disabled:hover {
      transform: none;
      box-shadow: none;
    }

    /* 特殊狀態 */
    .platform-btn.filter-active {
      border-color: var(--brand-primary);
      color: var(--brand-primary);
      background: var(--brand-primary-bg);
    }

    /* 標準按鈕基礎樣式 (舊版兼容) */
    .btn-standard {
      height: var(--btn-height-md);
      padding: var(--btn-padding-md);
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 500;
      border: 1px solid transparent;
      background: transparent;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    /* 主要按鈕 */
    .btn-primary {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--brand-primary-hover);
      border-color: var(--brand-primary-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    /* 成功按鈕 */
    .btn-success {
      background: var(--brand-success);
      border-color: var(--brand-success);
      color: white;
    }

    .btn-success:hover {
      background: var(--brand-success-hover);
      border-color: var(--brand-success-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    /* 危險按鈕 */
    .btn-danger {
      background: var(--brand-danger);
      border-color: var(--brand-danger);
      color: white;
    }

    .btn-danger:hover {
      background: var(--brand-danger-hover);
      border-color: var(--brand-danger-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    /* 次要按鈕 (outlined) */
    .btn-secondary {
      border-color: var(--border-base);
      color: var(--text-secondary);
    }

    .btn-secondary:hover {
      border-color: var(--border-hover);
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    /* 圖標按鈕 */
    .btn-icon {
      width: var(--btn-height-md);
      height: var(--btn-height-md);
      padding: 0;
      border-radius: var(--radius-sm);
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-tertiary);
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-icon:hover {
      background: var(--bg-hover);
      border-color: var(--border-light);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    .btn-icon.btn-icon--primary:hover {
      background: var(--brand-primary-bg);
      color: var(--brand-primary);
      border-color: rgba(24, 144, 255, 0.3);
    }

    .btn-icon.btn-icon--danger:hover {
      background: var(--brand-danger-bg);
      color: var(--brand-danger);
      border-color: rgba(255, 77, 79, 0.3);
    }

    /* 小尺寸按鈕 */
    .btn-sm {
      height: var(--btn-height-sm);
      padding: var(--btn-padding-sm);
      font-size: 12px;
    }

    .btn-icon.btn-sm {
      width: var(--btn-height-sm);
      height: var(--btn-height-sm);
    }

    /* 大尺寸按鈕 */
    .btn-lg {
      height: var(--btn-height-lg);
      padding: var(--btn-padding-lg);
      font-size: 14px;
    }

    .btn-icon.btn-lg {
      width: var(--btn-height-lg);
      height: var(--btn-height-lg);
    }

    /* 按鈕組 */
    .btn-group {
      display: inline-flex;
      align-items: center;
    }

    .btn-group .btn-standard:not(:first-child) {
      margin-left: -1px;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }

    .btn-group .btn-standard:not(:last-child) {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    /* 統一搜尋框樣式 */
    .search-input {
      width: 300px !important;
    }

    /* 統一選擇器樣式 */
    .select-full {
      width: 100% !important;
    }

    .select-sm {
      width: 60px !important;
    }

    .select-md {
      width: 80px !important;
    }

    .select-lg {
      width: 120px !important;
    }

    .select-xl {
      width: 150px !important;
    }

    .select-xxl {
      width: 180px !important;
    }

    /* 🎯 優化狀態標籤設計 */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: var(--radius-xl);
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      transition: all 0.2s ease;
    }

    .status-badge::before {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: 0.6;
        transform: scale(0.8);
      }

      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* 狀態標籤颜色 */
    .status-healthy,
    .status-badge-healthy {
      background: rgba(95, 207, 128, 0.12);
      color: var(--brand-success);
      border: 1px solid rgba(95, 207, 128, 0.24);
    }

    .status-warning,
    .status-badge-warning {
      background: rgba(255, 184, 77, 0.12);
      color: var(--brand-warning);
      border: 1px solid rgba(255, 184, 77, 0.24);
    }

    .status-critical,
    .status-badge-critical {
      background: rgba(255, 107, 107, 0.12);
      color: var(--brand-danger);
      border: 1px solid rgba(255, 107, 107, 0.24);
    }

    .status-new {
      background: rgba(74, 144, 255, 0.12);
      color: var(--brand-primary);
      border: 1px solid rgba(74, 144, 255, 0.24);
    }

    .status-acknowledged {
      background: rgba(255, 184, 77, 0.12);
      color: var(--brand-warning);
      border: 1px solid rgba(255, 184, 77, 0.24);
    }

    .status-resolved {
      background: rgba(95, 207, 128, 0.12);
      color: var(--brand-success);
      border: 1px solid rgba(95, 207, 128, 0.24);
    }

    /* 統一間距樣式 */

    /* 統一元件樣式 */
    .transparent-bg {
      background: transparent !important;
    }

    .row-error {
      background-color: rgba(255, 77, 79, 0.08) !important;
    }

    /* 靜音規則設定透明背景 */
    .silence-modal .ant-modal-content,
    .silence-modal .ant-modal-body {
      background: transparent !important;
    }

    .silence-modal .ant-table,
    .silence-modal .ant-table-tbody>tr>td {
      background: transparent !important;
    }

    /* 高亮行樣式 */
    .highlighted-row {
      background: rgba(24, 144, 255, 0.1) !important;
      border-left: 3px solid #1890ff !important;
      animation: highlight-fade 3s ease-out;
    }

    @keyframes highlight-fade {
      0% {
        background: rgba(24, 144, 255, 0.3) !important;
        border-left-color: #40a9ff !important;
      }

      100% {
        background: rgba(24, 144, 255, 0.1) !important;
        border-left-color: #1890ff !important;
      }
    }

    /* Top N 資源使用列表表格樣式 */
    .topn-table .ant-table-tbody>tr>td {
      padding: 2px 4px !important;
      line-height: 1.2 !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    }

    .topn-table .ant-table-thead>tr>th {
      padding: 4px 4px !important;
      line-height: 1.2 !important;
      background: rgba(255, 255, 255, 0.05) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    }

    .topn-table .ant-table-tbody>tr:hover>td {
      background: rgba(255, 255, 255, 0.03) !important;
    }

    .topn-table .ant-table {
      background: transparent !important;
    }

    .topn-table .ant-table-container {
      background: transparent !important;
    }

    .topn-table .ant-table-content {
      background: transparent !important;
    }

    /* 分頁樣式 */
    .topn-table .ant-pagination {
      margin: 12px 8px !important;
    }

    .topn-table .ant-pagination-item,
    .topn-table .ant-pagination-prev,
    .topn-table .ant-pagination-next,
    .topn-table .ant-pagination-jump-prev,
    .topn-table .ant-pagination-jump-next {
      background-color: transparent !important;
      border-color: transparent !important;
      border-radius: 4px;
    }

    .topn-table .ant-pagination-item a {
      color: rgba(255, 255, 255, 0.85) !important;
    }

    .topn-table .ant-pagination-prev .ant-pagination-item-link,
    .topn-table .ant-pagination-next .ant-pagination-item-link {
      color: rgba(255, 255, 255, 0.85) !important;
    }

    .topn-table .ant-pagination-item-active {
      border-color: #1677ff !important;
    }

    .topn-table .ant-pagination-item-active a {
      color: #1677ff !important;
    }

    /* Radio 按鈕樣式 */
    .topn-radio-group .ant-radio-group {
      border-radius: 6px;
      background-color: rgba(38, 38, 38, 0.6);
    }

    .topn-radio-group .ant-radio-button-wrapper {
      background-color: transparent !important;
      border-color: transparent !important;
      color: rgba(255, 255, 255, 0.85) !important;
      padding: 0 16px;
      height: 32px;
      line-height: 32px;
      border-right: 1px solid rgba(66, 66, 66, 0.6) !important;
    }

    .topn-radio-group .ant-radio-button-wrapper:last-child {
      border-right: none !important;
    }

    .topn-radio-group .ant-radio-button-wrapper:not(:first-child)::before {
      display: none;
    }

    .topn-radio-group .ant-radio-button-wrapper-checked:not(.ant-radio-button-wrapper-disabled) {
      background-color: transparent !important;
      border-color: #1677ff !important;
      color: #1677ff !important;
      border-width: 1px !important;
      border-style: solid !important;
      border-radius: 6px;
    }

    .topn-radio-group .ant-radio-button-wrapper-checked:not(.ant-radio-button-wrapper-disabled):hover {
      background-color: transparent !important;
      color: #1677ff !important;
    }

    .no-margin {
      margin: 0 !important;
    }

    /* Header controls 樣式 */
    .header-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .header-controls h2 {
      margin: 0;
      font-size: 20px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.9);
    }

    /* 分頁樣式 */
    .custom-pagination .ant-pagination-item,
    .custom-pagination .ant-pagination-prev,
    .custom-pagination .ant-pagination-next,
    .custom-pagination .ant-pagination-jump-prev,
    .custom-pagination .ant-pagination-jump-next {
      background-color: transparent !important;
      border-color: transparent !important;
      border-radius: 4px;
    }

    .custom-pagination .ant-pagination-item a {
      color: rgba(255, 255, 255, 0.85) !important;
    }

    .custom-pagination .ant-pagination-prev .ant-pagination-item-link,
    .custom-pagination .ant-pagination-next .ant-pagination-item-link {
      color: rgba(255, 255, 255, 0.85) !important;
    }

    .custom-pagination .ant-pagination-item-active {
      border-color: #1677ff !important;
    }

    .custom-pagination .ant-pagination-item-active a {
      color: #1677ff !important;
    }

    .ant-table-pagination.ant-pagination {
      margin: 16px 8px !important;
    }



    /* 導航項目樣式 */
    .nav-item {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(200, 200, 200, 0.05) 100%);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      cursor: pointer;
      transition: all 0.3s ease;
      height: 100%;
      backdrop-filter: blur(20px) saturate(180%) brightness(1.1);
      -webkit-backdrop-filter: blur(20px) saturate(180%) brightness(1.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 12px;
      z-index: -1;
    }

    .nav-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
      border-color: rgba(255, 255, 255, 0.25);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(200, 200, 200, 0.06) 100%);
    }

    .nav-item-content {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      height: 100%;
    }

    .nav-item-icon {
      font-size: 24px;
      color: rgba(255, 255, 255, 0.8);
      margin-top: 4px;
    }

    .nav-item-text {
      flex: 1;
    }

    .nav-item-title {
      margin: 0 0 8px 0 !important;
      color: rgba(255, 255, 255, 0.9) !important;
    }

    .nav-item-description {
      margin: 0 !important;
      color: rgba(255, 255, 255, 0.6) !important;
      font-size: 14px;
      line-height: 1.4;
    }

    /* Disabled nav item styles */
    .nav-item.disabled {
      cursor: not-allowed;
      opacity: 0.5;
      filter: grayscale(50%);
    }

    .nav-item.disabled:hover {
      transform: none;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.1);
      border-color: rgba(255, 255, 255, 0.15);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(200, 200, 200, 0.05) 100%);
    }

    .nav-item.disabled .nav-item-icon {
      opacity: 0.6;
    }

    .nav-item.disabled .nav-item-title,
    .nav-item.disabled .nav-item-description {
      opacity: 0.7;
    }

    /* 模態框區段樣式 */
    .modal-section {
      padding: 16px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .modal-section+.modal-section {
      margin-top: 16px;
    }

    /* 條件群組容器樣式 */
    .condition-group-container {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 6px;
      padding: 12px;
    }

    .condition-group-container+.condition-group-container {
      margin-top: 12px;
    }

    .condition-group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .condition-group-title {
      font-size: 14px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.85);
    }

    .condition-group-remove {
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      transition: color 0.2s;
    }

    .condition-group-remove:hover {
      color: rgba(255, 255, 255, 0.9);
    }

    /* 腳本參數容器樣式 */
    .script-params-container {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 6px;
      margin-top: 12px;
    }

    .script-params-header {
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .script-params-content {
      padding: 12px 16px;
    }

    /* 統計卡片樣式 */

    /* 🔧 統一樣式類 - 替換重複內嵌樣式 */

    /* ⚡ 統一顏色樣式 - 已移至底部使用 CSS 變數版本 */

    /* 統一間距樣式 */
    .margin-bottom-sm {
      margin-bottom: 8px;
    }

    .margin-bottom-md {
      margin-bottom: 16px;
    }

    .margin-bottom-lg {
      margin-bottom: 24px;
    }

    /* 統一字體樣式 */
    .font-medium {
      font-weight: 500;
    }

    .font-semibold {
      font-weight: 600;
    }

    .font-bold {
      font-weight: 700;
    }

    /* 統一標題樣式 */
    .section-title {
      margin-bottom: 16px;
      color: rgba(255, 255, 255, 0.9);
      font-size: 16px;
      font-weight: 600;
    }

    .chart-title {
      margin-bottom: 8px;
      color: rgba(255, 255, 255, 0.85);
      margin-top: 0;
      font-size: 14px;
      font-weight: 600;
    }

    /* 統一高度樣式 */
    .card-height-small {
      height: 88px;
    }

    .card-height-large {
      height: 240px;
    }

    /* 統一內距樣式 */
    .padding-md {
      padding: 16px;
    }

    .padding-lg {
      padding: 20px;
    }

    /* 卡片標題樣式 */
    .card-title {
      color: var(--text-tertiary);
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    /* 卡片數值樣式 */
    .card-value {
      font-size: 32px;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 4px;
    }

    .card-value-large {
      font-size: 40px;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 4px;
    }

    /* 卡片描述樣式 */
    .card-description {
      color: var(--text-secondary);
      font-size: 12px;
    }

    /* 卡片圖標樣式 */
    .card-icon {
      font-size: 32px;
      opacity: 0.8;
    }

    .card-icon-large {
      font-size: 36px;
      opacity: 0.8;
    }

    .card-icon-xl {
      font-size: 40px;
      opacity: 0.8;
    }

    /* 卡片內容佈局 */
    .card-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 100%;
      padding: 20px 16px;
    }

    .card-content-vertical {
      display: flex;
      flex-direction: column;
      justify-content: center;
      height: 100%;
    }

    /* 圖表區域樣式 */
    .chart-section {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }

    .chart-header {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .chart-content {
      padding: 16px 20px;
    }

    /* 分析區域樣式 */
    .analysis-section {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 16px;
    }

    .analysis-header {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .analysis-content {
      padding: 16px 20px;
    }

    /* 空分析提示樣式 */
    .empty-analysis {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 32px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* 登入頁面樣式 */
    .login-page {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: linear-gradient(135deg, #0a0b0d 0%, #161719 50%, #0a0b0d 100%);
      background-attachment: fixed;
      position: relative;
      overflow: hidden;
    }

    .login-bg-shape1,
    .login-bg-shape2 {
      position: absolute;
      width: 150%;
      height: 200%;
      background: radial-gradient(circle at 50% 50%, rgba(138, 43, 226, 0.1) 0%, transparent 50%);
      animation: float 20s ease-in-out infinite;
      pointer-events: none;
    }

    .login-bg-shape1 {
      top: -50%;
      left: -25%;
    }

    .login-bg-shape2 {
      bottom: -50%;
      right: -25%;
      background: radial-gradient(circle at 50% 50%, rgba(24, 144, 255, 0.1) 0%, transparent 50%);
      animation-duration: 25s;
      animation-direction: reverse;
    }


    .login-card {
      width: 360px;
      padding: 32px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-xl);
      box-shadow: 0 24px 80px rgba(0, 0, 0, 0.6), 0 8px 32px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(24px) saturate(200%);
      -webkit-backdrop-filter: blur(24px) saturate(200%);
      z-index: 1;
    }

    .login-header {
      text-align: center;
      margin-bottom: 24px;
    }

    .login-logo {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
      font-size: 28px;
      color: white;
    }

    .login-title {
      color: var(--text-primary) !important;
      margin: 0 0 4px 0 !important;
      font-weight: 700 !important;
      font-size: 28px !important;
      letter-spacing: -0.5px;
    }

    .login-subtitle {
      color: var(--text-secondary) !important;
      font-size: 14px !important;
      display: block;
      font-weight: 500;
    }

    .login-page .ant-form-item-label>label {
      color: var(--text-primary) !important;
      font-size: 13px !important;
      font-weight: 600 !important;
    }

    .login-page .ant-input-affix-wrapper {
      background: var(--bg-container) !important;
      border: 1px solid var(--border-light) !important;
      border-radius: var(--radius-lg) !important;
      height: 44px;
      font-size: 15px;
      color: var(--text-primary);
    }

    .login-page .ant-input {
      background: transparent !important;
      color: var(--text-primary) !important;
    }

    .login-page .ant-input::placeholder {
      color: var(--text-tertiary) !important;
    }

    .login-page .ant-input-prefix .anticon {
      color: var(--text-tertiary);
    }

    .login-page .ant-input-affix-wrapper:hover {
      border-color: var(--border-hover) !important;
    }

    .login-page .ant-input-affix-wrapper:focus-within {
      border-color: var(--brand-primary) !important;
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2) !important;
    }

    .login-page .ant-checkbox-wrapper {
      color: var(--text-secondary) !important;
      font-size: 13px;
    }

    .login-page .ant-btn-link {
      color: var(--brand-primary);
      font-size: 13px;
    }

    .login-submit-btn.platform-btn--primary {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      border: none;
      box-shadow: 0 6px 24px rgba(108, 117, 125, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .login-submit-btn.platform-btn--primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(108, 117, 125, 0.4) !important;
    }

    /* 登入頁面樣式 */
    .login-page {
      background: linear-gradient(135deg, #0a0b0d 0%, #161719 50%, #0a0b0d 100%) !important;
      background-attachment: fixed !important;
    }

    .login-page .ant-input,
    .login-page .ant-input-password {
      background: var(--bg-container) !important;
      border: 1px solid var(--border-light) !important;
      border-radius: var(--radius-lg) !important;
      color: var(--text-primary) !important;
      transition: all 0.3s ease !important;
    }

    .login-page .ant-input::placeholder,
    .login-page .ant-input-password .ant-input::placeholder {
      color: var(--text-tertiary) !important;
    }

    .login-page .ant-input:hover,
    .login-page .ant-input-password:hover {
      border-color: var(--border-hover) !important;
    }

    .login-page .ant-input:focus,
    .login-page .ant-input-focused,
    .login-page .ant-input-password:focus-within {
      border-color: var(--brand-primary) !important;
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1) !important;
    }

    .login-page .ant-form-item-label>label {
      color: var(--text-primary) !important;
      font-weight: 600 !important;
    }

    .login-page .ant-checkbox-wrapper {
      color: var(--text-secondary) !important;
    }

    .login-page .login-submit-btn:hover {
      transform: translateY(-1px) !important;
      box-shadow: 0 8px 32px rgba(108, 117, 125, 0.4) !important;
    }

    .login-page .login-submit-btn:active {
      transform: translateY(0) !important;
      box-shadow: 0 4px 16px rgba(108, 117, 125, 0.3) !important;
    }

    /* 使用者團隊容器樣式 */
    .user-team-container {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 16px;
    }

    /* 角色列表容器樣式 */
    .role-list-container {
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
      height: fit-content;
      box-shadow: var(--shadow-sm);
    }

    .role-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-elevated);
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .role-list-content {
      padding: var(--spacing-md);
      max-height: 500px;
      overflow-y: auto;
    }

    /* 角色列表項目樣式 */
    .role-list-item:hover {
      background: var(--bg-hover) !important;
      border: 1px solid var(--border-base) !important;
    }

    .role-list-item.ant-list-item {
      border: none !important;
    }

    /* 角色權限容器樣式 */
    .role-permissions-container {
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
      height: fit-content;
      box-shadow: var(--shadow-sm);
    }

    .role-permissions-header {
      padding: var(--spacing-lg) var(--spacing-xl);
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-elevated);
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .role-permissions-content {
      padding: var(--spacing-lg) var(--spacing-xl);
    }

    /* 權限樹樣式優化 */
    .role-permissions-container .ant-tree .ant-tree-treenode {
      padding: 4px 0;
    }

    .role-permissions-container .ant-tree .ant-tree-node-content-wrapper {
      color: var(--text-primary) !important;
      padding: 2px 4px;
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }

    .role-permissions-container .ant-tree .ant-tree-node-content-wrapper:hover {
      background: var(--bg-hover) !important;
    }

    .role-permissions-container .ant-tree .ant-tree-checkbox {
      margin-right: 8px;
    }

    /* 修復彈窗關閉按鈕與滾動條重疊問題 */
    .ant-modal .ant-modal-close {
      top: 16px !important;
      right: 24px !important;
      z-index: 1050 !important;
      width: 32px !important;
      height: 32px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      background: rgba(0, 0, 0, 0.6) !important;
      border-radius: 50% !important;
      transition: all 0.3s ease !important;
    }

    .ant-modal .ant-modal-close:hover {
      background: rgba(255, 255, 255, 0.1) !important;
      transform: scale(1.1) !important;
    }

    .ant-modal .ant-modal-close-x {
      width: 16px !important;
      height: 16px !important;
      font-size: 16px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      color: var(--text-primary) !important;
    }

    /* 彈窗內容區域調整，避免與關閉按鈕重疊 */
    .ant-modal-content {
      padding-top: 24px !important;
      position: relative !important;
    }

    .ant-modal-body {
      padding: 24px !important;
      max-height: 70vh !important;
      overflow-y: auto !important;
      /* 為滾動條留出空間 */
      padding-right: 32px !important;
      margin-right: -8px !important;
    }

    /* 自定義滾動條樣式 */
    .ant-modal-body::-webkit-scrollbar {
      width: 8px;
    }

    .ant-modal-body::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }

    .ant-modal-body::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
    }

    .ant-modal-body::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Transfer 組件樣式優化 */
    .ant-transfer-list {
      background: rgba(0, 0, 0, 0.2) !important;
      border: 1px solid rgba(255, 255, 255, 0.1) !important;
    }

    .ant-transfer-list-header {
      background: rgba(0, 0, 0, 0.3) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    }

    .ant-transfer-list-header-title {
      color: rgba(255, 255, 255, 0.9) !important;
    }

    .ant-transfer-list-body {
      background: rgba(0, 0, 0, 0.1) !important;
    }

    .ant-transfer-list-content-item {
      color: rgba(255, 255, 255, 0.9) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    }

    .ant-transfer-list-content-item:hover {
      background: rgba(255, 255, 255, 0.05) !important;
    }

    .ant-transfer-list-search {
      background: rgba(255, 255, 255, 0.05) !important;
      border: 1px solid rgba(255, 255, 255, 0.1) !important;
    }

    .ant-transfer-list-search input {
      background: transparent !important;
      color: rgba(255, 255, 255, 0.9) !important;
    }

    .ant-transfer-list-search input::placeholder {
      color: rgba(255, 255, 255, 0.4) !important;
    }

    /* Header 和 Sidebar 細灰線分隔 */
    .ant-layout-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
      height: 48px !important;
      line-height: 48px !important;
    }

    .ant-layout-sider {
      border-right: 1px solid rgba(255, 255, 255, 0.08) !important;
    }

    .ant-layout-sider-collapsed {
      border-right: 1px solid rgba(255, 255, 255, 0.08) !important;
    }

    /* 🎯 平台級 UI/UX 標準化設計規範 */

    /* === PlatformModal 彈窗標準化設計 - 按照設計規範 === */
    .platform-modal .ant-modal {
      --modal-border-radius: 16px;
      --modal-backdrop: rgba(0, 0, 0, 0.75);
      --modal-shadow: 0 24px 80px rgba(0, 0, 0, 0.6), 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    .platform-modal .ant-modal-mask {
      background: var(--modal-backdrop);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    .platform-modal .ant-modal-content {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--modal-border-radius);
      box-shadow: var(--modal-shadow);
      overflow: hidden;
      backdrop-filter: blur(24px) saturate(200%);
      -webkit-backdrop-filter: blur(24px) saturate(200%);
    }

    /* Modal 尺寸規範 */
    .platform-modal--small .ant-modal {
      width: 480px !important;
    }

    .platform-modal--medium .ant-modal {
      width: 600px !important;
    }

    .platform-modal--large .ant-modal {
      width: 800px !important;
    }

    .platform-modal--xlarge .ant-modal {
      width: 1000px !important;
    }

    .platform-modal .ant-modal-header {
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-light);
      padding: 24px 32px;
      display: flex;
      align-items: center;
      gap: 12px;
      min-height: 72px;
    }

    .platform-modal .ant-modal-title {
      color: var(--text-primary);
      font-size: 18px;
      font-weight: 600;
      margin: 0;
      flex: 1;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .platform-modal .modal-header-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      color: var(--brand-primary);
      font-size: 16px;
    }

    .platform-modal .ant-modal-body {
      padding: 32px;
      max-height: 70vh;
      overflow-y: auto;
    }

    .platform-modal .ant-modal-footer {
      background: var(--bg-elevated);
      border-top: 1px solid var(--border-light);
      padding: 16px 32px;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      min-height: 60px;
      align-items: center;
    }

    /* === 設定頁面佈局模式標準化 === */
    .settings-layout {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-xl);
    }

    .settings-section {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
    }

    .settings-section-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
    }

    .settings-section-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
      line-height: 1.2;
    }

    .settings-section-description {
      font-size: 14px;
      color: var(--text-tertiary);
      margin-top: var(--spacing-xs);
      line-height: 1.4;
    }

    .settings-section-actions {
      display: flex;
      gap: var(--spacing-sm);
    }

    .settings-form-group {
      margin-bottom: var(--spacing-2xl);
    }

    .settings-form-group:last-child {
      margin-bottom: 0;
    }

    .settings-form-row {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: var(--spacing-xl);
      align-items: flex-start;
      margin-bottom: var(--spacing-lg);
    }

    .settings-form-label {
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
    }

    .settings-form-description {
      font-size: 13px;
      color: var(--text-tertiary);
      line-height: 1.4;
    }

    .settings-form-control {
      width: 100%;
    }

    /* === 全域操作按鈕標準化 === */
    .platform-btn {
      --btn-height: 36px;
      --btn-padding: 0 var(--spacing-lg);
      --btn-font-size: 14px;
      --btn-font-weight: 500;
      --btn-border-radius: var(--radius-sm);
      --btn-transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);

      height: var(--btn-height);
      padding: var(--btn-padding);
      font-size: var(--btn-font-size);
      font-weight: var(--btn-font-weight);
      border-radius: var(--btn-border-radius);
      transition: var(--btn-transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
      white-space: nowrap;
      cursor: pointer;
      border: 1px solid transparent;
      background: transparent;
    }

    /* 主要按鈕 */
    .platform-btn--primary {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
      color: white;
    }

    .platform-btn--primary:hover {
      background: var(--brand-primary-hover);
      border-color: var(--brand-primary-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(24, 144, 255, 0.3);
    }

    /* 次要按鈕 */
    .platform-btn--secondary {
      border-color: var(--border-base);
      color: var(--text-secondary);
      background: var(--bg-elevated);
    }

    .platform-btn--secondary:hover {
      border-color: var(--border-hover);
      background: var(--bg-hover);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    /* 危險按鈕 */
    .platform-btn--danger {
      background: var(--brand-danger);
      border-color: var(--brand-danger);
      color: white;
    }

    .platform-btn--danger:hover {
      background: var(--brand-danger-hover);
      border-color: var(--brand-danger-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(255, 77, 79, 0.3);
    }

    /* 小尺寸按鈕 */
    .platform-btn--small {
      --btn-height: 28px;
      --btn-padding: 0 var(--spacing-md);
      --btn-font-size: 12px;
    }

    /* 大尺寸按鈕 */
    .platform-btn--large {
      --btn-height: 44px;
      --btn-padding: 0 var(--spacing-2xl);
      --btn-font-size: 16px;
    }

    /* 僅圖示按鈕 */
    .platform-btn--icon-only {
      --btn-padding: 0;
      width: var(--btn-height);
      min-width: var(--btn-height);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* 幽靈按鈕變體 */
    .platform-btn--ghost {
      --btn-bg: transparent;
      --btn-color: var(--text-tertiary);
      --btn-border-color: var(--border-light);
      --btn-bg-hover: var(--bg-hover);
      --btn-color-hover: var(--text-secondary);
      --btn-border-color-hover: var(--border-default);
    }

    .platform-btn--ghost:hover {
      background: var(--btn-bg-hover);
      color: var(--btn-color-hover);
      border-color: var(--btn-border-color-hover);
    }

    /* 文字按鈕變體 */
    .platform-btn--text {
      --btn-bg: transparent;
      --btn-color: var(--text-tertiary);
      --btn-border-color: transparent;
      --btn-bg-hover: var(--bg-hover);
      --btn-color-hover: var(--text-secondary);
      --btn-border-color-hover: transparent;
      padding: var(--spacing-xs) var(--spacing-sm);
    }

    .platform-btn--text:hover {
      background: var(--btn-bg-hover);
      color: var(--btn-color-hover);
    }

    /* === TableRowActions 組件樣式 - 按照設計規範 === */
    .table-row-actions {
      display: flex;
      gap: 4px;
      align-items: center;
      justify-content: center;
      min-width: 120px;
      padding: 4px;
    }

    .table-row-actions .platform-btn {
      opacity: 0.6;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      min-width: 28px;
      height: 28px;
      border-radius: var(--radius-sm);
    }

    .table-row-actions .platform-btn:hover {
      opacity: 1;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .table-row-actions .platform-btn:active {
      transform: translateY(0);
    }

    /* 操作按鈕變體 */
    .table-action-view:hover {
      color: var(--brand-info);
      background: rgba(114, 46, 209, 0.1);
      border-color: rgba(114, 46, 209, 0.3);
    }

    .table-action-edit:hover {
      color: var(--brand-primary);
      background: var(--brand-primary-bg);
      border-color: rgba(24, 144, 255, 0.3);
    }

    .table-action-delete:hover {
      color: var(--brand-danger);
      background: var(--brand-danger-bg);
      border-color: rgba(255, 77, 79, 0.3);
    }

    .table-action-copy:hover {
      color: var(--brand-success);
      background: var(--brand-success-bg);
      border-color: rgba(82, 196, 26, 0.3);
    }

    /* === 工具列樣式 === */
    .toolbar-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      gap: var(--spacing-lg);
      padding: var(--spacing-md) 0;
    }

    .toolbar-group {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    .toolbar-group--secondary .platform-btn {
      opacity: 0.8;
    }

    .toolbar-group--secondary .platform-btn:hover {
      opacity: 1;
    }

    .filter-active {
      --btn-color: var(--brand-primary);
      --btn-bg: rgba(24, 144, 255, 0.1);
      --btn-border-color: var(--brand-primary);
    }

    /* === 批次操作工具列樣式 === */
    .batch-action-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-md) var(--spacing-lg);
      margin: var(--spacing-md) 0;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
      animation: slideInDown 0.3s ease;
    }

    .batch-selection-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      color: var(--text-secondary);
      font-size: 13px;
    }

    .batch-count {
      font-weight: 600;
      color: var(--brand-primary);
      margin: 0 var(--spacing-xs);
    }

    .batch-actions {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    /* === 增強批次操作工具列樣式 === */
    .enhanced-batch-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, var(--glass-bg) 0%, rgba(24, 144, 255, 0.05) 100%);
      border: var(--glass-border);
      border-left: 3px solid var(--brand-primary);
      border-radius: var(--radius-lg);
      padding: var(--spacing-md) var(--spacing-lg);
      margin: var(--spacing-md) 0;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: 0 4px 12px rgba(24, 144, 255, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      animation: slideInDown 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .enhanced-batch-toolbar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(24, 144, 255, 0.3), transparent);
    }

    .enhanced-batch-toolbar .batch-selection-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }

    .enhanced-batch-toolbar .batch-indicator {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      padding: 4px 12px;
      background: rgba(24, 144, 255, 0.1);
      border: 1px solid rgba(24, 144, 255, 0.2);
      border-radius: var(--radius-full);
      font-size: 13px;
      font-weight: 600;
    }

    .enhanced-batch-toolbar .batch-indicator .batch-count {
      color: var(--brand-primary);
      margin: 0;
    }

    .enhanced-batch-toolbar .batch-clear-btn {
      color: var(--text-tertiary);
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }

    .enhanced-batch-toolbar .batch-clear-btn:hover {
      color: var(--brand-danger);
      background: rgba(255, 77, 79, 0.1);
      border-color: rgba(255, 77, 79, 0.2);
    }

    .enhanced-batch-toolbar .batch-operations {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    .enhanced-batch-toolbar .batch-operations .platform-btn {
      position: relative;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .enhanced-batch-toolbar .batch-operations .platform-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* 批次操作按鈕變體樣式 */
    .enhanced-batch-toolbar .platform-btn--success {
      --btn-bg: var(--status-success-bg);
      --btn-color: var(--status-success);
      --btn-border-color: rgba(82, 196, 26, 0.3);
    }

    .enhanced-batch-toolbar .platform-btn--success:hover {
      --btn-bg: var(--status-success);
      --btn-color: white;
      --btn-border-color: var(--status-success);
    }

    .enhanced-batch-toolbar .platform-btn--danger {
      --btn-bg: var(--status-error-bg);
      --btn-color: var(--status-error);
      --btn-border-color: rgba(255, 77, 79, 0.3);
    }

    .enhanced-batch-toolbar .platform-btn--danger:hover {
      --btn-bg: var(--status-error);
      --btn-color: white;
      --btn-border-color: var(--status-error);
    }

    .enhanced-batch-toolbar .platform-btn--warning {
      --btn-bg: var(--status-warning-bg);
      --btn-color: var(--status-warning);
      --btn-border-color: rgba(250, 173, 20, 0.3);
    }

    .enhanced-batch-toolbar .platform-btn--warning:hover {
      --btn-bg: var(--status-warning);
      --btn-color: white;
      --btn-border-color: var(--status-warning);
    }

    /* 批次操作模態框樣式 */
    .enhanced-batch-toolbar+.ant-modal .ant-modal-content {
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .enhanced-batch-toolbar+.ant-modal .ant-modal-header {
      background: linear-gradient(135deg, var(--bg-surface) 0%, var(--bg-elevated) 100%);
      border-bottom: 1px solid var(--border-light);
      padding: var(--spacing-lg);
    }

    .enhanced-batch-toolbar+.ant-modal .ant-modal-body {
      padding: var(--spacing-lg);
    }

    .enhanced-batch-toolbar+.ant-modal .ant-modal-footer {
      background: var(--bg-elevated);
      border-top: 1px solid var(--border-light);
      padding: var(--spacing-md) var(--spacing-lg);
    }

    /* 響應式批次操作工具列 */
    @media (max-width: 768px) {
      .enhanced-batch-toolbar {
        flex-direction: column;
        gap: var(--spacing-md);
        padding: var(--spacing-md);
      }

      .enhanced-batch-toolbar .batch-selection-info {
        width: 100%;
        justify-content: space-between;
      }

      .enhanced-batch-toolbar .batch-operations {
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
      }

      .enhanced-batch-toolbar .batch-operations .platform-btn {
        flex: 1;
        min-width: 100px;
      }
    }

    /* === Modal 操作樣式 === */
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-lg) 0 0;
      margin-top: var(--spacing-lg);
      border-top: 1px solid var(--border-light);
    }

    /* === 🎬 微動畫系統 - 提升交互體驗 === */
    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.95);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes ripple {
      from {
        opacity: 1;
        transform: scale(0);
      }

      to {
        opacity: 0;
        transform: scale(1);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.05);
        opacity: 0.8;
      }
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      10%,
      30%,
      50%,
      70%,
      90% {
        transform: translateX(-2px);
      }

      20%,
      40%,
      60%,
      80% {
        transform: translateX(2px);
      }
    }

    /* 頁面載入動畫 */
    .page-enter {
      animation: fadeInScale 0.3s ease-out;
    }

    .card-enter {
      animation: slideInUp 0.4s ease-out;
    }

    /* 按鈕互動反饋 */
    .platform-btn {
      position: relative;
      overflow: hidden;
    }

    .platform-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transition: width 0.3s ease, height 0.3s ease;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }

    .platform-btn:active::before {
      width: 300px;
      height: 300px;
      animation: ripple 0.6s ease-out;
    }

    .platform-btn:active {
      transform: scale(0.98);
    }

    .platform-btn--icon-only:active {
      transform: scale(0.95);
    }

    /* 載入狀態動畫 */
    .loading-spinner {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    /* 錯誤狀態動畫 */
    .error-shake {
      animation: shake 0.5s ease-in-out;
    }

    /* Hover 狀態增強 */
    .hover-lift {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    /* 表格行動畫 */
    .table-row-animate {
      transition: all 0.2s ease-out;
    }

    .table-row-animate:hover {
      background: var(--bg-hover);
      box-shadow: inset 3px 0 0 var(--brand-primary);
      transform: translateX(3px);
    }

    /* Modal 進入動畫 */
    .ant-modal {
      animation: fadeInScale 0.3s ease-out;
    }

    .ant-modal-mask {
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* Toast 通知動畫 */
    .toast-slide-in {
      animation: slideInRight 0.3s ease-out;
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100%);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* 成功/失敗狀態動畫 */
    .success-pulse {
      animation: successPulse 1s ease-in-out;
    }

    @keyframes successPulse {
      0% {
        box-shadow: 0 0 0 0 rgba(82, 196, 26, 0.7);
      }

      70% {
        box-shadow: 0 0 0 10px rgba(82, 196, 26, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(82, 196, 26, 0);
      }
    }

    /* 表單驗證動畫 */
    .form-field-error {
      animation: shake 0.4s ease-in-out;
      border-color: var(--brand-danger) !important;
      box-shadow: 0 0 0 2px rgba(255, 77, 79, 0.2) !important;
    }

    /* === 表格標準化設計 === */
    .platform-table-container {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
    }

    .platform-table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-lg) var(--spacing-xl);
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-light);
      min-height: 64px;
    }

    .platform-table-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .platform-table-actions {
      display: flex;
      gap: var(--spacing-md);
      align-items: center;
    }

    .platform-table .ant-table {
      background: transparent;
    }

    .platform-table .ant-table-thead>tr>th {
      background: var(--bg-elevated);
      color: var(--text-primary);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: var(--spacing-lg);
      height: 48px;
      border-bottom: 1px solid var(--border-light);
      white-space: nowrap;
    }

    .platform-table .ant-table-tbody>tr {
      height: 48px;
      transition: all 0.2s ease;
    }

    .platform-table .ant-table-tbody>tr:hover {
      background: var(--bg-hover);
    }

    .platform-table .ant-table-tbody>tr>td {
      padding: var(--spacing-sm) var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
      color: var(--text-secondary);
      vertical-align: middle;
      font-size: 13px;
      line-height: 1.4;
    }

    /* === 增強型表格優化 === */
    .platform-enhanced-table {
      background: transparent;
    }

    .platform-enhanced-table .ant-table-thead>tr>th {
      background: var(--bg-elevated);
      color: var(--text-primary);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 12px 16px;
      height: auto;
      border-bottom: 2px solid var(--border-default);
      white-space: nowrap;
      position: relative;
    }

    .platform-enhanced-table .ant-table-thead>tr>th::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--brand-primary);
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .platform-enhanced-table .ant-table-thead>tr>th:hover::after {
      opacity: 0.3;
    }

    /* 表格行優化 - 三種密度 */
    .platform-enhanced-table.density-compact .ant-table-tbody>tr {
      height: 36px;
    }

    .platform-enhanced-table.density-compact .ant-table-tbody>tr>td {
      padding: 6px 12px;
      font-size: 12px;
      line-height: 1.3;
    }

    .platform-enhanced-table.density-standard .ant-table-tbody>tr {
      height: 48px;
    }

    .platform-enhanced-table.density-standard .ant-table-tbody>tr>td {
      padding: 12px 16px;
      font-size: 13px;
      line-height: 1.4;
    }

    .platform-enhanced-table.density-comfortable .ant-table-tbody>tr {
      height: 56px;
    }

    .platform-enhanced-table.density-comfortable .ant-table-tbody>tr>td {
      padding: 16px 20px;
      font-size: 14px;
      line-height: 1.5;
    }

    /* 表格行互動效果 */
    .platform-enhanced-table .ant-table-tbody>tr {
      transition: all 0.2s ease;
      border-left: 3px solid transparent;
    }

    .platform-enhanced-table .ant-table-tbody>tr:hover {
      background: var(--bg-hover);
      border-left-color: var(--brand-primary);
      transform: translateX(2px);
    }

    .platform-enhanced-table .ant-table-tbody>tr.ant-table-row-selected {
      background: rgba(24, 144, 255, 0.1);
      border-left-color: var(--brand-primary);
    }

    .platform-enhanced-table .ant-table-tbody>tr.ant-table-row-selected:hover {
      background: rgba(24, 144, 255, 0.15);
    }

    /* 欄位類型特定樣式 */
    .table-cell-status {
      text-align: center;
    }

    .table-cell-number {
      text-align: right;
      font-variant-numeric: tabular-nums;
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
    }

    .table-cell-date {
      font-variant-numeric: tabular-nums;
      color: var(--text-tertiary);
      font-size: 12px;
    }

    .table-cell-action {
      text-align: center;
      padding: 8px !important;
    }

    /* 響應式欄位顯示 */
    @media (max-width: 1200px) {
      .table-column-optional {
        display: none;
      }
    }

    @media (max-width: 768px) {
      .table-column-secondary {
        display: none;
      }

      .platform-enhanced-table .ant-table-tbody>tr>td {
        padding: 8px 12px;
        font-size: 12px;
      }

      .table-cell-action {
        padding: 4px !important;
      }
    }

    /* 分頁樣式優化 */
    .platform-pagination.ant-pagination {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-lg) 0;
      background: var(--bg-elevated);
      border-top: 1px solid var(--border-light);
    }

    .platform-pagination .ant-pagination-total-text {
      color: var(--text-tertiary);
      font-size: 13px;
      margin-right: auto;
    }

    .platform-pagination .ant-pagination-item,
    .platform-pagination .ant-pagination-prev,
    .platform-pagination .ant-pagination-next {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      color: var(--text-secondary);
    }

    .platform-pagination .ant-pagination-item:hover,
    .platform-pagination .ant-pagination-prev:hover,
    .platform-pagination .ant-pagination-next:hover {
      background: var(--bg-hover);
      border-color: var(--brand-primary);
      color: var(--brand-primary);
    }

    .platform-pagination .ant-pagination-item-active {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
      color: white;
    }

    .platform-pagination .ant-pagination-item-active:hover {
      background: var(--brand-primary);
      color: white;
    }

    /* 空狀態優化 */
    .platform-enhanced-table .ant-empty {
      padding: var(--spacing-2xl);
    }

    .platform-enhanced-table .ant-empty-description {
      color: var(--text-tertiary);
      font-size: 14px;
    }

    /* 載入狀態優化 */
    .platform-enhanced-table .ant-spin-container {
      position: relative;
      min-height: 200px;
    }

    /* 表格工具列整合 */
    .table-density-control {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .density-option {
      padding: 4px 8px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      background: var(--bg-elevated);
      color: var(--text-tertiary);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 11px;
      text-transform: uppercase;
    }

    .density-option:hover {
      border-color: var(--brand-primary);
      color: var(--brand-primary);
    }

    .density-option.active {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
      color: white;
    }

    /* === 🏷️ 頁面標題組件樣式 === */
    .page-header {
      margin-bottom: var(--spacing-xl);
      padding: var(--spacing-lg) 0;
    }

    .page-breadcrumb {
      margin-bottom: var(--spacing-md);
    }

    .page-header-content {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--spacing-lg);
    }

    .page-header-main {
      flex: 1;
      min-width: 0;
    }

    .page-title-section {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
    }

    .page-title-icon {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 48px;
      height: 48px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      color: var(--brand-primary);
      font-size: 20px;
    }

    .page-title-text {
      flex: 1;
      min-width: 0;
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0 0 var(--spacing-xs) 0;
      line-height: 1.2;
    }

    .page-subtitle {
      font-size: 16px;
      color: var(--text-tertiary);
      margin: 0;
      line-height: 1.4;
      max-width: 600px;
    }

    .page-header-actions {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      flex-shrink: 0;
    }

    /* 響應式處理 */
    @media (max-width: 768px) {
      .page-header-content {
        flex-direction: column;
        align-items: stretch;
        gap: var(--spacing-md);
      }

      .page-title {
        font-size: 24px;
      }

      .page-subtitle {
        font-size: 14px;
      }

      .page-title-section {
        align-items: center;
      }

      .page-title-icon {
        width: 40px;
        height: 40px;
        font-size: 18px;
      }
    }

    /* === 📊 情境化 KPI 卡片樣式 === */
    .contextual-kpi-card {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      transition: all 0.3s ease;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
      position: relative;
      overflow: hidden;
      height: 120px;
      /* 統一高度 */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      /* 恢復間距對齊，確保內容在底部對齊 */
    }

    .contextual-kpi-card.clickable {
      cursor: pointer;
    }

    .contextual-kpi-card.clickable:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
      border-color: var(--brand-primary);
    }

    .contextual-kpi-card.clickable:active {
      transform: translateY(0);
    }

    /* KPI 狀態樣式 */
    .contextual-kpi-card.critical::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--error-color);
    }

    .contextual-kpi-card.warning::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--warning-color);
    }

    .contextual-kpi-card.success::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--success-color);
    }

    .kpi-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* 改為居中對齊 */
      margin-bottom: var(--spacing-md);
    }

    .kpi-title-section {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      flex: 1;
      min-width: 0;
    }

    .kpi-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: rgba(24, 144, 255, 0.1);
      border-radius: var(--radius-md);
      color: var(--brand-primary);
      font-size: 14px;
      flex-shrink: 0;
    }

    .kpi-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .kpi-trend {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: 12px;
      font-weight: 600;
    }

    .trend-value {
      font-variant-numeric: tabular-nums;
    }

    .kpi-content {
      flex: 1;
    }

    .kpi-value {
      font-size: 32px;
      font-weight: 700;
      line-height: 1;
      margin-bottom: var(--spacing-xs);
      font-variant-numeric: tabular-nums;
      display: flex;
      align-items: baseline;
      gap: var(--spacing-xs);
    }

    .kpi-unit {
      font-size: 16px;
      font-weight: 400;
      color: var(--text-tertiary);
    }

    .kpi-description {
      font-size: 12px;
      color: var(--text-tertiary);
      line-height: 1.4;
    }

    /* 可篩選 KPI 特殊樣式 */
    .filterable-kpi.active {
      border-color: var(--brand-primary);
      background: rgba(24, 144, 255, 0.05);
      box-shadow: 0 0 0 1px var(--brand-primary);
    }

    .filterable-kpi.active .kpi-title {
      color: var(--brand-primary);
      font-weight: 600;
    }

    /* === 🎯 KPI 卡片網格統一配置 === */
    .kpi-grid {
      margin-bottom: var(--spacing-lg);
    }

    .kpi-grid .ant-row {
      margin-left: -8px;
      margin-right: -8px;
    }

    .kpi-grid .ant-col {
      padding-left: 8px;
      padding-right: 8px;
      margin-bottom: 12px;
    }

    /* === 📏 頁面佈局優化 - 確保內容在視窗範圍內 === */
    .page-header {
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-sm) 0;
    }

    .chart-card {
      margin-bottom: var(--spacing-lg);
    }

    /* === 🎛️ 統一內容區域間距 === */
    .ant-tabs {
      margin-top: var(--spacing-md);
    }

    .ant-tabs .ant-tabs-content-holder {
      padding-top: var(--spacing-lg);
    }

    /* Ant Design 表格上方間距統一 */
    .ant-table-wrapper {
      margin-top: var(--spacing-lg);
    }

    /* === 🎯 深度間距優化 - 基於截圖分析 === */
    /* 統一卡片容器間距 */
    .ant-card {
      margin-bottom: var(--spacing-md);
    }

    /* 統一表單區域間距 */
    .ant-form {
      margin-bottom: var(--spacing-lg);
    }

    .search-section,
    .filter-section {
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-md);
      background: var(--bg-secondary);
      border-radius: var(--border-radius);
    }

    /* 統一分頁器間距 */
    .ant-pagination {
      margin-top: var(--spacing-lg);
      text-align: center;
      padding: var(--spacing-md) 0;
    }

    /* 統一描述和列表間距 */
    .ant-descriptions {
      margin-bottom: var(--spacing-lg);
    }

    .ant-list-item {
      padding: var(--spacing-md) 0;
      border-bottom: 1px solid var(--border-light);
    }

    /* 統一工具列間距 */
    .table-toolbar,
    .content-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
      padding: var(--spacing-sm) 0;
    }

    .filter-bar {
      display: flex;
      gap: var(--spacing-md);
      align-items: center;
      flex-wrap: wrap;
    }

    /* 統一按鈕組間距 */
    .ant-btn-group {
      margin-right: var(--spacing-md);
    }

    .ant-btn+.ant-btn {
      margin-left: var(--spacing-sm);
    }

    /* 統一表單項間距 */
    .ant-form-item {
      margin-bottom: var(--spacing-lg);
    }

    .ant-form-item:last-child {
      margin-bottom: 0;
    }

    /* === 🔧 模態框和彈出組件間距統一 === */
    .ant-modal-body {
      padding: var(--spacing-xl);
    }

    .ant-modal-header {
      padding: var(--spacing-lg) var(--spacing-xl);
      border-bottom: 1px solid var(--border-light);
    }

    .ant-modal-footer {
      padding: var(--spacing-md) var(--spacing-xl);
      border-top: 1px solid var(--border-light);
    }

    .ant-drawer-body {
      padding: var(--spacing-lg);
    }

    .ant-drawer-header {
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
    }

    /* 統一彈出框和提示框間距 */
    .ant-popover-inner-content {
      padding: var(--spacing-md);
    }

    .ant-tooltip-inner {
      padding: var(--spacing-sm) var(--spacing-md);
    }

    /* === 📋 表格和數據展示優化 === */
    .ant-table-thead>tr>th {
      padding: var(--spacing-md) var(--spacing-lg);
      background: var(--bg-secondary);
      font-weight: 600;
    }

    .ant-table-tbody>tr>td {
      padding: var(--spacing-md) var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
    }

    /* === 📊 表格密度系統 === */
    /* 緊湊模式 */
    .table-density-compact .ant-table {
      font-size: 12px;
    }

    .table-density-compact .ant-table-thead>tr>th {
      padding: 6px 12px;
      font-size: 12px;
    }

    .table-density-compact .ant-table-tbody>tr>td {
      padding: 4px 12px;
    }

    .table-density-compact .ant-btn {
      height: 26px;
      padding: 0 8px;
      font-size: 12px;
    }

    .table-density-compact .ant-tag {
      padding: 0 6px;
      font-size: 11px;
      line-height: 18px;
    }

    /* 標準模式 (預設) */
    .table-density-standard .ant-table {
      font-size: 13px;
    }

    .table-density-standard .ant-table-thead>tr>th {
      padding: 12px 16px;
      font-size: 13px;
    }

    .table-density-standard .ant-table-tbody>tr>td {
      padding: 8px 16px;
    }

    /* 舒適模式 */
    .table-density-comfortable .ant-table {
      font-size: 14px;
    }

    .table-density-comfortable .ant-table-thead>tr>th {
      padding: 16px 24px;
      font-size: 14px;
    }

    .table-density-comfortable .ant-table-tbody>tr>td {
      padding: 12px 24px;
    }

    .table-density-comfortable .ant-btn {
      height: 36px;
      padding: 4px 16px;
      font-size: 14px;
    }

    .table-density-comfortable .ant-tag {
      padding: 2px 10px;
      font-size: 13px;
      line-height: 22px;
    }

    /* === TableDensitySwitcher 組件樣式 - 按照設計規範 === */
    .table-density-switcher {
      display: inline-flex;
      align-items: center;
      gap: 2px;
      padding: 2px;
      background: var(--bg-elevated);
      border-radius: 6px;
      border: 1px solid var(--border-light);
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .density-option {
      padding: 6px 12px;
      border: none;
      background: transparent;
      color: var(--text-tertiary);
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 4px;
      min-width: 70px;
      justify-content: center;
      position: relative;
    }

    .density-option:hover {
      background: var(--bg-hover);
      color: var(--text-secondary);
      transform: translateY(-1px);
    }

    .density-option.active {
      background: var(--brand-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3);
      transform: translateY(-1px);
    }

    .density-option.active:hover {
      background: var(--brand-primary-hover);
      transform: translateY(-1px);
    }

    /* 密度選項圖標 */
    .density-option-icon {
      width: 12px;
      height: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* 三種密度的可視化指示器 */
    .density-indicator {
      display: flex;
      flex-direction: column;
      gap: 1px;
      width: 12px;
      height: 12px;
    }

    .density-indicator-line {
      height: 2px;
      background: currentColor;
      border-radius: 1px;
    }

    /* 緊湊模式 */
    .density-compact .density-indicator-line {
      height: 1px;
      margin: 1px 0;
    }

    /* 標準模式 */
    .density-standard .density-indicator-line {
      height: 2px;
      margin: 1px 0;
    }

    /* 舒適模式 */
    .density-comfortable .density-indicator-line {
      height: 3px;
      margin: 0.5px 0;
    }

    /* === AdvancedFilterPanel 組件樣式 - 按照設計規範 === */
    .advanced-filter-panel {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
    }

    /* 篩選器標籤容器 */
    .filter-tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-items: center;
      min-height: 32px;
      padding: 4px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      background: var(--bg-elevated);
    }

    .filter-tags-container .ant-tag {
      margin: 0;
      border-radius: var(--radius-xs);
      font-size: 12px;
    }

    .filter-tags-container .ant-input {
      border: none;
      background: transparent;
      box-shadow: none;
      padding: 0;
      margin-left: 4px;
    }

    .filter-tags-container .ant-input:focus {
      border: none;
      box-shadow: none;
    }

    /* 數值範圍篩選器樣式 */
    .filter-number-range .ant-input-group-compact {
      display: flex;
      align-items: center;
    }

    .filter-number-range .ant-input-group-compact>* {
      border-radius: var(--radius-sm) !important;
    }

    .filter-number-range .ant-input-group-compact>*:not(:first-child):not(:last-child) {
      border-radius: 0 !important;
    }

    /* 滑塊篩選器增強樣式 */
    .filter-slider-container {
      padding: 8px 0;
    }

    .filter-slider-container .ant-slider {
      margin: 0;
    }

    .filter-slider-container .ant-slider-track {
      background: var(--brand-primary);
    }

    .filter-slider-container .ant-slider-handle {
      border-color: var(--brand-primary);
    }

    .filter-slider-container .ant-slider-handle:focus {
      border-color: var(--brand-primary);
      box-shadow: 0 0 0 5px rgba(24, 144, 255, 0.2);
    }

    /* 評分篩選器樣式 */
    .filter-rate-container {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4px 0;
    }

    .filter-rate-container .ant-rate {
      font-size: 16px;
    }

    /* 樹形選擇器增強樣式 */
    .advanced-filter-panel .ant-tree-select {
      width: 100%;
    }

    .advanced-filter-panel .ant-tree-select-dropdown {
      border-radius: var(--radius-md);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    /* 級聯選擇器樣式 */
    .advanced-filter-panel .ant-cascader {
      width: 100%;
    }

    .advanced-filter-panel .ant-cascader-dropdown {
      border-radius: var(--radius-md);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    /* 時間選擇器增強樣式 */
    .advanced-filter-panel .ant-picker {
      width: 100%;
      border-radius: var(--radius-sm);
    }

    .advanced-filter-panel .ant-picker-dropdown {
      border-radius: var(--radius-md);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    /* Switch 開關樣式增強 */
    .advanced-filter-panel .ant-switch {
      background: var(--bg-elevated);
    }

    .advanced-filter-panel .ant-switch-checked {
      background: var(--brand-primary);
    }

    /* 複選框組樣式 */
    .advanced-filter-panel .ant-checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .advanced-filter-panel .ant-checkbox-wrapper {
      margin: 0;
    }

    /* 單選框組樣式 */
    .advanced-filter-panel .ant-radio-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .advanced-filter-panel .ant-radio-wrapper {
      margin: 0;
    }

    /* 單選按鈕組樣式 */
    .advanced-filter-panel .ant-radio-group-solid .ant-radio-button-wrapper-checked:not(.ant-radio-button-wrapper-disabled) {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
    }

    /* 響應式篩選器佈局 */
    @media (max-width: 768px) {
      .advanced-filter-panel {
        padding: var(--spacing-md);
      }

      .filter-tags-container {
        min-height: 40px;
      }

      .filter-tags-container .ant-input {
        min-width: 100px;
      }

      .advanced-filter-panel .ant-checkbox-group,
      .advanced-filter-panel .ant-radio-group {
        gap: 12px;
      }
    }

    .filter-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      padding-bottom: var(--spacing-md);
      border-bottom: 1px solid var(--border-light);
    }

    .filter-panel-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .filter-panel-actions {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
    }

    .filter-item {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .filter-label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
    }

    .filter-description {
      font-size: 12px;
      color: var(--text-tertiary);
      margin-top: var(--spacing-xs);
      line-height: 1.4;
    }

    .filter-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: var(--spacing-md);
      border-top: 1px solid var(--border-light);
    }

    .filter-count {
      font-size: 13px;
      color: var(--text-tertiary);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .filter-active-count {
      font-weight: 600;
      color: var(--brand-primary);
    }

    /* 篩選器輸入框樣式優化 */
    .advanced-filter-panel .ant-input,
    .advanced-filter-panel .ant-select-selector {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }

    .advanced-filter-panel .ant-input:hover,
    .advanced-filter-panel .ant-select-selector:hover {
      border-color: var(--border-hover);
    }

    .advanced-filter-panel .ant-input:focus,
    .advanced-filter-panel .ant-select-focused .ant-select-selector {
      border-color: var(--brand-primary);
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
    }

    /* 統一彩色和提示框間距 */
    .ant-tag {
      margin: 2px 4px 2px 0;
      padding: 2px 8px;
      border-radius: var(--border-radius);
    }

    /* === 📱 響應式設計系統 === */
    /* 媒體查詢斷點 */
    :root {
      --breakpoint-xs: 480px;
      --breakpoint-sm: 576px;
      --breakpoint-md: 768px;
      --breakpoint-lg: 992px;
      --breakpoint-xl: 1200px;
      --breakpoint-xxl: 1600px;
    }

    /* 移動端優化 - 手機視圖 */
    @media (max-width: 576px) {

      /* 調整內容邊距 */
      .app-content {
        padding: 12px;
      }

      /* 工具列響應式 */
      .toolbar-actions {
        flex-direction: column;
        gap: 12px;
      }

      .toolbar-group {
        width: 100%;
        justify-content: space-between;
      }

      /* 表格滾動 */
      .table-wrapper {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .ant-table {
        min-width: 600px;
      }

      /* Modal 全螢幕 */
      .ant-modal {
        max-width: calc(100vw - 16px);
        margin: 8px;
      }

      .platform-modal--medium,
      .platform-modal--large,
      .platform-modal--xlarge {
        width: 100% !important;
      }

      /* 按鈕堆疊 */
      .ant-btn-group {
        display: flex;
        flex-direction: column;
        width: 100%;
      }

      .ant-btn-group .ant-btn {
        width: 100%;
        border-radius: var(--radius-sm) !important;
        margin: 4px 0;
      }

      /* 簡化表格 */
      .ant-table-thead>tr>th {
        padding: 8px;
        font-size: 12px;
      }

      .ant-table-tbody>tr>td {
        padding: 8px;
        font-size: 12px;
      }

      /* 隱藏次要欄位 */
      .hide-on-mobile {
        display: none !important;
      }

      /* 篩選器調整 */
      .advanced-filter-panel {
        width: 100% !important;
        max-width: none !important;
      }

      /* 卡片間距 */
      .ant-card {
        margin-bottom: 12px;
      }

      /* 統計卡片排列 */
      .stat-card {
        margin-bottom: 12px;
      }

      /* 分頁器簡化 */
      .ant-pagination-options {
        display: none;
      }

      /* 批次操作工具列 */
      .batch-action-toolbar {
        flex-direction: column;
        padding: 12px;
        gap: 8px;
      }

      .batch-actions {
        width: 100%;
      }

      /* 表格密度切換器 */
      .table-density-switcher {
        width: 100%;
        justify-content: space-around;
      }
    }

    /* 平板視圖 */
    @media (min-width: 577px) and (max-width: 992px) {

      /* 調整工具列 */
      .toolbar-actions {
        flex-wrap: wrap;
      }

      /* 表格密度 */
      .ant-table-thead>tr>th {
        padding: 10px 12px;
      }

      .ant-table-tbody>tr>td {
        padding: 10px 12px;
      }

      /* Modal 尺寸 */
      .platform-modal--xlarge {
        width: 90% !important;
        max-width: 800px !important;
      }

      /* 統計卡片 */
      .kpi-grid .ant-col {
        margin-bottom: 16px;
      }

      /* 隱藏部分欄位 */
      .hide-on-tablet {
        display: none !important;
      }
    }

    /* 桌面視圖優化 */
    @media (min-width: 1200px) {

      /* 最大內容寬度 */
      .app-content {
        max-width: 1600px;
        margin: 0 auto;
      }

      /* 大螢幕表格優化 */
      .ant-table {
        font-size: 14px;
      }

      /* 多欄布局 */
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
      }
    }

    /* 通用響應式輔助類 */
    .mobile-only {
      display: none;
    }

    @media (max-width: 576px) {
      .mobile-only {
        display: block;
      }

      .desktop-only {
        display: none;
      }
    }

    .tablet-only {
      display: none;
    }

    @media (min-width: 577px) and (max-width: 992px) {
      .tablet-only {
        display: block;
      }
    }

    /* === 空狀態設計系統 - 按照設計規範 === */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-2xl) var(--spacing-lg);
      text-align: center;
      min-height: 300px;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: var(--spacing-lg);
      opacity: 0.6;
    }

    .empty-state-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 var(--spacing-sm) 0;
    }

    .empty-state-description {
      font-size: 14px;
      color: var(--text-tertiary);
      margin: 0 0 var(--spacing-xl) 0;
      max-width: 400px;
      line-height: 1.5;
    }

    .empty-state-action {
      margin-top: var(--spacing-md);
    }

    /* 空狀態變體 */
    .empty-state--initial {
      background: linear-gradient(135deg, rgba(24, 144, 255, 0.05) 0%, rgba(114, 46, 209, 0.05) 100%);
      border-radius: var(--radius-lg);
      border: 1px dashed var(--border-light);
    }

    .empty-state--initial .empty-state-icon {
      color: var(--brand-primary);
    }

    .empty-state--no-results .empty-state-icon {
      color: var(--brand-warning);
    }

    .empty-state--error .empty-state-icon {
      color: var(--brand-danger);
    }

    .empty-state--loading {
      opacity: 0.7;
    }

    /* 觸控優化 */
    @media (pointer: coarse) {

      /* 增大觸控目標 */
      .ant-btn {
        min-height: 44px;
      }

      .platform-btn {
        min-height: 44px;
      }

      .ant-input {
        min-height: 44px;
      }

      .ant-select-selector {
        min-height: 44px !important;
      }

      /* 增大可點擊區域 */
      .ant-checkbox-wrapper {
        padding: 8px;
      }

      .ant-radio-wrapper {
        padding: 8px;
      }
    }

    /* 統一步驟條間距 */
    .ant-steps {
      margin-bottom: var(--spacing-lg);
    }

    .ant-steps-item {
      padding-left: 0;
      margin-right: var(--spacing-xl);
    }

    /* === 🎛️ 特定頁面區域間距優化 === */
    /* 表格操作區域 */
    .table-actions {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    /* 搜尋和篩選器區域 */
    .search-filters {
      display: flex;
      gap: var(--spacing-md);
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-md);
      background: var(--bg-secondary);
      border-radius: var(--border-radius);
    }

    /* 頁面頂部工具列 */
    .page-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-md) 0;
      border-bottom: 1px solid var(--border-light);
    }

    /* 統計卡片之間的間距 */
    .stats-card {
      margin-bottom: var(--spacing-md);
    }

    /* 資源列表項目間距 */
    .resource-item {
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-light);
    }

    /* 通知和警報項目間距 */
    .notification-item,
    .alert-item {
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
      border-left: 4px solid var(--border-light);
    }

    /* 用戶管理和設定頁面特殊間距 */
    .user-profile-section {
      margin-bottom: var(--spacing-xl);
      padding: var(--spacing-lg);
      background: var(--bg-elevated);
      border-radius: var(--border-radius);
    }

    .settings-section {
      margin-bottom: var(--spacing-xl);
      padding: var(--spacing-lg);
      border: 1px solid var(--border-light);
      border-radius: var(--border-radius);
    }

    /* === 🎨 視覺層次最後調整 === */
    /* 統一文字對比和層次 */
    .ant-table-thead>tr>th {
      color: var(--text-primary);
      font-weight: 600;
      font-size: 14px;
    }

    .ant-table-tbody>tr>td {
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* 統一按鈕文字大小 */
    .ant-btn {
      font-size: 14px;
      font-weight: 500;
      line-height: 1.5;
    }

    /* 統一卡片標題樣式 */
    .ant-card-head-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* 統一表單標籤樣式 */
    .ant-form-item-label>label {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    /* 統一標籤和徽章文字 */
    .ant-tag {
      font-size: 12px;
      font-weight: 500;
    }

    /* 統一導航文字 */
    .ant-menu-item {
      font-size: 14px;
      font-weight: 500;
    }

    /* 統一頁面標題層次 */
    .page-title {
      font-size: 24px;
      font-weight: 600;
      line-height: 1.2;
      color: var(--text-primary);
    }

    .page-subtitle {
      font-size: 16px;
      font-weight: 400;
      line-height: 1.4;
      color: var(--text-tertiary);
    }

    /* 統一數據顯示字體 */
    .kpi-value {
      font-family: 'SF Mono', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
      font-weight: 600;
    }

    .metric-value {
      font-family: 'SF Mono', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
      font-weight: 500;
    }

    /* 響應式佈局優化 */
    @media (max-width: 1200px) {
      .kpi-grid {
        margin-bottom: var(--spacing-md);
      }

      .chart-card {
        margin-bottom: var(--spacing-md);
      }

      .page-header {
        margin-bottom: var(--spacing-md);
      }
    }

    /* 小螢幕優化 */
    @media (max-width: 768px) {
      .page-header {
        margin-bottom: var(--spacing-sm);
        padding: var(--spacing-xs) 0;
      }

      .kpi-grid {
        margin-bottom: var(--spacing-sm);
      }
    }

    /* 響應式 KPI 卡片 */
    @media (max-width: 768px) {
      .contextual-kpi-card {
        padding: var(--spacing-md);
        height: 100px;
        /* 小螢幕使用較小固定高度 */
      }

      .kpi-value {
        font-size: 24px;
      }

      .kpi-title {
        font-size: 13px;
      }

      .kpi-icon {
        width: 20px;
        height: 20px;
        font-size: 12px;
      }
    }

    /* === 響應式設計優化 === */
    @media (max-width: 1200px) {
      .settings-layout {
        padding: var(--spacing-lg);
      }

      .settings-form-row {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }

      .platform-table-header {
        flex-direction: column;
        gap: var(--spacing-md);
        align-items: stretch;
      }

      .platform-table-actions {
        justify-content: flex-end;
      }
    }




    /* === 🚦 高級狀態指示器系統 === */
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: relative;
      overflow: hidden;
    }

    .status-indicator::before {
      content: '';
      position: absolute;
      left: 8px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    .status-indicator--animated::before {
      animation: statusPulse 2s ease-in-out infinite;
    }

    @keyframes statusPulse {

      0%,
      100% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: 0.6;
        transform: scale(0.8);
      }
    }

    /* 健康狀態 */
    .status-indicator--healthy {
      background: linear-gradient(135deg, rgba(82, 196, 26, 0.15) 0%, rgba(82, 196, 26, 0.05) 100%);
      color: var(--brand-success);
      border: 1px solid rgba(82, 196, 26, 0.3);
    }

    /* 警告狀態 */
    .status-indicator--warning {
      background: linear-gradient(135deg, rgba(250, 173, 20, 0.15) 0%, rgba(250, 173, 20, 0.05) 100%);
      color: var(--brand-warning);
      border: 1px solid rgba(250, 173, 20, 0.3);
    }

    /* 危險狀態 */
    .status-indicator--critical {
      background: linear-gradient(135deg, rgba(255, 77, 79, 0.15) 0%, rgba(255, 77, 79, 0.05) 100%);
      color: var(--brand-danger);
      border: 1px solid rgba(255, 77, 79, 0.3);
    }

    /* 離線狀態 */
    .status-indicator--offline {
      background: linear-gradient(135deg, rgba(140, 140, 140, 0.15) 0%, rgba(140, 140, 140, 0.05) 100%);
      color: var(--text-quaternary);
      border: 1px solid rgba(140, 140, 140, 0.3);
    }

    /* === 📊 資料視覺化增強 === */
    .progress-bar {
      position: relative;
      width: 100%;
      height: 8px;
      background: var(--bg-elevated);
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid var(--border-light);
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--brand-primary) 0%, var(--brand-primary-hover) 100%);
      border-radius: 4px;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .progress-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 0.3) 50%,
          rgba(255, 255, 255, 0) 100%);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%);
      }

      100% {
        transform: translateX(100%);
      }
    }

    /* 進度條變體 */
    .progress-bar--success .progress-bar-fill {
      background: linear-gradient(90deg, var(--brand-success) 0%, #73d13d 100%);
    }

    .progress-bar--warning .progress-bar-fill {
      background: linear-gradient(90deg, var(--brand-warning) 0%, #ffc53d 100%);
    }

    .progress-bar--danger .progress-bar-fill {
      background: linear-gradient(90deg, var(--brand-danger) 0%, #ff7875 100%);
    }

    /* === 💡 智能提示系統 === */
    .smart-tooltip {
      position: relative;
      cursor: help;
    }

    .smart-tooltip::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-overlay);
      color: var(--text-primary);
      padding: 8px 12px;
      border-radius: var(--radius-md);
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      z-index: 1000;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-lg);
      backdrop-filter: blur(12px);
    }

    .smart-tooltip::before {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(2px);
      border: 4px solid transparent;
      border-top-color: var(--bg-overlay);
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
    }

    .smart-tooltip:hover::after,
    .smart-tooltip:hover::before {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(-4px);
    }

    /* === 🎯 焦點管理系統 === */
    .focus-visible {
      outline: 2px solid var(--brand-primary);
      outline-offset: 2px;
      border-radius: var(--radius-sm);
    }

    .skip-link {
      position: absolute;
      top: -40px;
      left: 6px;
      background: var(--bg-elevated);
      color: var(--text-primary);
      padding: 8px 16px;
      text-decoration: none;
      border-radius: var(--radius-sm);
      border: 2px solid var(--brand-primary);
      z-index: 10000;
      font-weight: 500;
    }

    .skip-link:focus {
      top: 6px;
    }

    /* === 🔊 無障礙支援 === */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .sr-only-focusable:focus {
      position: static;
      width: auto;
      height: auto;
      padding: inherit;
      margin: inherit;
      overflow: visible;
      clip: auto;
      white-space: normal;
    }

    /* === 🎮 鍵盤快捷鍵支援 === */
    .keyboard-shortcut {
      display: inline-flex;
      align-items: center;
      gap: 2px;
      font-size: 11px;
      color: var(--text-tertiary);
      background: var(--bg-elevated);
      padding: 2px 6px;
      border-radius: var(--radius-xs);
      border: 1px solid var(--border-light);
      font-family: monospace;
      margin-left: 8px;
    }

    .keyboard-shortcut-key {
      background: var(--bg-hover);
      padding: 1px 4px;
      border-radius: 2px;
      border: 1px solid var(--border-light);
      min-width: 16px;
      text-align: center;
    }

    /* === 📱 觸控優化增強 === */
    @media (hover: none) and (pointer: coarse) {

      /* 移除 hover 效果 */
      .hover-lift:hover {
        transform: none;
        box-shadow: none;
      }

      /* 增大點擊區域 */
      .table-row-actions .platform-btn {
        min-width: 44px;
        min-height: 44px;
      }

      /* 優化觸控反饋 */
      .platform-btn:active {
        background: var(--bg-active);
        transform: scale(0.95);
      }
    }

    /* 🎨 通用樣式類別系統 */
    /* 文字顏色 */
    .text-primary {
      color: var(--c-gray-900) !important;
    }

    .text-secondary {
      color: var(--c-gray-700) !important;
    }

    .text-tertiary {
      color: var(--c-gray-500) !important;
    }

    .text-muted {
      color: var(--c-gray-400) !important;
    }

    /* 背景顏色 */
    .bg-primary {
      background: var(--bg-primary) !important;
    }

    .bg-secondary {
      background: var(--bg-secondary) !important;
    }

    .bg-tertiary {
      background: var(--bg-tertiary) !important;
    }

    .bg-hover {
      background: var(--bg-hover) !important;
    }

    .bg-active {
      background: var(--bg-active) !important;
    }

    /* 邊框顏色 */
    .border-primary {
      border-color: var(--c-gray-200) !important;
    }

    .border-secondary {
      border-color: var(--c-gray-300) !important;
    }

    /* 陰影 */
    .shadow-sm {
      box-shadow: var(--shadow-sm) !important;
    }

    .shadow-md {
      box-shadow: var(--shadow-md) !important;
    }

    .shadow-lg {
      box-shadow: var(--shadow-lg) !important;
    }

    .shadow-xl {
      box-shadow: var(--shadow-xl) !important;
    }

    /* 間距 */
    .p-xs {
      padding: var(--space-xs) !important;
    }

    .p-sm {
      padding: var(--space-sm) !important;
    }

    .p-md {
      padding: var(--space-md) !important;
    }

    .p-lg {
      padding: var(--space-lg) !important;
    }

    .p-xl {
      padding: var(--space-xl) !important;
    }

    .m-xs {
      margin: var(--space-xs) !important;
    }

    .m-sm {
      margin: var(--space-sm) !important;
    }

    .m-md {
      margin: var(--space-md) !important;
    }

    .m-lg {
      margin: var(--space-lg) !important;
    }

    .m-xl {
      margin: var(--space-xl) !important;
    }

    /* 圓角 */
    .rounded-xs {
      border-radius: var(--radius-xs) !important;
    }

    .rounded-sm {
      border-radius: var(--radius-sm) !important;
    }

    .rounded-md {
      border-radius: var(--radius-md) !important;
    }

    .rounded-lg {
      border-radius: var(--radius-lg) !important;
    }

    .rounded-xl {
      border-radius: var(--radius-xl) !important;
    }

    /* === 🚀 性能優化工具類 === */
    .will-change-transform {
      will-change: transform;
    }

    .will-change-opacity {
      will-change: opacity;
    }

    .gpu-accelerated {
      transform: translateZ(0);
      backface-visibility: hidden;
    }

    .smooth-scroll {
      scroll-behavior: smooth;
    }

    .no-scroll {
      overflow: hidden;
    }

    .hide-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .hide-scrollbar::-webkit-scrollbar {
      display: none;
    }

    /* === 🎯 佈局工具類 === */
    .flex-center {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .flex-between {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .flex-start {
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }

    .flex-end {
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    .flex-column {
      display: flex;
      flex-direction: column;
    }

    .flex-column-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-md);
    }

    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--spacing-md);
    }

    .grid-4 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--spacing-md);
    }

    /* === 📐 尺寸工具類 === */
    .w-full {
      width: 100%;
    }

    .h-full {
      height: 100%;
    }

    .w-fit {
      width: fit-content;
    }

    .h-fit {
      height: fit-content;
    }

    .max-w-xs {
      max-width: 20rem;
    }

    .max-w-sm {
      max-width: 24rem;
    }

    .max-w-md {
      max-width: 28rem;
    }

    .max-w-lg {
      max-width: 32rem;
    }

    .max-w-xl {
      max-width: 36rem;
    }

    /* === 🎨 狀態工具類 === */
    .is-loading {
      pointer-events: none;
      opacity: 0.7;
      cursor: wait;
    }

    .is-disabled {
      pointer-events: none;
      opacity: 0.5;
      user-select: none;
    }

    .is-hidden {
      display: none !important;
    }

    .is-invisible {
      visibility: hidden !important;
    }

    .is-clickable {
      cursor: pointer;
    }

    .is-not-clickable {
      cursor: not-allowed;
    }

    /* === 🔧 文字工具類 === */
    .text-center {
      text-align: center;
    }

    .text-left {
      text-align: left;
    }

    .text-right {
      text-align: right;
    }

    .text-truncate {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .text-truncate-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .text-truncate-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .text-uppercase {
      text-transform: uppercase;
    }

    .text-lowercase {
      text-transform: lowercase;
    }

    .text-capitalize {
      text-transform: capitalize;
    }

    .font-mono {
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
    }

    .font-bold {
      font-weight: 700;
    }

    .font-semibold {
      font-weight: 600;
    }

    .font-medium {
      font-weight: 500;
    }

    .font-normal {
      font-weight: 400;
    }

    /* === 🌙 主題切換系統 === */
    [data-theme="light"] {
      --bg-page: #ffffff;
      --bg-container: #f8f9fa;
      --bg-elevated: #ffffff;
      --bg-overlay: #ffffff;
      --bg-hover: rgba(0, 0, 0, 0.04);
      --bg-active: rgba(0, 0, 0, 0.08);
      --bg-selected: rgba(24, 144, 255, 0.1);

      --text-primary: rgba(0, 0, 0, 0.88);
      --text-secondary: rgba(0, 0, 0, 0.65);
      --text-tertiary: rgba(0, 0, 0, 0.45);
      --text-quaternary: rgba(0, 0, 0, 0.25);
      --text-disabled: rgba(0, 0, 0, 0.15);

      --border-base: rgba(0, 0, 0, 0.06);
      --border-light: rgba(0, 0, 0, 0.04);
      --border-focus: var(--brand-primary);
      --border-hover: rgba(0, 0, 0, 0.12);

      --glass-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.6) 100%);
      --glass-border: 1px solid rgba(0, 0, 0, 0.08);
      --glass-backdrop: blur(20px) saturate(180%);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.12), inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }

    /* 主題切換器組件 */
    .theme-switcher {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: 20px;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .theme-option {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      color: var(--text-tertiary);
      position: relative;
    }

    .theme-option:hover {
      color: var(--text-secondary);
      background: var(--bg-hover);
    }

    .theme-option.active {
      color: var(--text-primary);
      background: var(--brand-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3);
    }

    .theme-option.active::after {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 18px;
      padding: 2px;
      background: linear-gradient(45deg, var(--brand-primary), var(--brand-primary-hover));
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask-composite: xor;
      -webkit-mask-composite: xor;
    }

    /* === 🎭 動態配色系統 === */
    .dynamic-theme-primary {
      --brand-primary: #1890ff;
      --brand-primary-hover: #40a9ff;
      --brand-primary-active: #096dd9;
      --brand-primary-bg: rgba(24, 144, 255, 0.1);
    }

    .dynamic-theme-purple {
      --brand-primary: #722ed1;
      --brand-primary-hover: #9254de;
      --brand-primary-active: #531dab;
      --brand-primary-bg: rgba(114, 46, 209, 0.1);
    }

    .dynamic-theme-green {
      --brand-primary: #52c41a;
      --brand-primary-hover: #73d13d;
      --brand-primary-active: #389e0d;
      --brand-primary-bg: rgba(82, 196, 26, 0.1);
    }

    .dynamic-theme-orange {
      --brand-primary: #fa8c16;
      --brand-primary-hover: #ffa940;
      --brand-primary-active: #d46b08;
      --brand-primary-bg: rgba(250, 140, 22, 0.1);
    }

    .dynamic-theme-red {
      --brand-primary: #ff4d4f;
      --brand-primary-hover: #ff7875;
      --brand-primary-active: #d9363e;
      --brand-primary-bg: rgba(255, 77, 79, 0.1);
    }

    /* 配色選擇器 */
    .color-palette-selector {
      display: flex;
      gap: 8px;
      padding: 12px;
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
    }

    .color-palette-option {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s ease;
      position: relative;
    }

    .color-palette-option:hover {
      transform: scale(1.2);
    }

    .color-palette-option.active {
      border-color: rgba(255, 255, 255, 0.8);
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
    }

    .color-palette-option.active::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 12px;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    /* 預設配色 */
    .color-blue {
      background: #1890ff;
    }

    .color-purple {
      background: #722ed1;
    }

    .color-green {
      background: #52c41a;
    }

    .color-orange {
      background: #fa8c16;
    }

    .color-red {
      background: #ff4d4f;
    }

    /* === 📱 Progressive Web App 支援 === */
    .pwa-install-prompt {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--spacing-lg);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
      max-width: 320px;
      z-index: 9999;
      animation: slideInUp 0.3s ease-out;
    }

    .pwa-install-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: var(--spacing-md);
    }

    .pwa-install-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-primary-hover));
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }

    .pwa-install-text {
      flex: 1;
    }

    .pwa-install-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 4px 0;
    }

    .pwa-install-description {
      font-size: 12px;
      color: var(--text-tertiary);
      margin: 0;
    }

    .pwa-install-actions {
      display: flex;
      gap: var(--spacing-sm);
      justify-content: flex-end;
    }

    /* === 🎨 高級色彩工具 === */
    .color-preview {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 1px solid var(--border-light);
      display: inline-block;
      vertical-align: middle;
      margin-right: 8px;
    }

    .color-swatch {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 8px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      font-size: 12px;
      font-family: monospace;
      color: var(--text-secondary);
    }

    /* === 🚀 載入骨架屏系統 === */
    .skeleton {
      background: linear-gradient(90deg, var(--bg-elevated) 25%, var(--bg-hover) 50%, var(--bg-elevated) 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s infinite;
      border-radius: var(--radius-sm);
    }

    @keyframes skeleton-loading {
      0% {
        background-position: 200% 0;
      }

      100% {
        background-position: -200% 0;
      }
    }

    .skeleton-text {
      height: 1em;
      margin-bottom: 0.5em;
    }

    .skeleton-text:last-child {
      margin-bottom: 0;
      width: 75%;
    }

    .skeleton-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    .skeleton-button {
      width: 80px;
      height: 32px;
    }

    .skeleton-card {
      width: 100%;
      height: 200px;
    }

    /* 字體 */
    .font-xs {
      font-size: var(--font-size-xs) !important;
    }

    .font-sm {
      font-size: var(--font-size-sm) !important;
    }

    .font-md {
      font-size: var(--font-size-md) !important;
    }

    .font-lg {
      font-size: var(--font-size-lg) !important;
    }

    .font-xl {
      font-size: var(--font-size-xl) !important;
    }

    /* === 🚨 錯誤邊界與異常處理 === */
    .error-boundary {
      padding: var(--spacing-2xl);
      text-align: center;
      background: linear-gradient(135deg, rgba(255, 77, 79, 0.05) 0%, rgba(255, 77, 79, 0.02) 100%);
      border: 1px dashed rgba(255, 77, 79, 0.3);
      border-radius: var(--radius-lg);
      margin: var(--spacing-lg) 0;
    }

    .error-boundary-icon {
      font-size: 48px;
      color: var(--brand-danger);
      margin-bottom: var(--spacing-md);
      opacity: 0.8;
    }

    .error-boundary-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 var(--spacing-sm) 0;
    }

    .error-boundary-message {
      font-size: 14px;
      color: var(--text-tertiary);
      margin: 0 0 var(--spacing-lg) 0;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    .error-boundary-details {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      margin: var(--spacing-md) 0;
      text-align: left;
      font-family: monospace;
      font-size: 12px;
      color: var(--text-secondary);
      max-height: 200px;
      overflow-y: auto;
    }

    .error-boundary-actions {
      display: flex;
      gap: var(--spacing-md);
      justify-content: center;
      flex-wrap: wrap;
    }

    /* === 🔔 系統通知增強 === */
    .notification-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      max-width: 400px;
      pointer-events: none;
    }

    .notification-item {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
      pointer-events: auto;
      animation: slideInRight 0.3s ease-out;
      position: relative;
      overflow: hidden;
    }

    .notification-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--brand-primary);
    }

    .notification-item.success::before {
      background: var(--brand-success);
    }

    .notification-item.warning::before {
      background: var(--brand-warning);
    }

    .notification-item.error::before {
      background: var(--brand-danger);
    }

    .notification-header {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 8px;
    }

    .notification-icon {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      color: white;
      font-size: 12px;
      margin-top: 2px;
    }

    .notification-content {
      flex: 1;
      min-width: 0;
    }

    .notification-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 4px 0;
    }

    .notification-message {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.4;
      margin: 0;
    }

    .notification-close {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 20px;
      height: 20px;
      border: none;
      background: none;
      color: var(--text-tertiary);
      cursor: pointer;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .notification-close:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    /* === 💾 用戶偏好設定系統 === */
    .preferences-panel {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
    }

    .preference-section {
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
    }

    .preference-section:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .preference-label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: var(--spacing-sm);
    }

    .preference-description {
      font-size: 12px;
      color: var(--text-tertiary);
      margin-bottom: var(--spacing-md);
      line-height: 1.4;
    }

    .preference-control {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }

    /* 切換開關 */
    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: var(--bg-hover);
      border-radius: 12px;
      border: 1px solid var(--border-light);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .toggle-switch.active {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
    }

    .toggle-switch-thumb {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch.active .toggle-switch-thumb {
      transform: translateX(20px);
    }

    /* === 🌐 國際化準備 === */
    [dir="rtl"] {
      --text-align-start: right;
      --text-align-end: left;
      --margin-start: margin-right;
      --margin-end: margin-left;
      --padding-start: padding-right;
      --padding-end: padding-left;
    }

    [dir="ltr"] {
      --text-align-start: left;
      --text-align-end: right;
      --margin-start: margin-left;
      --margin-end: margin-right;
      --padding-start: padding-left;
      --padding-end: padding-right;
    }

    .text-start {
      text-align: var(--text-align-start);
    }

    .text-end {
      text-align: var(--text-align-end);
    }

    .ms-auto {
      margin-inline-start: auto;
    }

    .me-auto {
      margin-inline-end: auto;
    }

    /* RTL 特定調整 */
    [dir="rtl"] .table-row-actions {
      flex-direction: row-reverse;
    }

    [dir="rtl"] .breadcrumb-separator {
      transform: scaleX(-1);
    }

    [dir="rtl"] .dropdown-arrow {
      transform: scaleX(-1);
    }

    /* === 🎯 最終優化與清理 === */

    /* 減少不必要的重繪 */
    .optimization-layer {
      transform: translateZ(0);
      backface-visibility: hidden;
      perspective: 1000px;
    }

    /* 優化文字渲染 */
    .crisp-text {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }

    /* 減少 CLS (Cumulative Layout Shift) */
    .layout-stable {
      contain: layout style paint;
    }

    /* 優化交互性能 */
    .interactive-element {
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    /* 媒體查詢優化 */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    @media (prefers-color-scheme: light) {
      :root:not([data-theme]) {
        --bg-page: #ffffff;
        --bg-container: #f8f9fa;
        --text-primary: rgba(0, 0, 0, 0.88);
        --text-secondary: rgba(0, 0, 0, 0.65);
      }
    }

    /* 高對比度模式支援 */
    @media (prefers-contrast: high) {
      :root {
        --border-base: rgba(0, 0, 0, 0.3);
        --border-light: rgba(0, 0, 0, 0.2);
        --text-tertiary: rgba(0, 0, 0, 0.7);
      }
    }

    .font-normal {
      font-weight: var(--font-weight-normal) !important;
    }

    /* === 📊 SRE 專用實時數據可視化組件 === */
    .metric-chart-container {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
      position: relative;
      overflow: hidden;
    }

    .metric-chart-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--spacing-lg);
    }

    .metric-chart-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 4px 0;
    }

    .metric-chart-subtitle {
      font-size: 12px;
      color: var(--text-tertiary);
      margin: 0;
    }

    .metric-chart-controls {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    .time-range-selector {
      display: flex;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      overflow: hidden;
    }

    .time-range-option {
      padding: 4px 12px;
      font-size: 12px;
      color: var(--text-tertiary);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .time-range-option:hover {
      background: var(--bg-hover);
      color: var(--text-secondary);
    }

    .time-range-option.active {
      background: var(--brand-primary);
      color: white;
    }

    /* 實時指標顯示 */
    .realtime-metric {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-md);
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      transition: all 0.3s ease;
    }

    .realtime-metric:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .realtime-metric-icon {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: white;
    }

    .realtime-metric-content {
      flex: 1;
      min-width: 0;
    }

    .realtime-metric-label {
      font-size: 12px;
      color: var(--text-tertiary);
      margin: 0 0 2px 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .realtime-metric-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
      font-variant-numeric: tabular-nums;
    }

    .realtime-metric-trend {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      font-weight: 500;
      margin-top: 4px;
    }

    .trend-up {
      color: var(--brand-success);
    }

    .trend-down {
      color: var(--brand-danger);
    }

    .trend-stable {
      color: var(--text-tertiary);
    }

    /* CPU/Memory 使用率環形圖 */
    .circular-progress {
      position: relative;
      width: 60px;
      height: 60px;
    }

    .circular-progress-svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .circular-progress-track {
      fill: none;
      stroke: var(--bg-hover);
      stroke-width: 4;
    }

    .circular-progress-fill {
      fill: none;
      stroke-width: 4;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s ease;
    }

    .circular-progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* 網路流量圖表 */
    .network-traffic-chart {
      height: 120px;
      position: relative;
      overflow: hidden;
      background: linear-gradient(180deg, var(--bg-elevated) 0%, var(--bg-hover) 100%);
      border-radius: var(--radius-sm);
      padding: var(--spacing-sm);
    }

    .traffic-line {
      position: absolute;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, var(--brand-primary) 0%, transparent 100%);
      animation: traffic-flow 3s ease-in-out infinite;
    }

    @keyframes traffic-flow {

      0%,
      100% {
        opacity: 0.3;
      }

      50% {
        opacity: 1;
      }
    }

    /* 服務健康狀態網格 */
    .service-health-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: var(--spacing-sm);
      padding: var(--spacing-md);
    }

    .service-health-item {
      aspect-ratio: 1;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-sm);
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .service-health-item:hover {
      transform: scale(1.02);
      box-shadow: var(--shadow-md);
    }

    .service-health-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--text-quaternary);
    }

    .service-health-item.healthy::before {
      background: var(--brand-success);
    }

    .service-health-item.warning::before {
      background: var(--brand-warning);
    }

    .service-health-item.critical::before {
      background: var(--brand-danger);
    }

    .service-health-icon {
      font-size: 24px;
      margin-bottom: var(--spacing-xs);
      opacity: 0.8;
    }

    .service-health-name {
      font-size: 11px;
      color: var(--text-secondary);
      text-align: center;
      margin: 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .service-health-status {
      font-size: 8px;
      padding: 1px 4px;
      border-radius: 2px;
      margin-top: 2px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    /* 警報瀑布流 */
    .alert-waterfall {
      max-height: 400px;
      overflow-y: auto;
      padding: var(--spacing-sm);
      background: var(--bg-elevated);
      border-radius: var(--radius-md);
    }

    .alert-item {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm);
      border-radius: var(--radius-sm);
      margin-bottom: var(--spacing-xs);
      transition: all 0.2s ease;
      border-left: 3px solid transparent;
    }

    .alert-item:hover {
      background: var(--bg-hover);
    }

    .alert-item.critical {
      border-left-color: var(--brand-danger);
      background: rgba(255, 77, 79, 0.05);
    }

    .alert-item.warning {
      border-left-color: var(--brand-warning);
      background: rgba(250, 173, 20, 0.05);
    }

    .alert-item.info {
      border-left-color: var(--brand-primary);
      background: rgba(24, 144, 255, 0.05);
    }

    .alert-icon {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: white;
      margin-top: 2px;
    }

    .alert-content {
      flex: 1;
      min-width: 0;
    }

    .alert-title {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0 0 2px 0;
    }

    .alert-message {
      font-size: 12px;
      color: var(--text-secondary);
      margin: 0 0 4px 0;
      line-height: 1.3;
    }

    .alert-meta {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: 10px;
      color: var(--text-tertiary);
    }

    .alert-timestamp {
      font-variant-numeric: tabular-nums;
    }

    .alert-source {
      background: var(--bg-hover);
      padding: 1px 4px;
      border-radius: 2px;
      font-family: monospace;
    }

    /* 系統拓撲圖 */
    .topology-container {
      position: relative;
      min-height: 300px;
      background: radial-gradient(circle at 50% 50%, var(--bg-elevated) 0%, var(--bg-page) 100%);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .topology-node {
      position: absolute;
      width: 60px;
      height: 60px;
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .topology-node:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(24, 144, 255, 0.3);
    }

    .topology-node.online {
      border-color: var(--brand-success);
      box-shadow: 0 0 10px rgba(82, 196, 26, 0.2);
    }

    .topology-node.offline {
      border-color: var(--brand-danger);
      box-shadow: 0 0 10px rgba(255, 77, 79, 0.2);
      opacity: 0.7;
    }

    .topology-connection {
      position: absolute;
      height: 2px;
      background: linear-gradient(90deg, var(--brand-primary) 0%, transparent 50%, var(--brand-primary) 100%);
      transform-origin: left center;
      opacity: 0.6;
      animation: data-flow 2s linear infinite;
    }

    @keyframes data-flow {
      0% {
        background-position: -100% 0;
      }

      100% {
        background-position: 100% 0;
      }
    }

    .topology-label {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      color: var(--text-tertiary);
      white-space: nowrap;
    }

    .font-medium {
      font-weight: var(--font-weight-medium) !important;
    }

    .font-semibold {
      font-weight: var(--font-weight-semibold) !important;
    }

    .font-bold {
      font-weight: var(--font-weight-bold) !important;
    }

    /* 處理歷史時間線樣式 */
    .incident-timeline {
      padding: 8px 0;
      margin: 0;
      list-style: none;
      position: relative;
    }

    /* 時間軸連接線 */
    .incident-timeline::before {
      content: '';
      position: absolute;
      left: 7px;
      top: 20px;
      bottom: 20px;
      width: 2px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
      border-radius: 1px;
    }

    .timeline-item {
      position: relative;
      padding: 8px 0 8px 24px;
      color: rgba(255, 255, 255, 0.85);
      font-size: 13px;
      line-height: 1.4;
    }

    .timeline-item:last-child {
      padding-bottom: 0;
    }

    .timeline-dot {
      position: absolute;
      left: 0;
      top: 12px;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #1890ff;
      border: 2px solid rgba(26, 29, 35, 1);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.2);
      z-index: 1;
    }

    .timeline-dot-completed {
      background: #52c41a;
      box-shadow: 0 0 0 1px rgba(82, 196, 26, 0.3), 0 0 8px rgba(82, 196, 26, 0.2);
    }

    .timeline-dot-current {
      background: #faad14;
      animation: timeline-pulse 2s infinite;
      box-shadow: 0 0 0 1px rgba(250, 173, 20, 0.4), 0 0 8px rgba(250, 173, 20, 0.3);
    }

    .timeline-dot-default {
      background: rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    .timeline-content {
      margin-left: 4px;
    }

    .timeline-title {
      font-weight: 500;
      margin-bottom: 2px;
      color: rgba(255, 255, 255, 0.9);
    }

    .timeline-description {
      color: rgba(255, 255, 255, 0.6);
      font-size: 12px;
    }

    @keyframes timeline-pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(250, 173, 20, 0.4);
      }

      70% {
        box-shadow: 0 0 0 4px rgba(250, 173, 20, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(250, 173, 20, 0);
      }
    }

    /* ===== Dashboard Layout System ===== */
    .dashboard-container {
      display: grid;
      grid-template-columns: 260px 1fr;
      grid-template-rows: 64px 1fr;
      grid-template-areas:
        "sidebar header"
        "sidebar main";
      min-height: 100vh;
      background: var(--bg-page);
    }

    .dashboard-header {
      grid-area: header;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--spacing-lg);
      background: var(--bg-surface);
      border-bottom: 1px solid var(--border-light);
      z-index: 100;
    }

    .dashboard-sidebar {
      grid-area: sidebar;
      background: var(--bg-surface);
      border-right: 1px solid var(--border-light);
      overflow-y: auto;
      z-index: 99;
    }

    .dashboard-main {
      grid-area: main;
      padding: var(--spacing-lg);
      overflow-y: auto;
      background: var(--bg-page);
    }

    /* Dashboard Grid System */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
    }

    .dashboard-widget {
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      min-height: 200px;
    }

    .dashboard-widget:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1);
      border-color: var(--accent-blue);
    }

    .widget-small {
      grid-column: span 3;
    }

    .widget-medium {
      grid-column: span 4;
    }

    .widget-large {
      grid-column: span 6;
    }

    .widget-xlarge {
      grid-column: span 8;
    }

    .widget-full {
      grid-column: span 12;
    }

    .widget-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-md);
      padding-bottom: var(--spacing-sm);
      border-bottom: 1px solid var(--border-light);
    }

    .widget-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .widget-icon {
      width: 20px;
      height: 20px;
      color: var(--accent-blue);
    }

    .widget-actions {
      display: flex;
      gap: var(--spacing-xs);
    }

    .widget-action {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .widget-action:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .widget-content {
      flex: 1;
      min-height: 0;
      height: calc(100% - 60px);
    }

    /* Draggable Widget System */
    .widget-draggable {
      cursor: move;
    }

    .widget-draggable:hover .widget-drag-handle {
      opacity: 1;
    }

    .widget-drag-handle {
      position: absolute;
      top: var(--spacing-sm);
      left: var(--spacing-sm);
      width: 20px;
      height: 20px;
      background: var(--bg-hover);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s ease;
      cursor: grab;
      z-index: 10;
    }

    .widget-drag-handle:active {
      cursor: grabbing;
    }

    .widget-dragging {
      opacity: 0.7;
      transform: rotate(3deg);
      z-index: 1000;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }

    .widget-drop-zone {
      border: 2px dashed var(--accent-blue);
      background: rgba(24, 144, 255, 0.05);
      border-radius: var(--radius-lg);
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent-blue);
      font-weight: 500;
      transition: all 0.3s ease;
      position: relative;
    }

    .widget-drop-zone::before {
      content: "✨";
      font-size: 24px;
      margin-bottom: var(--spacing-sm);
    }

    .widget-drop-zone.drag-over {
      background: rgba(24, 144, 255, 0.1);
      border-color: var(--brand-primary);
      transform: scale(1.02);
    }

    /* Widget Resize Handles */
    .widget-resizable {
      position: relative;
    }

    .widget-resize-handle {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 20px;
      height: 20px;
      cursor: nw-resize;
      background: linear-gradient(-45deg, transparent 40%, var(--border-light) 40%, var(--border-light) 60%, transparent 60%);
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .widget-resizable:hover .widget-resize-handle {
      opacity: 1;
    }

    /* Responsive Dashboard Layout */
    @media (max-width: 1400px) {
      .dashboard-grid {
        grid-template-columns: repeat(8, 1fr);
      }

      .widget-xlarge {
        grid-column: span 8;
      }
    }

    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: repeat(6, 1fr);
      }

      .widget-small {
        grid-column: span 2;
      }

      .widget-medium {
        grid-column: span 3;
      }

      .widget-large {
        grid-column: span 6;
      }

      .widget-xlarge {
        grid-column: span 6;
      }
    }

    @media (max-width: 768px) {
      .dashboard-container {
        grid-template-columns: 1fr;
        grid-template-rows: 56px auto 1fr;
        grid-template-areas:
          "header"
          "sidebar"
          "main";
      }

      .dashboard-sidebar {
        height: auto;
        max-height: 180px;
        border-right: none;
        border-bottom: 1px solid var(--border-light);
        overflow-x: auto;
        overflow-y: hidden;
      }

      .dashboard-main {
        padding: var(--spacing-md);
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }

      .widget-small,
      .widget-medium,
      .widget-large,
      .widget-xlarge,
      .widget-full {
        grid-column: span 1;
      }

      .dashboard-widget {
        padding: var(--spacing-md);
        min-height: 160px;
      }
    }

    /* Dashboard Customization Panel */
    .dashboard-customizer {
      position: fixed;
      right: -360px;
      top: 64px;
      width: 360px;
      height: calc(100vh - 64px);
      background: var(--bg-surface);
      border-left: 1px solid var(--border-light);
      z-index: 1000;
      transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
      box-shadow: -8px 0 24px rgba(0, 0, 0, 0.1);
    }

    .dashboard-customizer.open {
      right: 0;
    }

    .customizer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.3);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .customizer-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .customizer-header {
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
      position: sticky;
      top: 0;
      background: var(--bg-surface);
      z-index: 10;
    }

    .customizer-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 var(--spacing-xs) 0;
    }

    .customizer-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin: 0;
    }

    .customizer-section {
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
    }

    .customizer-section:last-child {
      border-bottom: none;
    }

    .customizer-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 var(--spacing-md) 0;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .widget-template {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-sm);
      cursor: grab;
      transition: all 0.2s ease;
      background: var(--bg-elevated);
    }

    .widget-template:hover {
      border-color: var(--accent-blue);
      background: var(--bg-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .widget-template:active {
      cursor: grabbing;
      transform: scale(0.98);
    }

    .widget-template-icon {
      width: 32px;
      height: 32px;
      background: var(--accent-blue);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 14px;
    }

    .widget-template-info {
      flex: 1;
      min-width: 0;
    }

    .widget-template-name {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0 0 2px 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .widget-template-desc {
      font-size: 12px;
      color: var(--text-secondary);
      margin: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Dashboard Layout Controls */
    .layout-controls {
      display: flex;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
    }

    .layout-preset {
      flex: 1;
      padding: var(--spacing-sm);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      background: var(--bg-elevated);
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .layout-preset:hover {
      border-color: var(--accent-blue);
      background: var(--bg-hover);
    }

    .layout-preset.active {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
    }

    .layout-preset-name {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .layout-preset-preview {
      width: 100%;
      height: 24px;
      background: currentColor;
      opacity: 0.2;
      border-radius: 2px;
    }

    /* Widget Animation System */
    @keyframes widget-appear {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .widget-animate-in {
      animation: widget-appear 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    @keyframes widget-disappear {
      from {
        opacity: 1;
        transform: scale(1);
      }

      to {
        opacity: 0;
        transform: scale(0.95);
      }
    }

    .widget-animate-out {
      animation: widget-disappear 0.2s cubic-bezier(0.4, 0, 1, 1) forwards;
    }

    /* ===== Monitoring Alert Components ===== */
    .alert-container {
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .alert-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-md) var(--spacing-lg);
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-light);
    }

    .alert-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .alert-counter {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: 14px;
      color: var(--text-secondary);
    }

    .alert-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 20px;
      height: 20px;
      padding: 0 6px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      color: white;
    }

    .alert-badge.critical {
      background: var(--status-error);
      animation: alert-pulse 2s infinite;
    }

    .alert-badge.warning {
      background: var(--status-warning);
    }

    .alert-badge.info {
      background: var(--status-info);
    }

    .alert-badge.resolved {
      background: var(--status-success);
    }

    @keyframes alert-pulse {

      0%,
      100% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.1);
        opacity: 0.8;
      }
    }

    /* Alert List */
    .alert-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .alert-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-md) var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
    }

    .alert-item:hover {
      background: var(--bg-hover);
    }

    .alert-item:last-child {
      border-bottom: none;
    }

    .alert-item.new::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--accent-blue);
    }

    .alert-severity {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .alert-severity.critical {
      background: var(--status-error);
      box-shadow: 0 0 8px rgba(255, 77, 79, 0.5);
    }

    .alert-severity.warning {
      background: var(--status-warning);
      box-shadow: 0 0 8px rgba(250, 173, 20, 0.5);
    }

    .alert-severity.info {
      background: var(--status-info);
    }

    .alert-severity.resolved {
      background: var(--status-success);
    }

    .alert-content {
      flex: 1;
      min-width: 0;
    }

    .alert-message {
      font-size: 14px;
      color: var(--text-primary);
      margin: 0 0 4px 0;
      font-weight: 500;
      line-height: 1.4;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .alert-details {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: 12px;
      color: var(--text-secondary);
    }

    .alert-source-tag {
      background: var(--bg-hover);
      padding: 2px 6px;
      border-radius: var(--radius-xs);
      font-family: var(--font-mono);
    }

    .alert-time {
      color: var(--text-tertiary);
    }

    /* Alert Actions */
    .alert-actions {
      display: flex;
      gap: var(--spacing-xs);
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .alert-item:hover .alert-actions {
      opacity: 1;
    }

    .alert-action {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .alert-action:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
    }

    .alert-action.acknowledge {
      color: var(--status-warning);
    }

    .alert-action.acknowledge:hover {
      background: rgba(250, 173, 20, 0.1);
      color: var(--status-warning);
    }

    .alert-action.resolve {
      color: var(--status-success);
    }

    .alert-action.resolve:hover {
      background: rgba(82, 196, 26, 0.1);
      color: var(--status-success);
    }

    /* Alert Filters */
    .alert-filters {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-md) var(--spacing-lg);
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-light);
    }

    .alert-filter {
      padding: 4px 8px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      background: var(--bg-surface);
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .alert-filter:hover {
      border-color: var(--accent-blue);
      color: var(--text-primary);
    }

    .alert-filter.active {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
    }

    /* Alert Statistics */
    .alert-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--spacing-md);
      padding: var(--spacing-lg);
      background: var(--bg-elevated);
    }

    .alert-stat {
      text-align: center;
    }

    .alert-stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .alert-stat-value.critical {
      color: var(--status-error);
    }

    .alert-stat-value.warning {
      color: var(--status-warning);
    }

    .alert-stat-value.info {
      color: var(--status-info);
    }

    .alert-stat-value.resolved {
      color: var(--status-success);
    }

    .alert-stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Alert Timeline */
    .alert-timeline {
      padding: var(--spacing-lg);
    }

    .alert-timeline-item {
      display: flex;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-md);
      position: relative;
    }

    .alert-timeline-item:not(:last-child)::after {
      content: '';
      position: absolute;
      left: 10px;
      top: 24px;
      bottom: -12px;
      width: 1px;
      background: var(--border-light);
    }

    .alert-timeline-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: white;
      flex-shrink: 0;
      z-index: 1;
    }

    .alert-timeline-icon.created {
      background: var(--status-error);
    }

    .alert-timeline-icon.acknowledged {
      background: var(--status-warning);
    }

    .alert-timeline-icon.resolved {
      background: var(--status-success);
    }

    .alert-timeline-content {
      flex: 1;
      padding-top: 2px;
    }

    .alert-timeline-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0 0 4px 0;
    }

    .alert-timeline-desc {
      font-size: 12px;
      color: var(--text-secondary);
      margin: 0 0 4px 0;
    }

    .alert-timeline-time {
      font-size: 11px;
      color: var(--text-tertiary);
    }

    /* Alert Notification */
    .alert-notification {
      position: fixed;
      top: 80px;
      right: var(--spacing-lg);
      width: 320px;
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
      z-index: 2000;
      transform: translateX(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .alert-notification.show {
      transform: translateX(0);
    }

    .alert-notification-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-md);
      border-bottom: 1px solid var(--border-light);
    }

    .alert-notification-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
    }

    .alert-notification-icon.critical {
      background: var(--status-error);
      animation: notification-shake 0.5s ease-in-out;
    }

    .alert-notification-icon.warning {
      background: var(--status-warning);
    }

    @keyframes notification-shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-2px);
      }

      75% {
        transform: translateX(2px);
      }
    }

    .alert-notification-title {
      flex: 1;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .alert-notification-close {
      width: 20px;
      height: 20px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: var(--radius-xs);
      transition: all 0.2s ease;
    }

    .alert-notification-close:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .alert-notification-body {
      padding: var(--spacing-md);
    }

    .alert-notification-message {
      font-size: 13px;
      color: var(--text-primary);
      margin: 0 0 var(--spacing-sm) 0;
      line-height: 1.4;
    }

    .alert-notification-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-secondary);
    }

    /* Alert Status Indicators */
    .alert-status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: var(--radius-xs);
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .alert-status-indicator.active {
      background: rgba(255, 77, 79, 0.1);
      color: var(--status-error);
    }

    .alert-status-indicator.acknowledged {
      background: rgba(250, 173, 20, 0.1);
      color: var(--status-warning);
    }

    .alert-status-indicator.resolved {
      background: rgba(82, 196, 26, 0.1);
      color: var(--status-success);
    }

    .alert-status-indicator.silenced {
      background: rgba(140, 140, 140, 0.1);
      color: var(--text-secondary);
    }

    /* Alert Severity Icons */
    .alert-severity-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      font-size: 10px;
      color: white;
      font-weight: 600;
    }

    .alert-severity-icon.critical {
      background: var(--status-error);
    }

    .alert-severity-icon.warning {
      background: var(--status-warning);
    }

    .alert-severity-icon.info {
      background: var(--status-info);
    }

    .alert-severity-icon.low {
      background: var(--text-secondary);
    }

    /* Responsive Alert Components */
    @media (max-width: 768px) {
      .alert-stats {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-sm);
        padding: var(--spacing-md);
      }

      .alert-notification {
        width: calc(100vw - 2 * var(--spacing-md));
        right: var(--spacing-md);
        left: var(--spacing-md);
      }

      .alert-filters {
        flex-wrap: wrap;
        gap: var(--spacing-xs);
      }

      .alert-item {
        padding: var(--spacing-sm) var(--spacing-md);
      }

      .alert-actions {
        opacity: 1;
      }
    }

    /* ===== Data Export Functionality Styles ===== */
    .export-button {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-md);
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .export-button:hover {
      background: var(--bg-hover);
      border-color: var(--accent-blue);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .export-button:active {
      transform: translateY(0);
    }

    .export-button.primary {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
    }

    .export-button.primary:hover {
      background: var(--brand-primary-hover);
      border-color: var(--brand-primary-hover);
    }

    .export-button-icon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .export-button.loading {
      pointer-events: none;
      opacity: 0.7;
    }

    .export-button.loading .export-button-icon {
      animation: export-spin 1s linear infinite;
    }

    @keyframes export-spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    /* Export Modal */
    .export-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .export-modal.open {
      opacity: 1;
      visibility: visible;
    }

    .export-modal-content {
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 480px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      transform: translateY(20px) scale(0.95);
      transition: all 0.3s ease;
    }

    .export-modal.open .export-modal-content {
      transform: translateY(0) scale(1);
    }

    .export-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
    }

    .export-modal-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .export-modal-close {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .export-modal-close:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .export-modal-body {
      padding: var(--spacing-lg);
    }

    /* Export Format Selection */
    .export-format-section {
      margin-bottom: var(--spacing-lg);
    }

    .export-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 var(--spacing-md) 0;
    }

    .export-format-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: var(--spacing-sm);
    }

    .export-format-option {
      padding: var(--spacing-md);
      border: 2px solid var(--border-light);
      border-radius: var(--radius-md);
      background: var(--bg-elevated);
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .export-format-option:hover {
      border-color: var(--accent-blue);
      background: var(--bg-hover);
    }

    .export-format-option.selected {
      border-color: var(--accent-blue);
      background: rgba(24, 144, 255, 0.1);
    }

    .export-format-icon {
      width: 32px;
      height: 32px;
      margin: 0 auto var(--spacing-sm);
      background: var(--accent-blue);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 12px;
    }

    .export-format-option.selected .export-format-icon {
      background: var(--brand-primary);
      box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);
    }

    .export-format-name {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0 0 2px 0;
    }

    .export-format-desc {
      font-size: 10px;
      color: var(--text-secondary);
      margin: 0;
    }

    /* Export Options */
    .export-options {
      margin-bottom: var(--spacing-lg);
    }

    .export-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-sm) 0;
      border-bottom: 1px solid var(--border-light);
    }

    .export-option:last-child {
      border-bottom: none;
    }

    .export-option-label {
      font-size: 14px;
      color: var(--text-primary);
      margin: 0;
    }

    .export-option-desc {
      font-size: 12px;
      color: var(--text-secondary);
      margin: 2px 0 0 0;
    }

    .export-toggle {
      position: relative;
      width: 40px;
      height: 20px;
      background: var(--bg-hover);
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .export-toggle.active {
      background: var(--accent-blue);
    }

    .export-toggle-handle {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 16px;
      height: 16px;
      background: white;
      border-radius: 50%;
      transition: transform 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .export-toggle.active .export-toggle-handle {
      transform: translateX(20px);
    }

    /* Export Progress */
    .export-progress-container {
      margin-bottom: var(--spacing-lg);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .export-progress-container.active {
      opacity: 1;
      visibility: visible;
    }

    .export-progress-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-sm);
    }

    .export-progress-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .export-progress-percent {
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .export-progress-bar {
      width: 100%;
      height: 8px;
      background: var(--bg-hover);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: var(--spacing-sm);
    }

    .export-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-blue), var(--brand-primary));
      border-radius: 4px;
      transition: width 0.3s ease;
      position: relative;
    }

    .export-progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: export-progress-shimmer 2s infinite;
    }

    @keyframes export-progress-shimmer {
      0% {
        transform: translateX(-100%);
      }

      100% {
        transform: translateX(100%);
      }
    }

    .export-progress-status {
      font-size: 12px;
      color: var(--text-secondary);
      text-align: center;
    }

    /* Export Summary */
    .export-summary {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .export-summary-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 var(--spacing-sm) 0;
    }

    .export-summary-list {
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .export-summary-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .export-summary-value {
      font-weight: 500;
      color: var(--text-primary);
    }

    /* Export Modal Footer */
    .export-modal-footer {
      display: flex;
      gap: var(--spacing-sm);
      justify-content: flex-end;
      padding: var(--spacing-lg);
      border-top: 1px solid var(--border-light);
      background: var(--bg-elevated);
    }

    /* Export Status Messages */
    .export-status {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 500;
      margin-bottom: var(--spacing-md);
    }

    .export-status.success {
      background: rgba(82, 196, 26, 0.1);
      color: var(--status-success);
      border: 1px solid rgba(82, 196, 26, 0.2);
    }

    .export-status.error {
      background: rgba(255, 77, 79, 0.1);
      color: var(--status-error);
      border: 1px solid rgba(255, 77, 79, 0.2);
    }

    .export-status.warning {
      background: rgba(250, 173, 20, 0.1);
      color: var(--status-warning);
      border: 1px solid rgba(250, 173, 20, 0.2);
    }

    .export-status-icon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    /* Bulk Export Controls */
    .bulk-export-toolbar {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-md) var(--spacing-lg);
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-lg);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }

    .bulk-export-toolbar.visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .bulk-export-info {
      flex: 1;
      font-size: 14px;
      color: var(--text-primary);
    }

    .bulk-export-count {
      font-weight: 600;
      color: var(--accent-blue);
    }

    .bulk-export-actions {
      display: flex;
      gap: var(--spacing-sm);
    }

    /* Quick Export Buttons */
    .quick-export-group {
      display: flex;
      gap: var(--spacing-xs);
      align-items: center;
    }

    .quick-export-btn {
      padding: 6px 12px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .quick-export-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      border-color: var(--accent-blue);
    }

    .quick-export-btn:active {
      transform: scale(0.98);
    }

    /* Export History */
    .export-history {
      margin-top: var(--spacing-lg);
    }

    .export-history-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 var(--spacing-md) 0;
    }

    .export-history-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .export-history-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-sm);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      margin-bottom: var(--spacing-xs);
      background: var(--bg-elevated);
      transition: all 0.2s ease;
    }

    .export-history-item:hover {
      background: var(--bg-hover);
      border-color: var(--accent-blue);
    }

    .export-history-info {
      flex: 1;
      min-width: 0;
    }

    .export-history-name {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0 0 2px 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .export-history-meta {
      font-size: 10px;
      color: var(--text-secondary);
    }

    .export-history-actions {
      display: flex;
      gap: var(--spacing-xs);
    }

    .export-history-action {
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: var(--radius-xs);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .export-history-action:hover {
      background: var(--bg-surface);
      color: var(--text-primary);
    }

    /* Responsive Export Styles */
    @media (max-width: 768px) {
      .export-modal-content {
        width: 95%;
        margin: var(--spacing-md);
      }

      .export-format-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .export-modal-footer {
        flex-direction: column-reverse;
      }

      .bulk-export-toolbar {
        flex-direction: column;
        align-items: stretch;
        gap: var(--spacing-sm);
      }

      .bulk-export-actions {
        justify-content: center;
      }

      .quick-export-group {
        flex-wrap: wrap;
        justify-content: center;
      }
    }

    /* ===== Unified Page Layout System ===== */
    .page-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-lg);
    }

    .page-header-unified {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
    }

    .page-title-section {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
    }

    .page-title-icon {
      width: 32px;
      height: 32px;
      background: var(--accent-blue);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
    }

    .page-title-text {
      font-size: 28px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .page-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin: 4px 0 0 0;
    }

    .page-actions {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    /* ===== Unified KPI Cards System ===== */
    .kpi-grid-unified {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }

    .kpi-card-unified {
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      transition: all 0.3s ease;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .kpi-card-unified:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      border-color: var(--accent-blue);
    }

    .kpi-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-sm);
    }

    .kpi-label {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .kpi-trend {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      font-weight: 600;
    }

    .kpi-trend.positive {
      color: var(--status-success);
    }

    .kpi-trend.negative {
      color: var(--status-error);
    }

    .kpi-trend.neutral {
      color: var(--text-secondary);
    }

    .kpi-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.2;
      margin-bottom: var(--spacing-xs);
    }

    .kpi-subtitle {
      font-size: 12px;
      color: var(--text-tertiary);
    }

    /* ===== Unified Table System ===== */
    .table-container-unified {
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      overflow: hidden;
      margin-bottom: var(--spacing-lg);
    }

    .table-header-unified {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-md) var(--spacing-lg);
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-light);
    }

    .table-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .table-actions {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    .table-search {
      width: 240px;
      height: 32px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      padding: 0 var(--spacing-sm);
      background: var(--bg-surface);
      color: var(--text-primary);
      font-size: 13px;
      transition: all 0.2s ease;
    }

    .table-search:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
    }

    .table-search::placeholder {
      color: var(--text-tertiary);
    }

    /* Table Density System */
    .table-density-controls {
      display: flex;
      gap: 2px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      padding: 2px;
    }

    .table-density-btn {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: var(--radius-xs);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .table-density-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .table-density-btn.active {
      background: var(--accent-blue);
      color: white;
    }

    /* Table Row Standards */
    .table-unified {
      width: 100%;
      border-collapse: collapse;
    }

    .table-unified thead th {
      background: var(--bg-elevated);
      padding: var(--spacing-sm) var(--spacing-md);
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.6px;
      border-bottom: 1px solid var(--border-light);
      height: 44px;
    }

    .table-unified tbody tr {
      border-bottom: 1px solid var(--border-light);
      transition: all 0.2s ease;
    }

    .table-unified tbody tr:hover {
      background: var(--bg-hover);
      transform: translateX(2px);
    }

    .table-unified tbody tr:last-child {
      border-bottom: none;
    }

    .table-unified tbody td {
      padding: var(--spacing-sm) var(--spacing-md);
      font-size: 13px;
      color: var(--text-primary);
      height: 44px;
      vertical-align: middle;
    }

    /* Table Density Variants */
    .table-unified.compact tbody td {
      height: 36px;
      padding: 6px 12px;
      font-size: 12px;
    }

    .table-unified.comfortable tbody td {
      height: 52px;
      padding: 14px 20px;
      font-size: 14px;
    }

    /* Status Indicators */
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-indicator.healthy {
      background: rgba(82, 196, 26, 0.1);
      color: var(--status-success);
    }

    .status-indicator.warning {
      background: rgba(250, 173, 20, 0.1);
      color: var(--status-warning);
    }

    .status-indicator.critical {
      background: rgba(255, 77, 79, 0.1);
      color: var(--status-error);
    }

    .status-indicator.offline {
      background: rgba(140, 140, 140, 0.1);
      color: var(--text-secondary);
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    /* Progress Bars in Tables */
    .table-progress {
      width: 80px;
      height: 6px;
      background: var(--bg-hover);
      border-radius: 3px;
      overflow: hidden;
      margin: 2px 0;
    }

    .table-progress-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .table-progress-fill.low {
      background: var(--status-success);
    }

    .table-progress-fill.medium {
      background: var(--status-warning);
    }

    .table-progress-fill.high {
      background: var(--status-error);
    }

    /* Action Buttons in Tables */
    .table-row-actions {
      display: flex;
      gap: var(--spacing-xs);
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .table-unified tbody tr:hover .table-row-actions {
      opacity: 1;
    }

    .table-action-btn {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .table-action-btn:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
    }

    .table-action-btn.danger:hover {
      background: rgba(255, 77, 79, 0.1);
      color: var(--status-error);
    }

    /* Responsive Table */
    @media (max-width: 1024px) {
      .table-unified .hide-on-tablet {
        display: none;
      }
    }

    @media (max-width: 768px) {
      .table-unified .hide-on-mobile {
        display: none;
      }

      .table-search {
        width: 180px;
      }

      .table-row-actions {
        opacity: 1;
      }
    }

    .timeline-time {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 4px;
    }

    /* ===== Settings Layout System ===== */
    .settings-layout {
      max-width: 1000px;
      margin: 0 auto;
      padding: var(--spacing-lg);
    }

    .settings-section {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      margin-bottom: var(--spacing-xl);
      overflow: hidden;
    }

    .settings-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-elevated);
    }

    .settings-section-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 4px 0;
    }

    .settings-section-desc {
      font-size: 13px;
      color: var(--text-secondary);
      margin: 0;
    }

    .settings-section-actions {
      display: flex;
      gap: var(--spacing-sm);
    }

    .settings-section-body {
      padding: var(--spacing-lg);
    }

    .settings-form-row {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: var(--spacing-xl);
      align-items: start;
      padding: var(--spacing-md) 0;
      border-bottom: 1px solid var(--border-light);
    }

    .settings-form-row:last-child {
      border-bottom: none;
    }

    .settings-form-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0 0 4px 0;
      text-align: right;
      padding-top: 6px;
    }

    .settings-form-desc {
      font-size: 12px;
      color: var(--text-secondary);
      margin: 0;
      text-align: right;
      line-height: 1.4;
    }

    .settings-form-control {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .settings-input {
      width: 100%;
      height: 32px;
      padding: 0 var(--spacing-sm);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      background: var(--bg-surface);
      color: var(--text-primary);
      font-size: 13px;
      transition: all 0.2s ease;
    }

    .settings-input:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
    }

    .settings-textarea {
      width: 100%;
      min-height: 72px;
      padding: var(--spacing-sm);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      background: var(--bg-surface);
      color: var(--text-primary);
      font-size: 13px;
      resize: vertical;
      transition: all 0.2s ease;
      font-family: inherit;
    }

    .settings-textarea:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
    }

    .settings-select {
      width: 100%;
      height: 32px;
      padding: 0 var(--spacing-sm);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      background: var(--bg-surface);
      color: var(--text-primary);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .settings-select:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
    }

    /* Toggle Switch */
    .settings-toggle {
      position: relative;
      width: 44px;
      height: 22px;
      background: var(--bg-hover);
      border-radius: 11px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .settings-toggle.active {
      background: var(--accent-blue);
    }

    .settings-toggle-handle {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      transition: transform 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .settings-toggle.active .settings-toggle-handle {
      transform: translateX(22px);
    }

    /* Help Text */
    .settings-help-text {
      font-size: 11px;
      color: var(--text-tertiary);
      margin-top: 4px;
      line-height: 1.4;
    }

    .settings-error-text {
      font-size: 11px;
      color: var(--status-error);
      margin-top: 4px;
    }

    /* Responsive Settings */
    @media (max-width: 768px) {
      .settings-form-row {
        grid-template-columns: 1fr;
        gap: var(--spacing-sm);
      }

      .settings-form-label,
      .settings-form-desc {
        text-align: left;
      }

      .settings-form-label {
        padding-top: 0;
      }
    }

    /* ===== Tab Navigation System ===== */
    .tab-navigation {
      display: flex;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: 4px;
      margin-bottom: var(--spacing-lg);
      overflow-x: auto;
    }

    .tab-item {
      flex: 1;
      min-width: 120px;
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-md);
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
      white-space: nowrap;
    }

    .tab-item:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .tab-item.active {
      background: var(--accent-blue);
      color: white;
      box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3);
    }

    .tab-content {
      min-height: 400px;
      animation: tab-fade-in 0.3s ease-out;
    }

    @keyframes tab-fade-in {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ===== Form Validation States ===== */
    .settings-input.error,
    .settings-textarea.error,
    .settings-select.error {
      border-color: var(--status-error);
      box-shadow: 0 0 0 2px rgba(255, 77, 79, 0.1);
    }

    .settings-input.success,
    .settings-textarea.success,
    .settings-select.success {
      border-color: var(--status-success);
      box-shadow: 0 0 0 2px rgba(82, 196, 26, 0.1);
    }

    /* ===== Notification Badges ===== */
    .notification-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 18px;
      height: 18px;
      padding: 0 6px;
      background: var(--status-error);
      color: white;
      border-radius: 9px;
      font-size: 11px;
      font-weight: 600;
      line-height: 1;
    }

    .notification-badge.warning {
      background: var(--status-warning);
    }

    .notification-badge.info {
      background: var(--status-info);
    }

    .notification-badge.success {
      background: var(--status-success);
    }

    /* ===== Loading States ===== */
    .loading-skeleton {
      background: linear-gradient(90deg, var(--bg-elevated) 25%, var(--bg-hover) 50%, var(--bg-elevated) 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 2s infinite;
      border-radius: var(--radius-sm);
    }

    @keyframes skeleton-loading {
      0% {
        background-position: 200% 0;
      }

      100% {
        background-position: -200% 0;
      }
    }

    .loading-skeleton.line {
      height: 16px;
      margin-bottom: var(--spacing-xs);
    }

    .loading-skeleton.card {
      height: 120px;
      border-radius: var(--radius-lg);
    }

    .loading-skeleton.circle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
    }

    /* ===== Empty States ===== */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-3xl);
      text-align: center;
      color: var(--text-secondary);
    }

    .empty-state-icon {
      width: 64px;
      height: 64px;
      margin-bottom: var(--spacing-lg);
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0 0 var(--spacing-sm) 0;
    }

    .empty-state-desc {
      font-size: 14px;
      color: var(--text-secondary);
      margin: 0 0 var(--spacing-lg) 0;
      max-width: 400px;
      line-height: 1.5;
    }

    .empty-state-action {
      margin-top: var(--spacing-md);
    }

    /* ===== Search and Filter Enhancements ===== */
    .search-filter-bar {
      display: flex;
      gap: var(--spacing-md);
      align-items: center;
      margin-bottom: var(--spacing-lg);
      flex-wrap: wrap;
    }

    .search-input {
      flex: 1;
      min-width: 240px;
      height: 36px;
      padding: 0 var(--spacing-sm) 0 36px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      background: var(--bg-surface);
      color: var(--text-primary);
      font-size: 14px;
      transition: all 0.2s ease;
      position: relative;
    }

    .search-input-container {
      position: relative;
      flex: 1;
      min-width: 240px;
    }

    .search-input-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-tertiary);
      pointer-events: none;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
    }

    .filter-tags {
      display: flex;
      gap: var(--spacing-sm);
      flex-wrap: wrap;
    }

    .filter-tag {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs);
      padding: 4px 8px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      font-size: 12px;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .filter-tag:hover {
      background: var(--bg-hover);
      border-color: var(--accent-blue);
    }

    .filter-tag.active {
      background: var(--accent-blue);
      color: white;
      border-color: var(--accent-blue);
    }

    .filter-tag-remove {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: inherit;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      transition: all 0.2s ease;
    }

    .filter-tag-remove:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* ===== Loading Error Overlay ===== */
    .loading-error-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .loading-error-content {
      background: var(--bg-surface, #1a1d23);
      border: 1px solid var(--border-light, rgba(255, 255, 255, 0.12));
      border-radius: var(--radius-lg, 12px);
      padding: var(--spacing-2xl, 32px);
      max-width: 400px;
      text-align: center;
      color: var(--text-primary, rgba(255, 255, 255, 0.85));
    }

    .loading-error-icon {
      font-size: 48px;
      margin-bottom: var(--spacing-lg, 16px);
    }

    .loading-error-content h3 {
      font-size: 20px;
      font-weight: 600;
      margin: 0 0 var(--spacing-md, 12px) 0;
      color: var(--status-error, #ff4d4f);
    }

    .loading-error-content p {
      font-size: 14px;
      color: var(--text-secondary, rgba(255, 255, 255, 0.65));
      margin: 0 0 var(--spacing-md, 12px) 0;
    }

    .loading-error-content ul {
      text-align: left;
      padding-left: 20px;
      margin: var(--spacing-md, 12px) 0;
      color: var(--text-secondary, rgba(255, 255, 255, 0.65));
    }

    .loading-error-content li {
      margin-bottom: 4px;
    }

    /* ===== Global Loading Spinner ===== */
    .global-loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-page, #0a0c10);
      z-index: 9998;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .global-loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-light, rgba(255, 255, 255, 0.12));
      border-top: 3px solid var(--accent-blue, #1890ff);
      border-radius: 50%;
      animation: global-loading-spin 1s linear infinite;
      margin-bottom: var(--spacing-lg, 16px);
    }

    @keyframes global-loading-spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .global-loading-text {
      color: var(--text-secondary, rgba(255, 255, 255, 0.65));
      font-size: 14px;
      margin-bottom: var(--spacing-sm, 8px);
    }

    .global-loading-progress {
      width: 200px;
      height: 4px;
      background: var(--bg-elevated, #262a31);
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: var(--spacing-md, 12px);
    }

    .global-loading-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-blue, #1890ff), var(--brand-primary, #40a9ff));
      border-radius: 2px;
      transition: width 0.3s ease;
      width: 0%;
    }

    .global-loading-details {
      font-size: 12px;
      color: var(--text-tertiary, rgba(255, 255, 255, 0.45));
      text-align: center;
      max-width: 300px;
    }

    /* ===== Progressive Enhancement Styles ===== */
    .no-js .requires-js {
      display: none;
    }

    .loading .requires-loaded {
      opacity: 0;
      pointer-events: none;
    }

    .enhanced .no-js-fallback {
      display: none;
    }

    /* ===== Font Loading Optimization ===== */
    @font-face {
      font-family: 'System UI Enhanced';
      src: local('SF Pro Display'), local('Segoe UI'), local('Roboto'), local('system-ui');
      font-display: swap;
      font-weight: 100 900;
    }

    /* Apply enhanced font when available */
    .fonts-loaded {
      font-family: 'System UI Enhanced', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    /* ===== Loading Notification System ===== */
    .loading-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      min-width: 300px;
      max-width: 400px;
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      z-index: 10000;
      transform: translateX(100%);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      padding: var(--spacing-md);
    }

    .loading-notification.show {
      transform: translateX(0);
      opacity: 1;
    }

    .loading-notification-content {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .loading-notification-icon {
      font-size: 18px;
      flex-shrink: 0;
    }

    .loading-notification-message {
      flex: 1;
      font-size: 14px;
      color: var(--text-primary);
      line-height: 1.4;
    }

    .loading-notification-success {
      border-left: 4px solid var(--status-success);
    }

    .loading-notification-error {
      border-left: 4px solid var(--status-error);
    }

    .loading-notification-warning {
      border-left: 4px solid var(--status-warning);
    }

    /* ===== Enhanced Error Overlay ===== */
    .loading-error-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10001;
      padding: var(--spacing-lg);
    }

    .loading-error-dialog {
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow: hidden;
      animation: errorDialogSlide 0.3s ease-out;
    }

    @keyframes errorDialogSlide {
      from {
        transform: translateY(-30px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .loading-error-header {
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
      background: linear-gradient(135deg, rgba(255, 77, 79, 0.1), rgba(255, 87, 87, 0.05));
    }

    .loading-error-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--status-error);
      margin: 0 0 var(--spacing-xs) 0;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .loading-error-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin: 0;
    }

    .loading-error-body {
      padding: var(--spacing-lg);
      max-height: 300px;
      overflow-y: auto;
    }

    .error-details-list {
      margin: 0 0 var(--spacing-lg) 0;
    }

    .error-item {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
    }

    .error-item:last-child {
      margin-bottom: 0;
    }

    .error-dependency {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .error-icon {
      font-size: 14px;
    }

    .error-reason {
      color: var(--status-error);
      font-size: 13px;
      margin-bottom: var(--spacing-xs);
    }

    .error-attempts {
      color: var(--text-secondary);
      font-size: 12px;
      margin-bottom: var(--spacing-xs);
    }

    .error-time {
      color: var(--text-tertiary);
      font-size: 11px;
    }

    .loading-error-actions {
      padding: var(--spacing-lg);
      border-top: 1px solid var(--border-light);
      display: flex;
      gap: var(--spacing-sm);
      justify-content: flex-end;
    }

    .loading-error-button {
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-md);
      border: none;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .loading-error-button-primary {
      background: var(--accent-blue);
      color: white;
    }

    .loading-error-button-primary:hover {
      background: var(--brand-primary);
      transform: translateY(-1px);
    }

    .loading-error-button-secondary {
      background: var(--bg-elevated);
      color: var(--text-secondary);
      border: 1px solid var(--border-light);
    }

    .loading-error-button-secondary:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    /* ===== Enhanced Global Loading Overlay ===== */
    .global-loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg,
          rgba(0, 0, 0, 0.8) 0%,
          rgba(0, 0, 0, 0.9) 100%);
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.3s ease;
    }

    .global-loading-content {
      text-align: center;
      color: white;
      max-width: 400px;
      padding: var(--spacing-lg);
    }

    .global-loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-top: 3px solid var(--accent-blue);
      border-radius: 50%;
      animation: global-loading-spin 1s linear infinite;
      margin: 0 auto var(--spacing-md) auto;
    }

    @keyframes global-loading-spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .global-loading-title {
      font-size: 20px;
      font-weight: 600;
      margin: 0 0 var(--spacing-sm) 0;
      color: white;
    }

    .global-loading-progress-text {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.8);
      margin: 0 0 var(--spacing-md) 0;
    }

    .global-loading-progress-container {
      width: 100%;
      max-width: 300px;
      margin: 0 auto var(--spacing-md) auto;
    }

    .global-loading-progress-bar {
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      overflow: hidden;
      position: relative;
    }

    .global-loading-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-blue), var(--brand-primary));
      border-radius: 2px;
      transition: width 0.3s ease;
      width: 0%;
      position: relative;
    }

    .global-loading-progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg,
          transparent,
          rgba(255, 255, 255, 0.4),
          transparent);
      animation: progressShimmer 2s infinite;
    }

    @keyframes progressShimmer {
      0% {
        transform: translateX(-100%);
      }

      100% {
        transform: translateX(100%);
      }
    }

    .global-loading-details {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      line-height: 1.4;
    }

    /* 🚀 改進版行內進度條設計 - 數值與進度條整合顯示 */
    .inline-progress-cell {
      position: relative;
      height: 32px;
      padding: 0 !important;
      overflow: hidden;
      border-radius: var(--radius-md);
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      transition: all 0.3s ease;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .inline-progress-cell:hover {
      border-color: var(--brand-primary);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transform: translateY(-1px);
    }

    /* 尺寸變體 */
    .inline-progress-small {
      height: 24px;
      border-radius: var(--radius-sm);
    }

    .inline-progress-medium {
      height: 32px;
    }

    .inline-progress-large {
      height: 40px;
      border-radius: var(--radius-lg);
    }

    .inline-progress-background {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: inherit;
      opacity: 1;
    }

    .inline-progress-background.animated {
      animation: progressFill 1.2s ease-out;
    }

    @keyframes progressFill {
      from {
        width: 0%;
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* 內容層 */
    .inline-progress-content {
      position: relative;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
      width: 100%;
      height: 100%;
      padding: 0 var(--spacing-sm);
    }

    .inline-progress-label {
      font-size: 10px;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-right: var(--spacing-xs);
    }

    .inline-progress-text {
      font-size: 13px;
      font-weight: 600;
      font-variant-numeric: tabular-nums;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      white-space: nowrap;
    }

    .inline-progress-small .inline-progress-text {
      font-size: 11px;
    }

    .inline-progress-large .inline-progress-text {
      font-size: 15px;
    }

    /* 狀態指示器 */
    .inline-progress-indicator {
      position: absolute;
      top: 3px;
      right: 3px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      opacity: 0.8;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .inline-progress-small .inline-progress-indicator {
      width: 4px;
      height: 4px;
      top: 2px;
      right: 2px;
    }

    .inline-progress-large .inline-progress-indicator {
      width: 8px;
      height: 8px;
      top: 4px;
      right: 4px;
    }

    /* 狀態樣式 */
    .inline-progress-cell.healthy {
      border-color: rgba(82, 196, 26, 0.2);
    }

    .inline-progress-cell.healthy:hover {
      border-color: #52c41a;
    }

    .inline-progress-cell.warning {
      border-color: rgba(250, 173, 20, 0.2);
    }

    .inline-progress-cell.warning:hover {
      border-color: #faad14;
    }

    .inline-progress-cell.critical {
      border-color: rgba(255, 77, 79, 0.2);
    }

    .inline-progress-cell.critical:hover {
      border-color: #ff4d4f;
    }

    .inline-progress-cell.success {
      border-color: rgba(82, 196, 26, 0.2);
    }

    .inline-progress-cell.success:hover {
      border-color: #52c41a;
    }

    .inline-progress-cell.normal {
      border-color: rgba(24, 144, 255, 0.2);
    }

    .inline-progress-cell.normal:hover {
      border-color: #1890ff;
    }

    /* 響應式調整 */
    @media (max-width: 768px) {
      .inline-progress-cell {
        height: 28px;
      }

      .inline-progress-text {
        font-size: 12px;
      }

      .inline-progress-label {
        display: none;
      }

      .inline-progress-indicator {
        display: none;
      }
    }

    /* 🎯 批次操作浮動工具列 */
    .batch-actions-floating {
      position: fixed;
      bottom: 32px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-elevated, rgba(26, 29, 35, 0.95));
      border: 1px solid var(--border-base, rgba(255, 255, 255, 0.12));
      border-radius: 12px;
      padding: 12px 24px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.48);
      display: flex;
      align-items: center;
      gap: 16px;
      z-index: 1000;
      animation: slideUp 0.3s ease;
      backdrop-filter: blur(20px);
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    .batch-info {
      display: flex;
      align-items: center;
      gap: 8px;
      padding-right: 16px;
      border-right: 1px solid var(--border-light, rgba(255, 255, 255, 0.08));
    }

    .batch-count {
      color: var(--brand-primary, #4A90FF);
      font-weight: 600;
    }

    /* Multi-step Modal Styles */
    .multi-step-modal .ant-modal-content {
      background: linear-gradient(135deg, rgba(32, 34, 38, 0.98) 0%, rgba(24, 26, 29, 0.98) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      overflow: hidden;
    }

    .multi-step-modal .ant-modal-header {
      display: none;
    }

    .multi-step-modal .ant-modal-body {
      padding: 32px;
    }

    .multi-step-modal .ant-modal-footer {
      display: none;
    }

    .multi-step-modal .step-content {
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .multi-step-modal .step-indicator:hover {
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(24, 144, 255, 0.6);
    }

    /* Silence Modal Styles */
    .silence-modal .ant-modal-content {
      background: linear-gradient(135deg, rgba(32, 34, 38, 0.98) 0%, rgba(24, 26, 29, 0.98) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      overflow: hidden;
    }

    .silence-modal .ant-modal-header {
      display: none;
    }

    .silence-modal .ant-modal-body {
      padding: 32px;
    }

    .silence-modal .ant-modal-footer {
      display: none;
    }

    .silence-modal .step-content {
      animation: fadeIn 0.3s ease-in;
    }

    .silence-modal .step-indicator:hover {
      transform: scale(1.05);
      box-shadow: 0 0 25px rgba(24, 144, 255, 0.5);
    }

    /* 🎯 統一步驟式導引樣式 */
    .steps-container {
      margin-bottom: 32px;
      padding: 24px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .steps-container .steps {
      display: flex;
      gap: 16px;
      position: relative;
      justify-content: space-between;
    }

    .step-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      position: relative;
      z-index: 1;
      transition: all 0.2s ease;
    }

    .step-indicator {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid rgba(255, 255, 255, 0.4);
      background: rgba(32, 34, 38, 0.8);
      backdrop-filter: blur(20px);
      position: relative;
      z-index: 2;
    }

    .step-indicator.active {
      background: linear-gradient(135deg, #1890ff 0%, #40a9ff 100%);
      border: 3px solid #1890ff;
      box-shadow: 0 0 25px rgba(24, 144, 255, 0.6), 0 0 50px rgba(24, 144, 255, 0.3);
      transform: scale(1.15);
      color: #ffffff;
    }

    .step-indicator.completed {
      background: linear-gradient(135deg, #52c41a 0%, #95de64 100%);
      border: 3px solid #52c41a;
      box-shadow: 0 0 20px rgba(82, 196, 26, 0.5);
      color: #ffffff;
    }

    .step-indicator.completed::after {
      content: '✓';
      position: absolute;
      font-size: 14px;
      font-weight: bold;
    }

    .step-label {
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      color: rgba(255, 255, 255, 0.8);
      transition: all 0.2s ease;
      line-height: 1.2;
      margin-top: 4px;
    }

    .step-item:hover .step-label,
    .step-item.active .step-label {
      color: #ffffff;
      transform: translateY(-2px);
    }

    .step-item:hover .step-indicator {
      transform: scale(1.05);
      border-color: rgba(255, 255, 255, 0.6);
    }

    .step-connector {
      position: absolute;
      top: 24px;
      left: 60px;
      right: calc(-100% + 60px);
      height: 3px;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
      z-index: 1;
      border-radius: 2px;
    }

    .step-connector.completed {
      background: linear-gradient(90deg, #52c41a, #1890ff);
    }

    .step-progress {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: linear-gradient(90deg, #52c41a 0%, #1890ff 100%);
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 2px;
    }

    .modal-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      padding-bottom: 20px;
      margin-bottom: 20px;
    }

    .step-content {
      animation: fadeInUp 0.3s ease-in;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* 🎯 統一彈窗底部按鈕樣式 - 8點網格系統 */
    .modal-footer,
    .modal-footer-unified {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      padding: 24px 0 0 0;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      margin-top: 24px;
    }

    .modal-footer>div {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .modal-footer .ant-btn,
    .modal-footer-unified .ant-btn,
    .modal-footer-btn {
      height: 36px;
      padding: 0 20px;
      border-radius: 6px;
      font-weight: 500;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .modal-footer .ant-btn-default,
    .modal-footer-unified .ant-btn-default {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.85);
    }

    .modal-footer .ant-btn-default:hover,
    .modal-footer-unified .ant-btn-default:hover {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(255, 255, 255, 0.3);
      color: #fff;
    }

    .modal-footer .ant-btn-primary,
    .modal-footer-unified .ant-btn-primary {
      background: linear-gradient(135deg, #1890ff 0%, #40a9ff 100%);
      border: none;
      box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3);
    }

    .modal-footer .ant-btn-primary:hover,
    .modal-footer-unified .ant-btn-primary:hover {
      background: linear-gradient(135deg, #40a9ff 0%, #1890ff 100%);
      box-shadow: 0 4px 12px rgba(24, 144, 255, 0.4);
      transform: translateY(-1px);
    }

    /* 🎯 Compact Modal Styles - 8點網格系統優化 */
    .ant-modal .ant-modal-body {
      padding: 24px;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .ant-modal .ant-modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-light);
    }

    /* 8點網格系統表單間距 */
    .ant-modal .ant-form-item {
      margin-bottom: 16px;
      padding: 8px 0;
      /* 調整表單項目上下 padding 從 12px 改為 8px */
    }

    .ant-modal .ant-form-item:last-child {
      margin-bottom: 0;
    }

    /* 8點網格系統描述列表 */
    .ant-modal .ant-descriptions-item {
      padding: 8px 16px;
    }

    /* 8點網格系統卡片內容 */
    .ant-modal .ant-card {
      margin-bottom: 16px;
    }

    .ant-modal .ant-card-body {
      padding: 16px;
    }

    /* 8點網格系統列表項目 */
    .ant-modal .ant-list-item {
      padding: 8px 16px;
    }

    /* 緊湊的步驟指示器 */
    .ant-modal .ant-steps {
      margin-bottom: 16px;
    }

    /* 8點網格系統區塊間距 */
    .ant-modal .section-block {
      margin-bottom: 16px;
      padding: 16px;
    }

    /* 滾動條美化 */
    .ant-modal .ant-modal-body::-webkit-scrollbar {
      width: 6px;
    }

    .ant-modal .ant-modal-body::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }

    .ant-modal .ant-modal-body::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* 🎨 統一的統計卡片樣式 - Unified Statistic Card Styles */
    .stat-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: var(--radius-lg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.16);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(74, 144, 255, 0.1) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-card .ant-card-body {
      padding: 20px 24px;
    }

    /* 自定義卡片標題高度 */
    .ant-card-head {
      height: 40px;
      min-height: 40px;
    }

    .ant-card-head .ant-card-head-wrapper {
      align-items: center;
    }

    .ant-card-head-title {
      font-size: 14px;
      font-weight: 500;
    }

    .stat-card .ant-statistic-title {
      color: var(--text-tertiary);
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .stat-card .ant-statistic-content {
      color: var(--text-primary);
    }

    .stat-card .ant-statistic-content-value {
      font-size: 32px;
      font-weight: 600;
      line-height: 1.2;
    }

    .stat-card .ant-statistic-content-suffix {
      font-size: 16px;
      font-weight: 400;
      margin-left: 4px;
      opacity: 0.7;
    }

    /* 特殊卡片樣式 - 圖表背景卡片 */
    .chart-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.03) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-lg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.08);
      transition: all 0.3s ease;
    }

    .chart-card:hover {
      border-color: rgba(255, 255, 255, 0.15);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.12);
    }

    /* 🎯 Unified Button Styles */
    /* Primary Actions - 主要操作按鈕 */
    .btn-primary-action {
      height: 32px;
      padding: 0 16px;
      font-weight: 500;
      border-radius: var(--radius-base);
    }

    /* Toolbar Buttons - 工具列按鈕 */
    .ant-btn.toolbar-btn,
    button.ant-btn.toolbar-btn {
      height: 32px !important;
      border-radius: 6px !important;
      background: transparent !important;
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      color: rgba(255, 255, 255, 0.85) !important;
      padding: 0 12px !important;
    }

    .ant-btn.toolbar-btn:hover,
    button.ant-btn.toolbar-btn:hover,
    .ant-btn.toolbar-btn:focus,
    button.ant-btn.toolbar-btn:focus {
      background: rgba(255, 255, 255, 0.05) !important;
      border-color: rgba(255, 255, 255, 0.3) !important;
      color: rgba(255, 255, 255, 0.95) !important;
    }

    .ant-btn.toolbar-btn--icon-only,
    button.ant-btn.toolbar-btn--icon-only {
      width: 32px !important;
      padding: 0 !important;
      border-radius: 6px !important;
    }

    /* 通知鈴 Badge 尺寸 */
    .ant-badge .ant-badge-count {
      height: 18px !important;
      line-height: 18px !important;
      border-radius: 9px !important;
      font-size: 12px !important;
      font-weight: 500 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      padding: 0 4px !important;
      min-width: 18px !important;
    }

    /* 單數字 Badge - 完美圓形 */
    .ant-badge .ant-badge-count:not(.ant-badge-multiple-words) {
      width: 18px !important;
      border-radius: 50% !important;
      padding: 0 !important;
    }

    .ant-badge .ant-badge-count-sm {
      height: 18px !important;
      line-height: 18px !important;
      padding: 0 4px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      min-width: 18px !important;
    }

    /* AI 分析按鈕 - 漸層紫色 */
    .ant-btn.btn-ai-analysis,
    button.ant-btn.btn-ai-analysis {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      border: none !important;
      color: white !important;
      font-weight: 500 !important;
      border-radius: 6px !important;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3) !important;
      transition: all 0.3s ease !important;
      height: 32px !important;
      padding: 0 16px !important;
    }

    .ant-btn.btn-ai-analysis:hover,
    button.ant-btn.btn-ai-analysis:hover,
    .ant-btn.btn-ai-analysis:focus,
    button.ant-btn.btn-ai-analysis:focus {
      background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%) !important;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
      transform: translateY(-1px) !important;
      color: white !important;
      border: none !important;
    }

    .ant-btn.btn-ai-analysis:active,
    button.ant-btn.btn-ai-analysis:active {
      transform: translateY(0) !important;
      box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3) !important;
      background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%) !important;
      color: white !important;
      border: none !important;
    }

    /* Table Action Buttons - 表格操作按鈕 */
    .table-action-btn {
      height: 24px;
      padding: 0 8px;
      font-size: 13px;
    }

    .table-action-icon-btn {
      width: 28px;
      height: 28px;
      padding: 0;
      border-radius: var(--radius-sm);
    }

    /* Modal Footer Buttons - 彈窗底部按鈕 */
    .modal-footer-btn {
      height: 32px;
      min-width: 80px;
      font-weight: 500;
    }

    /* Batch Action Buttons - 批次操作按鈕 */
    .batch-action-button {
      height: 32px;
      padding: 0 16px;
      border-radius: 6px;
      font-weight: 500;
    }

    .batch-action-button.ant-btn-primary {
      background: #1890ff;
      border-color: #1890ff;
    }

    .batch-action-button--success {
      background: #52c41a !important;
      border-color: #52c41a !important;
      color: white !important;
    }

    .batch-action-button--success:hover,
    .batch-action-button--success:focus {
      background: #73d13d !important;
      border-color: #73d13d !important;
      color: white !important;
    }

    /* Danger Buttons - 危險操作按鈕 */
    .danger-button {
      color: var(--brand-danger);
      border-color: var(--brand-danger);
    }

    .batch-action-button.ant-btn-dangerous,
    .batch-action-button.danger-button,
    .ant-btn.batch-action-button.danger-button {
      background: #ff4d4f !important;
      border-color: #ff4d4f !important;
      color: white !important;
    }

    .batch-action-button.ant-btn-dangerous:hover,
    .batch-action-button.danger-button:hover,
    .ant-btn.batch-action-button.danger-button:hover,
    .batch-action-button.ant-btn-dangerous:focus,
    .batch-action-button.danger-button:focus,
    .ant-btn.batch-action-button.danger-button:focus {
      background: #ff7875 !important;
      border-color: #ff7875 !important;
      color: white !important;
    }

    .danger-button:hover {
      background: rgba(255, 77, 79, 0.1);
      border-color: var(--brand-danger);
      color: var(--brand-danger);
    }

    /* Icon Button Tooltips - 圖標按鈕提示 */
    .icon-btn-wrapper {
      display: inline-block;
    }

    /* 🎯 Compact Navigation Items - 緊湊導航項目 */
    .compact-nav-item {
      padding: 12px !important;
      min-height: auto !important;
    }

    .compact-nav-item .nav-item-content {
      padding: 0 !important;
    }

    .compact-nav-item .nav-item-icon {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .compact-nav-item .nav-item-title {
      margin-bottom: 2px !important;
      font-size: 14px !important;
      line-height: 1.2 !important;
    }

    .compact-nav-item .nav-item-description {
      margin-bottom: 0 !important;
      font-size: 12px !important;
      line-height: 1.3 !important;
    }

    /* 🎯 Admin Navigation Items - 管理中心導航項目 */
    .admin-nav-item {
      min-height: 120px;
    }

    .admin-nav-item .nav-item-content {
      padding: 0 !important;
      height: 100%;
    }

    .admin-nav-item .nav-item-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .admin-nav-item:hover .nav-item-icon {
      background: rgba(24, 144, 255, 0.15) !important;
    }

    /* 🎯 Notification Styles - 通知樣式 */
    .notification-popover .ant-popover-inner {
      padding: 0;
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .notification-dropdown .notification-item:hover {
      background: linear-gradient(135deg, rgba(24, 144, 255, 0.08) 0%, rgba(24, 144, 255, 0.04) 100%) !important;
    }

    .notification-dropdown ::-webkit-scrollbar {
      width: 6px;
    }

    .notification-dropdown ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 3px;
    }

    .notification-dropdown ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    /* 🎯 Notification Badge Styles - 通知徽章樣式 */
    .ant-badge-count,
    .ant-badge .ant-badge-count,
    .ant-badge-multiple-words {
      color: white !important;
      background: #ff4d4f !important;
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      font-weight: 600 !important;
      font-size: 12px !important;
    }

    /* 單數字 Badge - 完美圓形 (全域) */
    .ant-badge-count:not(.ant-badge-multiple-words) {
      width: 18px !important;
      border-radius: 50% !important;
      padding: 0 !important;
    }

    /* 🎯 Button Alignment Uniformity - 按鈕對齊統一 */

    /* 工具欄容器對齊 */
    .toolbar,
    .page-toolbar,
    .ant-space {
      display: flex !important;
      align-items: center !important;
      gap: 8px !important;
    }

    /* 所有按鈕垂直居中對齊 */
    .ant-btn {
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      vertical-align: middle !important;
      margin: 0 !important;
    }

    /* 搜索框與按鈕對齊 */
    .ant-input,
    .ant-input-search,
    .search-input,
    .ant-input-search-button {
      vertical-align: middle !important;
      display: inline-flex !important;
      align-items: center !important;
    }

    /* Space 組件內的項目對齊 */
    .ant-space-item {
      display: flex !important;
      align-items: center !important;
    }

    /* 表格操作按鈕對齊 */
    .ant-table-tbody .ant-btn {
      vertical-align: middle !important;
      margin: 2px 4px !important;
    }

    /* 頁面標題區域對齊 */
    .page-header,
    .table-header {
      display: flex !important;
      align-items: center !important;
      justify-content: space-between !important;
      margin-bottom: 16px !important;
    }

    /* 🎯 Unified Button Styles - 統一按鈕樣式 */

    /* 統一刪除按鈕樣式 */
    .ant-btn[danger],
    .ant-btn.ant-btn-dangerous,
    .btn--danger {
      background: var(--brand-danger) !important;
      border-color: var(--brand-danger) !important;
      color: white !important;
    }

    .ant-btn[danger]:hover,
    .ant-btn.ant-btn-dangerous:hover,
    .btn--danger:hover {
      background: #ff4d4f !important;
      border-color: #ff4d4f !important;
      color: white !important;
    }

    /* 批次刪除按鈕 - outlined 樣式 */
    .danger-button {
      background: transparent !important;
      border: 1px solid var(--brand-danger) !important;
      color: var(--brand-danger) !important;
    }

    .danger-button:hover {
      background: rgba(255, 77, 79, 0.1) !important;
      border-color: var(--brand-danger) !important;
      color: var(--brand-danger) !important;
    }

    /* 鏈接樣式的刪除按鈕 */
    .ant-btn-link.ant-btn-dangerous,
    .ant-btn-link[danger],
    button.ant-btn.ant-btn-link.ant-btn-dangerous,
    .ant-btn.ant-btn-link.ant-btn-dangerous {
      color: var(--brand-danger) !important;
      background: transparent !important;
      border: none !important;
    }

    .ant-btn-link.ant-btn-dangerous:hover,
    .ant-btn-link[danger]:hover,
    button.ant-btn.ant-btn-link.ant-btn-dangerous:hover,
    .ant-btn.ant-btn-link.ant-btn-dangerous:hover {
      color: #ff4d4f !important;
      background: rgba(255, 107, 107, 0.1) !important;
    }

    /* 更強的選擇器覆蓋 Ant Design 默認樣式 */
    .ant-table-tbody .ant-btn.ant-btn-link.ant-btn-dangerous {
      color: var(--brand-danger) !important;
    }

    .ant-table-tbody .ant-btn.ant-btn-link.ant-btn-dangerous:hover {
      color: #ff4d4f !important;
      background: rgba(255, 107, 107, 0.1) !important;
    }

    /* 強制覆蓋所有可能的 danger 按鈕樣式 */
    [data-testid] .ant-btn[danger],
    .ant-btn[danger],
    .ant-btn.ant-btn-dangerous,
    button[danger],
    button.ant-btn-dangerous {
      color: var(--brand-danger) !important;
      background: transparent !important;
      border: 1px solid transparent !important;
    }

    [data-testid] .ant-btn[danger]:hover,
    .ant-btn[danger]:hover,
    .ant-btn.ant-btn-dangerous:hover,
    button[danger]:hover,
    button.ant-btn-dangerous:hover {
      color: #ff4d4f !important;
      background: rgba(255, 107, 107, 0.1) !important;
      border: 1px solid transparent !important;
    }

    /* 統一編輯按鈕樣式 */
    .ant-btn-primary,
    .btn--primary {
      background: var(--brand-primary) !important;
      border-color: var(--brand-primary) !important;
    }

    .ant-btn-primary:hover,
    .btn--primary:hover {
      background: #40a9ff !important;
      border-color: #40a9ff !important;
    }

    /* 表格操作按鈕統一間距和尺寸 */
    .ant-table-tbody .ant-btn {
      margin: 2px !important;
      min-width: 60px !important;
      height: 30px !important;
      font-size: 12px !important;
    }

    /* 圖標按鈕統一 */
    .table-action-icon-btn {
      width: 30px !important;
      height: 30px !important;
      padding: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
    }

    /* === 🎯 表格操作按鈕統一樣式 === */

    /* 表格按鈕基礎樣式 - 使用新的設計系統 */
    .ant-table-tbody .ant-btn:not(.ant-switch),
    .ant-table-tbody button:not(.ant-switch) {
      height: var(--btn-height-sm) !important;
      padding: var(--btn-padding-sm) !important;
      font-size: 12px !important;
      font-weight: 500 !important;
      border-radius: var(--radius-sm) !important;
      min-width: 60px !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      gap: 4px !important;
      transition: all 0.2s ease !important;
      box-shadow: none !important;
    }

    /* 預設按鈕 - 次要樣式 */
    .ant-table-tbody .ant-btn:not(.ant-switch):not(.ant-btn-primary):not(.ant-btn-dangerous):not([danger]),
    .ant-table-tbody button:not(.ant-switch):not(.ant-btn-primary):not(.ant-btn-dangerous):not([danger]) {
      border: 1px solid var(--border-base) !important;
      background: transparent !important;
      color: var(--text-secondary) !important;
    }

    .ant-table-tbody .ant-btn:not(.ant-switch):not(.ant-btn-primary):not(.ant-btn-dangerous):not([danger]):hover,
    .ant-table-tbody button:not(.ant-switch):not(.ant-btn-primary):not(.ant-btn-dangerous):not([danger]):hover {
      border-color: var(--border-hover) !important;
      background: var(--bg-hover) !important;
      color: var(--text-primary) !important;
      transform: translateY(-1px) !important;
    }

    /* 主要操作按鈕 - 使用品牌色 */
    .ant-table-tbody .ant-btn-primary:not(.ant-switch),
    .ant-table-tbody button.ant-btn-primary:not(.ant-switch) {
      border: 1px solid var(--brand-primary) !important;
      background: var(--brand-primary-bg) !important;
      color: var(--brand-primary) !important;
    }

    .ant-table-tbody .ant-btn-primary:hover:not(.ant-switch),
    .ant-table-tbody button.ant-btn-primary:hover:not(.ant-switch) {
      border-color: var(--brand-primary-hover) !important;
      background: rgba(24, 144, 255, 0.2) !important;
      color: var(--brand-primary-hover) !important;
      transform: translateY(-1px) !important;
    }

    /* 危險操作按鈕 - 使用危險色 */
    .ant-table-tbody .ant-btn-dangerous:not(.ant-switch),
    .ant-table-tbody .ant-btn[danger]:not(.ant-switch),
    .ant-table-tbody button[danger]:not(.ant-switch),
    .ant-table-tbody button.ant-btn-dangerous:not(.ant-switch) {
      border: 1px solid var(--brand-danger) !important;
      background: var(--brand-danger-bg) !important;
      color: var(--brand-danger) !important;
    }

    .ant-table-tbody .ant-btn-dangerous:hover:not(.ant-switch),
    .ant-table-tbody .ant-btn[danger]:hover:not(.ant-switch),
    .ant-table-tbody button[danger]:hover:not(.ant-switch),
    .ant-table-tbody button.ant-btn-dangerous:hover:not(.ant-switch) {
      border-color: var(--brand-danger-hover) !important;
      background: rgba(255, 77, 79, 0.2) !important;
      color: var(--brand-danger-hover) !important;
      transform: translateY(-1px) !important;
    }

    /* 文字按鈕樣式 */
    .ant-table-tbody .ant-btn-link:not(.ant-switch) {
      background: transparent !important;
      border: none !important;
      color: var(--text-tertiary) !important;
      min-width: auto !important;
      padding: 4px 8px !important;
    }

    .ant-table-tbody .ant-btn-link:hover:not(.ant-switch) {
      color: var(--brand-primary) !important;
      background: var(--brand-primary-bg) !important;
    }

    .ant-table-tbody .ant-btn-link.ant-btn-dangerous:hover:not(.ant-switch) {
      color: var(--brand-danger) !important;
      background: var(--brand-danger-bg) !important;
    }

    /* 顯示所有圖標 - 恢復正常圖標顯示 */
    .ant-table-tbody .ant-btn .anticon,
    .ant-table-tbody button .anticon {
      display: inline-block !important;
      font-size: 14px !important;
    }

    /* 🎯 Switch 組件修復 - 重置所有樣式 */
    .ant-switch {
      position: relative !important;
      display: inline-block !important;
      box-sizing: border-box !important;
      width: 44px !important;
      height: 22px !important;
      line-height: 20px !important;
      background: rgba(255, 255, 255, 0.25) !important;
      border: 1px solid transparent !important;
      border-radius: 100px !important;
      cursor: pointer !important;
      transition: all 0.3s ease !important;
      user-select: none !important;
    }

    .ant-switch-checked {
      background: #1890ff !important;
    }

    .ant-switch:focus,
    .ant-switch:hover {
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2) !important;
    }

    .ant-switch-checked:focus,
    .ant-switch-checked:hover {
      background: #40a9ff !important;
    }

    .ant-switch-disabled {
      background: rgba(255, 255, 255, 0.08) !important;
      cursor: not-allowed !important;
      opacity: 0.4 !important;
    }

    .ant-switch-disabled:hover {
      box-shadow: none !important;
    }

    /* Switch 內部滑塊 */
    .ant-switch-handle {
      position: absolute !important;
      top: 1px !important;
      left: 1px !important;
      width: 18px !important;
      height: 18px !important;
      background: #fff !important;
      border-radius: 50% !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
      transition: all 0.3s ease !important;
      z-index: 1 !important;
    }

    .ant-switch-checked .ant-switch-handle {
      left: calc(100% - 19px) !important;
    }

    /* 移除任何可能干擾的內部元素 */
    .ant-switch-inner {
      display: none !important;
    }

    .ant-switch::after {
      display: none !important;
    }

    /* 🎯 固定欄位背景修復 - 強制覆蓋所有狀態 */
    .table-wrapper .ant-table-cell-fix-right,
    .table-wrapper .ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-cell-fix-right-last {
      background: transparent !important;
      background-color: transparent !important;
      backdrop-filter: none !important;
      box-shadow: none !important;
    }

    .table-wrapper .ant-table-cell-fix-right-first::after,
    .table-wrapper .ant-table-cell-fix-right-last::after {
      background: none !important;
      box-shadow: none !important;
      border: none !important;
    }

    /* 表頭固定欄位 */
    .table-wrapper .ant-table-thead>tr>th.ant-table-cell-fix-right,
    .table-wrapper .ant-table-thead>tr>th.ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-thead>tr>th.ant-table-cell-fix-right-last {
      background: var(--bg-elevated) !important;
      background-color: var(--bg-elevated) !important;
    }

    /* 表格內容固定欄位 */
    .table-wrapper .ant-table-tbody>tr>td.ant-table-cell-fix-right,
    .table-wrapper .ant-table-tbody>tr>td.ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-tbody>tr>td.ant-table-cell-fix-right-last {
      background: transparent !important;
      background-color: transparent !important;
    }

    /* 懸停狀態固定欄位 - 與其他欄位完全一致 */
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right,
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right-last {
      background: var(--bg-hover) !important;
      background-color: var(--bg-hover) !important;
    }

    /* 確保整行懸停時所有欄位背景一致 */
    .table-wrapper .ant-table-tbody>tr:hover>td {
      background: var(--bg-hover) !important;
    }

    /* 固定欄位在整行懸停時保持完全一致的效果 */
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right,
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right-last {
      background: var(--bg-hover) !important;
      background-color: var(--bg-hover) !important;
    }

    /* 選中狀態固定欄位 */
    .table-wrapper .ant-table-row-selected>td.ant-table-cell-fix-right,
    .table-wrapper .ant-table-row-selected>td.ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-row-selected>td.ant-table-cell-fix-right-last {
      background: var(--bg-selected) !important;
      background-color: var(--bg-selected) !important;
    }

    /* 強制移除所有固定欄位的陰影和邊框效果 */
    .table-wrapper .ant-table-cell-fix-right::before,
    .table-wrapper .ant-table-cell-fix-right::after,
    .table-wrapper .ant-table-cell-fix-right-first::before,
    .table-wrapper .ant-table-cell-fix-right-first::after,
    .table-wrapper .ant-table-cell-fix-right-last::before,
    .table-wrapper .ant-table-cell-fix-right-last::after {
      display: none !important;
      content: none !important;
      background: none !important;
      box-shadow: none !important;
      border: none !important;
    }


    /* 🎯 小尺寸按鈕 outlined 樣式 - 統一尺寸 */
    .ant-table-tbody .ant-btn-sm,
    .ant-table-tbody .ant-btn.ant-btn-sm {
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      background: transparent !important;
      box-shadow: none !important;
      padding: 4px 12px !important;
      height: 32px !important;
      font-size: 13px !important;
      border-radius: 6px !important;
      min-width: 60px !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
    }

    .ant-table-tbody .ant-btn-primary.ant-btn-sm {
      color: var(--brand-primary) !important;
      border-color: var(--brand-primary) !important;
    }

    .ant-table-tbody .ant-btn-primary.ant-btn-sm:hover {
      color: #40a9ff !important;
      border-color: #40a9ff !important;
      background: rgba(24, 144, 255, 0.1) !important;
    }

    .ant-table-tbody .ant-btn-dangerous.ant-btn-sm,
    .ant-table-tbody .ant-btn-sm[danger] {
      color: var(--brand-danger) !important;
      border-color: var(--brand-danger) !important;
    }

    .ant-table-tbody .ant-btn-dangerous.ant-btn-sm:hover,
    .ant-table-tbody .ant-btn-sm[danger]:hover {
      color: #ff4d4f !important;
      border-color: #ff4d4f !important;
      background: rgba(255, 107, 107, 0.1) !important;
    }

    /* 🎯 User Menu Styles - 用戶選單樣式 */
    .user-menu-trigger:hover {
      background: rgba(255, 255, 255, 0.08) !important;
    }

    .user-dropdown-menu .ant-dropdown-menu {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-2xl);
    }

    .user-dropdown-menu .ant-dropdown-menu-item {
      border-radius: var(--radius-sm);
      margin: 2px 0;
      transition: all 0.2s ease;
    }

    .user-dropdown-menu .ant-dropdown-menu-item:hover {
      background: linear-gradient(135deg, rgba(24, 144, 255, 0.1) 0%, rgba(24, 144, 255, 0.05) 100%);
    }

    .user-dropdown-menu .ant-dropdown-menu-item-divider {
      background: var(--border-light);
      margin: 4px 0;
    }

    /* 🎯 Login Page Styles - 登入頁面樣式 */
    @keyframes float {

      0%,
      100% {
        transform: translate(0, 0) scale(1);
      }

      33% {
        transform: translate(-30px, -30px) scale(0.96);
      }

      66% {
        transform: translate(30px, -20px) scale(1.04);
      }
    }

    .login-card .ant-input-affix-wrapper {
      background: rgba(255, 255, 255, 0.05) !important;
      border: 1px solid rgba(255, 255, 255, 0.1) !important;
      border-radius: 8px !important;
      transition: all 0.3s ease;
    }

    .login-card .ant-input-affix-wrapper:hover {
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      background: rgba(255, 255, 255, 0.08) !important;
      border-radius: 8px !important;
    }

    .login-card .ant-input-affix-wrapper-focused,
    .login-card .ant-input-affix-wrapper:focus-within {
      border: 1px solid var(--brand-primary) !important;
      background: rgba(24, 144, 255, 0.05) !important;
      border-radius: 8px !important;
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2) !important;
    }

    .login-card .ant-input {
      background: transparent !important;
      border: none !important;
      color: var(--text-primary) !important;
    }

    .login-card .ant-input::placeholder {
      color: var(--text-tertiary) !important;
    }

    /* 額外確保沒有雙框線 */
    .login-card .ant-input-affix-wrapper,
    .login-card .ant-input-affix-wrapper:hover,
    .login-card .ant-input-affix-wrapper:focus,
    .login-card .ant-input-affix-wrapper-focused {
      outline: none !important;
      box-sizing: border-box !important;
    }

    .login-submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(22, 104, 220, 0.4) !important;
    }

    .login-submit-btn:active {
      transform: translateY(0);
    }

    .centered-statistic .ant-statistic-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
  </style>
</head>

<body class="loading">
  <!-- Global Loading Overlay -->
  <div class="global-loading-overlay" style="display: flex;">
    <div class="global-loading-content">
      <div class="global-loading-spinner"></div>
      <h2 class="global-loading-title">SRE 平台載入中</h2>
      <div class="global-loading-progress-text">準備載入依賴庫...</div>
      <div class="global-loading-progress-container">
        <div class="global-loading-progress-bar">
          <div class="global-loading-progress-fill" style="width: 0%"></div>
        </div>
      </div>
      <div class="global-loading-details">
        正在載入 React、Ant Design 及其他必要的依賴庫<br>
        首次載入可能需要較長時間，請稍候...
      </div>
    </div>
  </div>

  <!-- Loading Error Overlay -->
  <div class="loading-error-overlay">
    <div class="loading-error-dialog">
      <div class="loading-error-header">
        <h3 class="loading-error-title">
          <span class="error-icon">⚠️</span>
          依賴庫載入失敗
        </h3>
        <p class="loading-error-subtitle">部分依賴庫無法正常載入，這可能影響平台功能</p>
      </div>
      <div class="loading-error-body">
        <div class="error-details-list">
          <!-- Error details will be populated by JavaScript -->
        </div>
        <p>請檢查您的網路連線，或嘗試重新載入頁面。</p>
      </div>
      <div class="loading-error-actions">
        <button class="loading-error-button loading-error-button-secondary" onclick="location.reload()">
          重新載入頁面
        </button>
        <button class="loading-error-button loading-error-button-primary"
          onclick="window.SREPlatform.resourceManager.retryAllFailed()">
          重試載入
        </button>
      </div>
    </div>
  </div>

  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo, useCallback } = React;
    const { Layout, Menu, ConfigProvider, theme, Typography, Input, Avatar, Button, Row, Col, Card, Statistic, Table, Tag, Modal, Form, Select, Breadcrumb, message, Tabs, DatePicker, List, Divider, Dropdown, Badge, Drawer, Tree, Collapse, InputNumber, Transfer, Spin, Empty, Switch, Space, Radio, Progress, Popover, Tooltip, Descriptions, Timeline, Checkbox, Steps, TimePicker, Alert } = antd;
    // 圖標直接從全局範圍訪問
    // 圖標直接從全局範圍訪問
    const UserOutlined = window.UserOutlined || (() => null);
    const SearchOutlined = window.SearchOutlined || (() => null);
    const LogoutOutlined = window.LogoutOutlined || (() => null);
    const DashboardOutlined = window.DashboardOutlined || (() => null);
    const HddOutlined = window.HddOutlined || (() => null);
    const TeamOutlined = window.TeamOutlined || (() => null);
    const ProfileOutlined = window.ProfileOutlined || (() => null);
    const CodeOutlined = window.CodeOutlined || (() => null);
    const BarChartOutlined = window.BarChartOutlined || (() => null);
    const HistoryOutlined = window.HistoryOutlined || (() => null);
    const PlusOutlined = window.PlusOutlined || (() => null);
    const PlusSquareOutlined = window.PlusSquareOutlined || (() => null);
    const SettingOutlined = window.SettingOutlined || (() => null);
    const SafetyCertificateOutlined = window.SafetyCertificateOutlined || (() => null);
    const BellOutlined = window.BellOutlined || (() => null);
    const DownOutlined = window.DownOutlined || (() => null);
    const ExclamationCircleOutlined = window.ExclamationCircleOutlined || (() => null);
    const InfoCircleOutlined = window.InfoCircleOutlined || (() => null);
    const EditOutlined = window.EditOutlined || (() => null);
    const DeleteOutlined = window.DeleteOutlined || (() => null);
    const ApartmentOutlined = window.ApartmentOutlined || (() => null);
    const BuildOutlined = window.BuildOutlined || (() => null);
    const ControlOutlined = window.ControlOutlined || (() => null);
    const AuditOutlined = window.AuditOutlined || (() => null);
    const MenuUnfoldOutlined = window.MenuUnfoldOutlined || (() => null);
    const MenuFoldOutlined = window.MenuFoldOutlined || (() => null);
    const PauseCircleOutlined = window.PauseCircleOutlined || (() => null);
    const ScheduleOutlined = window.ScheduleOutlined || (() => null);
    const CarryOutOutlined = window.CarryOutOutlined || (() => null);
    const ThunderboltOutlined = window.ThunderboltOutlined || (() => null);
    const MinusCircleOutlined = window.MinusCircleOutlined || (() => null);
    const MinusSquareOutlined = window.MinusSquareOutlined || (() => null);
    const FireOutlined = window.FireOutlined || (() => null);
    const ClockCircleOutlined = window.ClockCircleOutlined || (() => null);
    const CheckCircleOutlined = window.CheckCircleOutlined || (() => null);
    const CopyOutlined = window.CopyOutlined || (() => null);
    const PlayCircleOutlined = window.PlayCircleOutlined || (() => null);
    const RobotOutlined = window.RobotOutlined || (() => null);
    const DeploymentUnitOutlined = window.DeploymentUnitOutlined || (() => null);
    const EyeOutlined = window.EyeOutlined || (() => null);
    const FilterOutlined = window.FilterOutlined || (() => null);
    const ReloadOutlined = window.ReloadOutlined || (() => null);
    const DownloadOutlined = window.DownloadOutlined || (() => null);
    const DollarOutlined = window.DollarOutlined || (() => null);
    const LineChartOutlined = window.LineChartOutlined || (() => null);
    const AlertOutlined = window.AlertOutlined || (() => null);
    const PieChartOutlined = window.PieChartOutlined || (() => null);
    const FileDoneOutlined = window.FileDoneOutlined || (() => null);
    const FileTextOutlined = window.FileTextOutlined || (() => null);
    const DatabaseOutlined = window.DatabaseOutlined || (() => null);
    const FieldTimeOutlined = window.FieldTimeOutlined || (() => null);
    const RiseOutlined = window.RiseOutlined || (() => null);
    const FileProtectOutlined = window.FileProtectOutlined || (() => null);
    const BranchesOutlined = window.BranchesOutlined || (() => null);
    const BookOutlined = window.BookOutlined || (() => null);
    const AppstoreOutlined = window.AppstoreOutlined || (() => null);
    const ArrowUpOutlined = window.ArrowUpOutlined || (() => null);
    const ArrowDownOutlined = window.ArrowDownOutlined || (() => null);
    const AlignCenterOutlined = window.AlignCenterOutlined || (() => null);
    const BorderOutlined = window.BorderOutlined || (() => null);
    const CompressOutlined = window.CompressOutlined || (() => null);
    const ExpandOutlined = window.ExpandOutlined || (() => null);
    const MinusOutlined = window.MinusOutlined || (() => null);
    const UnorderedListOutlined = window.UnorderedListOutlined || (() => null);
    const WarningOutlined = window.WarningOutlined || (() => null);
    const GlobalOutlined = window.GlobalOutlined || (() => null);
    const SaveOutlined = window.SaveOutlined || (() => null);
    const QuestionCircleOutlined = window.QuestionCircleOutlined || (() => null);
    const BulbOutlined = window.BulbOutlined || (() => null);
    const LockOutlined = window.LockOutlined || (() => null);
    const TagsOutlined = window.TagsOutlined || (() => null);
    const TagOutlined = window.TagOutlined || (() => null);
    const LinkOutlined = window.LinkOutlined || (() => null);
    const MailOutlined = window.MailOutlined || (() => null);
    const BarsOutlined = window.BarsOutlined || (() => null);
    const CloseOutlined = window.CloseOutlined || (() => null);
    const CheckOutlined = window.CheckOutlined || (() => null);
    const SafetyOutlined = window.SafetyOutlined || (() => null);
    const MonitorOutlined = window.MonitorOutlined || (() => null);
    const { Title, Text, Paragraph } = Typography;
    const { TextArea } = Input;
    const { RangePicker } = DatePicker;
    dayjs.extend(dayjs_plugin_relativeTime);
    dayjs.extend(dayjs_plugin_isBetween);

    // === 🚀 性能優化和通用組件 ===

    // 錯誤邊界組件
    class ErrorBoundary extends React.Component {
      constructor(props) {
        super(props);
        this.state = { hasError: false, error: null };
      }

      static getDerivedStateFromError(error) {
        return { hasError: true, error };
      }

      componentDidCatch(error, errorInfo) {
        console.error('Error caught by boundary:', error, errorInfo);
      }

      render() {
        if (this.state.hasError) {
          return (
            <div style={{
              padding: '20px',
              textAlign: 'center',
              background: 'rgba(255, 77, 79, 0.1)',
              border: '1px solid rgba(255, 77, 79, 0.3)',
              borderRadius: '8px',
              margin: '20px'
            }}>
              <Title level={4} style={{ color: '#ff4d4f', marginBottom: '16px' }}>
                🚨 發生錯誤
              </Title>
              <Text type="secondary" style={{ display: 'block', marginBottom: '16px' }}>
                應用程式遇到了一些問題，請刷新頁面重試。
              </Text>
              <Button onClick={() => window.location.reload()}>
                刷新頁面
              </Button>
            </div>
          );
        }

        return this.props.children;
      }
    }

    // 自定義 Hook: 表格數據管理
    const useTableData = (initialData = [], options = {}) => {
      const [data, setData] = useState(initialData);
      const [loading, setLoading] = useState(false);
      const [selectedKeys, setSelectedKeys] = useState([]);

      const updateData = useCallback((newData) => {
        setData(newData);
      }, []);

      const addItem = useCallback((item) => {
        setData(prev => [...prev, { ...item, key: item.key || `key_${Date.now()}` }]);
      }, []);

      const removeItems = useCallback((keys) => {
        setData(prev => prev.filter(item => !keys.includes(item.key)));
      }, []);

      const clearSelection = useCallback(() => {
        setSelectedKeys([]);
      }, []);

      return {
        data,
        loading,
        selectedKeys,
        setLoading,
        updateData,
        addItem,
        removeItems,
        setSelectedKeys,
        clearSelection
      };
    };

    // 自定義 Hook: 搜尋和篩選
    const useSearchFilter = (data, searchFields = []) => {
      const [searchText, setSearchText] = useState('');
      const [filters, setFilters] = useState({});
      const [isFilterOpen, setIsFilterOpen] = useState(false);

      const filteredData = useMemo(() => {
        let result = data;

        // 文字搜尋
        if (searchText && searchFields.length > 0) {
          result = result.filter(item =>
            searchFields.some(field => {
              const value = item[field];
              return value && value.toString().toLowerCase().includes(searchText.toLowerCase());
            })
          );
        }

        // 條件篩選
        Object.entries(filters).forEach(([key, value]) => {
          if (value && value.length > 0) {
            result = result.filter(item => {
              const itemValue = item[key];
              return Array.isArray(value) ? value.includes(itemValue) : itemValue === value;
            });
          }
        });

        return result;
      }, [data, searchText, filters, searchFields]);

      const applyFilter = useCallback((newFilters) => {
        setFilters(newFilters);
        setIsFilterOpen(false);
      }, []);

      const clearFilters = useCallback(() => {
        setFilters({});
        setSearchText('');
      }, []);

      return {
        searchText,
        setSearchText,
        filters,
        isFilterOpen,
        setIsFilterOpen,
        filteredData,
        applyFilter,
        clearFilters
      };
    };

    // 🎯 平台級標準化組件系統 - 統一 UI/UX 體驗

    // === 標準化 Modal 組件 ===
    const PlatformModal = React.memo(({
      title,
      visible,
      open, // 支援新版 Ant Design 的 open prop
      onClose,
      onCancel, // 支援 onCancel prop
      children,
      footer,
      width = 600,
      size = 'medium', // small: 480px, medium: 600px, large: 800px, xlarge: 1000px
      centered = true,
      confirmLoading = false,
      ...props
    }) => {
      // 根據 size 設定寬度
      const sizeWidth = {
        small: 480,
        medium: 600,
        large: 800,
        xlarge: 1000
      }[size] || width;

      // 兼容 visible 和 open
      const isOpen = open !== undefined ? open : visible;
      const handleClose = onCancel || onClose;

      // 如果沒有提供 footer，使用標準的 ModalActions
      const standardFooter = footer === undefined ? (
        <ModalActions
          onCancel={handleClose}
          onConfirm={props.onOk}
          confirmLoading={confirmLoading}
          confirmText={props.okText || '確定'}
          cancelText={props.cancelText || '取消'}
        />
      ) : footer;

      return (
        <Modal
          title={
            <div style={{
              display: 'flex',
              alignItems: 'center',
              gap: '8px',
              fontSize: '16px',
              fontWeight: 500
            }}>
              {props.icon && props.icon}
              <span>{title}</span>
            </div>
          }
          open={isOpen}
          onCancel={handleClose}
          footer={standardFooter}
          width={sizeWidth}
          centered={centered}
          className={`platform-modal platform-modal--${size}`}
          maskClosable={false}
          destroyOnClose
          confirmLoading={confirmLoading}
          {...props}
        >
          {children}
        </Modal>
      );
    });

    // === 標準化設定頁面布局組件 ===
    const SettingsLayout = React.memo(({ children }) => (
      <div className="settings-layout">
        {children}
      </div>
    ));

    const SettingsSection = React.memo(({
      title,
      description,
      actions,
      children,
      ...props
    }) => (
      <div className="settings-section" {...props}>
        <div className="settings-section-header">
          <div>
            <h3 className="settings-section-title">{title}</h3>
            {description && (
              <p className="settings-section-description">{description}</p>
            )}
          </div>
          {actions && (
            <div className="settings-section-actions">
              {actions}
            </div>
          )}
        </div>
        {children}
      </div>
    ));

    const SettingsFormRow = React.memo(({
      label,
      description,
      children,
      required = false
    }) => (
      <div className="settings-form-row">
        <div>
          <div className="settings-form-label">
            {label}
            {required && <span style={{ color: 'var(--brand-danger)' }}> *</span>}
          </div>
          {description && (
            <div className="settings-form-description">{description}</div>
          )}
        </div>
        <div className="settings-form-control">
          {children}
        </div>
      </div>
    ));

    // === 標準化按鈕組件 ===
    const PlatformButton = React.memo(({
      variant = 'secondary', // primary, secondary, text, danger, ghost
      size = 'medium', // small, medium, large
      icon,
      loading = false,
      disabled = false,
      children,
      className = '',
      htmlType = 'button',
      tooltip,
      ...props
    }) => {
      const classNames = [
        'platform-btn',
        `platform-btn--${variant}`,
        size !== 'medium' ? `platform-btn--${size}` : '',
        icon && !children ? 'platform-btn--icon-only' : '',
        loading ? 'platform-btn--loading' : '',
        disabled ? 'platform-btn--disabled' : '',
        className
      ].filter(Boolean).join(' ');

      const ButtonContent = (
        <button
          className={classNames}
          disabled={disabled || loading}
          type={htmlType}
          {...props}
        >
          {loading ? <Spin size="small" /> : icon}
          {children}
        </button>
      );

      return tooltip ? (
        <Tooltip title={tooltip}>
          {ButtonContent}
        </Tooltip>
      ) : ButtonContent;
    });

    // === 表格密度切換組件 ===
    const TableDensitySwitcher = React.memo(({
      density = 'standard',
      onChange
    }) => {
      const densityOptions = [
        { value: 'compact', label: '緊湊', icon: <MinusSquareOutlined /> },
        { value: 'standard', label: '標準', icon: <BorderOutlined /> },
        { value: 'comfortable', label: '舒適', icon: <PlusSquareOutlined /> }
      ];

      return (
        <div className="table-density-switcher">
          {densityOptions.map(option => (
            <button
              key={option.value}
              className={`density-btn ${density === option.value ? 'active' : ''}`}
              onClick={() => onChange(option.value)}
            >
              {option.icon}
              <span>{option.label}</span>
            </button>
          ))}
        </div>
      );
    });

    // === 操作按鈕組 - 表格行動作 ===
    const TableRowActions = React.memo(({ record, onEdit, onDelete, onView, customActions = [] }) => (
      <Space size="small" className="table-row-actions">
        {onView && (
          <PlatformButton
            variant="text"
            size="small"
            icon={<EyeOutlined />}
            tooltip="查看詳情"
            onClick={() => onView(record)}
          />
        )}
        {onEdit && (
          <PlatformButton
            variant="text"
            size="small"
            icon={<EditOutlined />}
            tooltip="編輯"
            onClick={() => onEdit(record)}
          />
        )}
        {onDelete && (
          <PlatformButton
            variant="text"
            size="small"
            icon={<DeleteOutlined />}
            tooltip="刪除"
            className="table-action-delete"
            onClick={() => onDelete(record)}
          />
        )}
        {customActions.map((action, index) => (
          <PlatformButton
            key={index}
            variant="text"
            size="small"
            icon={action.icon}
            tooltip={action.tooltip}
            onClick={() => action.onClick(record)}
            {...action.props}
          />
        ))}
      </Space>
    ));

    // === 工具列按鈕組 ===
    const ToolbarActions = React.memo(({
      onRefresh,
      onExport,
      onAdd,
      onFilter,
      filterActive = false,
      showBatchActions = false,
      customActions = []
    }) => (
      <Space size="middle" className="toolbar-actions">
        <Space size="small" className="toolbar-group toolbar-group--secondary">
          {onRefresh && (
            <PlatformButton
              variant="ghost"
              size="small"
              icon={<ReloadOutlined />}
              tooltip="重新載入"
              onClick={onRefresh}
            />
          )}
          {onFilter && (
            <PlatformButton
              variant="ghost"
              size="small"
              icon={<FilterOutlined />}
              tooltip="篩選條件"
              className={filterActive ? 'filter-active' : ''}
              onClick={onFilter}
            />
          )}
          {onExport && (
            <PlatformButton
              variant="ghost"
              size="small"
              icon={<DownloadOutlined />}
              tooltip="匯出資料"
              onClick={onExport}
            />
          )}
        </Space>

        {customActions.length > 0 && (
          <Space size="small" className="toolbar-group toolbar-group--custom">
            {customActions.map((action, index) => (
              <PlatformButton
                key={index}
                variant={action.variant || 'ghost'}
                size="small"
                icon={action.icon}
                tooltip={action.tooltip}
                onClick={action.onClick}
                {...action.props}
              >
                {action.text}
              </PlatformButton>
            ))}
          </Space>
        )}

        {onAdd && (
          <Space size="small" className="toolbar-group toolbar-group--primary">
            <PlatformButton
              variant="primary"
              size="medium"
              icon={<PlusOutlined />}
              onClick={onAdd}
            >
              新增
            </PlatformButton>
          </Space>
        )}
      </Space>
    ));

    // === 統一的進階篩選器元件 ===
    const AdvancedFilterPanel = React.memo(({
      filters,
      onFilterChange,
      filterConfig,
      onReset,
      style = {}
    }) => {
      const [localFilters, setLocalFilters] = useState(filters || {});

      // 當 filters 變更時更新本地狀態
      useEffect(() => {
        setLocalFilters(filters || {});
      }, [filters]);

      const handleFieldChange = (fieldName, value) => {
        setLocalFilters(prev => ({
          ...prev,
          [fieldName]: value
        }));
      };

      const handleApply = () => {
        onFilterChange(localFilters);
      };

      const handleReset = () => {
        const resetFilters = {};
        filterConfig.forEach(config => {
          resetFilters[config.field] = config.defaultValue || (config.type === 'multiSelect' ? [] : '');
        });
        setLocalFilters(resetFilters);
        if (onReset) {
          onReset();
        } else {
          onFilterChange(resetFilters);
        }
      };

      const renderFilterField = (config) => {
        const value = localFilters[config.field];

        switch (config.type) {
          case 'text':
            return (
              <Input
                placeholder={config.placeholder}
                size="small"
                value={value || ''}
                onChange={(e) => handleFieldChange(config.field, e.target.value)}
                allowClear
                prefix={config.prefix}
                suffix={config.suffix}
                addonBefore={config.addonBefore}
                addonAfter={config.addonAfter}
              />
            );

          case 'search':
            return (
              <Input.Search
                placeholder={config.placeholder}
                size="small"
                value={value || ''}
                onChange={(e) => handleFieldChange(config.field, e.target.value)}
                allowClear
                enterButton={config.enterButton !== false}
                onSearch={config.onSearch}
              />
            );

          case 'textarea':
            return (
              <Input.TextArea
                placeholder={config.placeholder}
                value={value || ''}
                onChange={(e) => handleFieldChange(config.field, e.target.value)}
                rows={config.rows || 3}
                maxLength={config.maxLength}
                showCount={config.showCount}
              />
            );

          case 'select':
            return (
              <Select
                placeholder={config.placeholder}
                size="small"
                value={value}
                onChange={(val) => handleFieldChange(config.field, val)}
                style={{ width: '100%' }}
                allowClear
                showSearch={config.showSearch}
                filterOption={config.filterOption}
                optionFilterProp={config.optionFilterProp || 'children'}
                loading={config.loading}
              >
                {config.options?.map(opt => (
                  <Select.Option key={opt.value} value={opt.value} disabled={opt.disabled}>
                    {config.renderOption ? config.renderOption(opt) : opt.label}
                  </Select.Option>
                ))}
              </Select>
            );

          case 'multiSelect':
            return (
              <Select
                mode="multiple"
                placeholder={config.placeholder}
                size="small"
                value={value || []}
                onChange={(val) => handleFieldChange(config.field, val)}
                style={{ width: '100%' }}
                maxTagCount={config.maxTagCount || 2}
                maxTagPlaceholder={(omittedValues) => `+${omittedValues.length}`}
                allowClear
                showSearch={config.showSearch}
                filterOption={config.filterOption}
                optionFilterProp={config.optionFilterProp || 'children'}
                loading={config.loading}
              >
                {config.options?.map(opt => (
                  <Select.Option key={opt.value} value={opt.value} disabled={opt.disabled}>
                    {config.renderOption ? config.renderOption(opt) : opt.label}
                  </Select.Option>
                ))}
              </Select>
            );

          case 'treeSelect':
            return (
              <TreeSelect
                placeholder={config.placeholder}
                size="small"
                value={value}
                onChange={(val) => handleFieldChange(config.field, val)}
                style={{ width: '100%' }}
                allowClear
                showSearch={config.showSearch}
                treeData={config.treeData}
                treeCheckable={config.treeCheckable}
                multiple={config.multiple}
                maxTagCount={config.maxTagCount}
              />
            );

          case 'cascader':
            return (
              <Cascader
                placeholder={config.placeholder}
                size="small"
                value={value}
                onChange={(val) => handleFieldChange(config.field, val)}
                style={{ width: '100%' }}
                options={config.options}
                allowClear
                showSearch={config.showSearch}
                multiple={config.multiple}
                maxTagCount={config.maxTagCount}
              />
            );

          case 'dateRange':
            return (
              <DatePicker.RangePicker
                size="small"
                value={value}
                onChange={(dates) => handleFieldChange(config.field, dates)}
                style={{ width: '100%' }}
                placeholder={config.placeholder || ['開始日期', '結束日期']}
                format={config.format}
                showTime={config.showTime}
                disabledDate={config.disabledDate}
                {...(config.pickerProps || {})}
              />
            );

          case 'date':
            return (
              <DatePicker
                size="small"
                value={value}
                onChange={(date) => handleFieldChange(config.field, date)}
                style={{ width: '100%' }}
                placeholder={config.placeholder}
                format={config.format}
                showTime={config.showTime}
                disabledDate={config.disabledDate}
                {...(config.pickerProps || {})}
              />
            );

          case 'time':
            return (
              <TimePicker
                size="small"
                value={value}
                onChange={(time) => handleFieldChange(config.field, time)}
                style={{ width: '100%' }}
                placeholder={config.placeholder}
                format={config.format || 'HH:mm:ss'}
                {...(config.timeProps || {})}
              />
            );

          case 'timeRange':
            return (
              <TimePicker.RangePicker
                size="small"
                value={value}
                onChange={(times) => handleFieldChange(config.field, times)}
                style={{ width: '100%' }}
                placeholder={config.placeholder || ['開始時間', '結束時間']}
                format={config.format || 'HH:mm:ss'}
                {...(config.timeProps || {})}
              />
            );

          case 'number':
            return (
              <InputNumber
                placeholder={config.placeholder}
                size="small"
                value={value}
                onChange={(val) => handleFieldChange(config.field, val)}
                style={{ width: '100%' }}
                min={config.min}
                max={config.max}
                step={config.step}
                precision={config.precision}
                formatter={config.formatter}
                parser={config.parser}
                addonBefore={config.addonBefore}
                addonAfter={config.addonAfter}
                {...(config.numberProps || {})}
              />
            );

          case 'numberRange':
            return (
              <Input.Group compact>
                <InputNumber
                  placeholder={config.minPlaceholder || '最小值'}
                  size="small"
                  value={value?.min}
                  onChange={(val) => handleFieldChange(config.field, { ...value, min: val })}
                  style={{ width: '48%' }}
                  min={config.min}
                  max={config.max}
                />
                <Input
                  style={{ width: '4%', textAlign: 'center', pointerEvents: 'none' }}
                  placeholder="~"
                  disabled
                  size="small"
                />
                <InputNumber
                  placeholder={config.maxPlaceholder || '最大值'}
                  size="small"
                  value={value?.max}
                  onChange={(val) => handleFieldChange(config.field, { ...value, max: val })}
                  style={{ width: '48%' }}
                  min={config.min}
                  max={config.max}
                />
              </Input.Group>
            );

          case 'switch':
            return (
              <Switch
                checked={value}
                onChange={(checked) => handleFieldChange(config.field, checked)}
                size={config.size || 'small'}
                checkedChildren={config.checkedChildren}
                unCheckedChildren={config.unCheckedChildren}
              />
            );

          case 'checkbox':
            return (
              <Checkbox.Group
                value={value || []}
                onChange={(val) => handleFieldChange(config.field, val)}
                options={config.options}
              />
            );

          case 'radio':
            return (
              <Radio.Group
                value={value}
                onChange={(e) => handleFieldChange(config.field, e.target.value)}
                size="small"
              >
                {config.options?.map(opt => (
                  <Radio key={opt.value} value={opt.value} disabled={opt.disabled}>
                    {opt.label}
                  </Radio>
                ))}
              </Radio.Group>
            );

          case 'radioButton':
            return (
              <Radio.Group
                value={value}
                onChange={(e) => handleFieldChange(config.field, e.target.value)}
                size="small"
                optionType="button"
                buttonStyle={config.buttonStyle || 'outline'}
              >
                {config.options?.map(opt => (
                  <Radio.Button key={opt.value} value={opt.value} disabled={opt.disabled}>
                    {opt.label}
                  </Radio.Button>
                ))}
              </Radio.Group>
            );

          case 'slider':
            return (
              <div>
                <Slider
                  value={value}
                  onChange={(val) => handleFieldChange(config.field, val)}
                  min={config.min || 0}
                  max={config.max || 100}
                  step={config.step || 1}
                  range={config.range}
                  marks={config.marks}
                  included={config.included}
                  tipFormatter={config.tipFormatter}
                />
                {config.showValue && (
                  <div style={{ textAlign: 'center', marginTop: '8px', fontSize: '12px', color: 'var(--text-tertiary)' }}>
                    {Array.isArray(value) ? `${value[0]} - ${value[1]}` : value}
                  </div>
                )}
              </div>
            );

          case 'rate':
            return (
              <Rate
                value={value}
                onChange={(val) => handleFieldChange(config.field, val)}
                count={config.count || 5}
                allowHalf={config.allowHalf}
                allowClear={config.allowClear}
                character={config.character}
              />
            );

          case 'tags':
            return (
              <div className="filter-tags-container">
                {(value || []).map((tag, index) => (
                  <Tag
                    key={index}
                    closable
                    onClose={() => {
                      const newTags = [...(value || [])];
                      newTags.splice(index, 1);
                      handleFieldChange(config.field, newTags);
                    }}
                  >
                    {tag}
                  </Tag>
                ))}
                <Input
                  size="small"
                  placeholder={config.placeholder || '輸入標籤後按Enter'}
                  style={{ width: '120px' }}
                  onPressEnter={(e) => {
                    const newTag = e.target.value.trim();
                    if (newTag && !(value || []).includes(newTag)) {
                      handleFieldChange(config.field, [...(value || []), newTag]);
                      e.target.value = '';
                    }
                  }}
                />
              </div>
            );

          case 'custom':
            return config.render ? config.render(value, (val) => handleFieldChange(config.field, val), config) : null;

          default:
            return null;
        }
      };

      return (
        <div
          className="advanced-filter-panel"
          style={{
            width: '320px',
            padding: '16px',
            maxHeight: '500px',
            overflowY: 'auto',
            ...style
          }}
        >
          <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
            {filterConfig.map(config => (
              <div key={config.field}>
                <div style={{
                  marginBottom: '8px',
                  fontWeight: 600,
                  color: 'rgba(255, 255, 255, 0.9)',
                  fontSize: '13px'
                }}>
                  {config.label}
                  {config.required && <span style={{ color: 'var(--brand-danger)', marginLeft: '4px' }}>*</span>}
                </div>
                {renderFilterField(config)}
                {config.description && (
                  <div style={{
                    marginTop: '4px',
                    fontSize: '12px',
                    color: 'rgba(255, 255, 255, 0.6)'
                  }}>
                    {config.description}
                  </div>
                )}
              </div>
            ))}

            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              gap: '8px',
              paddingTop: '12px',
              borderTop: '1px solid rgba(255, 255, 255, 0.1)'
            }}>
              <PlatformButton
                variant="secondary"
                size="small"
                onClick={handleReset}
                style={{ flex: 1 }}
              >
                重設
              </PlatformButton>
              <PlatformButton
                variant="primary"
                size="small"
                onClick={handleApply}
                style={{ flex: 1 }}
              >
                套用篩選
              </PlatformButton>
            </div>
          </div>
        </div>
      );
    });

    // === 增強批次操作系統 ===
    const BatchOperations = {
      // 事件批次操作
      incidents: [
        {
          key: 'acknowledge',
          label: '批次確認',
          icon: React.createElement(CheckCircleOutlined),
          variant: 'primary',
          confirmTitle: '確認批次操作',
          confirmText: '確定要確認選中的 {{count}} 個事件嗎？',
          successText: '已成功確認 {{count}} 個事件'
        },
        {
          key: 'resolve',
          label: '批次解決',
          icon: React.createElement(CheckOutlined),
          variant: 'success',
          confirmTitle: '解決批次操作',
          confirmText: '確定要解決選中的 {{count}} 個事件嗎？',
          successText: '已成功解決 {{count}} 個事件'
        },
        {
          key: 'assign',
          label: '批次指派',
          icon: React.createElement(UserOutlined),
          variant: 'secondary',
          requiresInput: true,
          inputType: 'select',
          inputPlaceholder: '選擇指派人員',
          inputOptions: [
            { value: 'admin', label: '系統管理員' },
            { value: 'ops-team', label: '維運團隊' },
            { value: 'dev-team', label: '開發團隊' }
          ]
        },
        {
          key: 'silence',
          label: '批次靜音',
          icon: React.createElement(PauseCircleOutlined),
          variant: 'warning',
          requiresInput: true,
          inputType: 'number',
          inputPlaceholder: '靜音時長（小時）',
          inputProps: { min: 1, max: 168, defaultValue: 24 }
        },
        {
          key: 'priority',
          label: '調整優先級',
          icon: React.createElement(FireOutlined),
          variant: 'secondary',
          requiresInput: true,
          inputType: 'select',
          inputOptions: [
            { value: 'critical', label: '緊急' },
            { value: 'high', label: '高' },
            { value: 'medium', label: '中' },
            { value: 'low', label: '低' }
          ]
        }
      ],

      // 資源批次操作
      resources: [
        {
          key: 'delete',
          label: '批次刪除',
          icon: React.createElement(DeleteOutlined),
          variant: 'danger',
          confirmTitle: '危險操作確認',
          confirmText: '確定要刪除選中的 {{count}} 個資源嗎？此操作不可恢復！',
          confirmType: 'danger'
        },
        {
          key: 'move_group',
          label: '移動群組',
          icon: React.createElement(ApartmentOutlined),
          variant: 'secondary',
          requiresInput: true,
          inputType: 'treeSelect',
          inputPlaceholder: '選擇目標群組'
        },
        {
          key: 'add_tags',
          label: '新增標籤',
          icon: React.createElement(TagsOutlined),
          variant: 'secondary',
          requiresInput: true,
          inputType: 'tags',
          inputPlaceholder: '輸入標籤'
        },
        {
          key: 'export',
          label: '批次匯出',
          icon: React.createElement(DownloadOutlined),
          variant: 'primary',
          requiresInput: true,
          inputType: 'select',
          inputOptions: [
            { value: 'csv', label: 'CSV 格式' },
            { value: 'excel', label: 'Excel 格式' },
            { value: 'json', label: 'JSON 格式' }
          ]
        },
        {
          key: 'monitor',
          label: '批次監控',
          icon: React.createElement(EyeOutlined),
          variant: 'secondary',
          requiresInput: true,
          inputType: 'checkbox',
          inputOptions: [
            { value: 'cpu', label: 'CPU 監控' },
            { value: 'memory', label: '記憶體監控' },
            { value: 'disk', label: '磁碟監控' },
            { value: 'network', label: '網路監控' }
          ]
        }
      ],

      // 腳本批次操作
      scripts: [
        {
          key: 'enable',
          label: '批次啟用',
          icon: React.createElement(PlayCircleOutlined),
          variant: 'success'
        },
        {
          key: 'disable',
          label: '批次停用',
          icon: React.createElement(PauseCircleOutlined),
          variant: 'warning'
        },
        {
          key: 'clone',
          label: '批次複製',
          icon: React.createElement(CopyOutlined),
          variant: 'secondary',
          requiresInput: true,
          inputType: 'text',
          inputPlaceholder: '複製名稱前綴'
        },
        {
          key: 'delete',
          label: '批次刪除',
          icon: React.createElement(DeleteOutlined),
          variant: 'danger',
          confirmTitle: '刪除腳本確認',
          confirmText: '確定要刪除選中的 {{count}} 個腳本嗎？',
          confirmType: 'danger'
        }
      ],

      // 用戶批次操作
      users: [
        {
          key: 'activate',
          label: '批次啟用',
          icon: React.createElement(CheckCircleOutlined),
          variant: 'success'
        },
        {
          key: 'deactivate',
          label: '批次停用',
          icon: React.createElement(MinusCircleOutlined),
          variant: 'warning'
        },
        {
          key: 'assign_role',
          label: '指派角色',
          icon: React.createElement(TeamOutlined),
          variant: 'secondary',
          requiresInput: true,
          inputType: 'select',
          inputOptions: [
            { value: 'admin', label: '管理員' },
            { value: 'operator', label: '操作員' },
            { value: 'viewer', label: '觀察者' }
          ]
        }
      ]
    };

    // 增強的批次操作工具列
    const EnhancedBatchActionToolbar = React.memo(({
      selectedCount,
      selectedRows = [],
      onClear,
      actions = [],
      operationType = 'incidents',
      onBatchOperation,
      className = ''
    }) => {
      const [operationModal, setOperationModal] = useState(null);
      const [operationInput, setOperationInput] = useState('');
      const [operationLoading, setOperationLoading] = useState(false);

      if (selectedCount === 0) return null;

      const availableOperations = BatchOperations[operationType] || actions;

      const handleOperationClick = (operation) => {
        if (operation.requiresInput) {
          setOperationModal(operation);
          setOperationInput(operation.inputProps?.defaultValue || '');
        } else if (operation.confirmTitle) {
          Modal.confirm({
            title: operation.confirmTitle,
            content: operation.confirmText?.replace('{{count}}', selectedCount),
            type: operation.confirmType || 'confirm',
            onOk: () => executeOperation(operation),
            okText: '確認',
            cancelText: '取消'
          });
        } else {
          executeOperation(operation);
        }
      };

      const executeOperation = async (operation, inputValue = null) => {
        setOperationLoading(true);
        try {
          await onBatchOperation?.(operation.key, selectedRows, inputValue);

          const successMessage = operation.successText?.replace('{{count}}', selectedCount)
            || `已成功執行 ${operation.label} 操作`;
          message.success(successMessage);

          setOperationModal(null);
          setOperationInput('');
        } catch (error) {
          message.error(`批次操作失敗: ${error.message}`);
        } finally {
          setOperationLoading(false);
        }
      };

      const renderInputField = (operation) => {
        switch (operation.inputType) {
          case 'select':
            return (
              <Select
                value={operationInput}
                onChange={setOperationInput}
                placeholder={operation.inputPlaceholder}
                style={{ width: '100%' }}
                options={operation.inputOptions}
              />
            );
          case 'multiSelect':
            return (
              <Select
                mode="multiple"
                value={operationInput}
                onChange={setOperationInput}
                placeholder={operation.inputPlaceholder}
                style={{ width: '100%' }}
                options={operation.inputOptions}
              />
            );
          case 'number':
            return (
              <InputNumber
                value={operationInput}
                onChange={setOperationInput}
                placeholder={operation.inputPlaceholder}
                style={{ width: '100%' }}
                {...operation.inputProps}
              />
            );
          case 'tags':
            return (
              <Select
                mode="tags"
                value={operationInput}
                onChange={setOperationInput}
                placeholder={operation.inputPlaceholder}
                style={{ width: '100%' }}
              />
            );
          case 'checkbox':
            return (
              <Checkbox.Group
                value={operationInput}
                onChange={setOperationInput}
                options={operation.inputOptions}
              />
            );
          case 'treeSelect':
            return (
              <TreeSelect
                value={operationInput}
                onChange={setOperationInput}
                placeholder={operation.inputPlaceholder}
                style={{ width: '100%' }}
                treeData={operation.treeData || []}
              />
            );
          default:
            return (
              <Input
                value={operationInput}
                onChange={(e) => setOperationInput(e.target.value)}
                placeholder={operation.inputPlaceholder}
              />
            );
        }
      };

      return (
        <>
          <div className={`enhanced-batch-toolbar ${className}`}>
            <div className="batch-selection-info">
              <div className="batch-indicator">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span className="batch-count">已選擇 {selectedCount} 項</span>
              </div>
              <PlatformButton
                variant="text"
                size="small"
                icon={React.createElement(CloseOutlined)}
                onClick={onClear}
                className="batch-clear-btn"
              >
                清除選擇
              </PlatformButton>
            </div>

            <div className="batch-operations">
              <Space size="small">
                {availableOperations.map((operation, index) => (
                  <PlatformButton
                    key={operation.key || index}
                    variant={operation.variant || 'secondary'}
                    size="small"
                    icon={operation.icon}
                    loading={operationLoading && operationModal?.key === operation.key}
                    disabled={operation.disabled}
                    onClick={() => handleOperationClick(operation)}
                    tooltip={`${operation.label} (${selectedCount} 項)`}
                  >
                    {operation.label}
                  </PlatformButton>
                ))}
              </Space>
            </div>
          </div>

          {/* 操作輸入模態框 */}
          <Modal
            title={`${operationModal?.label} - ${selectedCount} 項`}
            open={!!operationModal}
            onOk={() => executeOperation(operationModal, operationInput)}
            onCancel={() => {
              setOperationModal(null);
              setOperationInput('');
            }}
            confirmLoading={operationLoading}
            okText="執行操作"
            cancelText="取消"
          >
            {operationModal && (
              <div style={{ marginBottom: '16px' }}>
                <div style={{ marginBottom: '8px', fontWeight: 500 }}>
                  {operationModal.inputPlaceholder || '請輸入參數'}
                </div>
                {renderInputField(operationModal)}
                {operationModal.inputDescription && (
                  <div style={{ marginTop: '8px', fontSize: '12px', color: 'var(--text-tertiary)' }}>
                    {operationModal.inputDescription}
                  </div>
                )}
              </div>
            )}
          </Modal>
        </>
      );
    });

    // === 批次操作工具列 ===
    const BatchActionToolbar = React.memo(({
      selectedCount,
      onClear,
      actions = [],
      className = ''
    }) => {
      if (selectedCount === 0) return null;

      return (
        <div className={`batch-action-toolbar ${className}`}>
          <div className="batch-selection-info">
            <PlatformButton
              variant="text"
              size="small"
              icon={<CloseOutlined />}
              tooltip="清除選擇"
              onClick={onClear}
            />
            <span className="batch-count">已選擇 {selectedCount} 項</span>
          </div>
          <Space size="small" className="batch-actions">
            {actions.map((action, index) => (
              <PlatformButton
                key={index}
                variant={action.variant || 'secondary'}
                size="small"
                icon={action.icon}
                tooltip={action.tooltip}
                loading={action.loading}
                disabled={action.disabled}
                onClick={() => action.onClick(selectedCount)}
                {...action.props}
              >
                {action.text}
              </PlatformButton>
            ))}
          </Space>
        </div>
      );
    });

    // === 通用匯出功能系統 ===
    const useDataExport = () => {
      const [exportLoading, setExportLoading] = useState(false);
      const [exportProgress, setExportProgress] = useState(0);

      // CSV 匯出
      const exportToCSV = useCallback((data, columns, filename = 'export') => {
        return new Promise((resolve, reject) => {
          try {
            setExportLoading(true);
            setExportProgress(0);

            // 處理表頭
            const headers = columns.map(col => col.title || col.label);

            // 處理資料行
            const csvData = data.map((row, index) => {
              setExportProgress(Math.round((index / data.length) * 80));

              return columns.map(col => {
                let value = '';

                if (col.dataIndex) {
                  value = row[col.dataIndex];
                } else if (col.render && typeof col.render === 'function') {
                  // 處理自定義渲染函數
                  const rendered = col.render(row[col.dataIndex], row, index);
                  value = typeof rendered === 'string' ? rendered : String(rendered || '');
                } else {
                  value = '';
                }

                // 處理特殊字符和格式
                if (value === null || value === undefined) {
                  return '';
                }

                value = String(value).replace(/"/g, '""');

                // 如果包含逗號、換行或引號，需要用引號包圍
                if (value.includes(',') || value.includes('\n') || value.includes('"')) {
                  return `"${value}"`;
                }

                return value;
              });
            });

            setExportProgress(90);

            // 組合CSV內容
            const csvContent = [headers, ...csvData]
              .map(row => row.join(','))
              .join('\n');

            // 添加BOM以支援中文
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });

            setExportProgress(100);

            // 下載檔案
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `${filename}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            setTimeout(() => {
              setExportLoading(false);
              setExportProgress(0);
              resolve();
            }, 500);
          } catch (error) {
            setExportLoading(false);
            setExportProgress(0);
            reject(error);
          }
        });
      }, []);

      // Excel 匯出 (使用 CSV 作為 fallback)
      const exportToExcel = useCallback(async (data, columns, filename = 'export') => {
        try {
          // 如果有 XLSX 庫，使用它；否則使用 CSV
          if (window.XLSX) {
            setExportLoading(true);
            setExportProgress(0);

            const worksheet = window.XLSX.utils.json_to_sheet(
              data.map((row, index) => {
                setExportProgress(Math.round((index / data.length) * 80));

                const processedRow = {};
                columns.forEach(col => {
                  const header = col.title || col.label;
                  let value = '';

                  if (col.dataIndex) {
                    value = row[col.dataIndex];
                  } else if (col.render && typeof col.render === 'function') {
                    const rendered = col.render(row[col.dataIndex], row, index);
                    value = typeof rendered === 'string' ? rendered : String(rendered || '');
                  }

                  processedRow[header] = value;
                });

                return processedRow;
              })
            );

            setExportProgress(90);

            const workbook = window.XLSX.utils.book_new();
            window.XLSX.utils.book_append_sheet(workbook, worksheet, 'Data');

            setExportProgress(100);

            window.XLSX.writeFile(workbook, `${filename}.xlsx`);

            setTimeout(() => {
              setExportLoading(false);
              setExportProgress(0);
            }, 500);
          } else {
            // Fallback to CSV
            await exportToCSV(data, columns, filename);
          }
        } catch (error) {
          setExportLoading(false);
          setExportProgress(0);
          throw error;
        }
      }, [exportToCSV]);

      // JSON 匯出
      const exportToJSON = useCallback((data, columns, filename = 'export') => {
        return new Promise((resolve, reject) => {
          try {
            setExportLoading(true);
            setExportProgress(0);

            const processedData = data.map((row, index) => {
              setExportProgress(Math.round((index / data.length) * 90));

              const processedRow = {};
              columns.forEach(col => {
                const key = col.dataIndex || col.key;
                if (key) {
                  processedRow[key] = row[key];
                }
              });

              return processedRow;
            });

            setExportProgress(100);

            const jsonContent = JSON.stringify(processedData, null, 2);
            const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8;' });

            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `${filename}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            setTimeout(() => {
              setExportLoading(false);
              setExportProgress(0);
              resolve();
            }, 500);
          } catch (error) {
            setExportLoading(false);
            setExportProgress(0);
            reject(error);
          }
        });
      }, []);

      return {
        exportToCSV,
        exportToExcel,
        exportToJSON,
        exportLoading,
        exportProgress
      };
    };

    // 匯出按鈕組件
    const ExportDropdown = React.memo(({
      data = [],
      columns = [],
      filename = 'export',
      selectedRows = null,
      onExportComplete = () => { },
      disabled = false
    }) => {
      const { exportToCSV, exportToExcel, exportToJSON, exportLoading, exportProgress } = useDataExport();
      const [exportModalVisible, setExportModalVisible] = useState(false);
      const [exportConfig, setExportConfig] = useState({
        format: 'csv',
        range: 'all', // all, selected, filtered
        includeHeaders: true,
        selectedColumns: []
      });

      useEffect(() => {
        // 初始化選中的欄位
        setExportConfig(prev => ({
          ...prev,
          selectedColumns: columns.map(col => col.dataIndex || col.key).filter(Boolean)
        }));
      }, [columns]);

      const handleExport = async (format) => {
        try {
          let exportData = data;
          let exportColumns = columns;

          // 根據範圍篩選資料
          if (exportConfig.range === 'selected' && selectedRows && selectedRows.length > 0) {
            exportData = selectedRows;
          }

          // 根據選中的欄位篩選columns
          if (exportConfig.selectedColumns.length > 0) {
            exportColumns = columns.filter(col =>
              exportConfig.selectedColumns.includes(col.dataIndex || col.key)
            );
          }

          switch (format) {
            case 'csv':
              await exportToCSV(exportData, exportColumns, filename);
              break;
            case 'excel':
              await exportToExcel(exportData, exportColumns, filename);
              break;
            case 'json':
              await exportToJSON(exportData, exportColumns, filename);
              break;
            default:
              throw new Error('不支援的匯出格式');
          }

          message.success(`成功匯出 ${exportData.length} 筆資料為 ${format.toUpperCase()} 格式`);
          onExportComplete?.(format, exportData.length);
          setExportModalVisible(false);
        } catch (error) {
          message.error(`匯出失敗: ${error.message}`);
        }
      };

      const exportMenuItems = [
        {
          key: 'csv',
          icon: React.createElement(FileTextOutlined),
          label: 'CSV 格式',
          onClick: () => handleExport('csv')
        },
        {
          key: 'excel',
          icon: React.createElement(FileDoneOutlined),
          label: 'Excel 格式',
          onClick: () => handleExport('excel')
        },
        {
          key: 'json',
          icon: React.createElement(CodeOutlined),
          label: 'JSON 格式',
          onClick: () => handleExport('json')
        },
        {
          type: 'divider'
        },
        {
          key: 'advanced',
          icon: React.createElement(SettingOutlined),
          label: '進階設定...',
          onClick: () => setExportModalVisible(true)
        }
      ];

      return (
        <>
          <Dropdown
            menu={{
              items: exportMenuItems
            }}
            placement="bottomRight"
            disabled={disabled || exportLoading}
          >
            <PlatformButton
              variant="secondary"
              size="small"
              icon={React.createElement(DownloadOutlined)}
              loading={exportLoading}
              disabled={disabled}
            >
              匯出資料
              {exportLoading && exportProgress > 0 && ` (${exportProgress}%)`}
            </PlatformButton>
          </Dropdown>

          <Modal
            title="匯出設定"
            open={exportModalVisible}
            onOk={() => handleExport(exportConfig.format)}
            onCancel={() => setExportModalVisible(false)}
            okText="開始匯出"
            cancelText="取消"
            confirmLoading={exportLoading}
          >
            <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
              {/* 匯出格式 */}
              <div>
                <div style={{ marginBottom: '8px', fontWeight: 500 }}>匯出格式</div>
                <Radio.Group
                  value={exportConfig.format}
                  onChange={(e) => setExportConfig(prev => ({ ...prev, format: e.target.value }))}
                >
                  <Radio.Button value="csv">CSV</Radio.Button>
                  <Radio.Button value="excel">Excel</Radio.Button>
                  <Radio.Button value="json">JSON</Radio.Button>
                </Radio.Group>
              </div>

              {/* 匯出範圍 */}
              <div>
                <div style={{ marginBottom: '8px', fontWeight: 500 }}>匯出範圍</div>
                <Radio.Group
                  value={exportConfig.range}
                  onChange={(e) => setExportConfig(prev => ({ ...prev, range: e.target.value }))}
                >
                  <Radio value="all">全部資料 ({data.length} 筆)</Radio>
                  {selectedRows && selectedRows.length > 0 && (
                    <Radio value="selected">已選擇資料 ({selectedRows.length} 筆)</Radio>
                  )}
                </Radio.Group>
              </div>

              {/* 欄位選擇 */}
              <div>
                <div style={{ marginBottom: '8px', fontWeight: 500 }}>匯出欄位</div>
                <Checkbox.Group
                  value={exportConfig.selectedColumns}
                  onChange={(values) => setExportConfig(prev => ({ ...prev, selectedColumns: values }))}
                  style={{ width: '100%' }}
                >
                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '8px' }}>
                    {columns.map(col => (
                      <Checkbox
                        key={col.dataIndex || col.key}
                        value={col.dataIndex || col.key}
                      >
                        {col.title || col.label}
                      </Checkbox>
                    ))}
                  </div>
                </Checkbox.Group>
              </div>

              {exportLoading && (
                <div>
                  <div style={{ marginBottom: '8px', fontWeight: 500 }}>匯出進度</div>
                  <Progress percent={exportProgress} size="small" />
                </div>
              )}
            </div>
          </Modal>
        </>
      );
    });

    // === 欄位自訂管理系統 ===
    const useColumnManager = (initialColumns = [], storageKey = 'table-columns') => {
      const [columns, setColumns] = useState(initialColumns);
      const [columnSettings, setColumnSettings] = useState(() => {
        try {
          const saved = localStorage.getItem(storageKey);
          return saved ? JSON.parse(saved) : {};
        } catch {
          return {};
        }
      });

      // 儲存欄位設定到 localStorage
      const saveColumnSettings = useCallback((settings) => {
        setColumnSettings(settings);
        try {
          localStorage.setItem(storageKey, JSON.stringify(settings));
        } catch (error) {
          console.warn('無法儲存欄位設定:', error);
        }
      }, [storageKey]);

      // 應用欄位設定
      const applyColumnSettings = useCallback((columns, settings) => {
        if (!settings || Object.keys(settings).length === 0) {
          return columns;
        }

        return columns
          .map(col => ({
            ...col,
            hidden: settings[col.key || col.dataIndex]?.hidden || false,
            width: settings[col.key || col.dataIndex]?.width || col.width,
            fixed: settings[col.key || col.dataIndex]?.fixed || col.fixed,
            sorter: settings[col.key || col.dataIndex]?.sortable !== false ? col.sorter : false
          }))
          .filter(col => !col.hidden)
          .sort((a, b) => {
            const aOrder = settings[a.key || a.dataIndex]?.order || 0;
            const bOrder = settings[b.key || b.dataIndex]?.order || 0;
            return aOrder - bOrder;
          });
      }, []);

      // 更新欄位設定
      const updateColumnSetting = useCallback((columnKey, setting) => {
        const newSettings = {
          ...columnSettings,
          [columnKey]: {
            ...columnSettings[columnKey],
            ...setting
          }
        };
        saveColumnSettings(newSettings);
      }, [columnSettings, saveColumnSettings]);

      // 重設欄位設定
      const resetColumnSettings = useCallback(() => {
        setColumnSettings({});
        try {
          localStorage.removeItem(storageKey);
        } catch (error) {
          console.warn('無法清除欄位設定:', error);
        }
      }, [storageKey]);

      // 處理過的欄位
      const processedColumns = useMemo(() => {
        return applyColumnSettings(initialColumns, columnSettings);
      }, [initialColumns, columnSettings, applyColumnSettings]);

      return {
        columns: processedColumns,
        columnSettings,
        updateColumnSetting,
        resetColumnSettings,
        saveColumnSettings
      };
    };

    // 欄位管理組件
    const ColumnManager = React.memo(({
      columns = [],
      columnSettings = {},
      onSettingsChange,
      visible = false,
      onClose
    }) => {
      const [localColumns, setLocalColumns] = useState([]);
      const [draggedItem, setDraggedItem] = useState(null);

      useEffect(() => {
        // 初始化本地欄位狀態
        const columnsWithSettings = columns.map(col => {
          const key = col.key || col.dataIndex;
          const settings = columnSettings[key] || {};
          return {
            ...col,
            key: key,
            hidden: settings.hidden || false,
            width: settings.width || col.width || 150,
            fixed: settings.fixed || col.fixed || false,
            sortable: settings.sortable !== false,
            order: settings.order || 0
          };
        }).sort((a, b) => a.order - b.order);

        setLocalColumns(columnsWithSettings);
      }, [columns, columnSettings]);

      const handleColumnToggle = (columnKey, checked) => {
        setLocalColumns(prev =>
          prev.map(col =>
            col.key === columnKey ? { ...col, hidden: !checked } : col
          )
        );
      };

      const handleWidthChange = (columnKey, width) => {
        setLocalColumns(prev =>
          prev.map(col =>
            col.key === columnKey ? { ...col, width } : col
          )
        );
      };

      const handleFixedChange = (columnKey, fixed) => {
        setLocalColumns(prev =>
          prev.map(col =>
            col.key === columnKey ? { ...col, fixed } : col
          )
        );
      };

      const handleSortableChange = (columnKey, sortable) => {
        setLocalColumns(prev =>
          prev.map(col =>
            col.key === columnKey ? { ...col, sortable } : col
          )
        );
      };

      const handleDragStart = (e, index) => {
        setDraggedItem(index);
        e.dataTransfer.effectAllowed = 'move';
      };

      const handleDragOver = (e, index) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
      };

      const handleDrop = (e, dropIndex) => {
        e.preventDefault();
        if (draggedItem === null || draggedItem === dropIndex) return;

        const newColumns = [...localColumns];
        const draggedColumn = newColumns.splice(draggedItem, 1)[0];
        newColumns.splice(dropIndex, 0, draggedColumn);

        // 更新順序
        const updatedColumns = newColumns.map((col, index) => ({
          ...col,
          order: index
        }));

        setLocalColumns(updatedColumns);
        setDraggedItem(null);
      };

      const handleApply = () => {
        const newSettings = {};
        localColumns.forEach((col, index) => {
          newSettings[col.key] = {
            hidden: col.hidden,
            width: col.width,
            fixed: col.fixed,
            sortable: col.sortable,
            order: index
          };
        });

        onSettingsChange?.(newSettings);
        onClose?.();
      };

      const handleReset = () => {
        const resetColumns = columns.map((col, index) => ({
          ...col,
          key: col.key || col.dataIndex,
          hidden: false,
          width: col.width || 150,
          fixed: col.fixed || false,
          sortable: true,
          order: index
        }));

        setLocalColumns(resetColumns);
      };

      return (
        <Modal
          title="欄位管理"
          open={visible}
          onOk={handleApply}
          onCancel={onClose}
          width={600}
          okText="套用設定"
          cancelText="取消"
        >
          <div className="column-manager">
            <div className="column-manager-header">
              <div className="column-manager-actions">
                <PlatformButton
                  variant="secondary"
                  size="small"
                  onClick={handleReset}
                >
                  重設為預設
                </PlatformButton>
              </div>
              <div className="column-manager-stats">
                顯示 {localColumns.filter(col => !col.hidden).length} / {localColumns.length} 欄位
              </div>
            </div>

            <div className="column-manager-list">
              {localColumns.map((col, index) => (
                <div
                  key={col.key}
                  className={`column-item ${draggedItem === index ? 'dragging' : ''}`}
                  draggable
                  onDragStart={(e) => handleDragStart(e, index)}
                  onDragOver={(e) => handleDragOver(e, index)}
                  onDrop={(e) => handleDrop(e, index)}
                >
                  <div className="column-item-drag">
                    <span className="drag-handle">⋮⋮</span>
                  </div>

                  <div className="column-item-visibility">
                    <Checkbox
                      checked={!col.hidden}
                      onChange={(e) => handleColumnToggle(col.key, e.target.checked)}
                    />
                  </div>

                  <div className="column-item-info">
                    <div className="column-title">{col.title}</div>
                    <div className="column-key">{col.key}</div>
                  </div>

                  <div className="column-item-settings">
                    <div className="setting-item">
                      <label>寬度:</label>
                      <InputNumber
                        value={col.width}
                        onChange={(value) => handleWidthChange(col.key, value)}
                        min={50}
                        max={500}
                        size="small"
                        style={{ width: '80px' }}
                      />
                    </div>

                    <div className="setting-item">
                      <label>固定:</label>
                      <Select
                        value={col.fixed}
                        onChange={(value) => handleFixedChange(col.key, value)}
                        size="small"
                        style={{ width: '80px' }}
                      >
                        <Select.Option value={false}>否</Select.Option>
                        <Select.Option value="left">左</Select.Option>
                        <Select.Option value="right">右</Select.Option>
                      </Select>
                    </div>

                    <div className="setting-item">
                      <Checkbox
                        checked={col.sortable}
                        onChange={(e) => handleSortableChange(col.key, e.target.checked)}
                      >
                        可排序
                      </Checkbox>
                    </div>
                  </div>
                </div>
              ))}
            </div>

            <div className="column-manager-tips">
              <Alert
                message="使用提示"
                description="拖曳欄位可調整順序，取消勾選可隱藏欄位，調整寬度和固定設定以優化顯示效果。"
                type="info"
                showIcon
                size="small"
              />
            </div>
          </div>
        </Modal>
      );
    });

    // 欄位管理按鈕
    const ColumnManagerButton = React.memo(({
      columns,
      columnSettings,
      onSettingsChange,
      size = 'small'
    }) => {
      const [visible, setVisible] = useState(false);

      return (
        <>
          <PlatformButton
            variant="secondary"
            size={size}
            icon={React.createElement(SettingOutlined)}
            onClick={() => setVisible(true)}
            tooltip="管理欄位顯示"
          >
            欄位設定
          </PlatformButton>

          <ColumnManager
            columns={columns}
            columnSettings={columnSettings}
            onSettingsChange={onSettingsChange}
            visible={visible}
            onClose={() => setVisible(false)}
          />
        </>
      );
    });

    // === 響應式導航選單 ===
    const ResponsiveNav = React.memo(({
      currentPage,
      onNavigate,
      menuItems
    }) => {
      const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

      // 預設選單項目
      const defaultMenuItems = [
        { key: 'dashboard', label: '總覽', icon: <DashboardOutlined /> },
        { key: 'incident-list', label: '事件管理', icon: <AlertOutlined /> },
        { key: 'resource-list', label: '資源管理', icon: <CloudServerOutlined /> },
        { key: 'notification-strategies', label: '通知策略', icon: <BellOutlined /> },
        { key: 'automation', label: '自動化', icon: <ThunderboltOutlined /> },
        { key: 'settings', label: '設定', icon: <SettingOutlined /> },
      ];

      const items = menuItems || defaultMenuItems;

      return (
        <>
          {/* 桌面端導航 */}
          <div className="desktop-only" style={{ display: 'flex', gap: '8px' }}>
            {items.map(item => (
              <PlatformButton
                key={item.key}
                variant={currentPage === item.key ? 'primary' : 'ghost'}
                size="small"
                icon={item.icon}
                onClick={() => onNavigate(item.key)}
              >
                {item.label}
              </PlatformButton>
            ))}
          </div>

          {/* 移動端漢堡選單 */}
          <div className="mobile-only">
            <PlatformButton
              variant="ghost"
              size="medium"
              icon={<MenuOutlined />}
              onClick={() => setMobileMenuOpen(true)}
            />

            <Drawer
              title="導航選單"
              placement="left"
              open={mobileMenuOpen}
              onClose={() => setMobileMenuOpen(false)}
              width={280}
              className="mobile-nav-drawer"
            >
              <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                {items.map(item => (
                  <PlatformButton
                    key={item.key}
                    variant={currentPage === item.key ? 'primary' : 'text'}
                    size="large"
                    icon={item.icon}
                    onClick={() => {
                      onNavigate(item.key);
                      setMobileMenuOpen(false);
                    }}
                    style={{
                      width: '100%',
                      justifyContent: 'flex-start',
                      paddingLeft: '16px'
                    }}
                  >
                    {item.label}
                  </PlatformButton>
                ))}
              </div>
            </Drawer>
          </div>
        </>
      );
    });

    // === Modal 底部操作按鈕組 ===
    const ModalActions = React.memo(({
      onCancel,
      onConfirm,
      confirmText = "確定",
      cancelText = "取消",
      confirmLoading = false,
      confirmDisabled = false,
      showCancel = true,
      customActions = []
    }) => (
      <Space size="middle" className="modal-actions">
        {customActions.map((action, index) => (
          <PlatformButton
            key={index}
            variant={action.variant || 'secondary'}
            size="medium"
            icon={action.icon}
            loading={action.loading}
            disabled={action.disabled}
            onClick={action.onClick}
            {...action.props}
          >
            {action.text}
          </PlatformButton>
        ))}
        {showCancel && (
          <PlatformButton
            variant="secondary"
            size="medium"
            onClick={onCancel}
          >
            {cancelText}
          </PlatformButton>
        )}
        <PlatformButton
          variant="primary"
          size="medium"
          loading={confirmLoading}
          disabled={confirmDisabled}
          onClick={onConfirm}
          htmlType="submit"
        >
          {confirmText}
        </PlatformButton>
      </Space>
    ));

    // === 🚀 增強型資料表 - 完整功能整合 ===
    const EnhancedTable = React.memo(({
      title,
      columns,
      dataSource,
      loading = false,
      // 搜尋功能
      searchable = true,
      searchPlaceholder = "搜尋...",
      searchValue = "",
      onSearchChange,
      // 篩選功能
      filterable = true,
      filters = [],
      onFilterChange,
      // 排序功能
      sortable = true,
      defaultSortField,
      defaultSortOrder = 'ascend',
      // 分頁功能
      paginated = true,
      pageSize = 20,
      total,
      currentPage = 1,
      onPageChange,
      showSizeChanger = true,
      pageSizeOptions = ['10', '20', '50', '100'],
      // 批次操作
      batchActions = [],
      selectedRowKeys = [],
      onSelectionChange,
      // 工具列動作
      toolbarActions = {},
      // 欄位顯示控制
      columnSettings = false,
      visibleColumns,
      onColumnVisibilityChange,
      // 匯出功能
      exportable = true,
      onExport,
      // 樣式配置
      size = 'small',
      bordered = false,
      showHeader = true,
      sticky = false,
      className = '',
      ...tableProps
    }) => {
      const [internalSortField, setInternalSortField] = useState(defaultSortField);
      const [internalSortOrder, setInternalSortOrder] = useState(defaultSortOrder);

      // 排序處理
      const handleTableChange = useCallback((pagination, filters, sorter) => {
        if (sortable && sorter) {
          setInternalSortField(sorter.field);
          setInternalSortOrder(sorter.order);
        }
        if (onPageChange && pagination) {
          onPageChange(pagination.current, pagination.pageSize);
        }
      }, [sortable, onPageChange]);

      // 批次操作
      const hasSelectedRows = selectedRowKeys.length > 0;
      const rowSelection = onSelectionChange ? {
        selectedRowKeys,
        onChange: onSelectionChange,
        columnWidth: 48,
      } : undefined;

      // 處理欄位顯示
      const finalColumns = useMemo(() => {
        let processedColumns = columns;

        // 如果有欄位顯示控制，過濾不可見欄位
        if (columnSettings && visibleColumns) {
          processedColumns = columns.filter(col =>
            visibleColumns[col.key] !== false && visibleColumns[col.dataIndex] !== false
          );
        }

        // 為可排序欄位添加排序功能
        if (sortable) {
          processedColumns = processedColumns.map(col => ({
            ...col,
            sorter: col.sorter || (col.sortable !== false ? true : undefined)
          }));
        }

        return processedColumns;
      }, [columns, columnSettings, visibleColumns, sortable]);

      // 分頁配置
      const paginationConfig = paginated ? {
        current: currentPage,
        pageSize: pageSize,
        total: total || dataSource.length,
        showSizeChanger,
        pageSizeOptions,
        showQuickJumper: true,
        showTotal: (total, range) => `顯示 ${range[0]}-${range[1]} 共 ${total} 項`,
        onChange: onPageChange,
        className: 'platform-pagination'
      } : false;

      return (
        <PlatformTableContainer
          title={title}
          actions={
            <ToolbarActions
              onRefresh={toolbarActions.onRefresh}
              onExport={exportable ? (onExport || toolbarActions.onExport) : undefined}
              onAdd={toolbarActions.onAdd}
              onFilter={toolbarActions.onFilter}
              filterActive={toolbarActions.filterActive}
              customActions={[
                ...(toolbarActions.customActions || []),
                ...(columnSettings ? [{
                  icon: <EyeOutlined />,
                  tooltip: '欄位設定',
                  onClick: toolbarActions.onColumnSettings,
                  text: '欄位'
                }] : [])
              ]}
            />
          }
          className={className}
        >
          {/* 搜尋和篩選控制列 */}
          {(searchable || filterable) && (
            <EnhancedTableControls
              searchValue={searchValue}
              onSearchChange={onSearchChange}
              searchPlaceholder={searchPlaceholder}
              filters={filters}
              onFilterChange={onFilterChange}
              showRefresh={false}
              showExport={false}
            />
          )}

          {/* 批次操作工具列 */}
          <BatchActionToolbar
            selectedCount={selectedRowKeys.length}
            onClear={() => onSelectionChange && onSelectionChange([])}
            actions={batchActions}
          />

          {/* 資料表 */}
          <Table
            {...tableProps}
            columns={finalColumns}
            dataSource={dataSource}
            loading={loading}
            rowSelection={rowSelection}
            pagination={paginationConfig}
            size={size}
            bordered={bordered}
            showHeader={showHeader}
            sticky={sticky}
            onChange={handleTableChange}
            className="platform-enhanced-table"
            scroll={{ x: 'max-content' }}
          />
        </PlatformTableContainer>
      );
    });

    // === 🎯 列表頁面核心功能 Hook ===
    const useListPageFeatures = ({
      initialData = [],
      searchFields = ['name'],
      pageSize = 20,
      sortField = 'name',
      sortOrder = 'ascend'
    }) => {
      // 基礎狀態
      const [data, setData] = useState(initialData);
      const [loading, setLoading] = useState(false);
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);

      // 搜尋狀態
      const [searchValue, setSearchValue] = useState('');
      const [filters, setFilters] = useState({});

      // 分頁狀態
      const [currentPage, setCurrentPage] = useState(1);
      const [currentPageSize, setCurrentPageSize] = useState(pageSize);

      // 排序狀態
      const [sortField_, setSortField] = useState(sortField);
      const [sortOrder_, setSortOrder] = useState(sortOrder);

      // 欄位顯示狀態
      const [visibleColumns, setVisibleColumns] = useState({});

      // 搜尋功能
      const filteredData = useMemo(() => {
        let result = data;

        // 文字搜尋
        if (searchValue) {
          result = result.filter(item =>
            searchFields.some(field => {
              const value = item[field];
              return value && value.toString().toLowerCase().includes(searchValue.toLowerCase());
            })
          );
        }

        // 進階篩選
        Object.entries(filters).forEach(([key, filterValue]) => {
          if (filterValue && filterValue.length > 0) {
            result = result.filter(item => {
              if (Array.isArray(filterValue)) {
                return filterValue.includes(item[key]);
              }
              return item[key] === filterValue;
            });
          }
        });

        return result;
      }, [data, searchValue, filters, searchFields]);

      // 分頁和排序後的資料
      const processedData = useMemo(() => {
        let result = [...filteredData];

        // 排序
        if (sortField_ && sortOrder_) {
          result.sort((a, b) => {
            const aVal = a[sortField_];
            const bVal = b[sortField_];

            if (typeof aVal === 'string') {
              return sortOrder_ === 'ascend'
                ? aVal.localeCompare(bVal)
                : bVal.localeCompare(aVal);
            }

            if (typeof aVal === 'number') {
              return sortOrder_ === 'ascend' ? aVal - bVal : bVal - aVal;
            }

            return 0;
          });
        }

        // 分頁
        const startIndex = (currentPage - 1) * currentPageSize;
        return result.slice(startIndex, startIndex + currentPageSize);
      }, [filteredData, sortField_, sortOrder_, currentPage, currentPageSize]);

      // 批次操作
      const batchDelete = useCallback((confirmCallback) => {
        if (selectedRowKeys.length === 0) return;

        Modal.confirm({
          title: `確定要刪除 ${selectedRowKeys.length} 項資料嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原，請謹慎操作。',
          okText: '確定刪除',
          okType: 'danger',
          cancelText: '取消',
          onOk: () => {
            setData(prev => prev.filter(item => !selectedRowKeys.includes(item.key)));
            setSelectedRowKeys([]);
            confirmCallback && confirmCallback();
          }
        });
      }, [selectedRowKeys]);

      return {
        // 資料狀態
        data: processedData,
        allData: data,
        setData,
        loading,
        setLoading,
        total: filteredData.length,

        // 搜尋和篩選
        searchValue,
        setSearchValue,
        filters,
        setFilters,

        // 分頁
        currentPage,
        setCurrentPage,
        currentPageSize,
        setCurrentPageSize,

        // 排序
        sortField: sortField_,
        setSortField,
        sortOrder: sortOrder_,
        setSortOrder,

        // 選擇
        selectedRowKeys,
        setSelectedRowKeys,

        // 欄位顯示
        visibleColumns,
        setVisibleColumns,

        // 批次操作
        batchDelete,

        // 統計資訊
        stats: {
          total: data.length,
          filtered: filteredData.length,
          selected: selectedRowKeys.length,
          currentPageStart: (currentPage - 1) * currentPageSize + 1,
          currentPageEnd: Math.min(currentPage * currentPageSize, filteredData.length)
        }
      };
    };

    // === 📊 表格密度控制組件 ===
    const TableDensityControl = React.memo(({ density = 'standard', onChange }) => {
      const densityOptions = [
        { value: 'compact', label: '緊湊', icon: <CompressOutlined /> },
        { value: 'standard', label: '標準', icon: <AlignCenterOutlined /> },
        { value: 'comfortable', label: '舒適', icon: <ExpandOutlined /> }
      ];

      return (
        <div className="table-density-control">
          <Tooltip title="調整表格行高密度">
            <Dropdown
              menu={{
                items: densityOptions.map(option => ({
                  key: option.value,
                  label: (
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      {option.icon}
                      <span>{option.label}</span>
                      {density === option.value && <CheckOutlined style={{ color: 'var(--brand-primary)' }} />}
                    </div>
                  ),
                  onClick: () => onChange(option.value)
                }))
              }}
              trigger={['click']}
            >
              <PlatformButton
                variant="ghost"
                size="small"
                icon={<SettingOutlined />}
                tooltip="密度設定"
              >
                密度
              </PlatformButton>
            </Dropdown>
          </Tooltip>
        </div>
      );
    });

    // === 🎛️ 欄位顯示控制組件 ===
    const ColumnVisibilityControl = React.memo(({
      columns,
      visibleColumns,
      onChange,
      title = "欄位顯示設定"
    }) => {
      const [open, setOpen] = useState(false);

      const handleVisibilityChange = (columnKey, visible) => {
        onChange({
          ...visibleColumns,
          [columnKey]: visible
        });
      };

      const resetToDefault = () => {
        const defaultVisible = {};
        columns.forEach(col => {
          defaultVisible[col.key || col.dataIndex] = col.defaultVisible !== false;
        });
        onChange(defaultVisible);
      };

      const hideAllOptional = () => {
        const newVisible = {};
        columns.forEach(col => {
          const key = col.key || col.dataIndex;
          newVisible[key] = col.required === true || col.priority === 'high';
        });
        onChange(newVisible);
      };

      const showAll = () => {
        const newVisible = {};
        columns.forEach(col => {
          newVisible[col.key || col.dataIndex] = true;
        });
        onChange(newVisible);
      };

      const visibleCount = Object.values(visibleColumns).filter(Boolean).length;

      return (
        <Popover
          title={
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <span>{title}</span>
              <Text type="secondary" style={{ fontSize: '12px' }}>
                {visibleCount} / {columns.length} 顯示
              </Text>
            </div>
          }
          content={
            <div style={{ width: 280, maxHeight: 400, overflowY: 'auto' }}>
              {/* 快速操作 */}
              <div style={{
                display: 'flex',
                gap: '8px',
                marginBottom: '12px',
                paddingBottom: '12px',
                borderBottom: '1px solid var(--border-light)'
              }}>
                <Button size="small" onClick={showAll}>全部顯示</Button>
                <Button size="small" onClick={hideAllOptional}>僅核心欄位</Button>
                <Button size="small" onClick={resetToDefault}>重設</Button>
              </div>

              {/* 欄位清單 */}
              <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                {columns.map(column => {
                  const key = column.key || column.dataIndex;
                  const isVisible = visibleColumns[key] !== false;
                  const isRequired = column.required === true;

                  return (
                    <div
                      key={key}
                      style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        padding: '4px 8px',
                        borderRadius: 'var(--radius-sm)',
                        background: isVisible ? 'rgba(24, 144, 255, 0.1)' : 'transparent'
                      }}
                    >
                      <Checkbox
                        checked={isVisible}
                        disabled={isRequired}
                        onChange={(e) => handleVisibilityChange(key, e.target.checked)}
                      />
                      <span style={{
                        flex: 1,
                        fontSize: '13px',
                        color: isVisible ? 'var(--text-primary)' : 'var(--text-tertiary)'
                      }}>
                        {column.title}
                      </span>
                      {isRequired && (
                        <Tag size="small" color="blue">必需</Tag>
                      )}
                      {column.priority === 'low' && (
                        <Tag size="small" color="orange">可選</Tag>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          }
          trigger="click"
          open={open}
          onOpenChange={setOpen}
          placement="bottomRight"
        >
          <PlatformButton
            variant="ghost"
            size="small"
            icon={<EyeOutlined />}
            tooltip="欄位設定"
          >
            欄位 ({visibleCount})
          </PlatformButton>
        </Popover>
      );
    });

    // === 📱 響應式欄位管理 Hook ===
    const useResponsiveColumns = (columns, breakpoints = {}) => {
      const [screenSize, setScreenSize] = useState('large');

      useEffect(() => {
        const updateScreenSize = () => {
          const width = window.innerWidth;
          if (width < 768) {
            setScreenSize('mobile');
          } else if (width < 1200) {
            setScreenSize('tablet');
          } else {
            setScreenSize('large');
          }
        };

        updateScreenSize();
        window.addEventListener('resize', updateScreenSize);
        return () => window.removeEventListener('resize', updateScreenSize);
      }, []);

      const responsiveColumns = useMemo(() => {
        return columns.map(column => {
          const responsiveProps = {};

          // 根據螢幕尺寸設定 className
          if (column.priority === 'low' && screenSize !== 'large') {
            responsiveProps.className = `${column.className || ''} table-column-optional`.trim();
          } else if (column.priority === 'medium' && screenSize === 'mobile') {
            responsiveProps.className = `${column.className || ''} table-column-secondary`.trim();
          }

          // 調整欄位寬度
          if (screenSize === 'mobile') {
            if (column.width && typeof column.width === 'string') {
              const numericWidth = parseInt(column.width);
              if (numericWidth > 20) {
                responsiveProps.width = Math.max(15, numericWidth - 5) + '%';
              }
            }
          }

          return {
            ...column,
            ...responsiveProps
          };
        });
      }, [columns, screenSize]);

      return {
        columns: responsiveColumns,
        screenSize,
        isMobile: screenSize === 'mobile',
        isTablet: screenSize === 'tablet',
        isLarge: screenSize === 'large'
      };
    };

    // === 🏷️ 標準化頁面標題組件 ===
    const PageHeader = React.memo(({
      title,
      subtitle,
      actions,
      breadcrumb,
      icon,
      className = '',
      level = 1
    }) => {
      const HeadingTag = `h${level}`;

      return (
        <div className={`page-header ${className}`}>
          {breadcrumb && (
            <div className="page-breadcrumb">
              {breadcrumb}
            </div>
          )}

          <div className="page-header-content">
            <div className="page-header-main">
              <div className="page-title-section">
                {icon && (
                  <div className="page-title-icon">
                    {icon}
                  </div>
                )}
                <div className="page-title-text">
                  <HeadingTag className="page-title">
                    {title}
                  </HeadingTag>
                  {subtitle && (
                    <p className="page-subtitle">
                      {subtitle}
                    </p>
                  )}
                </div>
              </div>
            </div>

            {actions && (
              <div className="page-header-actions">
                {actions}
              </div>
            )}
          </div>
        </div>
      );
    });

    // === 📊 情境化 KPI 卡片組件 ===
    const ContextualKPICard = React.memo(({
      title,
      value,
      unit = '',
      trend,
      trendDirection = 'up', // up, down, stable
      status = 'normal', // normal, warning, critical, success
      icon,
      onClick,
      className = '',
      description,
      loading = false
    }) => {
      const statusColors = {
        normal: 'var(--text-primary)',
        success: 'var(--success-color)',
        warning: 'var(--warning-color)',
        critical: 'var(--error-color)'
      };

      const trendIcons = {
        up: <ArrowUpOutlined />,
        down: <ArrowDownOutlined />,
        stable: <MinusOutlined />
      };

      const trendColors = {
        up: status === 'critical' ? 'var(--error-color)' : 'var(--success-color)',
        down: status === 'critical' ? 'var(--success-color)' : 'var(--error-color)',
        stable: 'var(--text-tertiary)'
      };

      return (
        <div
          className={`contextual-kpi-card ${status} ${onClick ? 'clickable' : ''} ${className}`}
          onClick={onClick}
        >
          <div className="kpi-header">
            <div className="kpi-title-section">
              {icon && (
                <div className="kpi-icon">
                  {icon}
                </div>
              )}
              <div className="kpi-title">
                {title}
              </div>
            </div>

            {trend && (
              <div className="kpi-trend" style={{ color: trendColors[trendDirection] }}>
                {trendIcons[trendDirection]}
                <span className="trend-value">{trend}</span>
              </div>
            )}
          </div>

          <div className="kpi-content">
            {loading ? (
              <Skeleton.Input active size="large" />
            ) : (
              <>
                <div className="kpi-value" style={{ color: statusColors[status] }}>
                  {typeof value === 'number' ? value.toLocaleString() : value}
                  {unit && <span className="kpi-unit">{unit}</span>}
                </div>

                {description && (
                  <div className="kpi-description">
                    {description}
                  </div>
                )}
              </>
            )}
          </div>
        </div>
      );
    });

    // === 🎛️ 快速篩選 KPI 組件 ===
    const FilterableKPICard = React.memo(({
      title,
      value,
      unit = '',
      filterKey,
      filterValue,
      isActive = false,
      onFilterClick,
      status = 'normal',
      icon,
      className = ''
    }) => {
      const handleClick = () => {
        if (onFilterClick) {
          onFilterClick(filterKey, filterValue, !isActive);
        }
      };

      return (
        <ContextualKPICard
          title={title}
          value={value}
          unit={unit}
          status={status}
          icon={icon}
          onClick={handleClick}
          className={`filterable-kpi ${isActive ? 'active' : ''} ${className}`}
        />
      );
    });

    // === 標準化表格容器組件 ===
    const PlatformTableContainer = React.memo(({
      title,
      actions,
      children,
      className = ''
    }) => (
      <div className={`platform-table-container ${className}`}>
        {(title || actions) && (
          <div className="platform-table-header">
            {title && <h3 className="platform-table-title">{title}</h3>}
            {actions && (
              <div className="platform-table-actions">
                {actions}
              </div>
            )}
          </div>
        )}
        <div className="platform-table">
          {children}
        </div>
      </div>
    ));

    // === 增強版表格搜尋和篩選組件 ===
    const EnhancedTableControls = React.memo(({
      searchValue,
      onSearchChange,
      searchPlaceholder = "搜尋...",
      filters = [],
      onFilterChange,
      showRefresh = true,
      onRefresh,
      showExport = false,
      onExport,
      extraActions
    }) => {
      return (
        <div style={{
          display: 'flex',
          gap: 'var(--spacing-md)',
          alignItems: 'center',
          flexWrap: 'wrap'
        }}>
          {/* 搜尋框 */}
          <Input.Search
            placeholder={searchPlaceholder}
            value={searchValue}
            onChange={(e) => onSearchChange?.(e.target.value)}
            style={{ width: 300 }}
            allowClear
          />

          {/* 篩選器 */}
          {filters.map((filter, index) => (
            <Select
              key={index}
              placeholder={filter.placeholder}
              value={filter.value}
              onChange={(value) => onFilterChange?.(filter.key, value)}
              style={{ width: filter.width || 150 }}
              allowClear
              mode={filter.multiple ? 'multiple' : undefined}
            >
              {filter.options?.map(option => (
                <Select.Option key={option.value} value={option.value}>
                  {option.label}
                </Select.Option>
              ))}
            </Select>
          ))}

          {/* 操作按鈕組 */}
          <div style={{ marginLeft: 'auto', display: 'flex', gap: 'var(--spacing-sm)' }}>
            {showRefresh && (
              <Tooltip title="重新整理">
                <PlatformButton
                  type="secondary"
                  icon={<ReloadOutlined />}
                  onClick={onRefresh}
                />
              </Tooltip>
            )}
            {showExport && (
              <Tooltip title="匯出資料">
                <PlatformButton
                  type="secondary"
                  icon={<DownloadOutlined />}
                  onClick={onExport}
                />
              </Tooltip>
            )}
            {extraActions}
          </div>
        </div>
      );
    });


    // 🚀 改進版行內進度條組件 - 整合數值與進度條背景
    const InlineProgressCell = React.memo(({
      value,
      max = 100,
      status = 'healthy',
      unit = '%',
      showPercentage = false,
      formatValue = null,
      label = null,
      size = 'medium', // small, medium, large
      animated = false,
      threshold = null, // { warning: 80, critical: 90 }
      showTooltip = true
    }) => {
      // 計算百分比
      const percentage = Math.min((value / max) * 100, 100);

      // 自動判斷狀態（如果有閾值設定）
      let finalStatus = status;
      if (threshold && status === 'healthy') {
        if (percentage >= (threshold.critical || 90)) {
          finalStatus = 'critical';
        } else if (percentage >= (threshold.warning || 80)) {
          finalStatus = 'warning';
        }
      }

      // 格式化顯示值
      const displayValue = formatValue ? formatValue(value) : value;
      const displayText = showPercentage ? `${percentage.toFixed(1)}%` : `${displayValue}${unit}`;

      const statusColors = {
        healthy: '#52c41a',
        success: '#52c41a',
        warning: '#faad14',
        critical: '#ff4d4f',
        normal: '#1890ff'
      };

      const backgroundColors = {
        healthy: 'rgba(82, 196, 26, 0.15)',
        success: 'rgba(82, 196, 26, 0.15)',
        warning: 'rgba(250, 173, 20, 0.15)',
        critical: 'rgba(255, 77, 79, 0.15)',
        normal: 'rgba(24, 144, 255, 0.15)'
      };

      const progressCell = (
        <div className={`inline-progress-cell inline-progress-${size} ${finalStatus} ${animated ? 'animated' : ''}`}>
          {/* 背景進度條 */}
          <div
            className="inline-progress-background"
            style={{
              width: `${percentage}%`,
              backgroundColor: backgroundColors[finalStatus]
            }}
          />

          {/* 前景文字內容 */}
          <div className="inline-progress-content">
            {label && (
              <span className="inline-progress-label">{label}</span>
            )}
            <span
              className="inline-progress-text"
              style={{ color: statusColors[finalStatus] }}
            >
              {displayText}
            </span>
          </div>

          {/* 狀態指示器 */}
          <div
            className="inline-progress-indicator"
            style={{ backgroundColor: statusColors[finalStatus] }}
          />
        </div>
      );

      // 可選的 Tooltip
      if (showTooltip) {
        return (
          <Tooltip
            title={
              <div>
                <div>數值: {displayValue}{unit}</div>
                <div>進度: {percentage.toFixed(1)}%</div>
                <div>狀態: {finalStatus}</div>
              </div>
            }
          >
            {progressCell}
          </Tooltip>
        );
      }

      return progressCell;
    });

    // 🔧 進度條表格欄位輔助函數
    const createProgressColumn = ({
      title,
      dataIndex,
      maxValue = 100,
      unit = '%',
      threshold = { warning: 80, critical: 90 },
      formatValue = null,
      showPercentage = false,
      width = '140px'
    }) => ({
      title,
      dataIndex,
      width,
      align: 'center',
      render: (value, record) => (
        <InlineProgressCell
          value={value || 0}
          max={maxValue}
          unit={unit}
          threshold={threshold}
          formatValue={formatValue}
          showPercentage={showPercentage}
          size="medium"
          animated={true}
          showTooltip={true}
        />
      ),
      sorter: (a, b) => (a[dataIndex] || 0) - (b[dataIndex] || 0)
    });

    // 通用表格組件 - 使用 React.memo 優化性能
    const OptimizedTable = React.memo(({
      dataSource,
      columns,
      loading,
      rowKey = 'key',
      pagination,
      onRowSelectionChange,
      scroll,
      size = 'small',
      className = 'transparent-bg'
    }) => {
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);

      const rowSelection = useMemo(() => onRowSelectionChange ? {
        selectedRowKeys,
        onChange: (keys) => {
          setSelectedRowKeys(keys);
          onRowSelectionChange(keys);
        },
        columnWidth: 32
      } : undefined, [selectedRowKeys, onRowSelectionChange]);

      const defaultPagination = useMemo(() => ({
        position: ['bottomRight'],
        showSizeChanger: true,
        showQuickJumper: true,
        size: 'small',
        ...pagination
      }), [pagination]);

      return (
        <Table
          rowSelection={rowSelection}
          columns={columns}
          dataSource={dataSource}
          rowKey={rowKey}
          loading={loading}
          pagination={defaultPagination}
          scroll={scroll || { x: 'max-content' }}
          size={size}
          className={className}
        />
      );
    });

    // --- Custom Hook for localStorage ---
    const useLocalStorageState = (key, defaultValue) => {
      const [state, setState] = useState(() => {
        try {
          const storedValue = window.localStorage.getItem(key);
          // Reviver function to parse ISO date strings back to dayjs objects
          const reviver = (k, v) => {
            if (typeof v === 'string' && /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/.test(v)) {
              return dayjs(v);
            }
            if (k === 'timeRange' && Array.isArray(v)) {
              return [dayjs(v[0]), dayjs(v[1])];
            }
            if (k === 'lastRun' && typeof v === 'string') {
              return dayjs(v);
            }
            return v;
          };
          return storedValue ? JSON.parse(storedValue, reviver) : defaultValue;
        } catch (error) {
          // localStorage 讀取失敗，使用預設值
          return defaultValue;
        }
      });

      useEffect(() => {
        try {
          window.localStorage.setItem(key, JSON.stringify(state));
        } catch (error) {
          // localStorage 寫入失敗，靜默處理
        }
      }, [key, state]);

      return [state, setState];
    };

    // --- 通用刪除確認函數 ---
    const useDeleteConfirm = () => {
      return (itemName, onDelete, customMessage = null) => {
        modal.confirm({
          title: `確定要刪除${customMessage || `此${itemName}`}嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            onDelete();
            message.success(`${itemName}刪除成功`);
          }
        });
      };

      const handleBatchAddToGroup = () => {
        if (selectedRowKeys.length === 0) {
          message.warning('請先選擇要操作的資源');
          return;
        }
        setIsAddToGroupModalOpen(true);
      };

      const handleConfirmAddToGroup = () => {
        if (!selectedGroupId) {
          message.error('請選擇一個資源群組');
          return;
        }

        const updatedResources = resources.map(res => {
          if (selectedRowKeys.includes(res.key)) {
            const currentGroups = res.groups || [];
            const newGroups = [...new Set([...currentGroups, selectedGroupId])];
            return { ...res, groups: newGroups };
          }
          return res;
        });

        setResources(updatedResources);
        message.success(`${selectedRowKeys.length} 個資源已成功加入群組`);
        setIsAddToGroupModalOpen(false);
        setSelectedRowKeys([]);
        setSelectedGroupId(null);
      };

      const handleOpenScanModal = () => {
        setIsScanModalOpen(true);
      };
    };

    // --- ECharts Component ---
    const EchartsForReact = ({ option, isDark }) => {
      const chartRef = useRef(null);
      useEffect(() => {
        let chart;
        if (chartRef.current !== null) {
          chart = echarts.init(chartRef.current, isDark ? 'dark' : 'light', { renderer: 'svg' });
          chart.setOption({ backgroundColor: 'transparent', ...option });
        }
        const resizeChart = () => { if (chart && !chart.isDisposed()) chart.resize(); };
        window.addEventListener('resize', resizeChart);
        return () => { if (chart) chart.dispose(); window.removeEventListener('resize', resizeChart); };
      }, [option, isDark]);
      return <div ref={chartRef} style={{ width: '100%', height: '100%' }} />;
    };

    // --- Page Components ---
    const LoginPage = ({ onLogin }) => {
      const [form] = Form.useForm();
      const onFinish = (values) => {
        if (values.username === 'admin' && values.password === 'admin') {
          onLogin();
        } else {
          message.error('帳號或密碼錯誤');
        }
      };
      return (
        <div className="login-page">
          {/* 背景裝飾 */}
          <div className="login-bg-shape1" />
          <div className="login-bg-shape2" />

          <div className="login-card">
            <div className="login-header">
              <div className="login-logo">
                <DeploymentUnitOutlined />
              </div>
              <Title level={2} className="login-title">SRE Platform</Title>
              <Text className="login-subtitle">智慧化系統可靠性管理平台</Text>
            </div>
            <Form
              form={form}
              name="login"
              onFinish={onFinish}
              layout="vertical"
              initialValues={{ username: 'admin', password: 'admin' }}
            >
              <Form.Item
                label="帳號"
                name="username"
                rules={[{ required: true, message: '請輸入帳號' }]}
              >
                <Input
                  size="large"
                  prefix={<UserOutlined />}
                  placeholder="請輸入帳號"
                  autoComplete="username"
                />
              </Form.Item>
              <Form.Item
                label="密碼"
                name="password"
                rules={[{ required: true, message: '請輸入密碼' }]}
              >
                <Input.Password
                  size="large"
                  prefix={<LockOutlined />}
                  placeholder="請輸入密碼"
                  autoComplete="current-password"
                />
              </Form.Item>
              <Form.Item>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Checkbox>記住我</Checkbox>
                  <Button type="link" style={{ padding: 0, height: 'auto' }}>
                    忘記密碼？
                  </Button>
                </div>
              </Form.Item>
              <Form.Item>
                <PlatformButton variant="primary" size="large" htmlType="submit" className="login-submit-btn" style={{ width: '100%' }}>
                  登入系統
                </PlatformButton>
              </Form.Item>
              <div style={{ textAlign: 'center' }}>
                <Text type="secondary" style={{ fontSize: '12px' }}>
                  測試帳號：admin / admin
                </Text>
              </div>
            </Form>
          </div>
        </div>
      );
    };



    const AiRiskForecast = ({ onNavigate }) => {
      const riskData = [
        { id: 'risk-1', resourceName: 'web-prod-01', metricName: 'CPU Usage', metricType: 'usage', timeToExhaust: 7, unit: '天' },
        { id: 'risk-2', resourceName: 'db-prod-01', metricName: 'Memory Usage', metricType: 'usage', timeToExhaust: 14, unit: '天' },
        { id: 'risk-3', resourceName: 'api-gateway-01', metricName: 'Latency', metricType: 'latency', timeToExhaust: 20, unit: '天' },
        { id: 'risk-4', resourceName: 'log-server-01', metricName: 'Disk Space', metricType: 'storage', timeToExhaust: 30, unit: '天' },
      ];

      const getIcon = (metricType) => {
        switch (metricType) {
          case 'storage':
            return <HddOutlined style={{ color: 'var(--brand-info)' }} />;
          case 'usage':
            return <DashboardOutlined style={{ color: 'var(--brand-success)' }} />;
          case 'latency':
            return <FieldTimeOutlined style={{ color: 'var(--brand-warning)' }} />;
          default:
            return <QuestionCircleOutlined />;
        }
      };

      return (
        <Card title="AI 風險預測" style={{ flex: 1, display: 'flex', flexDirection: 'column' }} bodyStyle={{ flex: 1, overflow: 'hidden', padding: '0 8px 8px' }}>
          <List
            itemLayout="horizontal"
            dataSource={riskData}
            renderItem={item => (
              <List.Item
                actions={[<Button type="link" onClick={() => onNavigate('resource-list', { searchText: item.resourceName, highlightedResource: item.resourceName })}>查看</Button>]}
                style={{ padding: '8px 12px', lineHeight: 1.6 }}
              >
                <List.Item.Meta
                  avatar={<Avatar size="large" icon={getIcon(item.metricType)} style={{ backgroundColor: 'rgba(255, 255, 255, 0.05)' }} />}
                  title={<a onClick={() => onNavigate('resource-list', { searchText: item.resourceName, highlightedResource: item.resourceName })}>{item.resourceName}</a>}
                  description={
                    <span>
                      {item.metricName} 預計在 <strong style={{ color: item.timeToExhaust < 15 ? 'var(--brand-danger)' : 'var(--brand-warning)' }}>{item.timeToExhaust} {item.unit}</strong> 後達到閾值
                    </span>
                  }
                />
              </List.Item>
            )}
          />
        </Card>
      );
    };

    // --- Page Components (Enhanced and Placeholders) ---
    const TopNResourceList = ({ themeMode }) => {
      const [metric, setMetric] = useState('CPU');

      // 生成趨勢數據 - 增強版隨機波動
      const generateTrend = () => {
        const baseValue = 55; // 基準值
        const trendDirection = Math.random() > 0.5 ? 1 : -1; // 上升或下降趨勢
        const volatility = 25; // 波動性

        let currentValue = baseValue;
        const trend = [];

        for (let i = 0; i < 12; i++) {
          // 新增趨勢方向的影響
          const trendInfluence = trendDirection * (i / 12) * 15;

          // 新增隨機波動
          const randomChange = (Math.random() - 0.5) * volatility;

          // 新增一些週期性變化（模擬一天中的波動）
          const periodicChange = Math.sin(i * Math.PI / 6) * 8;

          currentValue = Math.max(8, Math.min(98,
            baseValue + trendInfluence + randomChange + periodicChange
          ));

          // 新增平滑過渡
          if (i > 0) {
            const prevValue = trend[i - 1];
            currentValue = prevValue * 0.6 + currentValue * 0.4;
          }

          trend.push(Math.round(currentValue));
        }

        return trend;
      };

      const data = {
        CPU: Array.from({ length: 10 }, (_, i) => ({
          key: i,
          host: `web-prod-${i + 1}`,
          value: 95 - i * 2,
          trend: generateTrend()
        })),
        Mem: Array.from({ length: 10 }, (_, i) => ({
          key: i,
          host: `db-prod-${i + 1}`,
          value: 92 - i * 1.8,
          trend: generateTrend()
        })),
        Disk: Array.from({ length: 10 }, (_, i) => ({
          key: i,
          host: `log-server-${i + 1}`,
          value: 88 - i * 2.5,
          trend: generateTrend()
        })),
        Net: Array.from({ length: 10 }, (_, i) => ({
          key: i,
          host: `api-gateway-${i + 1}`,
          value: 800 - i * 25,
          trend: generateTrend()
        })),
      };

      // 建立迷你趨勢圖選項 - 增強版
      const createSparklineOption = (trendData, color, currentValue = 0) => {
        // 根據數值決定狀態
        const status = currentValue > 90 ? 'critical' :
          currentValue > 75 ? 'warning' : 'normal';

        return {
          backgroundColor: 'transparent',
          grid: { top: 3, bottom: 3, left: 2, right: 2 },

          // 新增輕微的背景色調指示狀態
          graphic: status !== 'normal' ? {
            type: 'rect',
            left: 0,
            top: 0,
            right: 0,
            bottom: 0,
            style: {
              fill: status === 'critical' ? 'rgba(255, 77, 79, 0.08)' :
                'rgba(250, 173, 20, 0.08)',
              borderRadius: 2
            }
          } : undefined,

          xAxis: {
            type: 'category',
            show: false,
            data: trendData.map((_, i) => i)
          },
          yAxis: {
            type: 'value',
            show: false,
            min: 'dataMin',
            max: 'dataMax'
          },
          series: [{
            data: trendData,
            type: 'line',
            smooth: true,
            showSymbol: false,
            lineStyle: {
              width: 1.5,
              color: color,
              shadowColor: color,
              shadowBlur: 1
            },
            // 新增輕微的區域填充
            areaStyle: {
              color: {
                type: 'linear',
                x: 0, y: 0, x2: 0, y2: 1,
                colorStops: [{
                  offset: 0, color: `${color}15`
                }, {
                  offset: 1, color: `${color}05`
                }]
              }
            },
            // 新增動畫效果
            animationDuration: 800,
            animationEasing: 'cubicOut'
          }]
        };
      };

      const columns = [
        {
          title: '主機',
          dataIndex: 'host',
          key: 'host',
          width: '20%',
          render: (text) => (
            <div className="text-secondary" style={{ fontSize: '12px', cursor: 'pointer' }} onClick={() => {
              // 切換到列表模式並篩選該主機
              setViewMode('list');
              setSearchText(text);
              setHighlightedResource(text);
            }}>
              {text}
            </div>
          )
        },
        {
          title: '資源趨勢 (24H)',
          dataIndex: 'trend',
          key: 'trend',
          width: '25%',
          render: (trend, record) => (
            <div style={{ height: '30px' }}>
              <EchartsForReact
                option={{
                  backgroundColor: 'transparent',
                  grid: { top: 4, bottom: 4, left: 2, right: 2 },
                  xAxis: { type: 'category', show: false, data: (trend || []).map((_, i) => i) },
                  yAxis: { type: 'value', show: false, min: 'dataMin', max: 'dataMax' },
                  series: [{
                    data: trend || [],
                    type: 'line',
                    smooth: false,
                    showSymbol: false,
                    lineStyle: { width: 2, color: '#6395f9' },
                    areaStyle: {
                      color: {
                        type: 'linear', x: 0, y: 0, x2: 0, y2: 1,
                        colorStops: [{ offset: 0, color: '#6395f94D' }, { offset: 1, color: '#6395f91A' }]
                      }
                    }
                  }]
                }}
                isDark={themeMode === 'dark'}
              />
            </div>
          )
        },
        {
          title: '使用率',
          dataIndex: 'value',
          key: 'value',
          width: '30%',
          render: (value, record) => {
            // 決定單位和最大值
            const metric = record.metric;
            const unit = metric === 'Net' ? ' Mbps' : '%';
            const maxValue = metric === 'Net' ? 1000 : 100;
            const displayValue = metric === 'Net' ? value : value;

            return (
              <InlineProgressCell
                value={displayValue}
                max={maxValue}
                unit={unit}
                threshold={{ warning: 75, critical: 90 }}
                size="medium"
                animated={true}
                showTooltip={true}
                formatValue={(val) => metric === 'Net' ? val.toFixed(0) : val.toFixed(1)}
              />
            );
          }
        }
      ];

      const titleContent = (
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' }}>
          <span style={{ fontSize: '16px', fontWeight: '600' }}>Top N 資源使用列表</span>
          <Radio.Group
            value={metric}
            onChange={(e) => setMetric(e.target.value)}
            size="small"
          >
            <Radio.Button value="CPU">CPU</Radio.Button>
            <Radio.Button value="Mem">記憶體</Radio.Button>
            <Radio.Button value="Disk">磁碟</Radio.Button>
            <Radio.Button value="Net">網路</Radio.Button>
          </Radio.Group>
        </div>
      );

      return (
        <Card
          title={titleContent}
          style={{
            height: '100%',
            display: 'flex',
            flexDirection: 'column',
            background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%)',
            border: '1px solid rgba(255, 255, 255, 0.12)',
            borderRadius: 'var(--radius-lg)',
            backdropFilter: 'blur(20px) saturate(180%)',
            WebkitBackdropFilter: 'blur(20px) saturate(180%)',
            boxShadow: '0 4px 24px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)',
            transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
            position: 'relative',
            overflow: 'hidden'
          }}
          bodyStyle={{ flex: 1, overflow: 'hidden', padding: '12px 12px 12px' }}
        >
          <div style={{ height: '100%', overflow: 'auto' }}>
            <Table
              dataSource={data[metric]}
              columns={columns}
              pagination={false}
              size="small"
              rowKey="key"
              className="topn-table"
              scroll={{ y: 'calc(100% - 25px)' }}
            />
          </div>
        </Card>
      );
    };

    const AIInsightSummary = ({ onNavigate }) => {
      const [isRefreshing, setIsRefreshing] = useState(false);
      const [insightContent, setInsightContent] = useState('整體系統穩定，但觀察到 Production Web Servers 的 CPU 使用率在高峰時段有 15% 的增長，接近警戒線。資料庫 延遲平穩，無明顯異常。建議關注 web-prod-03 主機的日誌，該主機出現了數次響應緩慢的情況。');

      // 刷新AI分析的函數
      const handleRefresh = async () => {
        setIsRefreshing(true);
        try {
          // 模擬AI重新分析過程
          await new Promise(resolve => setTimeout(resolve, 2000));

          // 模擬不同的AI分析結果
          const analysisVariants = [
            '整體系統穩定，但觀察到 Production Web Servers 的 CPU 使用率在高峰時段有 15% 的增長，接近警戒線。資料庫延遲平穩，無明顯異常。建議關注 web-prod-03 主機的日誌，該主機出現了數次響應緩慢的情況。',
            '系統運行良好，所有核心服務表現正常。檢測到 資料庫 連接池使用率略有上升，但仍在安全範圍內。建議在下次維護窗口期間優化 Production Web Servers 的負載分配策略。',
            '發現潛在的性能瓶頸：web-prod-03 主機的磁盤I/O使用率持續偏高，可能影響整體響應時間。資料庫查詢性能良好，但建議增加對 Production Web Servers 集群的監控頻率。',
            '系統整體健康，但注意到網絡延遲略有波動。Production Web Servers 負載均衡運行穩定，資料庫性能優異。建議在繁忙時段增加 web-prod-03 的資源配置以提升整體服務質量。'
          ];

          const randomAnalysis = analysisVariants[Math.floor(Math.random() * analysisVariants.length)];
          setInsightContent(randomAnalysis);

          message.success('AI 分析已更新');
        } catch (error) {
          message.error('重新生成分析失敗');
        } finally {
          setIsRefreshing(false);
        }
      };

      // 渲染實體連結的函數
      const renderEntityLinkedText = (text) => {
        const entityPatterns = [
          { pattern: /Production Web Servers/g, type: 'resource-group', param: 'Production Web Servers' },
          { pattern: /web-prod-03/g, type: 'resource', param: 'web-prod-03' },
          { pattern: /資料庫/g, type: 'service', param: '資料庫' }
        ];

        let result = text;
        entityPatterns.forEach(({ pattern, type, param }) => {
          result = result.replace(pattern, (match) => {
            let href = '#';
            let color = '#1890ff';

            switch (type) {
              case 'resource-group':
                href = `/resource-list?group=${encodeURIComponent(param)}`;
                color = '#52c41a';
                break;
              case 'resource':
                href = `/resource-detail/${param}`;
                color = '#faad14';
                break;
              case 'service':
                href = `/service-dashboard/${param}`;
                color = '#1677FF';
                break;
            }

            return `<a href="${href}" style="color: ${color}; text-decoration: underline; cursor: pointer; font-weight: 600;" onclick="event.preventDefault(); return false;">${match}</a>`;
          });
        });

        return <span dangerouslySetInnerHTML={{ __html: result }} />;
      };

      return (
        <div style={{
          background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%)',
          border: '1px solid rgba(114, 46, 209, 0.6)',
          borderRadius: 'var(--radius-lg)',
          padding: 'var(--spacing-lg)',
          backdropFilter: 'blur(10px)',
          boxShadow: '0 4px 12px rgba(0,0,0,0.1)',
          margin: '0 0 16px 0'
        }}>
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 'var(--spacing-md)' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
              <RobotOutlined style={{ fontSize: '24px', color: '#722ed1' }} />
              <Title level={4} style={{ margin: 0, color: 'var(--text-primary)' }}>AI 每日簡報</Title>
            </div>
            <Tooltip title="重新生成分析">
              <Avatar
                size={28}
                shape="square"
                icon={<ReloadOutlined spin={isRefreshing} />}
                onClick={handleRefresh}
                style={{
                  background: 'linear-gradient(135deg, #722ed1 0%, #9c4dcc 100%)',
                  fontSize: '14px',
                  cursor: isRefreshing ? 'not-allowed' : 'pointer',
                  opacity: isRefreshing ? 0.6 : 1,
                  transition: 'all 0.2s ease'
                }}
              />
            </Tooltip>
          </div>
          <Paragraph style={{ margin: 0, lineHeight: 1.7, color: 'var(--text-secondary)', fontSize: '14px' }}>
            {renderEntityLinkedText(insightContent)}
          </Paragraph>
        </div>
      );
    };

    // ⚡ 性能優化：使用 React.memo 和 useMemo 優化 HomePage
    const HomePage = ({ themeMode, onNavigate }) => {
      // This component is now much cleaner.
      // All the logic for TopNResourceList has been moved to that component.

      // 堆疊長條圖選項 - 資源群組狀態總覽
      const stackedBarOption = {
        tooltip: {
          trigger: 'axis',
          backgroundColor: 'rgba(0,0,0,0.8)',
          borderColor: 'rgba(255,255,255,0.2)',
          textStyle: { color: '#fff', fontSize: 11 }
        },
        // 新增點擊事件處理
        onClick: function (params) {
          if (onNavigate && params.name) {
            // 跳轉到資源列表頁面，並帶上群組篩選參數
            onNavigate('resource-list', { groupFilter: params.name });
          }
        },
        legend: {
          data: ['健康', '警告', '嚴重'],
          top: 0,
          textStyle: { color: 'rgba(255,255,255,0.85)', fontSize: 12 },
          itemGap: 8,
          itemWidth: 12,
          itemHeight: 8
        },
        grid: {
          left: '2%',
          right: '2%',
          bottom: '15%',
          top: '18%',
          containLabel: true
        },
        xAxis: {
          type: 'category',
          data: ['生產Web集群', '生產資料庫', '測試環境', '開發環境', '災備系統', '監控平台', 'API網關', '快取服務'],
          axisLabel: {
            color: 'rgba(255,255,255,0.65)',
            fontSize: 12,
            interval: 0,
            rotate: 0
          },
          axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }
        },
        yAxis: {
          type: 'value',
          axisLabel: { color: 'rgba(255,255,255,0.65)', fontSize: 10 },
          axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
          splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
        },
        series: [
          {
            name: '健康',
            type: 'bar',
            stack: '總量',
            data: [85, 18, 28, 22, 75, 32, 45, 38],
            color: '#52c41a',
            barWidth: '60%'
          },
          {
            name: '警告',
            type: 'bar',
            stack: '總量',
            data: [18, 12, 25, 8, 28, 22, 16, 14],
            color: '#faad14'
          },
          {
            name: '嚴重',
            type: 'bar',
            stack: '總量',
            data: [22, 8, 12, 6, 15, 10, 8, 12],
            color: '#ff4d4f'
          }
        ]
      };

      // 服務健康度熱力圖選項 - 四大黃金信號監控
      const serviceHealthHeatmapOption = {
        tooltip: {
          position: 'top',
          backgroundColor: 'rgba(0,0,0,0.8)',
          borderColor: 'rgba(255,255,255,0.2)',
          textStyle: { color: '#fff', fontSize: 11 },
          formatter: function (params) {
            const services = ['用戶認證', '訂單系統', '支付閘道', '通知服務', '資料分析', '檔案儲存'];
            const signals = ['延遲 (Latency)', '流量 (Traffic)', '錯誤 (Errors)', '飽和度 (Saturation)'];
            const service = services[params.data[1]];
            const signal = signals[params.data[0]];
            const statusText = params.data[2] === 0 ? '健康' : params.data[2] === 1 ? '警告' : '嚴重';
            return `${service}<br/>${signal}: ${statusText}`;
          }
        },
        // 新增點擊事件處理
        onClick: function (params) {
          if (onNavigate && params.data) {
            const services = ['用戶認證', '訂單系統', '支付閘道', '通知服務', '資料分析', '檔案儲存'];
            const signals = ['延遲', '流量', '錯誤', '飽和度'];
            const service = services[params.data[1]];
            const signal = signals[params.data[0]];
            // 跳轉到資源列表頁面，並帶上服務篩選參數
            onNavigate('resource-list', { serviceFilter: service, signalFilter: signal });
          }
        },
        animation: false,
        grid: {
          height: '65%',
          top: '10%',
          left: '15%',
          right: '5%'
        },
        xAxis: {
          type: 'category',
          data: ['延遲', '流量', '錯誤', '飽和度'],
          splitArea: {
            show: true
          },
          axisLabel: {
            color: 'rgba(255,255,255,0.85)',
            fontSize: 11
          }
        },
        yAxis: {
          type: 'category',
          data: ['用戶認證', '訂單系統', '支付閘道', '通知服務', '資料分析', '檔案儲存'],
          splitArea: {
            show: true
          },
          axisLabel: {
            color: 'rgba(255,255,255,0.85)',
            fontSize: 11
          }
        },
        visualMap: {
          min: 0,
          max: 2,
          type: 'piecewise',
          pieces: [
            { min: 0, max: 0, color: '#52c41a', label: '健康' },
            { min: 1, max: 1, color: '#faad14', label: '警告' },
            { min: 2, max: 2, color: '#ff4d4f', label: '嚴重' }
          ],
          orient: 'horizontal',
          left: 'center',
          bottom: '8%',
          itemWidth: 16,
          itemHeight: 10,
          textGap: 6,
          itemGap: 50,
          textStyle: {
            color: 'rgba(255,255,255,0.9)',
            fontSize: 11,
            fontWeight: 500
          }
        },
        series: [{
          name: '服務健康度',
          type: 'heatmap',
          data: [
            [0, 0, 0], [1, 0, 0], [2, 0, 1], [3, 0, 0],  // 用戶認證
            [0, 1, 0], [1, 1, 0], [2, 1, 0], [3, 1, 1],  // 訂單系統
            [0, 2, 1], [1, 2, 0], [2, 2, 2], [3, 2, 0],  // 支付閘道
            [0, 3, 0], [1, 3, 0], [2, 3, 0], [3, 3, 0],  // 通知服務
            [0, 4, 0], [1, 4, 1], [2, 4, 0], [3, 4, 0],  // 資料分析
            [0, 5, 0], [1, 5, 0], [2, 5, 0], [3, 5, 1]   // 檔案儲存
          ],
          label: {
            show: false
          },
          emphasis: {
            itemStyle: {
              shadowBlur: 10,
              shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
          }
        }]
      };

      return (
        <div style={{ display: 'flex', flexDirection: 'column', height: 'calc(100vh - 48px - 48px)', paddingBottom: 'var(--spacing-xl)' }}>

          {/* 區塊 A: 告警戰情 (Alert Status) */}
          <div style={{ marginBottom: '16px' }}>
            <Row gutter={[16, 12]}>
              {/* 主卡片 - 待處理告警 */}
              <Col xs={24} sm={12} md={8} lg={8}>
                <div
                  className="stat-card padding-md"
                  style={{ height: '120px', cursor: 'pointer' }}
                  onClick={() => {
                    if (onNavigate) onNavigate('incident-list', { statusFilter: 'new' });
                  }}
                >
                  <div className="card-content">
                    <div>
                      <div className="card-title" style={{ fontSize: '14px' }}>待處理告警</div>
                      <div className="card-value" style={{ color: '#ff4d4f', fontSize: '40px' }}>5</div>
                      <div className="card-description">
                        其中 <span style={{ color: '#ff4d4f', fontWeight: '600' }}>2</span> 嚴重
                      </div>
                    </div>
                    <FireOutlined className="card-icon" style={{ color: '#ff4d4f', fontSize: '36px' }} />
                  </div>
                </div>
              </Col>

              {/* 副卡片 1 - 處理中 */}
              <Col xs={24} sm={12} md={8} lg={8}>
                <div
                  className="stat-card padding-md"
                  style={{ height: '120px', cursor: 'pointer' }}
                  onClick={() => {
                    if (onNavigate) onNavigate('incident-list', { statusFilter: 'acknowledged' });
                  }}
                >
                  <div className="card-content">
                    <div>
                      <div className="card-title" style={{ fontSize: '14px' }}>處理中</div>
                      <div className="card-value" style={{ color: '#faad14', fontSize: '40px' }}>3</div>
                      <div className="card-description" style={{ color: '#faad14' }}>
                        ↘ 15% 較昨日
                      </div>
                    </div>
                    <ClockCircleOutlined className="card-icon" style={{ color: '#faad14', fontSize: '36px' }} />
                  </div>
                </div>
              </Col>

              {/* 副卡片 2 - 今日已解決 */}
              <Col xs={24} sm={12} md={8} lg={8}>
                <div
                  className="stat-card padding-md"
                  style={{ height: '120px', cursor: 'pointer' }}
                  onClick={() => {
                    if (onNavigate) onNavigate('incident-list', { statusFilter: 'resolved' });
                  }}
                >
                  <div className="card-content">
                    <div>
                      <div className="card-title" style={{ fontSize: '14px' }}>今日已解決</div>
                      <div className="card-value" style={{ color: '#52c41a', fontSize: '40px' }}>12</div>
                      <div className="card-description" style={{ color: '#52c41a' }}>
                        ↗ 8% 較昨日
                      </div>
                    </div>
                    <CheckCircleOutlined className="card-icon" style={{ color: '#52c41a', fontSize: '36px' }} />
                  </div>
                </div>
              </Col>
            </Row>
          </div>

          {/* AI 作戰參謀每日簡報 */}
          <AIInsightSummary onNavigate={onNavigate} />

          {/* 區塊 B: 資源健康度與關鍵業務監控 (Resource Health & Key Business Monitoring) */}
          <div style={{ flexGrow: 1, display: 'flex', flexDirection: 'column', minHeight: '400px', marginBottom: 'var(--spacing-lg)' }}>
            <Row gutter={[16, 12]} style={{ flexGrow: 1, height: '100%' }}>
              {/* 左側：服務健康度熱力圖 - 佔 1/3 */}
              <Col xs={24} sm={24} md={8} lg={8} style={{ display: 'flex', marginBottom: '16px' }}>
                <div
                  className="chart-card"
                  style={{
                    width: '100%',
                    padding: '16px',
                    cursor: 'pointer',
                    display: 'flex',
                    flexDirection: 'column',
                    minHeight: '350px',
                    height: '100%'
                  }}
                  onClick={() => {
                    if (onNavigate) onNavigate('resource-list');
                  }}
                >
                  <Title level={5} className="chart-title" style={{ marginBottom: '16px' }}>服務健康度總覽</Title>
                  <div style={{ flexGrow: 1, minHeight: '280px', height: 'calc(100% - 40px)' }}>
                    <EchartsForReact option={serviceHealthHeatmapOption} isDark={themeMode === 'dark'} />
                  </div>
                </div>
              </Col>

              {/* 右側：資源群組狀態總覽 - 佔 2/3 */}
              <Col xs={24} sm={24} md={16} lg={16} style={{ display: 'flex', marginBottom: '16px' }}>
                <div
                  className="chart-card"
                  style={{
                    width: '100%',
                    padding: '16px',
                    cursor: 'pointer',
                    display: 'flex',
                    flexDirection: 'column',
                    minHeight: '350px',
                    height: '100%'
                  }}
                  onClick={() => {
                    if (onNavigate) onNavigate('resource-list');
                  }}
                >
                  <Title level={5} className="chart-title" style={{ marginBottom: '16px' }}>資源群組狀態總覽</Title>
                  <div style={{ flexGrow: 1, minHeight: '280px', height: 'calc(100% - 40px)' }}>
                    <EchartsForReact option={stackedBarOption} isDark={themeMode === 'dark'} />
                  </div>
                </div>
              </Col>
            </Row>
          </div>

        </div>
      );
    };

    const ResourceOverviewPage = ({ themeMode, onNavigate }) => {
      // Data and state logic migrated from the original component
      const generateTrend = () => {
        const baseValue = 55;
        const trendDirection = Math.random() > 0.5 ? 1 : -1;
        const volatility = 25;
        let currentValue = baseValue;
        const trend = [];
        for (let i = 0; i < 12; i++) {
          const trendInfluence = trendDirection * (i / 12) * 15;
          const randomChange = (Math.random() - 0.5) * volatility;
          const periodicChange = Math.sin(i * Math.PI / 6) * 8;
          currentValue = Math.max(8, Math.min(98, baseValue + trendInfluence + randomChange + periodicChange));
          if (i > 0) {
            const prevValue = trend[i - 1];
            currentValue = prevValue * 0.6 + currentValue * 0.4;
          }
          trend.push(Math.round(currentValue));
        }
        return trend;
      };

      const initialData = [
        { key: 'host_1', name: 'db-prod-01', type: 'database', status: 'healthy', ip_address: '10.0.0.10', groups: ['g_1'], tags: ['production', 'database', 'high-priority'], trend: generateTrend(), alarms: [] },
        { key: 'host_2', name: 'web-prod-02', type: 'server', status: 'warning', ip_address: '10.0.0.21', groups: ['g_2'], tags: ['production', 'web-server'], trend: generateTrend(), alarms: [{ severity: 'warning', summary: 'Disk space is over 85%' }] },
        { key: 'host_3', name: 'api-gateway-prod', type: 'gateway', status: 'critical', ip_address: '10.0.0.35', groups: [], tags: ['production', 'high-priority'], trend: generateTrend(), alarms: [{ severity: 'critical', summary: 'API latency > 2s' }, { severity: 'warning', summary: '5xx error rate > 5%' }] },
        { key: 'host_4', name: 'cache-redis-prod', type: 'cache', status: 'healthy', ip_address: '10.0.0.40', groups: ['g_1', 'g_2'], tags: ['production', 'database'], trend: generateTrend(), alarms: [] },
        {
          key: 'host_5',
          name: 'k8s-master-node-01',
          type: 'server',
          status: 'healthy',
          ip_address: '10.0.1.5',
          groups: ['g_2', 'g_3'],
          tags: [
            'production', 'kubernetes', 'control-plane', 'high-availability', 'cluster-critical',
            'team-alpha', 'owner:JohnDoe', 'cost-center:12345', 'data-center:us-east-1a',
            'os:ubuntu-22.04', 'instance-type:m5.xlarge', 'backup-policy:daily'
          ],
          trend: generateTrend(),
          alarms: []
        }
      ];

      const [resources, setResources] = useLocalStorageState('sre-resources-v3', initialData);

      // Click handler for attention list, navigates to list page with filter
      const handleAttentionClick = (resourceName) => {
        onNavigate('resource-list', { searchText: resourceName, highlightedResource: resourceName });
      };

      const attentionResources = resources
        .filter(r => r.status === 'warning' || r.status === 'critical')
        .sort((a, b) => {
          if (a.status === 'critical' && b.status !== 'critical') return -1;
          if (a.status !== 'critical' && b.status === 'critical') return 1;
          return 0;
        });

      return (
        <React.Fragment>
          <div style={{ marginBottom: 'var(--spacing-lg)' }}>
            <Title level={2} className="page-title" style={{ marginBottom: '4px' }}>資源總覽</Title>
            <Paragraph className="page-subtitle" type="secondary" style={{ margin: 0 }}>
              您所有基礎設施的作戰指揮中心。即時掌握資源健康度、定位性能瓶頸，並預測未來容量風險。
            </Paragraph>
          </div>
          {/* 頂部橫幅：宏觀 KPI 狀態欄 */}
          <Row gutter={[16, 16]} style={{ marginBottom: 'var(--spacing-lg)' }}>
            {/* 總資源數 */}
            <Col xs={24} sm={12} md={6} lg={6}>
              <div
                className="stat-card"
                style={{ height: '120px', cursor: 'pointer' }}
                onClick={() => onNavigate('resource-list')}
              >
                <div className="card-content">
                  <div>
                    <div className="card-title" style={{ fontSize: '14px' }}>總資源數</div>
                    <div className="card-value" style={{ color: 'var(--brand-primary)', fontSize: '32px', fontWeight: '600' }}>
                      374 <span style={{ fontSize: '16px', color: 'var(--text-tertiary)', fontWeight: '400' }}>個</span>
                    </div>
                    <div className="card-description" style={{ fontSize: '12px', color: 'var(--text-tertiary)', marginTop: '4px' }}>
                      主機: 350, 服務: 24
                    </div>
                  </div>
                  <HddOutlined className="card-icon" style={{ color: 'var(--brand-primary)', fontSize: '24px' }} />
                </div>
              </div>
            </Col>

            {/* 健康狀態 */}
            <Col xs={24} sm={12} md={6} lg={6}>
              <div
                className="stat-card"
                style={{ height: '120px', cursor: 'pointer' }}
                onClick={() => onNavigate('resource-list', { statusFilter: 'healthy' })}
              >
                <div className="card-content">
                  <div>
                    <div className="card-title" style={{ fontSize: '14px' }}>健康狀態</div>
                    <div className="card-value" style={{ color: 'var(--brand-success)', fontSize: '32px', fontWeight: '600' }}>
                      138 <span style={{ fontSize: '16px', color: 'var(--text-tertiary)', fontWeight: '400' }}>健康</span>
                    </div>
                    <div className="card-description" style={{ display: 'flex', gap: '12px', fontSize: '12px' }}>
                      <span style={{ color: 'var(--brand-warning)', cursor: 'pointer', textDecoration: 'underline' }}
                        onClick={(e) => { e.stopPropagation(); onNavigate('resource-list', { statusFilter: 'warning' }) }}>
                        143 警告
                      </span>
                      <span style={{ color: 'var(--brand-danger)', cursor: 'pointer', textDecoration: 'underline' }}
                        onClick={(e) => { e.stopPropagation(); onNavigate('resource-list', { statusFilter: 'critical' }) }}>
                        93 嚴重
                      </span>
                    </div>
                  </div>
                  <CheckCircleOutlined className="card-icon" style={{ color: 'var(--brand-success)', fontSize: '24px' }} />
                </div>
              </div>
            </Col>

            {/* 作業系統分佈 */}
            <Col xs={24} sm={12} md={6} lg={6}>
              <div
                className="stat-card"
                style={{ height: '120px', cursor: 'pointer' }}
                onClick={() => onNavigate('resource-list')}
              >
                <div className="card-content">
                  <div>
                    <div className="card-title" style={{ fontSize: '14px' }}>作業系統分佈</div>
                    <div className="card-value" style={{ color: 'var(--text-primary)', fontSize: '32px', fontWeight: '600' }}>
                      350 <span style={{ fontSize: '16px', color: 'var(--text-tertiary)', fontWeight: '400' }}>Linux</span>
                    </div>
                    <div className="card-description">
                      Windows: 24
                    </div>
                  </div>
                  <BuildOutlined className="card-icon" style={{ color: 'var(--brand-info)', fontSize: '24px' }} />
                </div>
              </div>
            </Col>

            {/* 需要關注 */}
            <Col xs={24} sm={12} md={6} lg={6}>
              <div
                className="stat-card"
                style={{ height: '120px', cursor: 'pointer' }}
                onClick={() => onNavigate('resource-list', { attention: true })}
              >
                <div className="card-content">
                  <div>
                    <div className="card-title" style={{ fontSize: '14px' }}>需要關注</div>
                    <div className="card-value" style={{ color: 'var(--brand-warning)', fontSize: '32px', fontWeight: '600' }}>
                      {attentionResources.length} <span style={{ fontSize: '16px', color: 'var(--text-tertiary)', fontWeight: '400' }}>項</span>
                    </div>
                    <div className="card-description">
                      需立即處理
                    </div>
                  </div>
                  <AlertOutlined className="card-icon" style={{ color: 'var(--brand-warning)', fontSize: '24px' }} />
                </div>
              </div>
            </Col>
          </Row>

          {/* Main Content Area: 左側性能瓶頸分析 + 右側行動與風險中心 */}
          <Row gutter={[16, 16]} style={{ height: 'calc(100vh - 48px - 48px - 140px - 32px)' }}>
            {/* 左側區塊：性能瓶頸分析 (Top N 資源使用列表) */}
            <Col span={14} style={{ display: 'flex', flexDirection: 'column' }}>
              <div style={{ height: '490px' }}>
                <TopNResourceList themeMode={themeMode} />
              </div>
            </Col>

            {/* 右側區塊：行動與風險中心 */}
            <Col span={10} style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
              {/* 上方：AI 風險預測 */}
              <Card
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <RobotOutlined style={{ color: '#722ed1' }} />
                    <span style={{ fontSize: '16px', fontWeight: '600' }}>AI 風險預測</span>
                    <Badge count={3} style={{ backgroundColor: '#722ed1' }} />
                  </div>
                }
                style={{
                  height: '238px',
                  display: 'flex',
                  flexDirection: 'column',
                  background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%)',
                  border: '1px solid rgba(255, 255, 255, 0.12)',
                  borderRadius: 'var(--radius-lg)',
                  backdropFilter: 'blur(20px) saturate(180%)',
                  WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                  boxShadow: '0 4px 24px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)',
                  transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                  position: 'relative',
                  overflow: 'hidden'
                }}
                bodyStyle={{ flex: 1, padding: '12px', overflow: 'hidden' }}
              >
                <div style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
                  {/* 風險資源列表 */}
                  <div style={{ flex: 1, overflow: 'auto' }}>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '6px' }}>
                      {/* 高風險 - web-prod-01 */}
                      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '3px 6px', background: 'rgba(255, 77, 79, 0.08)', borderRadius: '4px' }}>
                        <div>
                          <Text strong style={{ color: 'var(--text-primary)' }}>web-prod-01</Text>
                          <br />
                          <Text style={{ fontSize: '11px', color: 'var(--text-tertiary)' }}>CPU 使用率持續上升，預計 2 小時內達 90%</Text>
                        </div>
                        <Tag color="red" size="small">高風險</Tag>
                      </div>

                      {/* 高風險 - api-gateway-01 */}
                      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '3px 6px', background: 'rgba(255, 77, 79, 0.08)', borderRadius: '4px' }}>
                        <div>
                          <Text strong style={{ color: 'var(--text-primary)' }}>api-gateway-01</Text>
                          <br />
                          <Text style={{ fontSize: '11px', color: 'var(--text-tertiary)' }}>響應時間異常波動，錯誤率上升趨勢</Text>
                        </div>
                        <Tag color="red" size="small">高風險</Tag>
                      </div>

                      {/* 中風險 - db-prod-02 */}
                      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '3px 6px', background: 'rgba(250, 173, 20, 0.08)', borderRadius: '4px' }}>
                        <div>
                          <Text strong style={{ color: 'var(--text-primary)' }}>db-prod-02</Text>
                          <br />
                          <Text style={{ fontSize: '11px', color: 'var(--text-tertiary)' }}>磁碟空間剩餘不足 15%，建議清理</Text>
                        </div>
                        <Tag color="orange" size="small">中風險</Tag>
                      </div>
                    </div>
                  </div>
                </div>
              </Card>

              {/* 下方：需關注的資源列表 */}
              <Card
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <AlertOutlined style={{ color: '#faad14' }} />
                    <span style={{ fontSize: '16px', fontWeight: '600' }}>需關注的資源列表</span>
                    <Badge count={attentionResources.length} style={{ backgroundColor: '#faad14' }} />
                  </div>
                }
                style={{
                  height: '238px',
                  display: 'flex',
                  flexDirection: 'column',
                  background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%)',
                  border: '1px solid rgba(255, 255, 255, 0.12)',
                  borderRadius: 'var(--radius-lg)',
                  backdropFilter: 'blur(20px) saturate(180%)',
                  WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                  boxShadow: '0 4px 24px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)',
                  transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                  position: 'relative',
                  overflow: 'hidden'
                }}
                bodyStyle={{ flex: 1, padding: '12px', overflow: 'hidden' }}
              >
                <div style={{ height: '100%', overflow: 'auto' }}>
                  <Table
                    columns={[
                      {
                        title: '狀態',
                        dataIndex: 'status',
                        key: 'status',
                        width: '30%',
                        render: (status) => (
                          <span className={`status-badge status-${status}`}>
                            {status.toUpperCase()}
                          </span>
                        )
                      },
                      {
                        title: '資源名稱',
                        dataIndex: 'name',
                        key: 'name',
                        width: '45%',
                        render: (text, record) => <a onClick={() => handleAttentionClick(text)}>{text}</a>
                      },
                      {
                        title: '告警',
                        dataIndex: 'alarms',
                        key: 'alarms',
                        width: '25%',
                        render: (alarms, record) => {
                          if (!alarms || alarms.length === 0) {
                            return <Text type="secondary">-</Text>;
                          }
                          const highestSeverity = alarms.some(a => a.severity === 'critical') ? 'critical' : 'warning';
                          const color = highestSeverity === 'critical' ? 'red' : 'orange';
                          return (
                            <Tag color={color} onClick={() => onNavigate && onNavigate('incident-list', { resourceFilter: record.name })} style={{ cursor: 'pointer' }}>
                              {alarms.length} 則
                            </Tag>
                          );
                        }
                      }
                    ]}
                    dataSource={attentionResources}
                    pagination={false}
                    size="small"
                    style={{ backgroundColor: 'transparent' }}
                    className="topn-table"
                    scroll={{ y: 'calc(100% - 25px)' }}
                  />
                </div>
              </Card>
            </Col>
          </Row>

        </React.Fragment >
      );
    };

    // 業務儀表板頁面
    const BusinessDashboardPage = ({ themeMode, onNavigate }) => {
      // 業務核心指標
      const businessMetrics = {
        dailyRevenue: 485720,
        dailyTransactions: 24751,
        activeUsers: 8934,
        avgTransactionValue: 196.3,
        conversionRate: 3.2,
        customerSatisfaction: 4.7,
        systemUptime: 99.8,
        avgResponseTime: 145,
        errorRate: 0.02,
        peakConcurrentUsers: 1247
      };

      return (
        <React.Fragment>
          <PageHeader
            title="業務運營儀表板"
            subtitle="即時監控業務核心指標，掌握營運狀態與服務品質"
            icon={<DollarOutlined />}
            actions={[
              <Button key="export" icon={<DownloadOutlined />}>
                匯出報告
              </Button>,
              <Button key="refresh" icon={<ReloadOutlined />}>
                重新整理
              </Button>
            ]}
          />

          {/* 業務核心指標 */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="今日營收"
                  value={`¥${(businessMetrics.dailyRevenue / 1000).toFixed(0)}K`}
                  trend="+15.2%"
                  status="success"
                  description="較昨日同期"
                  icon={<DollarOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="交易總量"
                  value={businessMetrics.dailyTransactions.toLocaleString()}
                  unit="筆"
                  trend="+12.3%"
                  status="success"
                  description="今日成功交易"
                  icon={<FileDoneOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="活躍用戶"
                  value={businessMetrics.activeUsers.toLocaleString()}
                  unit="人"
                  trend="+8.7%"
                  status="success"
                  description="過去 24 小時"
                  icon={<TeamOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="轉換率"
                  value={businessMetrics.conversionRate}
                  unit="%"
                  trend="+0.3%"
                  status="info"
                  description="訪客至付費用戶"
                  icon={<RiseOutlined />}
                />
              </Col>
            </Row>
          </div>

          {/* 服務品質指標 */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="系統可用性"
                  value={businessMetrics.systemUptime}
                  unit="%"
                  status="success"
                  description="過去 30 天平均"
                  icon={<SafetyCertificateOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="平均回應時間"
                  value={businessMetrics.avgResponseTime}
                  unit="ms"
                  status="success"
                  description="API 回應時間"
                  icon={<ClockCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="錯誤率"
                  value={businessMetrics.errorRate}
                  unit="%"
                  status="success"
                  description="過去 24 小時"
                  icon={<ExclamationCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="客戶滿意度"
                  value={businessMetrics.customerSatisfaction}
                  unit="/5.0"
                  status="success"
                  description="本月平均評分"
                  icon={<CheckCircleOutlined />}
                />
              </Col>
            </Row>
          </div>

          {/* 業務趨勢與洞察 */}
          <Row gutter={[24, 24]} style={{ marginBottom: 'var(--spacing-xl)' }}>
            {/* 收入趨勢圖 */}
            <Col xs={24} lg={16}>
              <Card
                className="dashboard-card"
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <LineChartOutlined style={{ color: '#1890ff' }} />
                    <span>收入趨勢</span>
                  </div>
                }
                extra={
                  <Select defaultValue="7d" size="small">
                    <Select.Option value="24h">24 小時</Select.Option>
                    <Select.Option value="7d">7 天</Select.Option>
                    <Select.Option value="30d">30 天</Select.Option>
                  </Select>
                }
                bodyStyle={{ padding: '20px' }}
              >
                <div style={{ height: '300px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                  <div style={{ textAlign: 'center', color: 'rgba(255, 255, 255, 0.6)' }}>
                    <LineChartOutlined style={{ fontSize: '48px', marginBottom: '16px' }} />
                    <div>收入趨勢圖表區域</div>
                    <div style={{ fontSize: '14px', marginTop: '8px' }}>
                      過去 7 天平均日收入: ¥{(businessMetrics.dailyRevenue * 0.85 / 1000).toFixed(0)}K
                    </div>
                  </div>
                </div>
              </Card>
            </Col>

            {/* 業務洞察與快速行動 */}
            <Col xs={24} lg={8}>
              <Card
                className="dashboard-card"
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <BulbOutlined style={{ color: '#faad14' }} />
                    <span>業務洞察</span>
                  </div>
                }
                bodyStyle={{ padding: '16px' }}
              >
                <div style={{ marginBottom: '20px' }}>
                  <Alert
                    message="交易量創新高"
                    description="今日交易量較昨日增長 12.3%，建議關注系統負載"
                    type="success"
                    showIcon
                    style={{ marginBottom: '12px' }}
                  />
                  <Alert
                    message="用戶活躍度上升"
                    description="活躍用戶數較上週同期增長 8.7%"
                    type="info"
                    showIcon
                  />
                </div>

                <Space direction="vertical" style={{ width: '100%' }} size="small">
                  <Button block icon={<BarChartOutlined />} onClick={() => onNavigate('analytics')}>
                    查看詳細分析
                  </Button>
                  <Button block icon={<AlertOutlined />} onClick={() => onNavigate('incident-list')}>
                    系統健康檢查
                  </Button>
                  <Button block icon={<SettingOutlined />} onClick={() => onNavigate('automation-center')}>
                    優化自動化流程
                  </Button>
                </Space>
              </Card>
            </Col>
          </Row>
        </React.Fragment>
      );
    };



    const ResourceListPage = React.memo(({ pageParams, themeMode, onNavigate }) => {
      const [viewMode, setViewMode] = useState('list'); // 預設改為 list
      const [isScanModalOpen, setIsScanModalOpen] = useState(false);

      // 掃描網路Modal的處理函數 - 使用 useCallback 優化
      const handleOpenScanModal = useCallback(() => {
        setIsScanModalOpen(true);
      }, []);

      // 測試資源規則的處理函數 - 使用 useCallback 優化
      const handleTestRule = useCallback((record) => {
        message.loading({ content: `正在測試資源 "${record.name}"...`, key: 'test_resource' });
        // Simulate API call
        setTimeout(() => {
          const success = Math.random() > 0.3; // 70% success rate
          if (success) {
            message.success({ content: '測試成功：資源連接正常。', key: 'test_resource' });
          } else {
            message.error({ content: '測試失敗：無法連接資源，請檢查網路設定。', key: 'test_resource' });
          }
        }, 1500);
      }, []);

      // 篩選狀態
      const [filterStatus, setFilterStatus] = useState([]);
      const [filterType, setFilterType] = useState([]);
      const [filterResourceName, setFilterResourceName] = useState('');
      const [isFilterOpen, setIsFilterOpen] = useState(false);

      // 篩選應用函數 - 使用 useCallback 優化
      const applyFilters = useCallback(() => {
        setIsFilterOpen(false);
        // 篩選邏輯會在渲染時應用
      }, []);

      // 重置篩選 - 使用 useCallback 優化
      const resetFilters = useCallback(() => {
        setFilterStatus([]);
        setFilterType([]);
        setFilterResourceName('');
        setIsFilterOpen(false);
      }, []);

      // 篩選組件
      const ResourceFilterPopover = () => (
        <div style={{ width: 300, padding: '16px' }}>
          <div style={{ marginBottom: '16px' }}>
            <div style={{ marginBottom: '8px', fontWeight: 500 }}>狀態</div>
            <Select
              mode="multiple"
              placeholder="選擇狀態"
              value={filterStatus}
              onChange={setFilterStatus}
              style={{ width: '100%' }}
              options={[
                { value: 'healthy', label: 'Healthy' },
                { value: 'warning', label: 'Warning' },
                { value: 'critical', label: 'Critical' }
              ]}
            />
          </div>
          <div style={{ marginBottom: '16px' }}>
            <div style={{ marginBottom: '8px', fontWeight: 500 }}>類型</div>
            <Select
              mode="multiple"
              placeholder="選擇類型"
              value={filterType}
              onChange={setFilterType}
              style={{ width: '100%' }}
              options={[
                { value: 'database', label: 'Database' },
                { value: 'server', label: 'Server' },
                { value: 'gateway', label: 'Gateway' },
                { value: 'cache', label: 'Cache' }
              ]}
            />
          </div>
          <div style={{ marginBottom: '16px' }}>
            <div style={{ marginBottom: '8px', fontWeight: 500 }}>資源名稱</div>
            <Input
              placeholder="輸入資源名稱"
              value={filterResourceName}
              onChange={e => setFilterResourceName(e.target.value)}
            />
          </div>
          <div style={{ display: 'flex', justifyContent: 'space-between', gap: '8px' }}>
            <Button onClick={resetFilters} style={{ flex: 1 }}>重置</Button>
            <Button type="primary" onClick={applyFilters} style={{ flex: 1 }}>應用</Button>
          </div>
        </div>
      );

      const mockGroups = [
        { id: 'g_1', name: 'Production Database' },
        { id: 'g_2', name: 'Production Web Servers' },
        { id: 'g_3', name: 'Staging Environment' },
      ];

      const groups = [
        { key: 'g_1', name: 'Production Database', description: '所有生產環境的資料庫', responsibleTeam: 'team_1', members: ['host_1'] },
        { key: 'g_2', name: 'Production Web Servers', description: '所有生產環境的 Web 伺服器', responsibleTeam: 'team_2', members: ['host_2'] },
        { key: 'g_3', name: 'Staging Environment', description: '測試環境所有資源', responsibleTeam: 'team_3', members: ['host_3', 'host_4'] },
      ];

      const teams = [
        { key: 'team_1', name: '資料庫團隊' },
        { key: 'team_2', name: 'Web 開發團隊' },
        { key: 'team_3', name: '測試團隊' },
      ];
      const generateTrend = () => {
        const baseValue = 55;
        const trendDirection = Math.random() > 0.5 ? 1 : -1;
        const volatility = 25;
        let currentValue = baseValue;
        const trend = [];
        for (let i = 0; i < 12; i++) {
          const trendInfluence = trendDirection * (i / 12) * 15;
          const randomChange = (Math.random() - 0.5) * volatility;
          const periodicChange = Math.sin(i * Math.PI / 6) * 8;
          currentValue = Math.max(8, Math.min(98, baseValue + trendInfluence + randomChange + periodicChange));
          if (i > 0) {
            const prevValue = trend[i - 1];
            currentValue = prevValue * 0.6 + currentValue * 0.4;
          }
          trend.push(Math.round(currentValue));
        }
        return trend;
      };

      const initialData = [
        { key: 'host_1', name: 'prod-mysql-master-us-east-01', type: 'database', status: 'healthy', ip_address: '10.100.10.11', groups: ['g_1'], tags: { environment: 'production', service: 'mysql', priority: 'high', cluster: 'primary', region: 'us-east-1' }, trend: generateTrend(), alarms: [] },
        { key: 'host_2', name: 'prod-web-nginx-us-east-02', type: 'server', status: 'warning', ip_address: '10.100.20.12', groups: ['g_2'], tags: { environment: 'production', service: 'web-server', tier: 'frontend' }, trend: generateTrend(), alarms: [{ severity: 'warning', summary: 'Disk space is over 85%' }] },
        { key: 'host_3', name: 'prod-api-gateway-us-east-01', type: 'gateway', status: 'critical', ip_address: '10.100.30.11', groups: [], tags: { environment: 'production', priority: 'high', version: '2.1.0' }, trend: generateTrend(), alarms: [{ severity: 'critical', summary: 'API latency > 2s' }, { severity: 'warning', summary: '5xx error rate > 5%' }] },
        { key: 'host_4', name: 'prod-redis-cache-us-east-01', type: 'cache', status: 'healthy', ip_address: '10.100.40.11', groups: ['g_1', 'g_2'], tags: { environment: 'production', service: 'redis', cluster: 'cache-cluster' }, trend: generateTrend(), alarms: [] },
        {
          key: 'host_5',
          name: 'prod-k8s-master-us-east-01',
          type: 'server',
          status: 'healthy',
          ip_address: '10.100.50.11',
          groups: ['g_2', 'g_3'],
          tags: {
            environment: 'production', service: 'kubernetes', role: 'control-plane', 'high-availability': 'true', 'cluster-critical': 'true',
            team: 'platform', owner: 'sre-team', 'cost-center': '12345', 'data-center': 'us-east-1a',
            os: 'ubuntu-22.04', 'instance-type': 'm5.xlarge', 'backup-policy': 'daily'
          },
          trend: generateTrend(),
          alarms: []
        }
      ];

      const [resources, setResources] = useLocalStorageState('sre-resources-v3', initialData);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingResource, setEditingResource] = useState(null);
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [highlightedResource, setHighlightedResource] = useState('');
      const [isAddToGroupModalOpen, setIsAddToGroupModalOpen] = useState(false);
      const [selectedGroupId, setSelectedGroupId] = useState(null);
      const [scanIpRange, setScanIpRange] = useState('');
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      const defaultVisibleColumns = {
        status: true,
        name: true,
        ip_address: true,
        tags: true,
        alarms: true,
        action: true,
        location: false,
        team: false,
        type: false,
        cpu_usage: false,
        memory_usage: false,
        usage: false,
        trend: false,
      };
      const [visibleColumns, setVisibleColumns] = useLocalStorageState('sre-resource-columns', defaultVisibleColumns);
      const [isColumnSettingsOpen, setIsColumnSettingsOpen] = useState(false);
      const [tableDensity, setTableDensity] = useState('standard');

      useEffect(() => {
        if (searchText && highlightedResource) {
          const lowerSearch = searchText.toLowerCase();
          const lowerHighlight = highlightedResource.toLowerCase();
          if (!lowerHighlight.includes(lowerSearch) && !lowerSearch.includes(lowerHighlight)) {
            setHighlightedResource('');
          }
        }
      }, [searchText, highlightedResource]);

      const showModal = (resource = null) => {
        setEditingResource(resource);
        form.setFieldsValue(resource || { name: '', ip_address: '', type: 'server', groups: [], tags: {} });
        setIsModalOpen(true);
      };
      const handleCancel = () => { setIsModalOpen(false); setEditingResource(null); form.resetFields(); };
      const onFinish = (values) => {
        const status = editingResource ? editingResource.status : 'healthy';
        if (editingResource) {
          setResources(resources.map(res => res.key === editingResource.key ? { ...res, ...values, status } : res));
          message.success('資源更新成功');
        } else {
          const newResource = { ...values, key: `r_${Date.now()}`, status: 'unknown', trend: generateTrend() };
          setResources([newResource, ...resources]);
          message.success('資源新增成功');
        }
        handleCancel();
      };
      const handleDelete = (key) => {
        confirmDelete('資源', () => {
          setResources(resources.filter(res => res.key !== key));
        });
      };

      const onSelectChange = (newSelectedRowKeys) => {
        setSelectedRowKeys(newSelectedRowKeys);
      };

      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `確定要刪除 ${selectedRowKeys.length} 個資源嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setResources(resources.filter(res => !selectedRowKeys.includes(res.key)));
            setSelectedRowKeys([]);
            message.success('批次刪除成功');
          }
        });
      };

      const handleConfirmAddToGroup = () => {
        if (!selectedGroupId) {
          message.error('請選擇一個資源群組');
          return;
        }

        const updatedResources = resources.map(res => {
          if (selectedRowKeys.includes(res.key)) {
            const currentGroups = res.groups || [];
            const newGroups = [...new Set([...currentGroups, selectedGroupId])];
            return { ...res, groups: newGroups };
          }
          return res;
        });

        setResources(updatedResources);
        message.success(`${selectedRowKeys.length} 個資源已成功加入群組`);
        setIsAddToGroupModalOpen(false);
        setSelectedRowKeys([]);
        setSelectedGroupId(null);
      };

      const allColumns = {
        status: { title: '資源狀態', dataIndex: 'status', width: '8%', sorter: (a, b) => (a.status || '').localeCompare(b.status || ''), render: (status) => <span className={`status-badge status-${status}`}>{status || '未知'}</span> },
        name: { title: '資源名稱', dataIndex: 'name', width: '18%', sorter: (a, b) => a.name.localeCompare(b.name), render: (name) => <div><div style={{ fontWeight: 500, color: 'var(--text-primary)' }}>{name || '-'}</div></div> },
        ip_address: { title: 'IP位址', dataIndex: 'ip_address', width: '14%', sorter: (a, b) => a.ip_address.localeCompare(b.ip_address) },
        location: { title: '位置', dataIndex: 'location', width: '12%', sorter: (a, b) => (a.location || '').localeCompare(b.location || ''), defaultVisible: false, render: (location, record) => <span>{record.name && (record.name.includes('east') ? 'us-east-1' : 'us-west-1')}</span> },
        team: { title: '所屬團隊', key: 'team', width: '12%', defaultVisible: false, render: (_, record) => <span>{record.groups && record.groups.length > 0 ? (groups.find(g => g.key === record.groups[0])?.name || '-') : '-'}</span> },
        type: { title: '資源類型', dataIndex: 'type', width: '10%', defaultVisible: false, sorter: (a, b) => (a.type || '').localeCompare(b.type || ''), render: (type) => <Tag>{type || '-'}</Tag> },
        tags: {
          title: '標籤',
          dataIndex: 'tags',
          key: 'tags',
          width: '25%',
          render: (tags) => {
            const tagEntries = Object.entries(tags || {});
            const displayTags = tagEntries.slice(0, 3);
            const hiddenCount = tagEntries.length - displayTags.length;
            return (
              <Space size={[4, 4]} wrap>
                {displayTags.map(([key, value]) => <Tag key={key}>{`${key}:${value}`}</Tag>)}
                {hiddenCount > 0 && <Tag>+{hiddenCount} more</Tag>}
              </Space>
            );
          }
        },
        alarms: {
          title: '即時告警',
          dataIndex: 'alarms',
          width: '10%',
          render: (alarms, record) => {
            if (!alarms || alarms.length === 0) return <Text type="secondary">-</Text>;
            const criticalCount = alarms.filter(a => a.severity === 'critical').length;
            const warningCount = alarms.filter(a => a.severity === 'warning').length;
            const highestSeverity = criticalCount > 0 ? 'critical' : 'warning';
            const icon = highestSeverity === 'critical' ? <FireOutlined style={{ color: 'var(--brand-danger)' }} /> : <WarningOutlined style={{ color: 'var(--brand-warning)' }} />;
            return (
              <Popover content={<List size="small" dataSource={alarms} renderItem={item => <List.Item>{item.summary}</List.Item>} />} title="活躍告警" trigger="hover">
                <Tag icon={icon} color={highestSeverity === 'critical' ? 'red' : 'orange'} style={{ cursor: 'pointer' }} onClick={() => onNavigate('incident-list', { resourceFilter: record.name })}>
                  {alarms.length}
                </Tag>
              </Popover>
            );
          }
        },
        cpu_usage: { title: 'CPU', dataIndex: 'cpu_usage', width: '12%', defaultVisible: false, render: (val) => <InlineProgressCell value={val || Math.floor(Math.random() * 100)} /> },
        memory_usage: { title: 'Memory', dataIndex: 'memory_usage', width: '12%', defaultVisible: false, render: (val) => <InlineProgressCell value={val || Math.floor(Math.random() * 100)} /> },
        action: { title: '操作', key: 'action', width: '10%', align: 'center', render: (_, record) => <TableRowActions onEdit={() => showModal(record)} onDelete={() => handleDelete(record.key)} onView={() => onNavigate('resource-details', { resourceId: record.key })} /> }
      };

      const columns = Object.keys(allColumns).filter(key => visibleColumns[key]).map(key => allColumns[key]);
      let filteredResources = resources.filter(res => res.name.toLowerCase().includes(searchText.toLowerCase()) || res.ip_address.toLowerCase().includes(searchText.toLowerCase()));

      return (
        <React.Fragment>
          <div className="toolbar-actions">
            <div className="toolbar-group">
              <Input.Search placeholder="搜尋資源名稱、IP 或標籤..." value={searchText} onChange={e => setSearchText(e.target.value)} style={{ width: 300 }} allowClear />
              <Popover content={<ResourceFilterPopover />} title="篩選條件" trigger="click" open={isFilterOpen} onOpenChange={setIsFilterOpen} placement="bottomLeft">
                <Button className="toolbar-btn" icon={<FilterOutlined />}>篩選<Badge count={filterStatus.length + filterType.length + (filterResourceName ? 1 : 0)} style={{ marginLeft: 8 }} /></Button>
              </Popover>
            </div>
            <div className="toolbar-group">
              <TableDensitySwitcher
                density={tableDensity}
                onChange={setTableDensity}
              />
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>匯出</Button>
              <Popover content={<div>...</div>} title="欄位顯示設定" trigger="click" open={isColumnSettingsOpen} onOpenChange={setIsColumnSettingsOpen} placement="bottomRight">
                <Button className="toolbar-btn" icon={<EyeOutlined />}>欄位設定</Button>
              </Popover>
              <Button className="toolbar-btn" icon={<SearchOutlined />} onClick={handleOpenScanModal}>掃描網路</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>新增資源</Button>
            </div>
          </div>

          <div className={`table-wrapper table-density-${tableDensity}`}>
            <Table rowSelection={rowSelection} columns={columns} dataSource={filteredResources} rowKey="key" className="transparent-bg" rowClassName={(record) => record.name === highlightedResource ? 'highlighted-row' : ''} size="small" />
          </div>

          <BatchActionToolbar selectedCount={selectedRowKeys.length} onClear={() => setSelectedRowKeys([])} actions={[{ icon: <TeamOutlined />, text: '加入群組', onClick: () => setIsAddToGroupModalOpen(true) }, { icon: <DeleteOutlined />, text: '批次刪除', variant: 'danger', onClick: handleBatchDelete }]} />

          <PlatformModal title={editingResource ? '編輯資源' : '新增資源'} visible={isModalOpen} onClose={handleCancel} footer={<ModalActions onCancel={handleCancel} onConfirm={() => form.submit()} confirmText={editingResource ? '更新' : '新增'} />}>
            <Form form={form} layout="vertical" onFinish={onFinish} style={{ marginTop: 24 }}>
              <SettingsSection title="基本資訊">
                <SettingsFormRow label="資源名稱" required><Form.Item name="name" noStyle rules={[{ required: true }]}><Input /></Form.Item></SettingsFormRow>
                <SettingsFormRow label="IP 位址" required><Form.Item name="ip_address" noStyle rules={[{ required: true }]}><Input /></Form.Item></SettingsFormRow>
                <SettingsFormRow label="類型" required><Form.Item name="type" noStyle rules={[{ required: true }]}><Select><Select.Option value="server">Server</Select.Option><Select.Option value="database">Database</Select.Option></Select></Form.Item></SettingsFormRow>
              </SettingsSection>
              <SettingsSection title="組織與標籤">
                <SettingsFormRow label="所屬群組"><Form.Item name="groups" noStyle><Select mode="multiple" options={mockGroups.map(g => ({ label: g.name, value: g.id }))} /></Form.Item></SettingsFormRow>
                <SettingsFormRow label="標籤"><Form.Item name="tags" noStyle><SmartTagInput /></Form.Item></SettingsFormRow>
              </SettingsSection>
            </Form>
          </PlatformModal>

          <PlatformModal
            title="批次加入群組"
            open={isAddToGroupModalOpen}
            onCancel={() => setIsAddToGroupModalOpen(false)}
            onOk={handleConfirmAddToGroup}
            okText="確認加入"
            cancelText="取消"
            size="small"
            icon={<TeamOutlined />}
          >
            <p>請選擇要將 {selectedRowKeys.length} 個資源加入的目標群組：</p>
            <Select
              placeholder="選擇資源群組"
              style={{ width: '100%' }}
              onChange={(value) => setSelectedGroupId(value)}
              allowClear
              options={mockGroups.map(group => ({ label: group.name, value: group.id }))}
            />
          </PlatformModal>
          <PlatformModal
            title="掃描網段以探索新資源"
            open={isScanModalOpen}
            onCancel={() => setIsScanModalOpen(false)}
            onOk={() => { message.info('開始掃描...'); setIsScanModalOpen(false); }}
            okText="開始掃描"
            cancelText="取消"
            size="small"
            icon={<SearchOutlined />}
          >
            <p>請輸入要掃描的 IP 網段（例如：192.168.1.0/24）。</p>
            <Input
              placeholder="192.168.1.0/24"
              value={scanIpRange}
              onChange={e => setScanIpRange(e.target.value)}
            />
          </PlatformModal>
        </React.Fragment>
      );
    }, (prevProps, nextProps) => {
      return prevProps.pageParams?.statusFilter === nextProps.pageParams?.statusFilter && prevProps.pageParams?.groupFilter === nextProps.pageParams?.groupFilter && prevProps.themeMode === nextProps.themeMode && prevProps.onNavigate === nextProps.onNavigate;
    });

    const ResourceGroupsPage = () => {
      // === 🚀 真實化的企業級資源數據 ===
      const allResourcesData = [
        // 生產資料庫集群
        {
          key: 'host_1',
          name: 'mysql-prod-master-01',
          type: 'database',
          status: 'healthy',
          ip_address: '10.100.10.11',
          tags: ['production', 'database', 'mysql', 'master', 'high-priority'],
          team: 'Database Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'db.r5.xlarge',
          cpu_usage: 68,
          memory_usage: 72,
          disk_usage: 58,
          created_at: dayjs().subtract(180, 'day'),
          last_check: dayjs().subtract(2, 'minute')
        },
        {
          key: 'host_2',
          name: 'mysql-prod-slave-01',
          type: 'database',
          status: 'healthy',
          ip_address: '10.100.10.12',
          tags: ['production', 'database', 'mysql', 'slave', 'high-priority'],
          team: 'Database Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'db.r5.xlarge',
          cpu_usage: 45,
          memory_usage: 52,
          disk_usage: 58,
          created_at: dayjs().subtract(180, 'day'),
          last_check: dayjs().subtract(3, 'minute')
        },
        // 生產Web服務器集群
        {
          key: 'host_3',
          name: 'web-prod-frontend-01',
          type: 'server',
          status: 'warning',
          ip_address: '10.100.20.11',
          tags: ['production', 'web', 'frontend', 'nginx', 'high-priority'],
          team: 'Frontend Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'c5.2xlarge',
          cpu_usage: 82,
          memory_usage: 78,
          disk_usage: 34,
          created_at: dayjs().subtract(90, 'day'),
          last_check: dayjs().subtract(1, 'minute')
        },
        {
          key: 'host_4',
          name: 'web-prod-backend-01',
          type: 'server',
          status: 'healthy',
          ip_address: '10.100.20.21',
          tags: ['production', 'web', 'backend', 'nodejs', 'high-priority'],
          team: 'Backend Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'c5.2xlarge',
          cpu_usage: 65,
          memory_usage: 71,
          disk_usage: 42,
          created_at: dayjs().subtract(75, 'day'),
          last_check: dayjs().subtract(1, 'minute')
        },
        // API 閘道和負載平衡
        {
          key: 'host_5',
          name: 'api-gateway-prod-01',
          type: 'gateway',
          status: 'critical',
          ip_address: '10.100.30.11',
          tags: ['production', 'api', 'gateway', 'kong', 'critical'],
          team: 'Platform Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'c5.xlarge',
          cpu_usage: 91,
          memory_usage: 86,
          disk_usage: 67,
          created_at: dayjs().subtract(120, 'day'),
          last_check: dayjs().subtract(30, 'second')
        },
        {
          key: 'host_6',
          name: 'load-balancer-prod-01',
          type: 'load_balancer',
          status: 'healthy',
          ip_address: '10.100.30.21',
          tags: ['production', 'load-balancer', 'nginx', 'high-priority'],
          team: 'Network Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'c5.large',
          cpu_usage: 23,
          memory_usage: 31,
          disk_usage: 15,
          created_at: dayjs().subtract(200, 'day'),
          last_check: dayjs().subtract(45, 'second')
        },
        // 快取服務
        {
          key: 'host_7',
          name: 'redis-prod-cluster-01',
          type: 'cache',
          status: 'healthy',
          ip_address: '10.100.40.11',
          tags: ['production', 'cache', 'redis', 'cluster', 'high-priority'],
          team: 'Backend Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'cache.r6g.large',
          cpu_usage: 55,
          memory_usage: 78,
          disk_usage: 25,
          created_at: dayjs().subtract(150, 'day'),
          last_check: dayjs().subtract(1, 'minute')
        },
        // 監控系統
        {
          key: 'host_8',
          name: 'prometheus-prod-01',
          type: 'monitoring',
          status: 'healthy',
          ip_address: '10.100.50.11',
          tags: ['production', 'monitoring', 'prometheus', 'observability'],
          team: 'SRE Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'm5.xlarge',
          cpu_usage: 72,
          memory_usage: 84,
          disk_usage: 76,
          created_at: dayjs().subtract(240, 'day'),
          last_check: dayjs().subtract(1, 'minute')
        },
        {
          key: 'host_9',
          name: 'grafana-prod-01',
          type: 'monitoring',
          status: 'healthy',
          ip_address: '10.100.50.21',
          tags: ['production', 'monitoring', 'grafana', 'visualization'],
          team: 'SRE Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'm5.large',
          cpu_usage: 38,
          memory_usage: 45,
          disk_usage: 32,
          created_at: dayjs().subtract(220, 'day'),
          last_check: dayjs().subtract(2, 'minute')
        },
        // 測試環境
        {
          key: 'host_10',
          name: 'web-staging-frontend-01',
          type: 'server',
          status: 'healthy',
          ip_address: '10.200.20.11',
          tags: ['staging', 'web', 'frontend', 'nginx', 'testing'],
          team: 'QA Team',
          environment: 'staging',
          region: 'us-east-1',
          instance_type: 't3.medium',
          cpu_usage: 25,
          memory_usage: 42,
          disk_usage: 28,
          created_at: dayjs().subtract(60, 'day'),
          last_check: dayjs().subtract(5, 'minute')
        },
        {
          key: 'host_11',
          name: 'mysql-staging-01',
          type: 'database',
          status: 'healthy',
          ip_address: '10.200.10.11',
          tags: ['staging', 'database', 'mysql', 'testing'],
          team: 'QA Team',
          environment: 'staging',
          region: 'us-east-1',
          instance_type: 'db.t3.medium',
          cpu_usage: 18,
          memory_usage: 35,
          disk_usage: 22,
          created_at: dayjs().subtract(60, 'day'),
          last_check: dayjs().subtract(4, 'minute')
        },
        // 開發和CI/CD工具
        {
          key: 'host_12',
          name: 'jenkins-cicd-01',
          type: 'ci_cd',
          status: 'healthy',
          ip_address: '10.300.10.11',
          tags: ['development', 'ci-cd', 'jenkins', 'automation'],
          team: 'DevOps Team',
          environment: 'development',
          region: 'us-east-1',
          instance_type: 'm5.large',
          cpu_usage: 42,
          memory_usage: 58,
          disk_usage: 67,
          created_at: dayjs().subtract(300, 'day'),
          last_check: dayjs().subtract(3, 'minute')
        },
        {
          key: 'host_13',
          name: 'gitlab-dev-01',
          type: 'development',
          status: 'healthy',
          ip_address: '10.300.10.21',
          tags: ['development', 'git', 'gitlab', 'source-control'],
          team: 'Development Team',
          environment: 'development',
          region: 'us-east-1',
          instance_type: 'm5.large',
          cpu_usage: 35,
          memory_usage: 48,
          disk_usage: 85,
          created_at: dayjs().subtract(350, 'day'),
          last_check: dayjs().subtract(6, 'minute')
        },
        // 網路基礎設施
        {
          key: 'host_14',
          name: 'core-switch-dc1-01',
          type: 'network',
          status: 'healthy',
          ip_address: '192.168.1.10',
          tags: ['infrastructure', 'network', 'switch', 'core'],
          team: 'Network Team',
          environment: 'infrastructure',
          region: 'us-east-1',
          instance_type: 'physical',
          cpu_usage: 8,
          memory_usage: 12,
          disk_usage: 5,
          created_at: dayjs().subtract(800, 'day'),
          last_check: dayjs().subtract(10, 'minute')
        },
        // 安全相關
        {
          key: 'host_15',
          name: 'waf-prod-01',
          type: 'security',
          status: 'healthy',
          ip_address: '10.100.60.11',
          tags: ['production', 'security', 'waf', 'protection'],
          team: 'Security Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'c5.large',
          cpu_usage: 28,
          memory_usage: 35,
          disk_usage: 22,
          created_at: dayjs().subtract(180, 'day'),
          last_check: dayjs().subtract(2, 'minute')
        }
      ];

      const initialGroups = [
        { key: 'g_1', name: 'Production Database', description: '所有生產環境的資料庫', members: ['host_1'], responsibleTeam: 'team_6' },
        { key: 'g_2', name: 'Production Web Servers', description: '所有生產環境的 Web 伺服器', members: ['host_2'], responsibleTeam: 'team_5' },
        { key: 'g_3', name: 'Staging Environment', description: '測試環境所有資源', members: ['host_5', 'host_6'], responsibleTeam: 'team_1' },
        { key: 'g_4', name: 'Network Infrastructure', description: '網路基礎設施資源', members: ['host_3', 'host_7'], responsibleTeam: 'team_7' },
        { key: 'g_5', name: 'Monitoring Systems', description: '監控系統與告警資源', members: ['host_4', 'host_8', 'host_9'], responsibleTeam: 'team_9' },
        { key: 'g_6', name: 'Security Resources', description: '安全相關的資源與工具', members: [], responsibleTeam: 'team_8' },
        { key: 'g_7', name: 'Development Tools', description: '開發環境與工具資源', members: ['host_10', 'host_11'], responsibleTeam: 'team_10' },
      ];

      const initialTeams = [
        { key: 'team_1', name: 'Developers', description: '負責開發與維護的核心團隊', members: ['user_2', 'user_4'], subscribers: ['user_1', 'slack_devops'], createdAt: dayjs().subtract(60, 'day'), owner: 'user_2' },
        { key: 'team_2', name: 'Viewers', description: '僅有檢視權限的觀察員', members: ['user_3'], subscribers: ['user_2'], createdAt: dayjs().subtract(45, 'day'), owner: 'user_1' },
        { key: 'team_3', name: 'Administrators', description: '平台最高權限管理者', members: ['user_1', 'user_4'], subscribers: ['user_1', 'slack_network', 'email_security', 'oncall_security'], createdAt: dayjs().subtract(90, 'day'), owner: 'user_1' },
        { key: 'team_4', name: 'QA Team', description: '品質保證與測試團隊', members: [], subscribers: ['user_3', 'email_ops'], createdAt: dayjs().subtract(20, 'day'), owner: 'user_1' },
        { key: 'team_5', name: 'DevOps Team', description: '負責CI/CD和基礎設施自動化的團隊', members: ['user_2', 'user_4'], subscribers: ['user_1', 'slack_devops'], createdAt: dayjs().subtract(30, 'day'), owner: 'user_2' },
        { key: 'team_6', name: 'Database Team', description: '負責資料庫管理與優化的團隊', members: ['user_1'], subscribers: ['user_1', 'slack_database'], createdAt: dayjs().subtract(40, 'day'), owner: 'user_1' },
        { key: 'team_7', name: 'Network Team', description: '負責網路基礎設施與安全的團隊', members: ['user_3'], subscribers: ['user_3', 'slack_network'], createdAt: dayjs().subtract(50, 'day'), owner: 'user_3' },
        { key: 'team_8', name: 'Security Team', description: '負責資訊安全與合規的團隊', members: ['user_4'], subscribers: ['user_4', 'email_security', 'oncall_security'], createdAt: dayjs().subtract(35, 'day'), owner: 'user_4' },
        { key: 'team_9', name: 'Operations Team', description: '負責系統運營與監控的團隊', members: ['user_1', 'user_2', 'user_3'], subscribers: ['user_1', 'slack_operations'], createdAt: dayjs().subtract(25, 'day'), owner: 'user_1' },
        { key: 'team_10', name: 'Platform Team', description: '負責平台架構與技術基礎設施的團隊', members: ['user_2', 'user_4'], subscribers: ['user_1', 'slack_platform'], createdAt: dayjs().subtract(15, 'day'), owner: 'user_2' },
      ];

      const [groups, setGroups] = useLocalStorageState('sre-groups', initialGroups);
      const [teams] = useLocalStorageState('sre-teams', initialTeams);
      const [allResources] = useState(allResourcesData.map(r => ({ ...r, title: r.name })));
      const [isGroupModalOpen, setIsGroupModalOpen] = useState(false);
      const [editingGroup, setEditingGroup] = useState(null);
      const [targetKeys, setTargetKeys] = useState([]);
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [groupForm] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // Column settings state
      const defaultVisibleColumns = {
        name: true,
        description: true,
        responsibleTeam: true,
        members: true,
        status: true,
        action: true
      };
      const [visibleColumns, setVisibleColumns] = useLocalStorageState('sre-resource-group-columns', defaultVisibleColumns);
      const [isColumnSettingsOpen, setIsColumnSettingsOpen] = useState(false);

      const getStatusSummary = (memberKeys) => {
        const summary = { healthy: 0, warning: 0, critical: 0 };
        memberKeys.forEach(key => {
          const resource = allResources.find(r => r.key === key);
          if (resource) {
            summary[resource.status]++;
          }
        });
        return summary;
      };

      const showGroupModal = (group = null) => {
        setEditingGroup(group);
        groupForm.setFieldsValue(group || { name: '', description: '', responsibleTeam: '' });
        setTargetKeys(group ? (group.members || []) : []);
        setIsGroupModalOpen(true);
      };
      const handleGroupCancel = () => {
        setIsGroupModalOpen(false);
        setEditingGroup(null);
        setTargetKeys([]);
        groupForm.resetFields();
      };
      const handleGroupFinish = (values) => {
        if (editingGroup) {
          setGroups(groups.map(g => g.key === editingGroup.key ? { ...g, ...values, members: targetKeys } : g));
          message.success('群組更新成功');
        } else {
          const newGroup = { ...values, key: `g_${Date.now()}`, members: targetKeys };
          setGroups([newGroup, ...groups]);
          message.success('群組新增成功');
        }
        handleGroupCancel();
      };
      const handleGroupDelete = (key) => {
        confirmDelete('群組', () => {
          setGroups(groups.filter(g => g.key !== key));
        });
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `確定要刪除 ${selectedRowKeys.length} 個群組嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setGroups(groups.filter(g => !selectedRowKeys.includes(g.key)));
            setSelectedRowKeys([]);
            message.success('批次刪除成功');
          }
        });
      };

      const handleViewHistory = (record) => {
        message.info(`查看群組「${record.name}」的操作歷史`);
        // 這裡可以跳轉到相關的歷史記錄頁面
      };


      const getTeamName = (teamKey) => {
        if (!teamKey) return '-';
        const team = teams.find(t => t.key === teamKey);
        return team ? team.name : teamKey;
      };

      // Define all possible columns
      const allColumns = {
        name: {
          title: '群組名稱',
          dataIndex: 'name',
          width: '20%',
          sorter: (a, b) => a.name.localeCompare(b.name)
        },
        description: {
          title: '描述',
          dataIndex: 'description',
          width: '20%'
        },
        responsibleTeam: {
          title: '負責團隊',
          dataIndex: 'responsibleTeam',
          width: '15%',
          render: responsibleTeam => getTeamName(responsibleTeam)
        },
        members: {
          title: '成員數量',
          dataIndex: 'members',
          width: '10%',
          render: members => members.length
        },
        status: {
          title: '狀態',
          dataIndex: 'members',
          width: '25%',
          render: members => {
            const summary = getStatusSummary(members);
            return (
              <span>
                <Tag color="green">Healthy: {summary.healthy}</Tag>
                <Tag color="orange">Warning: {summary.warning}</Tag>
                <Tag color="red">Critical: {summary.critical}</Tag>
              </span>
            );
          }
        },
        action: {
          title: '操作',
          key: 'action',
          width: '15%',
          render: (_, record) => (
            <Space size="small">
              <Tooltip title="編輯" placement="top">
                <Button type="text" icon={<EditOutlined />} onClick={() => showGroupModal(record)} />
              </Tooltip>
              <Tooltip title="刪除" placement="top">
                <Button type="text" icon={<DeleteOutlined />} danger onClick={() => handleGroupDelete(record.key)} />
              </Tooltip>
            </Space>
          )
        }
      };

      // Generate dynamic columns based on visible settings
      const columns = Object.keys(allColumns)
        .filter(key => visibleColumns[key])
        .map(key => allColumns[key]);

      const filteredGroups = groups.filter(g => g.name.toLowerCase().includes(searchText.toLowerCase()));

      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      return (
        <React.Fragment>

          {/* 工具列 */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="搜尋群組名稱或描述..."
                onChange={e => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                篩選
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>匯出</Button>
              <Popover
                content={
                  <div style={{ width: '200px' }}>
                    <div style={{ marginBottom: '12px', fontWeight: 600, color: 'rgba(255, 255, 255, 0.9)' }}>
                      欄位顯示設定
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                      {Object.keys(allColumns).map(key => (
                        <div key={key} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                          <Checkbox
                            checked={visibleColumns[key]}
                            onChange={(e) => setVisibleColumns(prev => ({ ...prev, [key]: e.target.checked }))}
                            style={{ marginRight: '8px' }}
                          />
                          <span style={{ color: 'rgba(255, 255, 255, 0.8)', fontSize: '13px' }}>
                            {allColumns[key].title}
                          </span>
                        </div>
                      ))}
                    </div>
                  </div>
                }
                title={null}
                trigger="click"
                open={isColumnSettingsOpen}
                onOpenChange={setIsColumnSettingsOpen}
                placement="bottomRight"
                overlayStyle={{
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  backdropFilter: 'blur(8px)',
                  border: '1px solid rgba(255, 255, 255, 0.1)'
                }}
              >
                <Button className="toolbar-btn" icon={<EyeOutlined />}>
                  欄位設定
                </Button>
              </Popover>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showGroupModal()}>
                新增群組
              </Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            {
              filteredGroups.length > 0 ?
                <Table rowSelection={rowSelection} columns={columns} dataSource={filteredGroups} rowKey="key" className="transparent-bg" size="small" /> :
                <Empty description="尚無任何資源群組">
                  <Button type="primary" icon={<PlusOutlined />} onClick={() => showGroupModal()}>立即新增群組</Button>
                </Empty>
            }
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>已選擇 <span className="batch-count">{selectedRowKeys.length}</span> 項</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>批次刪除</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          <Modal title={editingGroup ? '編輯群組' : '新增群組'} open={isGroupModalOpen} onCancel={handleGroupCancel} footer={null} width={900}>
            <Form form={groupForm} layout="vertical" onFinish={handleGroupFinish} style={{ marginTop: 24 }}>
              <Form.Item name="name" label="群組名稱" rules={[{ required: true, message: '請輸入群組名稱' }]}>
                <Input />
              </Form.Item>
              <Form.Item name="description" label="描述">
                <TextArea rows={3} />
              </Form.Item>
              <Form.Item name="responsibleTeam" label="負責團隊">
                <Select placeholder="請選擇負責團隊" allowClear>
                  {teams.map(team => (
                    <Select.Option key={team.key} value={team.key}>
                      {team.name}
                    </Select.Option>
                  ))}
                </Select>
              </Form.Item>
              <Form.Item label="群組資源">
                <Transfer
                  dataSource={allResources.map(resource => ({
                    key: resource.key,
                    title: `${resource.name} (${resource.type})`,
                    description: resource.ip_address,
                    status: resource.status,
                    name: resource.name,
                    type: resource.type,
                    ip_address: resource.ip_address
                  }))}
                  showSearch
                  filterOption={(inputValue, item) =>
                    item.name.toLowerCase().includes(inputValue.toLowerCase()) ||
                    item.type.toLowerCase().includes(inputValue.toLowerCase()) ||
                    item.ip_address.includes(inputValue)
                  }
                  targetKeys={targetKeys}
                  onChange={(targetKeys) => {
                    setTargetKeys(targetKeys);
                  }}
                  render={item => {
                    const resource = allResources.find(r => r.key === item.key);
                    return (
                      <div style={{ padding: '4px 0', display: 'flex', alignItems: 'center', gap: '8px' }}>
                        <div style={{ fontWeight: '500', color: 'rgba(255, 255, 255, 0.9)', flex: 1 }}>
                          {item.name}
                        </div>
                        <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)', flexShrink: 0 }}>
                          {item.type} • {item.ip_address}
                        </div>
                        <Tag size="small" color={
                          resource?.status === 'healthy' ? 'green' :
                            resource?.status === 'warning' ? 'orange' : 'red'
                        } style={{ flexShrink: 0 }}>
                          {resource?.status === 'healthy' ? '健康' :
                            resource?.status === 'warning' ? '警告' : '嚴重'}
                        </Tag>
                      </div>
                    );
                  }}
                  listStyle={{
                    width: 420,
                    height: 300,
                  }}
                  locale={{
                    itemUnit: '個資源',
                    itemsUnit: '個資源',
                    searchPlaceholder: '搜尋資源名稱、類型或IP'
                  }}
                  titles={['可用資源', '群組成員']}
                />
              </Form.Item>
              <div className="modal-footer">
                <div></div>
                <div>
                  <Button onClick={handleGroupCancel}>取消</Button>
                  <Button type="primary" htmlType="submit">{editingGroup ? '更新群組' : '建立群組'}</Button>
                </div>
              </div>
            </Form>
          </Modal>

        </React.Fragment >
      );
    };

    // 資源總覽 Tab - 高層次的儀表板視圖
    const ResourceOverviewTab = ({ themeMode, onNavigate }) => {
      // 資源統計資料 - 與首頁 systemKPIs 保持一致
      const resourceStats = {
        totalServers: 47,
        databases: 12,
        containers: 156,
        services: 23,
        healthyResources: 326,  // 與首頁一致
        warningResources: 35,   // 與首頁一致
        criticalResources: 13,  // 與首頁一致
        totalResources: 374     // 與首頁一致
      };

      return (
        <div style={{ marginTop: 'var(--spacing-lg)' }}>
          {/* 資源總覽主要內容 */}
          <Row gutter={[24, 24]} style={{ alignItems: 'stretch' }}>
            {/* Top N 資源使用率列表 */}
            <Col xs={24} lg={16} style={{ display: 'flex' }}>
              <Card
                className="dashboard-card"
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <UnorderedListOutlined style={{ color: '#1890ff' }} />
                    <span>資源列表總覽</span>
                    <Tag color="blue">{resourceStats.totalResources} 個資源</Tag>
                  </div>
                }
                extra={
                  <div style={{ display: 'flex', gap: '8px' }}>
                    <Button
                      size="small"
                      icon={<SearchOutlined />}
                      onClick={() => onNavigate('resource-list')}
                    >
                      詳細搜尋
                    </Button>
                  </div>
                }
                bodyStyle={{ padding: '12px' }}
                style={{ width: '100%', height: '452px', display: 'flex', flexDirection: 'column' }}
              >
                <div style={{ height: '100%', overflowY: 'auto', flex: 1, paddingRight: '4px', paddingBottom: '8px' }}>
                  {[
                    { name: 'web-prod-1', usage: 95, trend: 'up', status: 'critical' },
                    { name: 'web-prod-2', usage: 93, trend: 'up', status: 'critical' },
                    { name: 'web-prod-3', usage: 91, trend: 'stable', status: 'critical' },
                    { name: 'web-prod-4', usage: 89, trend: 'down', status: 'warning' },
                    { name: 'web-prod-5', usage: 87, trend: 'down', status: 'warning' },
                    { name: 'db-prod-1', usage: 85, trend: 'stable', status: 'warning' },
                    { name: 'api-gateway-1', usage: 83, trend: 'up', status: 'warning' },
                    { name: 'cache-redis-1', usage: 81, trend: 'down', status: 'warning' }
                  ].map((resource, index) => (
                    <div key={resource.name} style={{
                      display: 'flex',
                      alignItems: 'center',
                      padding: '8px 12px',
                      marginBottom: '4px',
                      backgroundColor: 'rgba(255, 255, 255, 0.02)',
                      borderRadius: '6px',
                      border: '1px solid rgba(255, 255, 255, 0.06)',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: resource.name })}
                    >
                      <div style={{ minWidth: '100px', fontWeight: 500, fontSize: '14px' }}>
                        {resource.name}
                      </div>
                      <div style={{ flex: 1, margin: '0 12px' }}>
                        <InlineProgressCell
                          value={resource.usage}
                          max={100}
                          unit="%"
                          status={resource.status}
                          size="small"
                          animated={true}
                          showTooltip={true}
                          formatValue={(val) => `${val}%`}
                        />
                      </div>
                      <div style={{ minWidth: '50px', textAlign: 'right' }}>
                        {resource.trend === 'up' ? (
                          <ArrowUpOutlined style={{ color: '#ff4d4f' }} />
                        ) : resource.trend === 'down' ? (
                          <ArrowDownOutlined style={{ color: '#52c41a' }} />
                        ) : (
                          <MinusOutlined style={{ color: '#faad14' }} />
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </Card>
            </Col>

            {/* 右側：AI 風險預測 + 需關注資源 */}
            <Col xs={24} lg={8} style={{ display: 'flex' }}>
              <div style={{ display: 'flex', flexDirection: 'column', gap: '16px', height: '452px', width: '100%' }}>
                {/* AI 風險預測 */}
                <Card
                  className="dashboard-card"
                  title={
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <RobotOutlined style={{ color: '#722ed1' }} />
                      <span>AI 風險預測</span>
                      <Badge count={3} style={{ backgroundColor: '#ff4d4f' }} />
                    </div>
                  }
                  bodyStyle={{ padding: '8px', overflow: 'hidden' }}
                  style={{ flex: 1, display: 'flex', flexDirection: 'column' }}
                >
                  <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '4px',
                    height: '100%',
                    overflowY: 'auto',
                    paddingRight: '4px'
                  }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '8px 10px',
                      backgroundColor: 'rgba(255, 77, 79, 0.1)',
                      borderRadius: '4px',
                      border: '1px solid rgba(255, 77, 79, 0.2)',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: 'web-prod-01' })}
                    >
                      <div style={{ flex: 1 }}>
                        <div style={{ fontWeight: 500, marginBottom: '2px', fontSize: '12px' }}>web-prod-01</div>
                        <div style={{ fontSize: '10px', color: 'rgba(255, 255, 255, 0.8)', lineHeight: '1.2' }}>
                          CPU 使用率持續上升，預計 2 小時內達 90%
                        </div>
                      </div>
                      <div>
                        <Tag color="red" size="small" style={{ fontSize: '10px', padding: '0 4px', lineHeight: '16px' }}>高風險</Tag>
                      </div>
                    </div>

                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '8px 10px',
                      backgroundColor: 'rgba(255, 77, 79, 0.1)',
                      borderRadius: '4px',
                      border: '1px solid rgba(255, 77, 79, 0.2)',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: 'api-gateway-01' })}
                    >
                      <div style={{ flex: 1 }}>
                        <div style={{ fontWeight: 500, marginBottom: '2px', fontSize: '12px' }}>api-gateway-01</div>
                        <div style={{ fontSize: '10px', color: 'rgba(255, 255, 255, 0.8)', lineHeight: '1.2' }}>
                          實體記憶體波動，錯誤率上升趨勢
                        </div>
                      </div>
                      <div>
                        <Tag color="red" size="small" style={{ fontSize: '10px', padding: '0 4px', lineHeight: '16px' }}>高風險</Tag>
                      </div>
                    </div>

                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '8px 10px',
                      backgroundColor: 'rgba(250, 173, 20, 0.1)',
                      borderRadius: '4px',
                      border: '1px solid rgba(250, 173, 20, 0.2)',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: 'db-prod-02' })}
                    >
                      <div style={{ flex: 1 }}>
                        <div style={{ fontWeight: 500, marginBottom: '2px', fontSize: '12px' }}>db-prod-02</div>
                        <div style={{ fontSize: '10px', color: 'rgba(255, 255, 255, 0.8)', lineHeight: '1.2' }}>
                          磁碟空間剩餘不足 15%，建議清理
                        </div>
                      </div>
                      <div>
                        <Tag color="orange" size="small" style={{ fontSize: '10px', padding: '0 4px', lineHeight: '16px' }}>中風險</Tag>
                      </div>
                    </div>
                  </div>
                </Card>

                {/* 需關注的資源列表 */}
                <Card
                  className="dashboard-card"
                  title={
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <AlertOutlined style={{ color: '#faad14' }} />
                      <span>需關注的資源列表</span>
                      <Badge count={2} style={{ backgroundColor: '#faad14' }} />
                    </div>
                  }
                  bodyStyle={{ padding: '8px', overflow: 'hidden' }}
                  style={{ flex: 1, display: 'flex', flexDirection: 'column' }}
                >
                  <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '8px',
                    height: '100%',
                    overflowY: 'auto',
                    paddingRight: '4px'
                  }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '8px 12px',
                      backgroundColor: 'rgba(255, 77, 79, 0.08)',
                      borderRadius: '4px',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: 'api-gateway-prod' })}
                    >
                      <div>
                        <div style={{ fontWeight: 500 }}>api-gateway-prod</div>
                        <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                          CRITICAL
                        </div>
                      </div>
                      <div style={{ textAlign: 'right' }}>
                        <div style={{ color: '#ff4d4f', fontWeight: 500 }}>2 則</div>
                      </div>
                    </div>

                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '8px 12px',
                      backgroundColor: 'rgba(250, 173, 20, 0.08)',
                      borderRadius: '4px',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: 'web-prod-02' })}
                    >
                      <div>
                        <div style={{ fontWeight: 500 }}>web-prod-02</div>
                        <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                          WARNING
                        </div>
                      </div>
                      <div style={{ textAlign: 'right' }}>
                        <div style={{ color: '#faad14', fontWeight: 500 }}>1 則</div>
                      </div>
                    </div>
                  </div>
                </Card>
              </div>
            </Col>
          </Row>

        </div>
      );
    };

    // 資源清單 Tab - 詳細的資源列表和管理
    const ResourceListTab = ({ pageParams, themeMode, onNavigate }) => {
      return (
        <div>
          <ResourceListPage pageParams={pageParams} themeMode={themeMode} onNavigate={onNavigate} />
        </div>
      );
    };

    // 資源群組 Tab - 按業務或功能分組的資源管理
    const ResourceGroupsTab = ({ onNavigate }) => {
      return (
        <div style={{ marginTop: 'var(--spacing-lg)' }}>
          <ResourceGroupsPage onNavigate={onNavigate} />
        </div>
      );
    };

    // 資源拓撲 Tab - 資源間的依賴關係視覺化
    const ResourceTopologyTab = ({ onNavigate }) => {
      return (
        <div style={{ marginTop: 'var(--spacing-lg)' }}>
          <Card
            className="dashboard-card"
            title={
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <BranchesOutlined style={{ color: '#1890ff' }} />
                <span>資源拓撲圖</span>
              </div>
            }
            extra={
              <div style={{ display: 'flex', gap: '8px' }}>
                <Button size="small" icon={<CompressOutlined />}>
                  收縮
                </Button>
                <Button size="small" icon={<ExpandOutlined />}>
                  展開
                </Button>
                <Button size="small" icon={<ReloadOutlined />}>
                  重新整理
                </Button>
              </div>
            }
            bodyStyle={{ padding: '20px' }}
          >
            <div style={{
              height: '600px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              backgroundColor: 'rgba(255, 255, 255, 0.02)',
              borderRadius: '8px',
              border: '2px dashed rgba(255, 255, 255, 0.1)'
            }}>
              <div style={{ textAlign: 'center', color: 'rgba(255, 255, 255, 0.6)' }}>
                <BranchesOutlined style={{ fontSize: '64px', marginBottom: '16px' }} />
                <div style={{ fontSize: '18px', marginBottom: '8px' }}>資源拓撲視覺化</div>
                <div style={{ fontSize: '14px' }}>
                  顯示資源間的依賴關係與數據流向
                </div>
                <Button
                  type="primary"
                  icon={<EyeOutlined />}
                  style={{ marginTop: '16px' }}
                  onClick={() => message.info('拓撲圖功能開發中...')}
                >
                  載入拓撲圖
                </Button>
              </div>
            </div>
          </Card>
        </div>
      );
    };

    const ResourcesPage = ({ onNavigate, pageKey, themeMode }) => {
      const tabKey = ['resource-overview', 'resource-groups', 'resource-topology'].includes(pageKey) ? pageKey : 'resource-overview';

      return (
        <React.Fragment>
          <PageHeader
            title="資源管理"
            subtitle="探索、組織與管理您的所有基礎設施資源"
            icon={<HddOutlined />}
          />

          {/* 📊 資源管理儀表板 - 核心指標總覽 */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="總資源數"
                  value={374}
                  unit="個"
                  status="success"
                  description="涵蓋所有業務系統"
                  icon={<HddOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="健康資源"
                  value={326}
                  unit="個"
                  status="success"
                  description="正常運行中"
                  icon={<SafetyCertificateOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="告警資源"
                  value={35}
                  unit="個"
                  status="warning"
                  description="需要關注"
                  icon={<ExclamationCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="資源群組"
                  value={12}
                  unit="組"
                  status="info"
                  description="業務邏輯分組"
                  icon={<ApartmentOutlined />}
                />
              </Col>
            </Row>
          </div>

          <Tabs
            activeKey={tabKey}
            onChange={(key) => onNavigate(key)}
            style={{
              '--tab-bar-margin': '0 0 var(--spacing-lg) 0'
            }}
          >
            <Tabs.TabPane
              tab={
                <span>
                  <BarsOutlined />
                  資源列表
                </span>
              }
              key="resource-overview"
            >
              <IntegratedResourceOverviewPage themeMode={themeMode} onNavigate={onNavigate} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <ApartmentOutlined />
                  資源群組
                </span>
              }
              key="resource-groups"
            >
              <ResourceGroupsDetailPage onNavigate={onNavigate} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <BranchesOutlined />
                  拓撲視圖
                </span>
              }
              key="resource-topology"
            >
              <ResourceTopologyDetailPage onNavigate={onNavigate} />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    // === 📊 告警與資源洞察頁面 ===
    const AlertsInsightsPage = ({ themeMode, onNavigate }) => {
      // 資源統計資料 - 從 ResourceOverviewTab 移動過來
      const resourceStats = {
        totalServers: 47,
        databases: 12,
        containers: 156,
        services: 23,
        healthyResources: 326,
        warningResources: 35,
        criticalResources: 13,
        totalResources: 374
      };

      return (
        <React.Fragment>
          <PageHeader
            title="告警與資源洞察"
            subtitle="即時監控業務核心指標，掌握營運狀態與服務品質"
            icon={<ExclamationCircleOutlined />}
          />

          {/* 資源概覽 KPI */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="伺服器總數"
                  value={resourceStats.totalServers}
                  unit="台"
                  trend="stable"
                  status="success"
                  description="實體與虛擬伺服器"
                  icon={<HddOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="資料庫"
                  value={resourceStats.databases}
                  unit="個"
                  trend="stable"
                  status="info"
                  description="各類型資料庫實例"
                  icon={<DatabaseOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="容器"
                  value={resourceStats.containers}
                  unit="個"
                  trend="up"
                  status="info"
                  description="運行中的容器實例"
                  icon={<DeploymentUnitOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="服務"
                  value={resourceStats.services}
                  unit="個"
                  trend="stable"
                  status="info"
                  description="註冊的微服務"
                  icon={<GlobalOutlined />}
                />
              </Col>
            </Row>
          </div>

          {/* 📊 資源列表總覽 */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <ResourceOverviewTab themeMode={themeMode} onNavigate={onNavigate} />
          </div>
        </React.Fragment>
      );
    };

    // === 🛠️ 資源列表工作區 - 專注於資源管理和操作 ===
    const IntegratedResourceOverviewPage = ({ themeMode, onNavigate }) => {
      return (
        <React.Fragment>


          {/* 📊 資源清單表格 */}
          <ResourceListTab pageParams={{}} themeMode={themeMode} onNavigate={onNavigate} />
        </React.Fragment>
      );
    };

    // === 📁 資源群組詳細頁面 - 業務導向的資源組織管理 ===
    const ResourceGroupsDetailPage = ({ onNavigate }) => {
      return (
        <React.Fragment>
          {/* 功能說明區塊 */}
          <Alert
            message="資源群組管理"
            description="按業務邏輯組織資源，方便團隊協作和權限管理。一個資源可以屬於多個群組，群組可以分配給特定團隊進行管理。"
            type="info"
            showIcon
            style={{ marginBottom: 'var(--spacing-lg)' }}
            action={
              <Space>
                <Button size="small" onClick={() => onNavigate('resource-overview')}>
                  返回總覽
                </Button>
                <Button size="small" type="link" onClick={() => onNavigate('platform-settings')}>
                  管理標籤
                </Button>
              </Space>
            }
          />

          {/* 嵌入原有的資源群組功能 */}
          <ResourceGroupsTab onNavigate={onNavigate} />
        </React.Fragment>
      );
    };

    // === 🔗 資源拓撲詳細頁面 - 依賴關係和影響分析 ===
    const ResourceTopologyDetailPage = ({ onNavigate }) => {
      return (
        <React.Fragment>
          {/* 功能說明區塊 */}
          <Alert
            message="資源拓撲視圖"
            description="視覺化展示資源間的依賴關係，幫助理解系統架構和進行影響分析。支援故障追蹤和變更影響評估。"
            type="info"
            showIcon
            style={{ marginBottom: 'var(--spacing-lg)' }}
            action={
              <Space>
                <Button size="small" onClick={() => onNavigate('resource-overview')}>
                  返回總覽
                </Button>
                <Button size="small" onClick={() => onNavigate('resource-groups')}>
                  查看群組
                </Button>
              </Space>
            }
          />

          {/* 嵌入原有的拓撲功能 */}
          <ResourceTopologyTab onNavigate={onNavigate} />
        </React.Fragment>
      );
    };

    const IncidentsPage = ({ onNavigate, pageKey }) => {
      const tabKey = ['incident-list', 'alerting-rules', 'silences'].includes(pageKey) ? pageKey : 'incident-list';

      // 事件管理詳細統計 - 專注事件處理流程
      const incidentStats = {
        activeIncidents: 5, // 當前活躍事件（新增+處理中）
        criticalIncidents: 2,
        acknowledgedIncidents: 3,
        todayResolved: 12,
        avgResolutionTime: 2.5,
        escalationRate: 8.3, // 升級率百分比
        automatedResolved: 7, // 自動解決的事件數
        onCallEngineers: 4 // 值班工程師數量
      };

      return (
        <React.Fragment>
          <PageHeader
            title="事件管理"
            subtitle="集中管理事件、定義規則並設定靜音，建立完整的事件管理流程"
            icon={<ExclamationCircleOutlined />}
          />

          {/* 🎯 事件處理流程儀表板 - 專注處理效率 */}
          {tabKey === 'incident-list' && (
            <div className="kpi-grid" style={{ marginBottom: 'var(--spacing-xl)' }}>
              <Row gutter={[16, 16]}>
                <Col xs={24} sm={12} md={6} lg={6}>
                  <ContextualKPICard
                    title="活躍事件"
                    value={incidentStats.activeIncidents}
                    unit="件"
                    status={incidentStats.criticalIncidents > 0 ? 'critical' : incidentStats.activeIncidents > 3 ? 'warning' : 'success'}
                    description={`${incidentStats.criticalIncidents} 件嚴重，${incidentStats.acknowledgedIncidents} 件處理中`}
                    icon={<FireOutlined />}
                  />
                </Col>
                <Col xs={24} sm={12} md={6} lg={6}>
                  <ContextualKPICard
                    title="今日已解決"
                    value={incidentStats.todayResolved}
                    unit="件"
                    trend="+8%"
                    status="success"
                    description={`${incidentStats.automatedResolved} 件自動解決`}
                    icon={<CheckCircleOutlined />}
                  />
                </Col>
                <Col xs={24} sm={12} md={6} lg={6}>
                  <ContextualKPICard
                    title="平均解決時間"
                    value={incidentStats.avgResolutionTime}
                    unit="小時"
                    trend="-15%"
                    status="success"
                    description="較上週大幅改善"
                    icon={<ClockCircleOutlined />}
                  />
                </Col>
                <Col xs={24} sm={12} md={6} lg={6}>
                  <ContextualKPICard
                    title="值班工程師"
                    value={incidentStats.onCallEngineers}
                    unit="人"
                    status="success"
                    description={`升級率 ${incidentStats.escalationRate}%`}
                    icon={<TeamOutlined />}
                  />
                </Col>
              </Row>
            </div>
          )}
          <Tabs defaultActiveKey={tabKey} onChange={(key) => onNavigate(key)}>
            <Tabs.TabPane tab="事件列表" key="incident-list">
              <IncidentListPage onNavigate={onNavigate} />
            </Tabs.TabPane>
            <Tabs.TabPane tab="事件規則" key="alerting-rules">
              <AlertingRulesPage />
            </Tabs.TabPane>
            <Tabs.TabPane tab="靜音規則" key="silences">
              <SilencesPage />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    const AnalyzingPage = ({ onNavigate, pageKey, themeMode }) => {
      const tabKey = [
        'capacity-planning',
        'performance-insights',
        'incident-trends',
        'cost-analysis',
        'mttr-analysis',
        'sla-reports'
      ].includes(pageKey) ? pageKey : 'capacity-planning';

      // 分析統計資料
      const analysisStats = {
        totalDataPoints: 15420,
        analysisReports: 28,
        avgProcessingTime: 3.2,
        accuracyRate: 96.8,
        resourceUtilization: 78.5,
        costSavings: 24300
      };

      return (
        <div className="page-container">
          {/* 統一頁面標題 */}
          <div className="page-header-unified">
            <div className="page-title-section">
              <div className="page-title-icon">
                📊
              </div>
              <div>
                <h1 className="page-title-text">分析中心</h1>
                <p className="page-subtitle">深入了解系統趨勢、效能瓶頸和運營數據，做出數據驅動的決策</p>
              </div>
            </div>
            <div className="page-actions">
              <button className="platform-btn platform-btn-ghost platform-btn-sm">
                📥 匯出報告
              </button>
              <button className="platform-btn platform-btn-primary platform-btn-sm">
                🔄 重新整理資料
              </button>
            </div>
          </div>

          {/* 統一 KPI 卡片系統 */}
          <div className="kpi-grid-unified">
            <div className="kpi-card-unified">
              <div className="kpi-header">
                <span className="kpi-label">數據點總數</span>
                <div className="kpi-trend positive">↗ +8.2%</div>
              </div>
              <div className="kpi-value">{analysisStats.totalDataPoints.toLocaleString()}</div>
              <div className="kpi-subtitle">過去 24 小時收集</div>
            </div>

            <div className="kpi-card-unified">
              <div className="kpi-header">
                <span className="kpi-label">分析報告</span>
                <div className="kpi-trend positive">↗ +12.5%</div>
              </div>
              <div className="kpi-value">{analysisStats.analysisReports}</div>
              <div className="kpi-subtitle">本月生成報告</div>
            </div>

            <div className="kpi-card-unified">
              <div className="kpi-header">
                <span className="kpi-label">處理時間</span>
                <div className="kpi-trend positive">↘ -15.3%</div>
              </div>
              <div className="kpi-value">{analysisStats.avgProcessingTime}s</div>
              <div className="kpi-subtitle">平均分析處理時間</div>
            </div>

            <div className="kpi-card-unified">
              <div className="kpi-header">
                <span className="kpi-label">準確率</span>
                <div className="kpi-trend positive">↗ +2.1%</div>
              </div>
              <div className="kpi-value">{analysisStats.accuracyRate}%</div>
              <div className="kpi-subtitle">AI 預測準確率</div>
            </div>
          </div>

          {/* 統一標籤導航 */}
          <div className="tab-navigation">
            <button
              className={`tab-item ${tabKey === 'capacity-planning' ? 'active' : ''}`}
              onClick={() => onNavigate('capacity-planning')}
            >
              📊 容量規劃
            </button>
            <button
              className={`tab-item ${tabKey === 'performance-insights' ? 'active' : ''}`}
              onClick={() => onNavigate('performance-insights')}
            >
              ⚡ 性能洞察
            </button>
            <button
              className={`tab-item ${tabKey === 'incident-trends' ? 'active' : ''}`}
              onClick={() => onNavigate('incident-trends')}
            >
              📈 事件趨勢
            </button>
            <button
              className={`tab-item ${tabKey === 'cost-analysis' ? 'active' : ''}`}
              onClick={() => onNavigate('cost-analysis')}
            >
              💰 成本分析
            </button>
            <button
              className={`tab-item ${tabKey === 'mttr-analysis' ? 'active' : ''}`}
              onClick={() => onNavigate('mttr-analysis')}
            >
              ⏱️ MTTR 分析
            </button>
            <button
              className={`tab-item ${tabKey === 'sla-reports' ? 'active' : ''}`}
              onClick={() => onNavigate('sla-reports')}
            >
              📋 SLA 報告
            </button>
          </div>

          {/* 標籤內容 */}
          <div className="tab-content">
            {tabKey === 'capacity-planning' && (
              <CapacityPlanningPage themeMode={themeMode} />
            )}
            {tabKey === 'performance-insights' && (
              <div className="empty-state">
                <div className="empty-state-icon">⚡</div>
                <h3 className="empty-state-title">性能洞察</h3>
                <p className="empty-state-desc">深入分析系統性能瓶頸，提供智能優化建議。即將推出更多功能。</p>
                <div className="empty-state-action">
                  <button className="platform-btn platform-btn-primary">設定性能監控</button>
                </div>
              </div>
            )}
            {tabKey === 'incident-trends' && (
              <div className="empty-state">
                <div className="empty-state-icon">📈</div>
                <h3 className="empty-state-title">事件趨勢分析</h3>
                <p className="empty-state-desc">分析事件發生模式，識別重複問題和根本原因。幫助預防類似事件。</p>
                <div className="empty-state-action">
                  <button className="platform-btn platform-btn-primary">檢視趨勢報告</button>
                </div>
              </div>
            )}
            {tabKey === 'cost-analysis' && (
              <div className="empty-state">
                <div className="empty-state-icon">💰</div>
                <h3 className="empty-state-title">成本分析</h3>
                <p className="empty-state-desc">追蹤資源使用成本，識別成本節約機會，最佳化運營支出。</p>
                <div className="empty-state-action">
                  <button className="platform-btn platform-btn-primary">檢視成本報告</button>
                </div>
              </div>
            )}
            {tabKey === 'mttr-analysis' && (
              <div className="empty-state">
                <div className="empty-state-icon">⏱️</div>
                <h3 className="empty-state-title">MTTR 分析</h3>
                <p className="empty-state-desc">追蹤平均修復時間，找出效率改善機會，提升系統可靠性。</p>
                <div className="empty-state-action">
                  <button className="platform-btn platform-btn-primary">檢視 MTTR 指標</button>
                </div>
              </div>
            )}
            {tabKey === 'sla-reports' && (
              <div className="empty-state">
                <div className="empty-state-icon">📋</div>
                <h3 className="empty-state-title">SLA 報告</h3>
                <p className="empty-state-desc">追蹤服務等級協議合規性，確保服務品質符合承諾標準。</p>
                <div className="empty-state-action">
                  <button className="platform-btn platform-btn-primary">產生 SLA 報告</button>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    const AutomationCenterPage = ({ onNavigate, pageKey, scripts, setScripts, addExecution, executions, setExecutions }) => {
      const tabKey = ['scripts', 'schedules', 'executions'].includes(pageKey) ? pageKey : 'scripts';

      // 計算自動化 KPI
      const totalScripts = scripts.length;
      const activeScripts = scripts.filter(s => s.status === 'active').length;
      const successfulExecutions = executions.filter(e => e.status === 'success').length;
      const totalExecutions = executions.length;
      const successRate = totalExecutions > 0 ? ((successfulExecutions / totalExecutions) * 100) : 100;
      const recentExecutions = executions.filter(e =>
        dayjs().diff(dayjs(e.executedAt), 'hours') <= 24
      ).length;

      return (
        <React.Fragment>
          <PageHeader
            title="自動化中心"
            subtitle="管理自動化腳本、排程任務與執行歷史，提升運維效率"
            icon={<CodeOutlined />}
          />

          {/* 自動化 KPI 儀表板 */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} md={6} key="total-scripts">
                <ContextualKPICard
                  title="腳本總數"
                  value={totalScripts}
                  unit="個"
                  trend={totalScripts > 20 ? 'up' : 'stable'}
                  status="success"
                  description={`${activeScripts} 個啟用中`}
                  icon={<CodeOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6} key="success-rate">
                <ContextualKPICard
                  title="執行成功率"
                  value={successRate}
                  unit="%"
                  trend={successRate >= 95 ? 'up' : successRate >= 85 ? 'stable' : 'down'}
                  status={successRate >= 95 ? 'success' : successRate >= 85 ? 'warning' : 'critical'}
                  description={`${successfulExecutions}/${totalExecutions} 次執行`}
                  icon={<CheckCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6} key="recent-executions">
                <ContextualKPICard
                  title="24小時執行"
                  value={recentExecutions}
                  unit="次"
                  trend={recentExecutions > 50 ? 'up' : 'stable'}
                  status="info"
                  description="過去一天的執行次數"
                  icon={<ClockCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6} key="scheduled-tasks">
                <ContextualKPICard
                  title="排程任務"
                  value={scripts.filter(s => s.schedule).length}
                  unit="個"
                  trend="stable"
                  status="info"
                  description="已設定排程的腳本"
                  icon={<ScheduleOutlined />}
                />
              </Col>
            </Row>
          </div>

          {/* 複合概要視圖 */}
          <Row gutter={[24, 24]} style={{ marginBottom: 'var(--spacing-xl)' }}>
            {/* 最近執行日誌 */}
            <Col xs={24} lg={16} key="recent-executions-log">
              <Card
                className="dashboard-card"
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <HistoryOutlined style={{ color: '#1890ff' }} />
                    <span>最近執行日誌</span>
                    <Badge count={recentExecutions} style={{ marginLeft: 'auto' }} />
                  </div>
                }
                bodyStyle={{ padding: '12px' }}
                style={{ height: '320px', display: 'flex', flexDirection: 'column' }}
              >
                <div style={{ flex: 1, overflowY: 'auto' }}>
                  {executions.slice(0, 5).map(execution => (
                    <div key={execution.id} style={{
                      display: 'flex',
                      alignItems: 'center',
                      padding: '8px 12px',
                      marginBottom: '8px',
                      backgroundColor: 'rgba(255, 255, 255, 0.02)',
                      borderRadius: '6px',
                      border: '1px solid rgba(255, 255, 255, 0.06)'
                    }}>
                      <div style={{ marginRight: '12px' }}>
                        {execution.status === 'success' ? (
                          <CheckCircleOutlined style={{ color: '#52c41a' }} />
                        ) : execution.status === 'failed' ? (
                          <ExclamationCircleOutlined style={{ color: '#ff4d4f' }} />
                        ) : (
                          <ClockCircleOutlined style={{ color: '#faad14' }} />
                        )}
                      </div>
                      <div style={{ flex: 1 }}>
                        <div style={{ fontWeight: 500, marginBottom: '2px' }}>
                          {scripts.find(s => s.id === execution.scriptId)?.name || `腳本 ${execution.scriptId}`}
                        </div>
                        <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                          {dayjs(execution.executedAt).format('MM-DD HH:mm')} •
                          耗時 {execution.duration}ms
                        </div>
                      </div>
                      <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.8)' }}>
                        {execution.triggeredBy}
                      </div>
                    </div>
                  ))}
                </div>
              </Card>
            </Col>

            {/* 熱門腳本 */}
            <Col xs={24} lg={8} key="popular-scripts">
              <Card
                className="dashboard-card"
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <FireOutlined style={{ color: '#ff7a45' }} />
                    <span>熱門腳本</span>
                  </div>
                }
                bodyStyle={{ padding: '12px' }}
                style={{ height: '320px', display: 'flex', flexDirection: 'column' }}
              >
                <div style={{ flex: 1, overflowY: 'auto' }}>
                  {scripts && scripts.length > 0 ? scripts
                    .filter(s => s.status === 'active')
                    .sort((a, b) => (b.executionCount || 0) - (a.executionCount || 0))
                    .slice(0, 3)
                    .map((script, index) => (
                      <div key={script.key} style={{
                        display: 'flex',
                        alignItems: 'center',
                        padding: '8px',
                        marginBottom: '6px',
                        backgroundColor: 'rgba(255, 255, 255, 0.03)',
                        borderRadius: '6px',
                        border: '1px solid rgba(255, 255, 255, 0.08)',
                        cursor: 'pointer',
                        transition: 'all 0.2s ease'
                      }}
                        onMouseEnter={(e) => {
                          e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.06)';
                          e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.15)';
                        }}
                        onMouseLeave={(e) => {
                          e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.03)';
                          e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.08)';
                        }}>
                        <div style={{
                          width: '24px',
                          height: '24px',
                          backgroundColor: index === 0 ? '#ff7a45' : index === 1 ? '#ffa940' : '#fadb14',
                          borderRadius: '50%',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          fontSize: '12px',
                          fontWeight: 'bold',
                          color: '#fff',
                          marginRight: '12px'
                        }}>
                          {index + 1}
                        </div>
                        <div style={{ marginRight: '12px' }}>
                          <Tag color={script.category === 'monitoring' ? 'blue' :
                            script.category === 'deployment' ? 'green' :
                              script.category === 'maintenance' ? 'orange' :
                                script.category === 'performance' ? 'purple' : 'default'}>
                            {script.category === 'monitoring' ? '監控' :
                              script.category === 'deployment' ? '部署' :
                                script.category === 'maintenance' ? '維護' :
                                  script.category === 'performance' ? '效能' : '其他'}
                          </Tag>
                        </div>
                        <div style={{ flex: 1 }}>
                          <div style={{ fontWeight: 500, marginBottom: '4px', color: 'rgba(255, 255, 255, 0.9)' }}>
                            {script.name}
                          </div>
                          <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                            執行 {script.executionCount || 0} 次 • 建立者：{script.creator}
                          </div>
                        </div>
                        <div style={{ textAlign: 'right' }}>
                          <div style={{
                            fontSize: '16px',
                            fontWeight: 'bold',
                            color: '#ff7a45',
                            marginBottom: '2px'
                          }}>
                            {script.executionCount || 0}
                          </div>
                          <div style={{ fontSize: '10px', color: 'rgba(255, 255, 255, 0.5)' }}>
                            次執行
                          </div>
                        </div>
                      </div>
                    )) :
                    <div style={{
                      textAlign: 'center',
                      padding: '24px',
                      color: 'rgba(255, 255, 255, 0.6)'
                    }}>
                      暫無腳本數據
                    </div>
                  }
                </div>
              </Card>
            </Col>
          </Row>

          <Tabs
            defaultActiveKey={tabKey}
            onChange={(key) => onNavigate(key)}
            style={{
              '--tab-bar-margin': '0 0 var(--spacing-lg) 0'
            }}
          >
            <Tabs.TabPane
              tab={
                <span>
                  <CodeOutlined />
                  腳本庫
                </span>
              }
              key="scripts"
            >
              <ScriptsPage scripts={scripts} setScripts={setScripts} addExecution={addExecution} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <ScheduleOutlined />
                  排程管理
                </span>
              }
              key="schedules"
            >
              <SchedulesPage scripts={scripts} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <HistoryOutlined />
                  執行日誌
                </span>
              }
              key="executions"
            >
              <ExecutionsPage executions={executions} setExecutions={setExecutions} />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    const IncidentListPage = ({ onNavigate, pageParams }) => {
      const initialData = [
        { key: 'i_1', summary: 'CPU high on prod-mysql-master-us-east-02', severity: 'critical', source: 'Prometheus', status: 'acknowledged', created_at: dayjs().subtract(5, 'minutes'), automation_id: null, assignee: 'user_2', resource_name: 'prod-mysql-master-us-east-02', service: '資料庫服務', business_impact: '高', storm_group: null, ruleName: '高 CPU 使用率', triggerThreshold: 'CPU > 90%' },
        { key: 'i_2', summary: 'Disk space low on prod-web-nginx-us-east-03', severity: 'warning', source: 'Grafana', status: 'new', created_at: dayjs().subtract(2, 'hour'), automation_id: 'e_1', assignee: null, resource_name: 'prod-web-nginx-us-east-03', service: 'Web應用', business_impact: '中', storm_group: null, ruleName: '磁碟空間不足', triggerThreshold: 'Disk < 15%' },
        { key: 'i_3', summary: 'API latency over 500ms on prod-api-gateway-us-west-01', severity: 'warning', source: 'Datadog', status: 'acknowledged', created_at: dayjs().subtract(1, 'day'), assignee: 'user_4', resource_name: 'prod-api-gateway-us-west-01', service: 'API閘道', business_impact: '高', storm_group: null, ruleName: 'API 延遲過高', triggerThreshold: 'P95 Latency > 500ms' },
        { key: 'i_4', summary: 'Prometheus Server Down on prod-mon-prometheus-us-east-01', severity: 'critical', source: 'Kubernetes', status: 'resolved', created_at: dayjs().subtract(3, 'day'), assignee: 'user_1', resource_name: 'prod-mon-prometheus-us-east-01', service: '監控系統', business_impact: '中', storm_group: null, ruleName: '基礎設施監控', triggerThreshold: 'Pod is not ready' },
        { key: 'i_5', summary: 'Memory usage high on stg-web-nodejs-us-east-01', severity: 'warning', source: 'Prometheus', status: 'new', created_at: dayjs().subtract(15, 'minutes'), automation_id: null, assignee: null, resource_name: 'stg-web-nodejs-us-east-01', service: 'Web應用', business_impact: '低', storm_group: null, ruleName: '測試環境資源監控', triggerThreshold: 'Memory > 80%' },
        { key: 'i_6', summary: 'Cache Redis Memory Full on prod-redis-cache-us-east-01', severity: 'critical', source: 'Grafana', status: 'new', created_at: dayjs().subtract(30, 'minutes'), automation_id: null, assignee: null, resource_name: 'prod-redis-cache-us-east-01', service: '快取服務', business_impact: '高', storm_group: null, ruleName: '快取服務監控', triggerThreshold: 'Memory > 95%' },
        { key: 'i_7', summary: 'Web Server 503 Errors on prod-web-nginx-us-east-01', severity: 'critical', source: 'Datadog', status: 'new', created_at: dayjs().subtract(2, 'minutes'), automation_id: null, assignee: null, resource_name: 'prod-web-nginx-us-east-01', service: 'Web應用', business_impact: '高', storm_group: 'storm_1', ruleName: 'Web 服務可用性', triggerThreshold: '5xx errors > 5%' },
        { key: 'i_8', summary: 'Load Balancer High Traffic on prod-lb-haproxy-us-east-01', severity: 'warning', source: 'Prometheus', status: 'new', created_at: dayjs().subtract(3, 'minutes'), automation_id: null, assignee: null, resource_name: 'prod-lb-haproxy-us-east-01', service: '負載平衡', business_impact: '中', storm_group: 'storm_1', ruleName: '網路流量監控', triggerThreshold: 'Traffic > 1Gbps' },
        { key: 'i_9', summary: 'Database Connection Pool Full on prod-mysql-master-us-east-01', severity: 'critical', source: 'Grafana', status: 'new', created_at: dayjs().subtract(2, 'minutes'), automation_id: null, assignee: null, resource_name: 'prod-mysql-master-us-east-01', service: '資料庫服務', business_impact: '高', storm_group: 'storm_1', ruleName: '資料庫連線池監控', triggerThreshold: 'Connection Pool > 98%' },
      ];
      const [incidents, setIncidents] = useLocalStorageState('sre-incidents-v4', initialData);
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);
      const [currentIncident, setCurrentIncident] = useState(null);
      const [isSilenceModalOpen, setIsSilenceModalOpen] = useState(false);
      const [silenceIncident, setSilenceIncident] = useState(null);
      const [silenceDuration, setSilenceDuration] = useState(1);
      const { message, modal } = antd.App.useApp();
      const [isAIAnalysisModalOpen, setIsAIAnalysisModalOpen] = useState(false);
      const [analyzedIncidents, setAnalyzedIncidents] = useState([]);
      const [quickFilters, setQuickFilters] = useState({
        new: false
      });
      const [advancedFilters, setAdvancedFilters] = useState({
        timeRange: null,
        severity: [],
        status: [],
        resourceName: ''
      });
      const [isFilterOpen, setIsFilterOpen] = useState(false);

      // 欄位自訂功能
      const defaultVisibleColumns = {
        severity: true,
        summary: true,
        resource_name: true,
        business_impact: true,
        ruleName: false, // 預設隱藏
        triggerThreshold: false, // 預設隱藏
        status: true,
        assignee: true,
        created_at: true,
        action: true
      };
      const [visibleColumns, setVisibleColumns] = useLocalStorageState('sre-incident-columns', defaultVisibleColumns);
      const [isColumnSettingsOpen, setIsColumnSettingsOpen] = useState(false);
      const [tableDensity, setTableDensity] = useState('standard');

      const handleStatusChange = (keys, newStatus) => {
        const actionText = newStatus === 'acknowledged' ? '確認' : '解決';
        setIncidents(incidents.map(inc => (keys.includes(inc.key) ? { ...inc, status: newStatus } : inc)));
        message.success(`事件狀態已更新`);
        if (isDetailModalOpen) {
          setCurrentIncident(prev => ({ ...prev, status: newStatus }));
        }
      };

      const handleBatchUpdate = (newStatus) => {
        const actionText = newStatus === 'acknowledged' ? '確認' : '解決';
        modal.confirm({
          title: `確定要批次 ${actionText} ${selectedRowKeys.length} 個事件嗎？`,
          icon: <ExclamationCircleOutlined />,
          onOk() {
            handleStatusChange(selectedRowKeys, newStatus);
            setSelectedRowKeys([]);
          }
        });
      };

      const handleAIAnalysis = (selectedKeys = null) => {
        const keysToAnalyze = selectedKeys || selectedRowKeys;
        if (keysToAnalyze.length === 0) {
          message.warning('請先選擇要分析的事件');
          return;
        }
        const incidentsToAnalyze = incidents.filter(incident => keysToAnalyze.includes(incident.key));
        setAnalyzedIncidents(incidentsToAnalyze);
        setIsAIAnalysisModalOpen(true);
      };

      // 處理快速篩選
      const handleQuickFilter = (filterType) => {
        setQuickFilters(prev => {
          const newFilters = { ...prev };
          // 切換當前篩選器
          newFilters[filterType] = !newFilters[filterType];
          return newFilters;
        });
      };

      const showDetailModal = (record) => {
        setCurrentIncident(record);
        setIsDetailModalOpen(true);
      };

      const showSilenceModal = (record) => {
        setSilenceIncident(record);
        setSilenceDuration(1); // 預設1小時
        setIsSilenceModalOpen(true);
      };

      const hideSilenceModal = () => {
        setIsSilenceModalOpen(false);
        setSilenceIncident(null);
        setSilenceDuration(1);
      };

      const handleSilence = () => {
        if (!silenceIncident) return;

        // 建立靜音規則的匹配條件
        const matchers = [
          { key: 'alert_name', op: '=', value: silenceIncident.summary },
          { key: 'resource_name', op: '=', value: silenceIncident.resource_name },
          { key: 'severity', op: '=', value: silenceIncident.severity }
        ];

        // 建立靜音規則物件
        const silenceRule = {
          key: `s_temp_${Date.now()}`,
          name: `臨時靜音 - ${silenceIncident.summary}`,
          description: `臨時靜音規則，由告警列表快速建立`,
          type: 'once',
          timeRange: [
            dayjs(),
            dayjs().add(silenceDuration, 'hour')
          ],
          matchers: matchers,
          creator: 'admin', // 應該從當前用戶獲取
          enabled: true,
          createdFromIncident: silenceIncident.key
        };

        // 取得現有的靜音規則並新增新規則
        const existingSilences = JSON.parse(localStorage.getItem('sre-silences-v2') || '[]');
        existingSilences.push(silenceRule);
        localStorage.setItem('sre-silences-v2', JSON.stringify(existingSilences));

        // 更新當前告警的狀態為靜音
        setIncidents(incidents.map(inc =>
          inc.key === silenceIncident.key
            ? { ...inc, status: 'silenced', silencedUntil: dayjs().add(silenceDuration, 'hour') }
            : inc
        ));

        message.success(`已建立 ${silenceDuration} 小時的靜音規則`);
        hideSilenceModal();
      };

      // 定義所有可能的欄位
      const allColumns = {
        severity: {
          title: '嚴重性',
          dataIndex: 'severity',
          width: '8%',
          sorter: (a, b) => a.severity.localeCompare(b.severity),
          render: (severity) => (
            <span className={`status-badge status-${severity}`}>
              {severity ? severity.toUpperCase() : 'UNKNOWN'}
            </span>
          )
        },
        summary: { title: '摘要', dataIndex: 'summary', width: '18%', sorter: (a, b) => a.summary.localeCompare(b.summary), render: (text, record) => <a onClick={() => showDetailModal(record)} style={{ color: '#1890ff', textDecoration: 'none', cursor: 'pointer' }} onMouseEnter={(e) => e.target.style.textDecoration = 'underline'} onMouseLeave={(e) => e.target.style.textDecoration = 'none'}>{text}</a> },
        resource_name: { title: '資源名稱', dataIndex: 'resource_name', width: '14%', sorter: (a, b) => (a || '').localeCompare(b || ''), render: name => name || '-' },
        business_impact: {
          title: '業務影響',
          dataIndex: 'business_impact',
          width: '10%',
          sorter: (a, b) => (a.business_impact || '').localeCompare(b.business_impact || ''),
          render: (impact) => {
            const color = impact === '高' ? 'red' : impact === '中' ? 'orange' : 'blue';
            return <Tag color={color}>{impact || '-'}</Tag>;
          }
        },
        ruleName: { title: '規則名稱', dataIndex: 'ruleName', width: '14%', sorter: (a, b) => (a || '').localeCompare(b || ''), render: name => name || '-' },
        triggerThreshold: { title: '觸發閾值', dataIndex: 'triggerThreshold', width: '10%', render: name => name || '-' },
        status: {
          title: '狀態',
          dataIndex: 'status',
          width: '8%',
          render: (status, record) => {
            const statusText = {
              new: 'NEW',
              acknowledged: 'ACK',
              resolved: 'RESOLVED',
              silenced: 'SILENCED'
            };

            // 顯示告警風暴標籤
            if (record.storm_group) {
              const stormCount = incidents.filter(i => i.storm_group === record.storm_group).length;
              return (
                <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>
                  <Tag color="orange" size="small" style={{ margin: 0, fontSize: '10px' }}>
                    風暴 ({stormCount})
                  </Tag>
                  <span className={`status-badge status-${status}`}>
                    {statusText[status] || 'UNKNOWN'}
                  </span>
                </div>
              );
            }

            return (
              <span className={`status-badge status-${status}`}>
                {statusText[status] || 'UNKNOWN'}
              </span>
            );
          }
        },
        assignee: { title: '處理人', dataIndex: 'assignee', width: '8%', sorter: (a, b) => (a || '').localeCompare(b || ''), render: (assignee) => assignee || '-' },
        created_at: { title: '觸發時間', dataIndex: 'created_at', width: '10%', sorter: (a, b) => a.created_at.valueOf() - b.created_at.valueOf(), render: time => <span title={time ? time.format('YYYY-MM-DD HH:mm:ss') : ''}>{time ? time.fromNow() : '-'}</span> },
        action: {
          title: '操作', key: 'action', width: '10%', render: (_, record) => (
            <Space size="small">
              <Tooltip title="確認事件" placement="top">
                <Button
                  type="text"
                  icon={<CheckCircleOutlined style={{ color: '#52c41a' }} />}
                  disabled={record.status !== 'new'}
                  onClick={() => handleStatusChange([record.key], 'acknowledged')}
                />
              </Tooltip>
              <Tooltip title={record.status === 'silenced' ? '已靜音' : '設置靜音'} placement="top">
                <Button
                  type="text"
                  icon={<PauseCircleOutlined />}
                  disabled={record.status === 'resolved'}
                  onClick={() => showSilenceModal(record)}
                />
              </Tooltip>
            </Space>
          )
        }
      };

      // 根據可見欄位設定動態生成表格欄位
      const columns = Object.keys(allColumns)
        .filter(key => visibleColumns[key])
        .map(key => allColumns[key]);

      // 應用預篩選和搜尋篩選
      let filteredIncidents = incidents;

      // 預篩選邏輯 (從總覽頁面下鑽過來)
      if (pageParams && pageParams.statusFilter) {
        filteredIncidents = filteredIncidents.filter(inc => inc.status === pageParams.statusFilter);
      }

      // 快速篩選邏輯
      if (quickFilters.new) {
        filteredIncidents = filteredIncidents.filter(inc => inc.status === 'new');
      }

      // 進階篩選邏輯
      if (advancedFilters.timeRange) {
        const [start, end] = advancedFilters.timeRange;
        filteredIncidents = filteredIncidents.filter(inc =>
          inc.created_at.isBetween(start, end)
        );
      }
      if (advancedFilters.severity && advancedFilters.severity.length > 0) {
        filteredIncidents = filteredIncidents.filter(inc => advancedFilters.severity.includes(inc.severity));
      }
      if (advancedFilters.status && advancedFilters.status.length > 0) {
        filteredIncidents = filteredIncidents.filter(inc => advancedFilters.status.includes(inc.status));
      }
      if (advancedFilters.resourceName) {
        filteredIncidents = filteredIncidents.filter(inc => inc.resource_name && inc.resource_name.toLowerCase().includes(advancedFilters.resourceName.toLowerCase()));
      }

      // 搜尋篩選邏輯
      if (searchText) {
        filteredIncidents = filteredIncidents.filter(inc =>
          inc.summary.toLowerCase().includes(searchText.toLowerCase()) ||
          inc.status.toLowerCase().includes(searchText.toLowerCase()) ||
          (inc.assignee && inc.assignee.toLowerCase().includes(searchText.toLowerCase())) ||
          (inc.resource_name && inc.resource_name.toLowerCase().includes(searchText.toLowerCase())) ||
          (inc.service && inc.service.toLowerCase().includes(searchText.toLowerCase()))
        );
      }
      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      // 統計資料
      const stats = {
        total: incidents.length,
        new: incidents.filter(i => i.status === 'new').length,
        acknowledged: incidents.filter(i => i.status === 'acknowledged').length,
        resolved: incidents.filter(i => i.status === 'resolved').length,
        critical: incidents.filter(i => i.severity === 'critical').length,
        warning: incidents.filter(i => i.severity === 'warning').length
      };

      return (
        <React.Fragment>




          {/* 工具列 */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="搜尋事件摘要、資源或處理人..."
                onChange={e => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Popover
                content={
                  <AdvancedFilterPanel
                    filters={advancedFilters}
                    onFilterChange={(newFilters) => {
                      setAdvancedFilters(newFilters);
                      setIsFilterOpen(false);
                    }}
                    filterConfig={[
                      {
                        field: 'timeRange',
                        label: '時間範圍',
                        type: 'dateRange',
                        placeholder: ['開始日期', '結束日期']
                      },
                      {
                        field: 'severity',
                        label: '嚴重性',
                        type: 'multiSelect',
                        placeholder: '選擇嚴重性',
                        options: [
                          { value: 'critical', label: 'Critical' },
                          { value: 'warning', label: 'Warning' }
                        ],
                        renderOption: (opt) => (
                          <span style={{ color: opt.value === 'critical' ? '#ff4d4f' : '#faad14' }}>
                            {opt.value === 'critical' ? '🔴' : '🟡'} {opt.label}
                          </span>
                        )
                      },
                      {
                        field: 'status',
                        label: '狀態',
                        type: 'multiSelect',
                        placeholder: '選擇狀態',
                        options: [
                          { value: 'new', label: 'New' },
                          { value: 'acknowledged', label: 'Acknowledged' },
                          { value: 'resolved', label: 'Resolved' }
                        ],
                        renderOption: (opt) => {
                          const icons = { new: '🆕', acknowledged: '✅', resolved: '🎯' };
                          return <span>{icons[opt.value]} {opt.label}</span>;
                        }
                      },
                      {
                        field: 'resourceName',
                        label: '資源名稱',
                        type: 'text',
                        placeholder: '輸入資源名稱'
                      }
                    ]}
                  />
                }
                title={null}
                trigger="click"
                open={isFilterOpen}
                onOpenChange={setIsFilterOpen}
                placement="bottomLeft"
                overlayStyle={{
                  backgroundColor: 'rgba(0, 0, 0, 0.9)',
                  backdropFilter: 'blur(8px)',
                  border: '1px solid rgba(255, 255, 255, 0.1)',
                  borderRadius: '8px',
                  boxShadow: '0 8px 32px rgba(0, 0, 0, 0.6)'
                }}
                overlayInnerStyle={{
                  padding: 0,
                  backgroundColor: 'transparent'
                }}
              >
                <PlatformButton
                  variant="ghost"
                  size="small"
                  icon={<FilterOutlined />}
                  onClick={() => setIsFilterOpen(!isFilterOpen)}
                >
                  篩選
                  <Badge count={Object.values(advancedFilters).filter(v => v && (!Array.isArray(v) || v.length > 0) && (v.resourceName ? v.resourceName.length > 0 : true)).length} style={{ marginLeft: 8 }} />
                </PlatformButton>
              </Popover>
              {/* 快速篩選按鈕 */}
              <PlatformButton
                variant={quickFilters.new ? 'primary' : 'ghost'}
                size="small"
                onClick={() => handleQuickFilter('new')}
                className={quickFilters.new ? 'filter-active' : ''}
              >
                未確認 (NEW)
              </PlatformButton>
            </Space>
            <Space>
              <TableDensitySwitcher
                density={tableDensity}
                onChange={setTableDensity}
              />
              <PlatformButton
                variant="ghost"
                size="small"
                icon={<DownloadOutlined />}
              >
                匯出
              </PlatformButton>
              <Popover
                content={
                  <div style={{ width: '200px' }}>
                    <div style={{ marginBottom: '12px', fontWeight: 600, color: 'rgba(255, 255, 255, 0.9)' }}>
                      欄位顯示設定
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                      {Object.keys(allColumns).map(key => (
                        <div key={key} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                          <Checkbox
                            checked={visibleColumns[key]}
                            onChange={(e) => setVisibleColumns(prev => ({ ...prev, [key]: e.target.checked }))}
                            style={{ marginRight: '8px' }}
                          />
                          <span style={{ color: 'rgba(255, 255, 255, 0.8)', fontSize: '13px' }}>
                            {allColumns[key].title}
                          </span>
                        </div>
                      ))}
                    </div>
                  </div>
                }
                title={null}
                trigger="click"
                open={isColumnSettingsOpen}
                onOpenChange={setIsColumnSettingsOpen}
                placement="bottomRight"
                overlayStyle={{
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  backdropFilter: 'blur(8px)',
                  border: '1px solid rgba(255, 255, 255, 0.1)'
                }}
              >
                <PlatformButton
                  variant="ghost"
                  size="small"
                  icon={<EyeOutlined />}
                  onClick={() => setIsColumnSettingsOpen(!isColumnSettingsOpen)}
                >
                  欄位設定
                </PlatformButton>
              </Popover>
              <PlatformButton
                variant="primary"
                size="small"
                icon={<RobotOutlined />}
                onClick={() => handleAIAnalysis(selectedRowKeys.length > 0 ? selectedRowKeys : null)}
              >
                AI 分析
              </PlatformButton>
            </Space>
          </Space>
          <div className={`table-wrapper table-density-${tableDensity}`}>
            <Table rowSelection={rowSelection} columns={columns} dataSource={filteredIncidents} rowKey="key" className="transparent-bg" size="small" />
          </div>
          <Modal
            title={
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <InfoCircleOutlined style={{ color: '#1890ff' }} />
                <span>事件詳情</span>
              </div>
            }
            open={isDetailModalOpen}
            onCancel={() => setIsDetailModalOpen(false)}
            footer={
              <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '12px' }}>
                <PlatformButton
                  variant="secondary"
                  size="medium"
                  onClick={() => setIsDetailModalOpen(false)}
                >
                  關閉
                </PlatformButton>
                <PlatformButton
                  variant="primary"
                  size="medium"
                  disabled={currentIncident && currentIncident.status !== 'new'}
                  onClick={() => { handleStatusChange([currentIncident.key], 'acknowledged') }}
                >
                  確認收到 (Ack)
                </PlatformButton>
                <PlatformButton
                  variant="primary"
                  size="medium"
                  icon={<RobotOutlined />}
                  onClick={() => handleAIAnalysis([currentIncident.key])}
                >
                  AI 分析
                </PlatformButton>
              </div>
            }
            width={800}
            style={{
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
              borderRadius: '12px'
            }}
          >
            {currentIncident && (
              <Tabs defaultActiveKey="1" style={{ marginTop: 16 }}>
                <Tabs.TabPane tab="基本資訊" key="1">
                  {/* 基本資訊區塊 */}
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '8px',
                    padding: '12px',
                    marginBottom: '12px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '12px' }}>
                      <div className="severity-indicator severity-critical"></div>
                      <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.85)' }}>基本資訊</Title>
                    </div>
                    <Descriptions bordered column={1} size="small" className="compact-descriptions">
                      <Descriptions.Item label="摘要">{currentIncident.summary}</Descriptions.Item>
                      <Descriptions.Item label="嚴重性"><Tag color={currentIncident.severity === 'critical' ? 'red' : 'orange'}>{currentIncident.severity ? currentIncident.severity.toUpperCase() : 'UNKNOWN'}</Tag></Descriptions.Item>
                      <Descriptions.Item label="狀態">{currentIncident.status ? currentIncident.status.toUpperCase() : 'UNKNOWN'}</Descriptions.Item>
                      <Descriptions.Item label="來源">{currentIncident.source}</Descriptions.Item>
                      <Descriptions.Item label="觸發時間">{currentIncident.created_at ? currentIncident.created_at.format('YYYY-MM-DD HH:mm:ss') : '-'}</Descriptions.Item>
                      <Descriptions.Item label="資源名稱">
                        <span style={{ marginRight: '8px' }}>{currentIncident.resource_name || '-'}</span>
                        <PlatformButton
                          variant="text"
                          size="small"
                        >
                          前往儀表板
                        </PlatformButton>
                      </Descriptions.Item>
                      <Descriptions.Item label="規則名稱">{currentIncident.ruleName || '-'}</Descriptions.Item>
                      <Descriptions.Item label="觸發閾值">{currentIncident.triggerThreshold || '-'}</Descriptions.Item>
                      {currentIncident.storm_group && (
                        <Descriptions.Item label="告警風暴">
                          <Tag color="orange">風暴群組: {currentIncident.storm_group}</Tag>
                          <PlatformButton
                            variant="text"
                            size="small"
                          >
                            查看相關告警
                          </PlatformButton>
                        </Descriptions.Item>
                      )}
                      <Descriptions.Item label="快速操作">
                        <Space>
                          <PlatformButton
                            variant="primary"
                            size="small"
                            icon={<BarChartOutlined />}
                          >
                            資源監控
                          </PlatformButton>
                        </Space>
                      </Descriptions.Item>
                    </Descriptions>
                  </div>
                </Tabs.TabPane>
                <Tabs.TabPane tab="處理歷史" key="2">
                  {/* 處理歷史區塊 */}
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '8px',
                    padding: '8px',
                    marginBottom: '8px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
                      <div className="severity-indicator severity-warning"></div>
                      <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.85)', fontSize: '14px' }}>處理歷史</Title>
                    </div>
                    <div className="incident-timeline">
                      <div className="timeline-item">
                        <div className="timeline-dot timeline-dot-completed"></div>
                        <div className="timeline-content">
                          <div className="timeline-title">事件建立</div>
                          <div className="timeline-description">由 {currentIncident.source} 觸發</div>
                          <div className="timeline-time">{currentIncident.created_at ? currentIncident.created_at.format('MM-DD HH:mm:ss') : '未知時間'}</div>
                        </div>
                      </div>
                      {currentIncident.status === 'acknowledged' && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-completed"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">事件確認</div>
                            <div className="timeline-description">已由 {currentIncident.assignee || '系統'} 確認</div>
                            <div className="timeline-time">{currentIncident.created_at ? currentIncident.created_at.add(2, 'minute').format('MM-DD HH:mm:ss') : ''}</div>
                          </div>
                        </div>
                      )}
                      {currentIncident.status === 'new' && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-current"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">等待確認</div>
                            <div className="timeline-description">尚未確認，請指派負責人</div>
                          </div>
                        </div>
                      )}
                      {currentIncident.status === 'acknowledged' && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-current"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">調查中</div>
                            <div className="timeline-description">正在分析和處理問題</div>
                          </div>
                        </div>
                      )}
                      {currentIncident.automation_id && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-completed"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">自動化執行</div>
                            <div className="timeline-description">執行腳本 {currentIncident.automation_id}</div>
                            <div className="timeline-time">{currentIncident.created_at ? currentIncident.created_at.add(1, 'minute').format('MM-DD HH:mm:ss') : ''}</div>
                          </div>
                        </div>
                      )}
                      {currentIncident.status === 'resolved' && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-completed"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">事件解決</div>
                            <div className="timeline-description">問題已修復並驗證</div>
                            <div className="timeline-time">{currentIncident.created_at ? currentIncident.created_at.add(15, 'minute').format('MM-DD HH:mm:ss') : ''}</div>
                          </div>
                        </div>
                      )}
                      {currentIncident.status !== 'resolved' && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-default"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">事件解決</div>
                            <div className="timeline-description">待處理</div>
                          </div>
                        </div>
                      )}
                    </div>
                    <div style={{ marginTop: '16px', paddingTop: '12px', borderTop: '1px solid rgba(255, 255, 255, 0.1)' }}>
                      <TextArea
                        rows={2}
                        placeholder="新增處理紀錄..."
                        style={{
                          background: 'rgba(255, 255, 255, 0.05)',
                          border: '1px solid rgba(255, 255, 255, 0.2)',
                          color: 'rgba(255, 255, 255, 0.9)',
                          borderRadius: '4px',
                          fontSize: '13px',
                          marginBottom: '12px'
                        }}
                      />
                      <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()} style={{ height: '32px', fontSize: '13px', display: 'block' }}>新增紀錄</Button>
                    </div>
                  </div>
                </Tabs.TabPane>
                <Tabs.TabPane tab="關聯事件" key="3">
                  {/* 關聯告警區塊 */}
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '8px',
                    padding: '8px',
                    marginBottom: '8px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
                      <div className="severity-indicator severity-info"></div>
                      <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.85)', fontSize: '14px' }}>關聯事件</Title>
                    </div>
                    <List
                      size="small"
                      bordered
                      dataSource={[
                        { summary: 'API latency over 500ms', time: '3 分鐘前觸發', status: 'ACK', severity: 'warning' },
                        { summary: 'Database slow query detected', time: '5 分鐘前觸發', status: 'NEW', severity: 'warning' },
                        { summary: 'Load balancer health check failed', time: '2 分鐘前觸發', status: 'NEW', severity: 'critical' }
                      ]}
                      renderItem={(item) => (
                        <List.Item style={{
                          color: 'rgba(255, 255, 255, 0.85)',
                          background: 'rgba(255, 255, 255, 0.02)',
                          padding: '8px 12px'
                        }}>
                          <div style={{ width: '100%' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '4px' }}>
                              <span style={{ fontWeight: '500' }}>{item.summary}</span>
                              <Tag
                                color={item.severity === 'critical' ? 'red' : 'orange'}
                                size="small"
                                style={{ fontSize: '10px' }}
                              >
                                {item.severity.toUpperCase()}
                              </Tag>
                            </div>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                              <span style={{
                                fontSize: '12px',
                                color: 'rgba(255, 255, 255, 0.6)'
                              }}>
                                {item.time}
                              </span>
                              <Tag
                                color={item.status === 'ACK' ? 'orange' : 'blue'}
                                size="small"
                                style={{ fontSize: '10px' }}
                              >
                                狀態: {item.status}
                              </Tag>
                            </div>
                          </div>
                        </List.Item>
                      )}
                    />
                  </div>
                </Tabs.TabPane>
                <Tabs.TabPane tab="自動化" key="4">
                  {/* 自動化區塊 */}
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '8px',
                    padding: '12px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '12px' }}>
                      <div className="severity-indicator severity-success"></div>
                      <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.85)' }}>自動化</Title>
                    </div>
                    {currentIncident.automation_id ? (
                      <p style={{ color: 'rgba(255, 255, 255, 0.85)' }}>
                        執行紀錄 ID: <a onClick={() => onNavigate('executions')} style={{ color: '#1890ff' }}>{currentIncident.automation_id}</a>
                      </p>
                    ) : (
                      <p style={{ color: 'rgba(255, 255, 255, 0.7)' }}>此事件未觸發自動化腳本。</p>
                    )}
                  </div>
                </Tabs.TabPane>
              </Tabs>
            )}
          </Modal>

          <AIAnalysisModal
            open={isAIAnalysisModalOpen}
            onClose={() => setIsAIAnalysisModalOpen(false)}
            incidents={analyzedIncidents}
            onNavigate={onNavigate}
          />

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>已選擇 <span className="batch-count">{selectedRowKeys.length}</span> 項</span>
              </div>
              <Space>
                <Button className="batch-action-button" onClick={() => handleBatchUpdate('acknowledged')}>
                  批次確認
                </Button>
                <Button className="batch-action-button batch-action-button--success" onClick={() => handleBatchUpdate('resolved')}>
                  批次解決
                </Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          {/* 靜音模態框 */}
          <Modal
            title="建立靜音"
            open={isSilenceModalOpen}
            onCancel={hideSilenceModal}
            onOk={handleSilence}
            okText="建立靜音"
            cancelText="取消"
            width={600}
          >
            <div style={{ padding: '8px 0' }}>
              <div style={{ marginBottom: '24px' }}>
                <Title level={5} style={{ color: 'rgba(255, 255, 255, 0.85)', marginBottom: '8px' }}>
                  事件資訊
                </Title>
                <div style={{ background: 'rgba(255, 255, 255, 0.02)', padding: '12px', borderRadius: '6px', border: '1px solid rgba(255, 255, 255, 0.08)' }}>
                  <div style={{ marginBottom: '8px' }}>
                    <Text strong style={{ color: 'rgba(255, 255, 255, 0.9)' }}>摘要：</Text>
                    <Text style={{ color: 'rgba(255, 255, 255, 0.7)' }}>{silenceIncident?.summary}</Text>
                  </div>
                  <div style={{ marginBottom: '8px' }}>
                    <Text strong style={{ color: 'rgba(255, 255, 255, 0.9)' }}>資源：</Text>
                    <Text style={{ color: 'rgba(255, 255, 255, 0.7)' }}>{silenceIncident?.resource_name}</Text>
                  </div>
                  <div>
                    <Text strong style={{ color: 'rgba(255, 255, 255, 0.9)' }}>嚴重性：</Text>
                    <Tag color={silenceIncident?.severity === 'critical' ? 'red' : 'orange'} style={{ marginLeft: '8px' }}>
                      {silenceIncident?.severity?.toUpperCase()}
                    </Tag>
                  </div>
                </div>
              </div>

              <div style={{ marginBottom: '24px' }}>
                <Title level={5} style={{ color: 'rgba(255, 255, 255, 0.85)', marginBottom: '8px' }}>
                  靜音設定
                </Title>
                <div style={{ background: 'rgba(255, 255, 255, 0.02)', padding: '12px', borderRadius: '6px', border: '1px solid rgba(255, 255, 255, 0.08)' }}>
                  <div style={{ marginBottom: '8px' }}>
                    <Text style={{ color: 'rgba(255, 255, 255, 0.8)' }}>
                      選擇靜音持續時間：
                    </Text>
                  </div>
                  <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
                    {[1, 2, 4, 8, 12, 24].map(duration => (
                      <Button
                        key={duration}
                        type={silenceDuration === duration ? 'primary' : 'default'}
                        size="small"
                        onClick={() => setSilenceDuration(duration)}
                        style={{
                          background: silenceDuration === duration ? undefined : 'rgba(255, 255, 255, 0.05)',
                          borderColor: 'rgba(255, 255, 255, 0.3)',
                          color: silenceDuration === duration ? undefined : 'rgba(255, 255, 255, 0.85)',
                          borderRadius: '6px',
                          transition: 'all 0.2s'
                        }}
                      >
                        {duration} 小時
                      </Button>
                    ))}
                  </div>
                  <div style={{ marginTop: '12px', padding: '8px', background: 'rgba(24, 144, 255, 0.1)', borderRadius: '4px', border: '1px solid rgba(24, 144, 255, 0.2)' }}>
                    <Text style={{ color: 'rgba(24, 144, 255, 0.9)', fontSize: '12px' }}>
                      📝 將建立靜音持續 {silenceDuration} 小時，到 {dayjs().add(silenceDuration, 'hour').format('YYYY-MM-DD HH:mm:ss')}
                    </Text>
                  </div>
                </div>
              </div>

              <div style={{ padding: '12px', background: 'rgba(250, 173, 20, 0.1)', borderRadius: '6px', border: '1px solid rgba(250, 173, 20, 0.2)' }}>
                <Text style={{ color: 'rgba(250, 173, 20, 0.9)', fontSize: '12px' }}>
                  💡 靜音規則將出現在「靜音」頁面中，您可以在那裡查看、管理或延長靜音時間。
                </Text>
              </div>
            </div>
          </Modal>
        </React.Fragment >
      );
    };

    const AIAnalysisModal = ({ open, onClose, incidents, onNavigate }) => {
      const [isLoading, setIsLoading] = useState(true);
      const [analysisResult, setAnalysisResult] = useState(null);

      // 實體連結渲染函數
      const renderEntityLinkedText = (text) => {
        const entityPatterns = [
          { pattern: /'([^']+)' 服務/g, type: 'service' },
          { pattern: /([a-zA-Z-]+\d+(?:-[a-zA-Z]+)*)/g, type: 'resource' },
          { pattern: /用戶([^。，\s]+)功能/g, type: 'business' },
          { pattern: /用戶數據庫/g, type: 'database' }
        ];

        let result = text;
        let linkIndex = 0;

        entityPatterns.forEach(({ pattern, type }) => {
          result = result.replace(pattern, (match, p1) => {
            const entityName = p1 || match;
            const linkId = `entity-link-${linkIndex++}`;

            let href = '#';
            let color = 'blue';

            switch (type) {
              case 'service':
                href = `/dashboard/service/${entityName}`;
                color = 'green';
                break;
              case 'resource':
                href = `/dashboard/resource/${entityName}`;
                color = 'orange';
                break;
              case 'business':
                href = `/dashboard/business/${entityName}`;
                color = 'purple';
                break;
              case 'database':
                href = `/dashboard/database/user-database`;
                color = 'blue';
                break;
            }

            return `<a href="${href}" style="color: var(--brand-${color}); text-decoration: underline; cursor: pointer;" onclick="window.open('${href}', '_blank'); return false;">${match}</a>`;
          });
        });

        return <span dangerouslySetInnerHTML={{ __html: result }} />;
      };

      // 執行操作的處理函數
      const handleActionClick = (recommendation) => {
        switch (recommendation.type) {
          case 'restart':
            Modal.confirm({
              title: '確認重啟服務',
              content: `您確定要重啟 ${recommendation.service} 服務嗎？`,
              okText: '確認重啟',
              cancelText: '取消',
              onOk: () => {
                message.success(`正在重啟 ${recommendation.service} 服務...`);
              }
            });
            break;
          case 'rollback':
            window.open(`/deployment/rollback/${recommendation.service}`, '_blank');
            break;
          case 'logs':
            window.open(`/logs/search?resource=${recommendation.resource}`, '_blank');
            break;
          case 'scale':
            window.open(`/scaling/configure/${recommendation.service}`, '_blank');
            break;
          default:
            message.info('正在執行操作...');
        }
      };

      useEffect(() => {
        if (open) {
          setIsLoading(true);
          setAnalysisResult(null);
          // Simulate AI analysis delay
          const timer = setTimeout(() => {
            // Mocked analysis result
            const rootCause = "根本原因很可能在於 'user-authentication' 服務中的內存洩漏，導致下游服務的連鎖故障。";
            const impact = "對用戶登錄和註冊功能造成嚴重影響。用戶數據庫可能存在數據不一致的風險。";
            const recommendations = [
              {
                text: "立即重啟 'user-authentication' 服務",
                type: "restart",
                service: "user-authentication",
                urgent: true
              },
              {
                text: "回滾 'user-authentication' 服務的最新部署",
                type: "rollback",
                service: "user-authentication",
                urgent: false
              },
              {
                text: "檢查 db-prod-01 日誌",
                type: "logs",
                resource: "db-prod-01",
                urgent: false
              },
              {
                text: "增加 'user-authentication' 服務的內存分配",
                type: "scale",
                service: "user-authentication",
                urgent: false
              }
            ];
            const confidence = 85; // AI分析信心度
            const analyzedEvents = incidents.map(inc => ({
              ...inc,
              analyzed: true
            }));
            setAnalysisResult({ rootCause, impact, recommendations, confidence, analyzedEvents });
            setIsLoading(false);
          }, 1500);
          return () => clearTimeout(timer);
        }
      }, [open, incidents]);

      return (
        <Modal
          title={
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
              <RobotOutlined style={{ color: 'var(--brand-info)' }} />
              <Title level={4} style={{ margin: 0 }}>AI 事件分析報告</Title>
            </div>
          }
          open={open}
          onCancel={onClose}
          footer={[
            <Button
              key="ack"
              type="default"
              icon={<CheckOutlined />}
              onClick={() => {
                message.success('已確認收到分析報告');
                onClose();
              }}
            >
              確認收到 (Ack)
            </Button>,
            <Button key="close" onClick={onClose}>關閉</Button>
          ]}
          width={800}
          centered
        >
          <Spin spinning={isLoading} tip="AI 引擎正在分析中，請稍候...">
            {analysisResult ? (
              <div style={{ marginTop: '24px', display: 'flex', flexDirection: 'column', gap: '24px' }}>
                <div className="modal-section">
                  <Title level={5} className="section-title">
                    分析事件 ({incidents.length})
                    {incidents.length > 3 && (
                      <Tag color="blue" size="small" style={{ marginLeft: '8px' }}>
                        批量分析
                      </Tag>
                    )}
                  </Title>
                  <List
                    size="small"
                    dataSource={incidents.slice(0, 3)}
                    renderItem={item => (
                      <List.Item>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' }}>
                          <span>{item.summary}</span>
                          <Tag color={
                            item.severity === 'critical' ? 'red' :
                              item.severity === 'major' ? 'orange' :
                                item.severity === 'minor' ? 'green' : 'blue'
                          } size="small">
                            {item.severity.toUpperCase()}
                          </Tag>
                        </div>
                      </List.Item>
                    )}
                  />
                  {incidents.length > 3 && (
                    <Typography.Text type="secondary" style={{ fontSize: '12px', marginTop: '8px', display: 'block' }}>
                      + 另外 {incidents.length - 3} 個事件已納入分析範圍
                    </Typography.Text>
                  )}
                </div>
                <div className="modal-section">
                  <Title level={5} className="section-title">
                    根本原因分析 (RCA)
                    <Tag color="blue" style={{ marginLeft: '8px', fontSize: '12px' }}>
                      信心度: {analysisResult.confidence}%
                    </Tag>
                  </Title>
                  <Paragraph>{renderEntityLinkedText(analysisResult.rootCause)}</Paragraph>
                </div>
                <div className="modal-section">
                  <Title level={5} className="section-title">影響範圍評估</Title>
                  <Paragraph>{renderEntityLinkedText(analysisResult.impact)}</Paragraph>
                </div>
                <div className="modal-section">
                  <Title level={5} className="section-title">建議操作</Title>
                  <List
                    size="small"
                    dataSource={analysisResult.recommendations}
                    renderItem={item => (
                      <List.Item>
                        <div style={{ width: '100%', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                          <div style={{ display: 'flex', alignItems: 'center', flex: 1 }}>
                            <BulbOutlined style={{
                              color: item.urgent ? 'var(--status-critical)' : 'var(--brand-primary)',
                              marginRight: '8px'
                            }} />
                            <span style={{ flex: 1 }}>{item.text}</span>
                            {item.urgent && (
                              <Tag color="red" size="small" style={{ marginLeft: '8px' }}>
                                緊急
                              </Tag>
                            )}
                          </div>
                          <Button
                            type={item.urgent ? "primary" : "default"}
                            size="small"
                            danger={item.urgent}
                            style={{ marginLeft: '12px', minWidth: '80px' }}
                            onClick={() => handleActionClick(item)}
                          >
                            {item.type === 'restart' ? '重啟' :
                              item.type === 'rollback' ? '回滾' :
                                item.type === 'logs' ? '查看日誌' :
                                  item.type === 'scale' ? '擴展' : '執行'}
                          </Button>
                        </div>
                      </List.Item>
                    )}
                  />
                </div>
              </div>
            ) : (
              <div style={{ height: '350px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                {/* Placeholder while loading */}
              </div>
            )}
          </Spin>
        </Modal>
      );
    };


    const AlertingRulesPage = () => {
      const [metrics, setMetrics] = useState([]);

      const steps = [
        { title: '基本資訊', description: '設定規則名稱和目標' },
        { title: '觸發條件', description: '定義告警觸發條件' },
        { title: '事件內容', description: '自訂事件內容與通知' },
        { title: '自動化', description: '設定自動化響應動作' }
      ];

      const mockScripts = [
        { id: 's_1', name: 'Auto-scaling for Web Servers', params: [{ name: 'instance_count', type: 'number', label: '實例數量' }] },
        { id: 's_2', name: 'Increase Database Disk Volume', params: [{ name: 'increase_gb', type: 'number', label: '增加容量 (GB)' }] },
        { id: 's_3', name: 'Restart Pod', params: [{ name: 'pod_name', type: 'string', label: 'Pod 名稱' }] },
      ];
      const mockChannels = [{ id: 'c_1', name: 'Email' }, { id: 'c_2', name: 'Slack' }, { id: 'c_3', name: 'Webhook' }];

      const initialRules = [
        {
          key: 'rule_1',
          name: '高 CPU 使用率',
          target: 'Production Web Servers',
          resource_tags: ['production', 'web-server'],
          conditions: { operator: 'AND', conditions: [{ metric: 'cpu_utilization', operator: '>', value: 90, duration: 5, durationUnit: 'minutes' }] },
          notifications: ['Slack'],
          enabled: true
        },
      ];

      const [rules, setRules] = useLocalStorageState('sre-alert-rules', initialRules);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingRule, setEditingRule] = useState(null);
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();
      const [currentStep, setCurrentStep] = useState(0);

      const showModal = (rule = null) => {
        setEditingRule(rule);
        form.setFieldsValue(rule || { name: '', description: '', condition_groups: [{ severity: 'warning', conditions: [{ duration: 5, duration_unit: 'minutes' }] }], automation_enabled: false });
        setCurrentStep(0);
        setIsModalOpen(true);
      };

      const handleCancel = () => {
        setIsModalOpen(false);
        setEditingRule(null);
        form.resetFields();
      };

      const onFinish = (values) => {
        if (editingRule) {
          setRules(rules.map(r => (r.key === editingRule.key ? { ...r, ...values } : r)));
        } else {
          setRules([...rules, { ...values, key: `rule_${Date.now()}`, enabled: true }]);
        }
        message.success(editingRule ? '規則更新成功' : '規則新增成功');
        handleCancel();
      };

      const handleDelete = (key) => {
        confirmDelete('規則', () => setRules(rules.filter(r => r.key !== key)));
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `確定要刪除 ${selectedRowKeys.length} 條規則嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setRules(rules.filter(r => !selectedRowKeys.includes(r.key)));
            setSelectedRowKeys([]);
            message.success('批次刪除成功');
          }
        });
      };

      const columns = [
        { title: '啟用', dataIndex: 'enabled', width: '8%', render: (enabled, record) => <Switch checked={enabled} onChange={(checked) => setRules(rules.map(r => r.key === record.key ? { ...r, enabled: checked } : r))} /> },
        { title: '規則名稱', dataIndex: 'name', width: '20%', sorter: (a, b) => a.name.localeCompare(b.name) },
        { title: '監控對象', dataIndex: 'target', width: '15%' },
        { title: '觸發條件', dataIndex: 'conditions', width: '25%', render: (conditions) => <span>{conditions.conditions.length} 個條件</span> },
        { title: '通知對象', dataIndex: 'notifications', key: 'notifications', width: '12%', render: (notifications) => <Space size={[4, 4]} wrap>{notifications.map(n => <Tag key={n}>{n}</Tag>)}</Space> },
        { title: '操作', key: 'action', width: '15%', align: 'center', render: (_, record) => <TableRowActions onEdit={() => showModal(record)} onDelete={() => handleDelete(record.key)} /> }
      ];

      const onSelectChange = (keys) => setSelectedRowKeys(keys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange };

      const filteredRules = rules.filter(rule => rule.name.toLowerCase().includes(searchText.toLowerCase()));

      return (
        <React.Fragment>
          <div className="toolbar-actions">
            <div className="toolbar-group">
              <Input.Search placeholder="搜尋規則名稱..." onChange={e => setSearchText(e.target.value)} style={{ width: 300 }} allowClear />
            </div>
            <div className="toolbar-group">
              <PlatformButton variant="primary" icon={<PlusOutlined />} onClick={() => showModal()}>新增規則</PlatformButton>
            </div>
          </div>

          <PlatformTableContainer>
            <Table rowSelection={rowSelection} columns={columns} dataSource={filteredRules} rowKey="key" size="small" />
          </PlatformTableContainer>

          <BatchActionToolbar selectedCount={selectedRowKeys.length} onClear={() => setSelectedRowKeys([])} actions={[{ text: '批次刪除', variant: 'danger', icon: <DeleteOutlined />, onClick: handleBatchDelete }]} />

          <PlatformModal title={editingRule ? '編輯事件規則' : '新增事件規則'} visible={isModalOpen} onClose={handleCancel} width={900} footer={
            <ModalActions
              onCancel={handleCancel}
              onConfirm={currentStep === steps.length - 1 ? () => form.submit() : () => setCurrentStep(currentStep + 1)}
              confirmText={currentStep === steps.length - 1 ? '完成' : '下一步'}
              customActions={currentStep > 0 ? [<PlatformButton onClick={() => setCurrentStep(currentStep - 1)}>上一步</PlatformButton>] : []}
            />
          }>
            <Steps current={currentStep} items={steps.map(s => ({ title: s.title }))} style={{ marginBottom: 24 }} />
            <Form form={form} layout="vertical" onFinish={onFinish}>
              <div style={{ display: currentStep === 0 ? 'block' : 'none' }}>
                <SettingsSection title="基本資訊">
                  <SettingsFormRow label="規則名稱" required><Form.Item name="name" noStyle rules={[{ required: true }]}><Input /></Form.Item></SettingsFormRow>
                  <SettingsFormRow label="描述"><Form.Item name="description" noStyle><TextArea rows={2} /></Form.Item></SettingsFormRow>
                </SettingsSection>
              </div>
              <div style={{ display: currentStep === 1 ? 'block' : 'none' }}>
                <SettingsSection title="觸發條件">
                  <Form.List name="condition_groups">
                    {(fields, { add, remove }) => fields.map(field => <div key={field.key}>...</div>)}
                  </Form.List>
                </SettingsSection>
              </div>
              <div style={{ display: currentStep === 2 ? 'block' : 'none' }}>
                <SettingsSection title="事件內容與通知">
                  <SettingsFormRow label="事件標題樣板" required><Form.Item name="title_template" noStyle rules={[{ required: true }]}><Input /></Form.Item></SettingsFormRow>
                  <SettingsFormRow label="事件內容樣板" required><Form.Item name="content_template" noStyle><TextArea rows={3} /></Form.Item></SettingsFormRow>
                </SettingsSection>
              </div>
              <div style={{ display: currentStep === 3 ? 'block' : 'none' }}>
                <SettingsSection title="自動化響應">
                  <Form.Item name="automation_enabled" valuePropName="checked"><Checkbox>啟用自動化響應</Checkbox></Form.Item>
                </SettingsSection>
              </div>
            </Form>
          </PlatformModal>
        </React.Fragment>
      );
    };

    const NotificationStrategiesPage = () => {
      // 🚀 通知策略模擬數據 - 企業級通知配置範例
      const defaultStrategies = [
        {
          key: 'ns_1',
          name: 'Production Database Critical Alerts',
          description: '生產資料庫嚴重告警策略',
          resourceGroup: { key: 'rg_prod_db', name: 'Production-Database' },
          team: { key: 'team_6', name: 'Database Team' },
          channels: [
            { key: 'c_pagerduty_db', name: 'Database Team PagerDuty', type: 'PagerDuty' },
            { key: 'c_slack_db', name: 'Database Slack Channel', type: 'Slack' }
          ],
          conditions: [
            { field: 'severity', operator: 'equals', value: 'critical' },
            { field: 'resource_type', operator: 'equals', value: 'database' }
          ],
          priority: 'high',
          enabled: true,
          createdAt: dayjs().subtract(15, 'day'),
          lastTriggered: dayjs().subtract(2, 'hour'),
          triggerCount: 8
        },
        {
          key: 'ns_2',
          name: 'Web Services Performance Degradation',
          description: 'Web服務性能降級告警策略',
          resourceGroup: { key: 'rg_prod_web', name: 'Production-Web' },
          team: { key: 'team_9', name: 'Operations Team' },
          channels: [
            { key: 'c_pagerduty_ops', name: 'Operations Team PagerDuty', type: 'PagerDuty' },
            { key: 'c_slack_ops', name: 'Operations Slack Channel', type: 'Slack' }
          ],
          conditions: [
            { field: 'severity', operator: 'in', value: ['warning', 'critical'] },
            { field: 'metric', operator: 'contains', value: 'response_time' },
            { field: 'resource_group', operator: 'equals', value: 'rg_prod_web' }
          ],
          priority: 'high',
          enabled: true,
          createdAt: dayjs().subtract(8, 'day'),
          lastTriggered: dayjs().subtract(25, 'minute'),
          triggerCount: 23
        },
        {
          key: 'ns_3',
          name: 'Network Infrastructure Alerts',
          description: '網路基礎設施告警策略',
          resourceGroup: { key: 'rg_monitoring', name: 'Monitoring' },
          team: { key: 'team_7', name: 'Network Team' },
          channels: [
            { key: 'c_pagerduty_network', name: 'Network Team PagerDuty', type: 'PagerDuty' },
            { key: 'c_slack_network', name: 'Network Slack Channel', type: 'Slack' }
          ],
          conditions: [
            { field: 'component', operator: 'in', value: ['network', 'firewall', 'load_balancer'] },
            { field: 'severity', operator: 'not_equals', value: 'info' }
          ],
          priority: 'medium',
          enabled: true,
          createdAt: dayjs().subtract(22, 'day'),
          lastTriggered: dayjs().subtract(3, 'hour'),
          triggerCount: 12
        },
        {
          key: 'ns_4',
          name: 'Security Incident Escalation',
          description: '安全事件升級告警策略',
          resourceGroup: { key: 'rg_prod_web', name: 'Production-Web' },
          team: { key: 'team_8', name: 'Security Team' },
          channels: [
            { key: 'c_email_security', name: 'Security Email', type: 'Email' }
          ],
          conditions: [
            { field: 'category', operator: 'equals', value: 'security' },
            { field: 'severity', operator: 'in', value: ['critical', 'high'] },
            { field: 'tags', operator: 'contains', value: 'intrusion' }
          ],
          priority: 'critical',
          enabled: true,
          createdAt: dayjs().subtract(30, 'day'),
          lastTriggered: dayjs().subtract(1, 'day'),
          triggerCount: 3
        },
        {
          key: 'ns_5',
          name: 'Staging Environment Issues',
          description: '測試環境問題告警策略',
          resourceGroup: { key: 'rg_staging', name: 'Staging' },
          team: { key: 'team_5', name: 'DevOps Team' },
          channels: [
            { key: 'c_email_devops', name: 'DevOps Email', type: 'Email' }
          ],
          conditions: [
            { field: 'environment', operator: 'equals', value: 'staging' },
            { field: 'severity', operator: 'in', value: ['warning', 'critical'] }
          ],
          priority: 'low',
          enabled: false,
          createdAt: dayjs().subtract(5, 'day'),
          lastTriggered: dayjs().subtract(6, 'hour'),
          triggerCount: 15
        },
        {
          key: 'ns_6',
          name: 'Platform Infrastructure Health',
          description: '平台基礎設施健康度告警策略',
          resourceGroup: { key: 'rg_monitoring', name: 'Monitoring' },
          team: { key: 'team_10', name: 'Platform Team' },
          channels: [
            { key: 'c_pagerduty_platform', name: 'Platform Team PagerDuty', type: 'PagerDuty' },
            { key: 'c_slack_platform', name: 'Platform Slack Channel', type: 'Slack' }
          ],
          conditions: [
            { field: 'service', operator: 'in', value: ['kubernetes', 'docker', 'consul'] },
            { field: 'health_score', operator: 'less_than', value: '80' },
            { field: 'severity', operator: 'not_equals', value: 'info' }
          ],
          priority: 'high',
          enabled: true,
          createdAt: dayjs().subtract(12, 'day'),
          lastTriggered: dayjs().subtract(45, 'minute'),
          triggerCount: 19
        }
      ];

      const [strategies, setStrategies] = useLocalStorageState('sre-notification-strategies', defaultStrategies);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingStrategy, setEditingStrategy] = useState(null);
      const [currentStep, setCurrentStep] = useState(1);
      const [selectedResourceGroup, setSelectedResourceGroup] = useState(null);
      const [selectedTeam, setSelectedTeam] = useState(null);
      const [selectedChannels, setSelectedChannels] = useState([]);
      const [matchConditions, setMatchConditions] = useState([]);
      const [strategyName, setStrategyName] = useState('');
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [manualTeamSelection, setManualTeamSelection] = useState(false);
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // 模擬數據
      const mockResourceGroups = [
        { key: 'rg_prod_db', name: 'Production-Database', description: '生產環境資料庫資源' },
        { key: 'rg_prod_web', name: 'Production-Web', description: '生產環境Web服務資源' },
        { key: 'rg_staging', name: 'Staging', description: '測試環境資源' },
        { key: 'rg_monitoring', name: 'Monitoring', description: '監控系統資源' }
      ];

      const mockTeams = [
        { key: 'team_1', name: 'Developers', description: '負責開發與維護的核心團隊' },
        { key: 'team_2', name: 'Viewers', description: '僅有檢視權限的觀察員' },
        { key: 'team_3', name: 'Administrators', description: '平台最高權限管理者' },
        { key: 'team_4', name: 'QA Team', description: '品質保證與測試團隊' },
        { key: 'team_5', name: 'DevOps Team', description: '負責CI/CD和基礎設施自動化的團隊' },
        { key: 'team_6', name: 'Database Team', description: '負責資料庫管理與優化的團隊' },
        { key: 'team_7', name: 'Network Team', description: '負責網路基礎設施與安全的團隊' },
        { key: 'team_8', name: 'Security Team', description: '負責資訊安全與合規的團隊' },
        { key: 'team_9', name: 'Operations Team', description: '負責系統運營與監控的團隊' },
        { key: 'team_10', name: 'Platform Team', description: '負責平台架構與技術基礎設施的團隊' }
      ];

      const mockChannels = [
        { key: 'c_pagerduty_db', name: 'Database Team PagerDuty', type: 'PagerDuty', team: 'team_6' },
        { key: 'c_slack_db', name: 'Database Slack Channel', type: 'Slack', team: 'team_6' },
        { key: 'c_pagerduty_ops', name: 'Operations Team PagerDuty', type: 'PagerDuty', team: 'team_9' },
        { key: 'c_slack_ops', name: 'Operations Slack Channel', type: 'Slack', team: 'team_9' },
        { key: 'c_email_devops', name: 'DevOps Email', type: 'Email', team: 'team_5' },
        { key: 'c_pagerduty_network', name: 'Network Team PagerDuty', type: 'PagerDuty', team: 'team_7' },
        { key: 'c_slack_network', name: 'Network Slack Channel', type: 'Slack', team: 'team_7' },
        { key: 'c_email_security', name: 'Security Email', type: 'Email', team: 'team_8' },
        { key: 'c_pagerduty_platform', name: 'Platform Team PagerDuty', type: 'PagerDuty', team: 'team_10' },
        { key: 'c_slack_platform', name: 'Platform Slack Channel', type: 'Slack', team: 'team_10' }
      ];

      const showModal = (strategy = null) => {
        setEditingStrategy(strategy);
        setCurrentStep(1);
        setSelectedResourceGroup(null);
        setSelectedTeam(null);
        setSelectedChannels([]);
        setMatchConditions([]);
        setStrategyName(strategy ? strategy.name : '');
        setManualTeamSelection(false);
        setIsModalOpen(true);
      };

      const handleCancel = () => {
        setIsModalOpen(false);
        setEditingStrategy(null);
        resetForm();
      };

      const resetForm = () => {
        setCurrentStep(1);
        setSelectedResourceGroup(null);
        setSelectedTeam(null);
        setSelectedChannels([]);
        setMatchConditions([]);
        setStrategyName('');
        setManualTeamSelection(false);
      };

      const handleResourceGroupSelect = (resourceGroupKey) => {
        const resourceGroup = mockResourceGroups.find(rg => rg.key === resourceGroupKey);
        setSelectedResourceGroup(resourceGroup);

        // 根據資源群組自動建議團隊（模擬邏輯）
        if (resourceGroupKey === 'rg_prod_db') {
          setSelectedTeam(mockTeams.find(t => t.key === 'team_6'));
          setSelectedChannels(mockChannels.filter(c => c.team === 'team_6'));
        } else if (resourceGroupKey === 'rg_prod_web') {
          setSelectedTeam(mockTeams.find(t => t.key === 'team_9'));
          setSelectedChannels(mockChannels.filter(c => c.team === 'team_9'));
        } else if (resourceGroupKey === 'rg_monitoring') {
          setSelectedTeam(mockTeams.find(t => t.key === 'team_9'));
          setSelectedChannels(mockChannels.filter(c => c.team === 'team_9'));
        } else {
          setSelectedTeam(mockTeams.find(t => t.key === 'team_5'));
          setSelectedChannels(mockChannels.filter(c => c.team === 'team_5'));
        }
      };

      const handleTeamSelect = (teamKey) => {
        const team = mockTeams.find(t => t.key === teamKey);
        setSelectedTeam(team);
        setSelectedChannels(mockChannels.filter(c => c.team === teamKey));
      };

      const addMatchCondition = () => {
        setMatchConditions([...matchConditions, { key: '', operator: '=', value: '' }]);
      };

      const updateMatchCondition = (index, field, value) => {
        const newConditions = [...matchConditions];
        newConditions[index] = { ...newConditions[index], [field]: value };
        setMatchConditions(newConditions);
      };

      const removeMatchCondition = (index) => {
        setMatchConditions(matchConditions.filter((_, i) => i !== index));
      };

      const handleCreateStrategy = () => {
        if (!selectedResourceGroup || !selectedTeam || selectedChannels.length === 0) {
          message.error('請完成所有必要設定');
          return;
        }

        const strategy = {
          key: editingStrategy ? editingStrategy.key : `ns_${Date.now()}`,
          name: strategyName || `${selectedResourceGroup.name} 通知策略`,
          resourceGroup: selectedResourceGroup,
          team: selectedTeam,
          channels: selectedChannels,
          matchConditions: matchConditions.filter(cond => cond.key && cond.value),
          createdAt: editingStrategy ? editingStrategy.createdAt : dayjs(),
          enabled: true
        };

        if (editingStrategy) {
          setStrategies(strategies.map(s => s.key === editingStrategy.key ? strategy : s));
          message.success('通知策略更新成功');
        } else {
          setStrategies([...strategies, strategy]);
          message.success('通知策略建立成功');
        }

        handleCancel();
      };

      const handleDelete = (strategy) => {
        confirmDelete('通知策略', () => {
          setStrategies(strategies.filter(s => s.key !== strategy.key));
        }, `策略 "${strategy.name}"`);
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `確定要刪除 ${selectedRowKeys.length} 條策略嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setStrategies(strategies.filter(s => !selectedRowKeys.includes(s.key)));
            setSelectedRowKeys([]);
            message.success('批次刪除成功');
          }
        });
      };

      const handleToggleEnabled = (strategyKey, enabled) => {
        setStrategies(strategies.map(strategy =>
          strategy.key === strategyKey
            ? { ...strategy, enabled }
            : strategy
        ));
        message.success(`通知策略已${enabled ? '啟用' : '停用'}`);
      };

      const columns = [
        {
          title: '啟用',
          dataIndex: 'enabled',
          width: '8%',
          render: (enabled, record) => (
            <Switch
              checked={enabled}
              onChange={(checked) => handleToggleEnabled(record.key, checked)}
            />
          )
        },
        { title: '策略名稱', dataIndex: 'name', sorter: (a, b) => a.name.localeCompare(b.name) },
        { title: '資源群組', dataIndex: 'resourceGroup', render: rg => rg?.name, sorter: (a, b) => a.resourceGroup?.name.localeCompare(b.resourceGroup?.name) },
        { title: '負責團隊', dataIndex: 'team', render: team => team?.name, sorter: (a, b) => a.team?.name.localeCompare(b.team?.name) },
        { title: '通知管道數', dataIndex: 'channels', render: channels => channels?.length || 0, sorter: (a, b) => (a.channels?.length || 0) - (b.channels?.length || 0) },
        {
          title: '操作',
          key: 'action',
          render: (_, record) => (
            <Space>
              <Tooltip title="編輯">
                <Button type="text" icon={<EditOutlined />} onClick={() => showModal(record)} />
              </Tooltip>
              <Tooltip title="刪除">
                <Button type="text" danger icon={<DeleteOutlined />} onClick={() => handleDelete(record)} />
              </Tooltip>
            </Space>
          )
        }
      ];

      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;
      const filteredStrategies = strategies.filter(s =>
        s.name.toLowerCase().includes(searchText.toLowerCase()) ||
        s.resourceGroup?.name.toLowerCase().includes(searchText.toLowerCase()) ||
        s.team?.name.toLowerCase().includes(searchText.toLowerCase())
      );

      return (
        <React.Fragment>

          {/* 工具列 */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="搜尋策略名稱、群組或團隊..."
                onChange={e => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                篩選
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>匯出</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>
                新增通知策略
              </Button>
            </Space>
          </Space>

          <div className="table-wrapper">
            {strategies.length > 0 ? (
              <Table
                rowSelection={rowSelection}
                columns={columns}
                dataSource={filteredStrategies}
                rowKey="key"
                className="transparent-bg"
                pagination={{ pageSize: 10, position: ['bottomRight'], size: 'small' }}
                size="small"
              />
            ) : (
              <div style={{ padding: '40px 20px', textAlign: 'center' }}>
                <Empty description="尚無任何通知策略" />
              </div>
            )}
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>已選擇 <span className="batch-count">{selectedRowKeys.length}</span> 項</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>批次刪除</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          {/* 新增/編輯通知策略模態框 */}
          <Modal
            title={null}
            open={isModalOpen}
            onCancel={handleCancel}
            width={900}
            footer={null}
            centered
            className="notification-strategy-modal"
            style={{
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
              borderRadius: '12px'
            }}
          >
            {/* Modal Header */}
            <div className="modal-header" style={{
              borderBottom: '1px solid rgba(255, 255, 255, 0.08)',
              paddingBottom: '20px',
              marginBottom: '20px'
            }}>
              <Title level={3} style={{ margin: 0, color: 'var(--text-primary)' }}>
                {editingStrategy ? '編輯通知策略' : '新增通知策略'}
              </Title>
              <Paragraph type="secondary" style={{ marginBottom: 0, marginTop: 8 }}>
                {currentStep === 1 && '選擇資源群組，決定監控範圍'}
                {currentStep === 2 && '設定通知管道，選擇負責團隊和管道'}
                {currentStep === 3 && '新增匹配條件，設定額外過濾條件'}
              </Paragraph>
            </div>

            {/* Steps Navigation */}
            <div className="steps-container" style={{
              marginBottom: '32px',
            }}>
              <div style={{ marginBottom: '16px', textAlign: 'center' }}>
                <Text style={{ fontSize: '12px', color: 'rgba(255,255,255,0.6)' }}>
                  💡 點擊任一步驟即可直接跳轉編輯
                </Text>
              </div>
              <div className="steps" style={{
                display: 'flex',
                position: 'relative'
              }}>
                {[
                  { step: 1, label: '選擇資源群組', icon: '🎯', subtitle: '決定監控範圍' },
                  { step: 2, label: '設定通知管道', icon: '👥', subtitle: '選擇負責團隊和管道' },
                  { step: 3, label: '新增匹配條件', icon: '⚙️', subtitle: '設定額外過濾條件' }
                ].map(({ step, label, icon, subtitle }) => {
                  const isActive = currentStep === step;
                  const isCompleted = currentStep > step;

                  return (
                    <div
                      key={step}
                      className="step-item"
                      onClick={() => setCurrentStep(step)}
                      style={{
                        flex: 1,
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        gap: '8px',
                        cursor: 'pointer',
                        position: 'relative',
                        zIndex: 1
                      }}
                    >
                      <div
                        className="step-indicator"
                        style={{
                          width: '50px',
                          height: '50px',
                          borderRadius: '50%',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          background: isActive ? 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)' :
                            isCompleted ? 'rgba(52, 168, 83, 0.9)' : 'rgba(255, 255, 255, 0.08)',
                          border: `2px solid ${isActive ? 'transparent' :
                            isCompleted ? 'rgba(52, 168, 83, 0.6)' : 'rgba(255, 255, 255, 0.2)'
                            }`,
                          fontSize: '20px',
                          transition: 'all 0.3s ease',
                          boxShadow: isActive ? '0 0 20px rgba(24, 144, 255, 0.4)' : 'none'
                        }}
                      >
                        {isCompleted ? '✓' : step}
                      </div>
                      <div style={{ textAlign: 'center' }}>
                        <div style={{
                          fontSize: '13px',
                          color: isActive ? '#1890ff' : isCompleted ? '#52a853' : 'rgba(255, 255, 255, 0.85)',
                          fontWeight: isActive ? '600' : '500',
                          transition: 'all 0.3s ease',
                          marginBottom: '2px'
                        }}>
                          {label}
                        </div>
                        <div style={{
                          fontSize: '11px',
                          color: 'rgba(255, 255, 255, 0.5)',
                          lineHeight: '1.2'
                        }}>
                          {subtitle}
                        </div>
                      </div>
                    </div>
                  );
                })}
                {/* Progress line */}
                <div
                  style={{
                    position: 'absolute',
                    top: '25px',
                    left: '25px',
                    right: '25px',
                    height: '2px',
                    background: 'rgba(255, 255, 255, 0.08)',
                    zIndex: 0
                  }}
                >
                  <div
                    style={{
                      position: 'absolute',
                      top: 0,
                      left: 0,
                      height: '100%',
                      width: `${((currentStep - 1) / 2) * 100}%`,
                      background: 'linear-gradient(90deg, #52a853 0%, #1890ff 100%)',
                      transition: 'width 0.3s ease'
                    }}
                  />
                </div>
              </div>
            </div>

            {/* Step Content Container */}
            <div className="step-content" style={{
              minHeight: '400px',
              position: 'relative',
              overflow: 'hidden',
              padding: '24px 0'
            }}>

              {/* 第1步：選擇資源群組 */}
              {currentStep === 1 && (
                <div style={{ padding: '0 20px' }}>
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '12px',
                    padding: '24px',
                    marginBottom: '24px'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
                      <div style={{
                        width: '8px',
                        height: '32px',
                        background: 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)',
                        borderRadius: '4px',
                        marginRight: '12px'
                      }} />
                      <Title level={4} style={{ margin: 0, color: 'var(--text-primary)' }}>
                        第一步：選擇您關心的範圍
                      </Title>
                    </div>

                    <Row gutter={[24, 16]}>
                      <Col span={24}>
                        <Form.Item
                          label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>資源群組</span>}
                          rules={[{ required: true, message: '請選擇資源群組' }]}
                        >
                          <Select
                            placeholder="請選擇一個資源群組..."
                            style={{
                              width: '100%',
                              height: '48px'
                            }}
                            value={selectedResourceGroup?.key}
                            onChange={handleResourceGroupSelect}
                          >
                            {mockResourceGroups.map(rg => (
                              <Select.Option key={rg.key} value={rg.key}>
                                <div style={{ padding: '4px 0' }}>
                                  <div style={{
                                    fontWeight: '500',
                                    fontSize: '14px',
                                    color: 'var(--text-primary)',
                                    lineHeight: '1.4',
                                    marginBottom: '2px'
                                  }}>
                                    {rg.name}
                                  </div>
                                  <div style={{
                                    fontSize: '12px',
                                    color: 'var(--text-tertiary)',
                                    lineHeight: '1.3'
                                  }}>
                                    {rg.description}
                                  </div>
                                </div>
                              </Select.Option>
                            ))}
                          </Select>
                        </Form.Item>
                      </Col>
                      <Col span={24}>
                        <Form.Item label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>策略名稱</span>}>
                          <Input
                            placeholder="自動生成或自訂名稱"
                            style={{ height: '48px' }}
                            value={strategyName}
                            onChange={e => setStrategyName(e.target.value)}
                          />
                        </Form.Item>
                      </Col>
                    </Row>
                  </div>
                </div>
              )}

              {/* 第2步：設定通知管道 */}
              {currentStep === 2 && selectedResourceGroup && (
                <div>
                  <div style={{ marginBottom: '24px' }}>
                    <Text strong style={{ fontSize: '16px', color: 'rgba(255, 255, 255, 0.9)' }}>
                      第二步：選擇通知管道
                    </Text>
                  </div>

                  {/* 系統建議 */}
                  {selectedTeam && !manualTeamSelection && (
                    <div style={{ marginBottom: '16px', padding: '12px', background: 'rgba(24, 144, 255, 0.1)', borderRadius: '6px', border: '1px solid rgba(24, 144, 255, 0.2)' }}>
                      <Text style={{ color: 'rgba(24, 144, 255, 0.9)' }}>
                        💡 系統建議：此資源群組由 <strong>{selectedTeam.name}</strong> 團隊負責
                      </Text>
                    </div>
                  )}

                  {/* 負責團隊選擇 */}
                  {(!selectedTeam || manualTeamSelection) && (
                    <Form.Item label="負責團隊" rules={[{ required: true, message: '請選擇負責團隊' }]}>
                      <Select
                        placeholder="選擇負責團隊"
                        style={{ width: '100%' }}
                        value={selectedTeam?.key}
                        onChange={handleTeamSelect}
                      >
                        {mockTeams.map(team => (
                          <Select.Option key={team.key} value={team.key}>
                            {team.name} - {team.description}
                          </Select.Option>
                        ))}
                      </Select>
                    </Form.Item>
                  )}

                  {/* 通知管道選擇 */}
                  {selectedTeam && (
                    <Form.Item label="通知管道" rules={[{ required: true, message: '請選擇至少一個通知管道' }]}>
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                        {mockChannels
                          .filter(channel => channel.team === selectedTeam.key)
                          .map(channel => (
                            <div key={channel.key} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                              <Checkbox
                                checked={selectedChannels.some(c => c.key === channel.key)}
                                onChange={(e) => {
                                  if (e.target.checked) {
                                    setSelectedChannels([...selectedChannels, channel]);
                                  } else {
                                    setSelectedChannels(selectedChannels.filter(c => c.key !== channel.key));
                                  }
                                }}
                              />
                              <Tag color={
                                channel.type === 'PagerDuty' ? 'red' :
                                  channel.type === 'Slack' ? 'blue' : 'green'
                              }>
                                {channel.type}
                              </Tag>
                              <Text style={{ color: 'rgba(255, 255, 255, 0.8)' }}>
                                {channel.name}
                              </Text>
                            </div>
                          ))}
                      </div>
                    </Form.Item>
                  )}

                  {/* 手動選擇其他團隊的連結 */}
                  {!manualTeamSelection && (
                    <div style={{ marginTop: '12px' }}>
                      <Button
                        type="link"
                        size="small"
                        onClick={() => setManualTeamSelection(true)}
                        style={{ padding: 0, fontSize: '12px' }}
                      >
                        手動選擇其他團隊?
                      </Button>
                    </div>
                  )}
                </div>
              )}

              {/* 第3步：新增匹配條件 */}
              {currentStep === 3 && (
                <div>
                  <div style={{ marginBottom: '24px' }}>
                    <Text strong style={{ fontSize: '16px', color: 'rgba(255, 255, 255, 0.9)' }}>
                      第三步：新增更多匹配條件 (可選)
                    </Text>
                    <br />
                    <Text style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                      除了資源群組外，還可以設定額外的標籤匹配條件
                    </Text>
                  </div>

                  <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                    {matchConditions.map((condition, index) => (
                      <div key={index} style={{ display: 'flex', alignItems: 'center', gap: '8px', padding: '8px', background: 'rgba(0,0,0,0.2)', borderRadius: '6px' }}>
                        <Text style={{ color: 'rgba(255, 255, 255, 0.7)', fontSize: '12px', minWidth: '60px' }}>
                          且 (AND)
                        </Text>
                        <Select
                          placeholder="選擇標籤"
                          style={{ width: '120px', flexShrink: 0 }}
                          value={condition.key}
                          onChange={value => updateMatchCondition(index, 'key', value)}
                        >
                          <Select.Option value="severity">severity</Select.Option>
                          <Select.Option value="alert_name">alert_name</Select.Option>
                          <Select.Option value="instance">instance</Select.Option>
                          <Select.Option value="service">service</Select.Option>
                        </Select>
                        <Select
                          style={{ width: '80px', flexShrink: 0 }}
                          value={condition.operator}
                          onChange={value => updateMatchCondition(index, 'operator', value)}
                        >
                          <Select.Option value="=">=</Select.Option>
                          <Select.Option value="!=">!=</Select.Option>
                          <Select.Option value="~">~</Select.Option>
                          <Select.Option value="!~">!~</Select.Option>
                        </Select>
                        <Input
                          placeholder="匹配值"
                          style={{ flex: 1 }}
                          value={condition.value}
                          onChange={e => updateMatchCondition(index, 'value', e.target.value)}
                        />
                        <Button
                          type="text"
                          danger
                          icon={<DeleteOutlined />}
                          onClick={() => removeMatchCondition(index)}
                        />
                      </div>
                    ))}

                    <Button
                      type="dashed"
                      onClick={addMatchCondition}
                      icon={<PlusOutlined />}
                      style={{ borderColor: 'rgba(255, 255, 255, 0.3)' }}
                    >
                      新增匹配條件
                    </Button>
                  </div>
                </div>
              )}

            </div>

            {/* 底部按鈕區域 */}
            <div className="modal-footer">
              <div>
                {currentStep > 1 && (
                  <Button
                    onClick={() => setCurrentStep(currentStep - 1)}
                  >
                    上一步
                  </Button>
                )}
              </div>
              <div>
                <Button
                  onClick={handleCancel}
                >
                  取消
                </Button>
                {currentStep < 3 && (
                  <Button
                    type="primary"
                    onClick={() => {
                      if (currentStep === 1 && !selectedResourceGroup) {
                        message.warning('請先選擇資源群組');
                        return;
                      }
                      if (currentStep === 2 && (!selectedTeam || selectedChannels.length === 0)) {
                        message.warning('請選擇負責團隊和通知管道');
                        return;
                      }
                      setCurrentStep(currentStep + 1);
                    }}
                  >
                    下一步
                  </Button>
                )}
                {currentStep === 3 && (
                  <Button
                    type="primary"
                    onClick={handleCreateStrategy}
                  >
                    {editingStrategy ? '更新策略' : '建立策略'}
                  </Button>
                )}
              </div>
            </div>
          </Modal>
        </React.Fragment >
      );
    };

    const SilencesPage = () => {
      const initialSilences = [
        {
          key: 's_1',
          name: '週末例行維護',
          description: '資料庫例行維護，預期會有短暫連線中斷',
          type: 'recurring',
          recurringPattern: 'weekly',
          weekdays: [6, 0], // 週六日
          timeSlot: ['02:00', '04:00'],
          validUntil: dayjs().add(6, 'month'),
          creator: 'admin',
          matchers: [
            { key: 'resource_group', op: '=', value: 'Production Database' },
            { key: 'resource_tag', op: '=', value: 'database' }
          ],
          enabled: true
        },
      ];

      const [silences, setSilences] = useLocalStorageState('sre-silences-v2', initialSilences);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingSilence, setEditingSilence] = useState(null);
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [currentStep, setCurrentStep] = useState(0);
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      const steps = [
        { title: '基本資訊', description: '設定規則名稱和描述' },
        { title: '設定排程', description: '設定靜音生效的時間' },
        { title: '設定範圍', description: '設定要靜音的事件條件' }
      ];

      const showModal = (silence = null) => {
        setEditingSilence(silence);
        setCurrentStep(0);
        form.setFieldsValue(silence || { matchers: [{}], enabled: true, type: 'once' });
        setIsModalOpen(true);
      };

      const handleCancel = () => {
        setIsModalOpen(false);
        setEditingSilence(null);
        form.resetFields();
      };

      const onFinish = (values) => {
        const newSilence = { ...values, key: editingSilence ? editingSilence.key : `s_${Date.now()}`, creator: editingSilence ? editingSilence.creator : 'admin' };
        if (editingSilence) {
          setSilences(silences.map(s => s.key === editingSilence.key ? newSilence : s));
        } else {
          setSilences([newSilence, ...silences]);
        }
        message.success(`靜音規則${editingSilence ? '更新' : '新增'}成功`);
        handleCancel();
      };

      const handleDelete = (key) => {
        confirmDelete('靜音規則', () => setSilences(silences.filter(s => s.key !== key)));
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `確定要刪除 ${selectedRowKeys.length} 條靜音規則嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setSilences(silences.filter(s => !selectedRowKeys.includes(s.key)));
            setSelectedRowKeys([]);
            message.success('批次刪除成功');
          }
        });
      };

      const columns = [
        { title: '啟用', dataIndex: 'enabled', width: '8%', render: (enabled, record) => <Switch checked={enabled} onChange={(checked) => setSilences(silences.map(s => s.key === record.key ? { ...s, enabled: checked } : s))} /> },
        { title: '名稱', dataIndex: 'name', width: '20%' },
        { title: '狀態', key: 'status', width: '10%', render: (_, record) => <Tag>生效中</Tag> },
        { title: '類型', dataIndex: 'type', width: '10%', render: (type) => <Tag>{type}</Tag> },
        { title: '匹配條件', dataIndex: 'matchers', width: '25%', render: (matchers) => <span>{matchers.length} 個條件</span> },
        { title: '排程', key: 'schedule', width: '15%' },
        { title: '操作', key: 'action', width: '12%', align: 'center', render: (_, record) => <TableRowActions onEdit={() => showModal(record)} onDelete={() => handleDelete(record.key)} /> }
      ];

      const onSelectChange = (keys) => setSelectedRowKeys(keys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange };

      const filteredSilences = silences.filter(s => s.name.toLowerCase().includes(searchText.toLowerCase()));

      return (
        <React.Fragment>
          <div className="toolbar-actions">
            <div className="toolbar-group">
              <Input.Search placeholder="搜尋規則名稱..." onChange={e => setSearchText(e.target.value)} style={{ width: 300 }} allowClear />
            </div>
            <div className="toolbar-group">
              <PlatformButton variant="primary" icon={<PlusOutlined />} onClick={() => showModal()}>新增規則</PlatformButton>
            </div>
          </div>

          <PlatformTableContainer>
            <Table rowSelection={rowSelection} columns={columns} dataSource={filteredSilences} rowKey="key" size="small" />
          </PlatformTableContainer>

          <BatchActionToolbar selectedCount={selectedRowKeys.length} onClear={() => setSelectedRowKeys([])} actions={[{ text: '批次刪除', variant: 'danger', icon: <DeleteOutlined />, onClick: handleBatchDelete }]} />

          <PlatformModal title={editingSilence ? '編輯靜音規則' : '新增靜音規則'} visible={isModalOpen} onClose={handleCancel} width={900} footer={
            <ModalActions
              onCancel={handleCancel}
              onConfirm={currentStep === steps.length - 1 ? () => form.submit() : () => setCurrentStep(currentStep + 1)}
              confirmText={currentStep === steps.length - 1 ? '完成' : '下一步'}
              customActions={currentStep > 0 ? [<PlatformButton onClick={() => setCurrentStep(currentStep - 1)}>上一步</PlatformButton>] : []}
            />
          }>
            <Steps current={currentStep} items={steps.map(s => ({ title: s.title }))} style={{ marginBottom: 24 }} />
            <Form form={form} layout="vertical" onFinish={onFinish}>
              <div style={{ display: currentStep === 0 ? 'block' : 'none' }}>
                <SettingsSection title="基本資訊">
                  <SettingsFormRow label="規則名稱" required><Form.Item name="name" noStyle rules={[{ required: true }]}><Input /></Form.Item></SettingsFormRow>
                  <SettingsFormRow label="描述"><Form.Item name="description" noStyle><TextArea rows={2} /></Form.Item></SettingsFormRow>
                </SettingsSection>
              </div>
              <div style={{ display: currentStep === 1 ? 'block' : 'none' }}>
                <SettingsSection title="設定排程">...</SettingsSection>
              </div>
              <div style={{ display: currentStep === 2 ? 'block' : 'none' }}>
                <SettingsSection title="設定範圍">...</SettingsSection>
              </div>
            </Form>
          </PlatformModal>
        </React.Fragment >
      );
    };

    const ScriptsPage = ({ scripts, setScripts, addExecution }) => {
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingScript, setEditingScript] = useState(null);
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      const showModal = (script = null) => {
        setEditingScript(script);
        form.setFieldsValue(script || { name: '', type: 'Python', description: '', code: '' });
        setIsModalOpen(true);
      };

      const handleCancel = () => setIsModalOpen(false);

      const onFinish = (values) => {
        if (editingScript) {
          setScripts(scripts.map(s => s.key === editingScript.key ? { ...s, ...values } : s));
          message.success('腳本更新成功');
        } else {
          const newScript = { ...values, key: `s_${Date.now()}`, creator: 'admin' };
          setScripts([newScript, ...scripts]);
          message.success('腳本新增成功');
        }
        handleCancel();
      };

      const handleRun = (script) => {
        modal.confirm({
          title: `確定要執行腳本 "${script.name}" 嗎?`,
          icon: <PlayCircleOutlined />,
          onOk: () => {
            message.loading({ content: '執行中...', key: 'run_script' });
            setTimeout(() => {
              addExecution({
                key: `e_${Date.now()}`,
                scriptName: script.name,
                trigger: { type: 'Manual', user: 'admin' },
                status: 'success',
                startTime: dayjs(),
                duration: `${(Math.random() * 5).toFixed(1)}s`
              });
              message.success({ content: '執行成功', key: 'run_script' });
            }, 1000);
          }
        })
      };

      const handleDelete = (key) => {
        confirmDelete('腳本', () => {
          setScripts(scripts.filter(s => s.key !== key));
        });
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `確定要刪除 ${selectedRowKeys.length} 個腳本嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setScripts(scripts.filter(s => !selectedRowKeys.includes(s.key)));
            setSelectedRowKeys([]);
            message.success('批次刪除成功');
          }
        });
      };

      const onSelectChange = (newSelectedRowKeys) => {
        setSelectedRowKeys(newSelectedRowKeys);
      };

      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };

      const columns = [
        { title: '腳本名稱', dataIndex: 'name', width: '25%' },
        { title: '類型', dataIndex: 'type', width: '12%', render: t => <Tag>{t}</Tag> },
        { title: '創建者', dataIndex: 'creator', width: '12%' },
        { title: '描述', dataIndex: 'description', width: '30%' },
        {
          title: '操作', key: 'action', width: '21%', align: 'center', render: (_, record) => (
            <TableRowActions
              onEdit={() => showModal(record)}
              onDelete={() => handleDelete(record.key)}
              customActions={[
                { icon: <PlayCircleOutlined style={{ color: 'var(--brand-success)' }} />, tooltip: '運行', onClick: () => handleRun(record) }
              ]}
            />
          )
        }
      ];

      return (
        <React.Fragment>
          <div className="toolbar-actions">
            <div className="toolbar-group">
              <Input.Search placeholder="搜尋腳本名稱或描述..." style={{ width: 300 }} allowClear />
            </div>
            <div className="toolbar-group">
              <PlatformButton variant="primary" icon={<PlusOutlined />} onClick={() => showModal()}>新增腳本</PlatformButton>
            </div>
          </div>

          <PlatformTableContainer>
            <Table rowSelection={rowSelection} columns={columns} dataSource={scripts} rowKey="key" size="small" />
          </PlatformTableContainer>

          <BatchActionToolbar selectedCount={selectedRowKeys.length} onClear={() => setSelectedRowKeys([])} actions={[{ text: '批次刪除', variant: 'danger', icon: <DeleteOutlined />, onClick: handleBatchDelete }]} />

          <PlatformModal title={editingScript ? '編輯腳本' : '新增腳本'} visible={isModalOpen} onClose={handleCancel} footer={<ModalActions onCancel={handleCancel} onConfirm={() => form.submit()} confirmText="儲存" />}>
            <Form form={form} layout="vertical" onFinish={onFinish} style={{ marginTop: 24 }}>
              <SettingsFormRow label="腳本名稱" required><Form.Item name="name" noStyle rules={[{ required: true }]}><Input /></Form.Item></SettingsFormRow>
              <SettingsFormRow label="類型" required><Form.Item name="type" noStyle rules={[{ required: true }]}><Select><Select.Option value="Python">Python</Select.Option><Select.Option value="Bash">Bash</Select.Option></Select></Form.Item></SettingsFormRow>
              <SettingsFormRow label="描述"><Form.Item name="description" noStyle><TextArea rows={2} /></Form.Item></SettingsFormRow>
              <SettingsFormRow label="腳本內容" required><Form.Item name="code" noStyle rules={[{ required: true }]}><TextArea rows={10} className="code-editor-like" /></Form.Item></SettingsFormRow>
            </Form>
          </PlatformModal>
        </React.Fragment >
      );
    };

    const SchedulesPage = ({ scripts }) => {
      const initialSchedules = [
        { key: 'sch_1', name: '每日資料庫備份', cron: '0 2 * * *', scriptId: 's_3', lastRun: dayjs().subtract(1, 'day').hour(2), lastStatus: 'success', enabled: true, creator: 'admin' },
        { key: 'sch_2', name: '每小時清理臨時文件', cron: '0 * * * *', scriptId: 's_2', lastRun: dayjs().subtract(30, 'minute'), lastStatus: 'failed', enabled: false, creator: 'dev_user' },
      ];
      const [schedules, setSchedules] = useLocalStorageState('sre-schedules', initialSchedules);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingSchedule, setEditingSchedule] = useState(null);
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();

      const handleDelete = (key) => {
        modal.confirm({
          title: '確定要刪除此排程嗎？',
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setSchedules(schedules.filter(s => s.key !== key));
            message.success('排程刪除成功');
          }
        });
      };

      const showModal = (schedule = null) => {
        setEditingSchedule(schedule);
        form.setFieldsValue(schedule || { name: '', description: '', cron: '0 * * * *', enabled: true, scheduleTime: dayjs().hour(2).minute(0), minuteInterval: 5 });
        setIsModalOpen(true);
      };
      const handleCancel = () => setIsModalOpen(false);
      const onFinish = (values) => {
        message.success(editingSchedule ? '排程更新成功' : '排程新增成功');
        handleCancel();
      };

      const onSelectChange = (newSelectedRowKeys) => {
        setSelectedRowKeys(newSelectedRowKeys);
      };

      const rowSelection = { selectedRowKeys, onChange: onSelectChange };

      const columns = [
        { title: '啟用', dataIndex: 'enabled', width: '5%', render: e => <Switch defaultChecked={e} /> },
        { title: '任務名稱', dataIndex: 'name', width: '15%' },
        { title: '腳本名稱', dataIndex: 'scriptId', width: '10%', render: id => scripts.find(s => s.key === id)?.name || '未知腳本' },
        { title: 'CRON 條件', dataIndex: 'cron', width: '10%' },
        { title: '上次狀態', dataIndex: 'lastStatus', width: '10%', render: status => <Tag color={status === 'success' ? 'green' : 'red'}>{status.toUpperCase()}</Tag> },
        { title: '上次執行時間', dataIndex: 'lastRun', width: '12%', render: lastRun => lastRun ? lastRun.format('MM-DD HH:mm') : '-' },
        { title: '下次執行', dataIndex: 'cron', width: '12%', render: cron => dayjs().add(1, 'hour').format('MM-DD HH:mm') },
        { title: '操作', key: 'action', width: '26%', align: 'center', render: (_, record) => <TableRowActions onEdit={() => showModal(record)} onDelete={() => handleDelete(record.key)} /> }
      ];

      return (
        <React.Fragment>
          <div className="toolbar-actions">
            <div className="toolbar-group">
              <Input.Search placeholder="搜尋排程名稱或描述..." style={{ width: 300 }} allowClear />
            </div>
            <div className="toolbar-group">
              <PlatformButton variant="primary" icon={<PlusOutlined />} onClick={() => showModal()}>新增排程</PlatformButton>
            </div>
          </div>

          <PlatformTableContainer>
            <Table rowSelection={rowSelection} columns={columns} dataSource={schedules} rowKey="key" size="small" />
          </PlatformTableContainer>

          <BatchActionToolbar selectedCount={selectedRowKeys.length} onClear={() => setSelectedRowKeys([])} actions={[{ text: '批次刪除', variant: 'danger', icon: <DeleteOutlined />, onClick: () => { } }]} />

          <PlatformModal title={editingSchedule ? '編輯排程' : '新增排程'} visible={isModalOpen} onClose={handleCancel} width={600} footer={<ModalActions onCancel={handleCancel} onConfirm={() => form.submit()} confirmText="儲存" />}>
            <Form form={form} layout="vertical" onFinish={onFinish} style={{ marginTop: 24 }}>
              <SettingsFormRow label="任務名稱" required><Form.Item name="name" noStyle rules={[{ required: true }]}><Input /></Form.Item></SettingsFormRow>
              <SettingsFormRow label="描述"><Form.Item name="description" noStyle><TextArea rows={2} /></Form.Item></SettingsFormRow>
              <SettingsFormRow label="執行腳本" required><Form.Item name="scriptId" noStyle rules={[{ required: true }]}><Select showSearch options={scripts.map(s => ({ label: s.name, value: s.key }))} /></Form.Item></SettingsFormRow>
            </Form>
          </PlatformModal>
        </React.Fragment >
      );
    };

    const ExecutionsPage = ({ executions, setExecutions }) => {
      const [logModal, setLogModal] = useState({ open: false, log: '', structuredLogs: [], record: null });
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);

      const viewLog = (record) => {
        const logContent = `[${dayjs().format('HH:mm:ss')}] INFO: Starting execution...\n[${dayjs().add(1, 'second').format('HH:mm:ss')}] INFO: Script completed successfully.`;
        setLogModal({ open: true, log: logContent, record: record });
      };

      const onSelectChange = (keys) => setSelectedRowKeys(keys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `確定要刪除 ${selectedRowKeys.length} 個執行日誌嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setExecutions(executions.filter(e => !selectedRowKeys.includes(e.key)));
            setSelectedRowKeys([]);
            message.success('批次刪除成功');
          }
        });
      };

      const columns = [
        { title: '狀態', dataIndex: 'status', render: s => <Tag color={s === 'success' ? 'green' : 'red'}>{s.toUpperCase()}</Tag> },
        { title: '腳本名稱', dataIndex: 'scriptName' },
        { title: '觸發方式', dataIndex: 'trigger', render: t => t.type === 'Manual' ? `手動 (${t.user})` : t.type },
        { title: '開始時間', dataIndex: 'startTime', render: t => t.format('YYYY-MM-DD HH:mm:ss') },
        { title: '執行耗時', dataIndex: 'duration' },
        { title: '操作', key: 'action', align: 'center', render: (_, record) => <TableRowActions customActions={[{ icon: <FileTextOutlined />, tooltip: '查看日誌', onClick: () => viewLog(record) }]} /> }
      ];

      return (
        <React.Fragment>
          <div className="toolbar-actions">
            <div className="toolbar-group">
              <Input.Search placeholder="搜尋腳本名稱或觸發者..." style={{ width: 300 }} allowClear />
            </div>
          </div>

          <PlatformTableContainer>
            <Table rowSelection={rowSelection} columns={columns} dataSource={executions} rowKey="key" size="small" />
          </PlatformTableContainer>

          <BatchActionToolbar selectedCount={selectedRowKeys.length} onClear={() => setSelectedRowKeys([])} actions={[{ text: '批次刪除', variant: 'danger', icon: <DeleteOutlined />, onClick: handleBatchDelete }]} />

          <PlatformModal title="執行日誌詳情" visible={logModal.open} onClose={() => setLogModal({ open: false, log: '' })} footer={<ModalActions onCancel={() => setLogModal({ open: false, log: '' })} onConfirm={() => navigator.clipboard.writeText(logModal.log)} confirmText="複製日誌" />}>
            <pre className="log-viewer">{logModal.log}</pre>
          </PlatformModal>
        </React.Fragment >
      );
    };

    const CapacityPlanningPage = ({ themeMode }) => {
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const [analysisResult, setAnalysisResult] = useState(null);
      const [isLoading, setIsLoading] = useState(false);
      const [confirmModal, setConfirmModal] = useState({ open: false, script: null });

      const mockResourceGroups = [
        { id: 'g_1', name: 'Production Database' },
        { id: 'g_2', name: 'Production Web Servers' },
      ];
      const mockMetrics = [
        { id: 'cpu_utilization', name: 'CPU 使用率 (%)' },
        { id: 'memory_usage', name: '記憶體使用率 (GB)' },
        { id: 'disk_space', name: '磁碟空間使用率 (%)' },
      ];
      const mockScripts = [
        { id: 's_1', name: 'Auto-scaling for Web Servers' },
        { id: 's_2', name: 'Increase Database Disk Volume' },
      ];

      const handleAnalysis = (values) => {
        setIsLoading(true);
        setAnalysisResult(null);
        setTimeout(() => {
          const historical = Array.from({ length: 30 }, (_, i) => {
            const date = dayjs().subtract(30 - i, 'days').format('YYYY-MM-DD');
            const value = 50 + i * 0.5 + Math.random() * 5;
            return [date, value.toFixed(2)];
          });

          const lastValue = parseFloat(historical[historical.length - 1][1]);
          const prediction = Array.from({ length: 90 }, (_, i) => {
            const date = dayjs().add(i + 1, 'days').format('YYYY-MM-DD');
            const value = lastValue + i * 0.3 + Math.random() * 2;
            return [date, value.toFixed(2)];
          });

          setAnalysisResult({
            key_metrics: { days_to_threshold: 45, threshold: 80, current_value: lastValue.toFixed(2), },
            chart_data: { historical, prediction },
            suggestions: [
              { text: '目前的資源增長趨勢穩定，但預計在 45 天後達到 80% 的警戒線。', actionable: false },
              { text: '建議執行擴容腳本，增加 2 個 Web Server 實例以應對預期流量增長。', actionable: true, action_type: '執行擴容腳本', action_target: { script_id: 's_1' } },
              { text: '考慮對資料庫進行垂直擴容，將實例類型升級至下一個級別。', actionable: false },
            ]
          });
          setIsLoading(false);
        }, 1500);
      };

      const handleActionClick = (suggestion) => {
        const script = mockScripts.find(s => s.id === suggestion.action_target.script_id);
        if (script) {
          setConfirmModal({ open: true, script: script });
        }
      };

      const handleConfirmOk = () => {
        message.loading({ content: '正在執行腳本...', key: 'exec' });
        setTimeout(() => {
          message.success({ content: `腳本 "${confirmModal.script.name}" 已成功執行`, key: 'exec' });
          setConfirmModal({ open: false, script: null });
        }, 1000);
      };

      const chartOption = analysisResult ? {
        backgroundColor: 'transparent',
        tooltip: { trigger: 'axis' },
        legend: { data: ['歷史數據', '預測趨勢'] },
        xAxis: {
          type: 'category',
          data: [
            ...analysisResult.chart_data.historical.map(d => d[0]),
            ...analysisResult.chart_data.prediction.map(d => d[0])
          ]
        },
        yAxis: {
          type: 'value',
          axisLabel: { formatter: '{value} %' }
        },
        series: [
          {
            name: '歷史數據',
            type: 'line',
            data: analysisResult.chart_data.historical,
            smooth: true
          },
          {
            name: '預測趨勢',
            type: 'line',
            data: [
              ...Array(Math.max(0, analysisResult.chart_data.historical.length - 1)).fill(null),
              analysisResult.chart_data.historical[analysisResult.chart_data.historical.length - 1],
              ...analysisResult.chart_data.prediction
            ].filter(item => item !== undefined),
            smooth: true,
            lineStyle: { type: 'dashed' }
          },
          {
            name: '警戒線',
            type: 'line',
            markLine: {
              silent: true,
              data: [{ yAxis: 80, name: '80% 警戒線' }],
              label: { position: 'end', formatter: '{b}', color: '#ff4d4f' },
              lineStyle: { color: '#ff4d4f' }
            }
          }
        ]
      } : {};

      return (
        <React.Fragment>
          <Form form={form} layout="inline" onFinish={handleAnalysis} style={{ marginBottom: 16, padding: '12px', background: 'rgba(0,0,0,0.2)', borderRadius: '8px' }}>
            <Form.Item name="resource_group" label="資源群組" rules={[{ required: true }]} initialValue="g_1" style={{ marginBottom: 4 }}>
              <Select className="select-xxl" placeholder="選擇資源群組" options={mockResourceGroups.map(g => ({ label: g.name, value: g.id }))} />
            </Form.Item>
            <Form.Item name="metric" label="效能指標" rules={[{ required: true }]} initialValue="cpu_utilization" style={{ marginBottom: 4 }}>
              <Select className="select-xxl" placeholder="選擇指標" options={mockMetrics.map(m => ({ label: m.name, value: m.id }))} />
            </Form.Item>
            <Form.Item name="period" label="預測期間" initialValue="90d" rules={[{ required: true }]} style={{ marginBottom: 4 }}>
              <Select className="select-lg">
                <Select.Option value="30d">30 天</Select.Option>
                <Select.Option value="60d">60 天</Select.Option>
                <Select.Option value="90d">90 天</Select.Option>
              </Select>
            </Form.Item>
            <Form.Item style={{ marginBottom: 4 }}>
              <Space>
                <Button type="primary" htmlType="submit" loading={isLoading}>開始分析</Button>
                <Button className="toolbar-btn" icon={<DownloadOutlined />}>匯出</Button>
              </Space>
            </Form.Item>
          </Form>

          <Spin spinning={isLoading} tip="正在進行數據分析與趨勢預測...">
            {analysisResult ? (
              <Row gutter={[16, 12]} align="stretch">
                <Col xs={24} md={8}>
                  <div style={{ display: 'flex', flexDirection: 'column', height: '320px', gap: '16px' }}>
                    {/* 目前使用率卡片 */}
                    <div style={{
                      flex: '1',
                      background: 'linear-gradient(135deg, rgba(24, 144, 255, 0.1) 0%, rgba(24, 144, 255, 0.05) 100%)',
                      border: '1px solid rgba(24, 144, 255, 0.2)',
                      borderRadius: '12px',
                      padding: '24px',
                      display: 'flex',
                      flexDirection: 'column',
                      justifyContent: 'center',
                      alignItems: 'center',
                      backdropFilter: 'blur(20px) saturate(180%)',
                      WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                      boxShadow: '0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                    }}>
                      <div style={{ fontSize: '14px', color: 'rgba(255, 255, 255, 0.7)', marginBottom: '8px' }}>目前使用率</div>
                      <div style={{ fontSize: '36px', fontWeight: 'bold', color: '#1890ff', marginBottom: '4px' }}>
                        {analysisResult.key_metrics.current_value}<span style={{ fontSize: '24px' }}>%</span>
                      </div>
                    </div>

                    {/* 警戒線卡片 */}
                    <div style={{
                      flex: '1',
                      background: 'linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%)',
                      border: '1px solid rgba(255, 193, 7, 0.2)',
                      borderRadius: '12px',
                      padding: '24px',
                      display: 'flex',
                      flexDirection: 'column',
                      justifyContent: 'center',
                      alignItems: 'center',
                      backdropFilter: 'blur(20px) saturate(180%)',
                      WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                      boxShadow: '0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                    }}>
                      <div style={{ fontSize: '14px', color: 'rgba(255, 255, 255, 0.7)', marginBottom: '8px' }}>預計達到 80% 警戒線</div>
                      <div style={{ fontSize: '36px', fontWeight: 'bold', color: '#ffc107', marginBottom: '4px' }}>
                        {analysisResult.key_metrics.days_to_threshold} <span style={{ fontSize: '16px' }}>天後</span>
                      </div>
                    </div>
                  </div>
                </Col>
                <Col xs={24} md={16}>
                  <div style={{
                    height: '320px',
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '12px',
                    padding: '24px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                  }}>
                    <Title level={5} style={{ margin: 0, marginBottom: 16, color: 'rgba(255, 255, 255, 0.85)' }}>趨勢預測圖</Title>
                    <div style={{ height: 'calc(100% - 40px)' }}>
                      <EchartsForReact option={chartOption} isDark={themeMode === 'dark'} />
                    </div>
                  </div>
                </Col>
                <Col xs={24}>
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '12px',
                    padding: '24px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)',
                    marginTop: '8px'
                  }}>
                    <Title level={5} style={{ margin: 0, marginBottom: 16, color: 'rgba(255, 255, 255, 0.85)', display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <RobotOutlined style={{ color: '#722ed1' }} />
                      分析與建議
                    </Title>
                    <List
                      size="small"
                      dataSource={analysisResult.suggestions}
                      renderItem={item => (
                        <List.Item
                          actions={item.actionable ? [
                            <Button
                              size="small"
                              type="primary"
                              icon={<ThunderboltOutlined />}
                              onClick={() => handleActionClick(item)}
                              style={{
                                background: 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)',
                                border: 'none',
                                borderRadius: '6px',
                                fontWeight: '500',
                                marginRight: 0
                              }}
                            >
                              {item.action_type}
                            </Button>
                          ] : []}
                        >
                          <List.Item.Meta description={<span style={{ color: 'rgba(255, 255, 255, 0.85)' }}>{item.text}</span>} />
                        </List.Item>
                      )}
                    />
                  </div>
                </Col>
              </Row>
            ) : (
              !isLoading && <div className="empty-analysis" style={{ marginTop: 8, textAlign: 'center' }}><Empty description="請選擇資源與指標以開始分析" /></div>
            )}
          </Spin>

          <Modal
            title="確認執行自動化腳本"
            open={confirmModal.open}
            onOk={handleConfirmOk}
            onCancel={() => setConfirmModal({ open: false, script: null })}
            okText="確認執行"
            cancelText="取消"
          >
            {confirmModal.script && <p>您確定要執行以下腳本嗎？<br /><strong>腳本名稱:</strong> {confirmModal.script.name}</p>}
          </Modal>
        </React.Fragment>
      );
    };

    // 共享的數據和工具函數
    const mockRoles = [
      { id: 'super_admin', name: '超級管理員', color: 'red' },
      { id: 'team_manager', name: '團隊管理員', color: 'orange' },
      { id: 'team_member', name: '團隊成員', color: 'blue' },
      { id: 'viewer', name: '唯讀用戶', color: 'gray' }
    ];


    const UserManagementPage = () => {
      const initialUsers = [
        { key: 'user_1', name: 'Admin User', email: 'admin@example.com', teams: ['team_3'], roles: ['super_admin'], status: 'active', lastLogin: dayjs().subtract(1, 'day'), createdAt: dayjs().subtract(30, 'day') },
        { key: 'user_2', name: 'Dev User', email: 'dev@example.com', teams: ['team_1'], roles: ['team_manager', 'team_member'], status: 'active', lastLogin: dayjs().subtract(2, 'hours'), createdAt: dayjs().subtract(15, 'day') },
        { key: 'user_3', name: 'View User', email: 'view@example.com', teams: ['team_2'], roles: ['viewer'], status: 'inactive', lastLogin: dayjs().subtract(7, 'day'), createdAt: dayjs().subtract(45, 'day') },
        { key: 'user_4', name: 'Ops User', email: 'ops@example.com', teams: ['team_1', 'team_3'], roles: ['team_member'], status: 'active', lastLogin: dayjs().subtract(30, 'minutes'), createdAt: dayjs().subtract(10, 'day') },
      ];

      const [users, setUsers] = useLocalStorageState('sre-users', initialUsers);
      const [isUserModalOpen, setIsUserModalOpen] = useState(false);
      const [editingUser, setEditingUser] = useState(null);
      const [userSearchText, setUserSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [userForm] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // 团队名称映射（在UserManagementPage中定义，避免依赖外部teams）
      const teamNameMap = {
        'team_1': 'Developers',
        'team_2': 'Viewers',
        'team_3': 'Administrators',
        'team_4': 'QA Team',
        'team_5': 'DevOps Team',
        'team_6': 'Database Team',
        'team_7': 'Network Team',
        'team_8': 'Security Team',
        'team_9': 'Operations Team',
        'team_10': 'Platform Team'
      };

      const getTeamNames = (teamIds) => teamIds.map(id => teamNameMap[id] || id);
      const getRoleNames = (roleIds) => roleIds.map(id => {
        const role = mockRoles.find(r => r.id === id);
        return role ? role.name : id;
      });

      // 用戶操作函數
      const showUserModal = (user = null) => {
        setEditingUser(user);
        userForm.setFieldsValue(user || { name: '', email: '', teams: [], roles: ['viewer'], status: 'active' });
        setIsUserModalOpen(true);
      };
      const handleUserCancel = () => {
        setIsUserModalOpen(false);
        setEditingUser(null);
        userForm.resetFields();
      };
      const handleUserFinish = (values) => {
        const newUser = {
          ...values,
          key: editingUser ? editingUser.key : `u_${Date.now()}`,
          createdAt: editingUser ? editingUser.createdAt : dayjs(),
          lastLogin: editingUser ? editingUser.lastLogin : null
        };
        if (editingUser) {
          setUsers(users.map(u => u.key === editingUser.key ? newUser : u));
          message.success('用戶更新成功');
        } else {
          setUsers([newUser, ...users]);
          message.success('用戶新增成功');
        }
        handleUserCancel();
      };
      const handleToggleUserStatus = (userKey, newStatus) => {
        const user = users.find(u => u.key === userKey);
        if (!user) return;

        // 檢查用戶當前狀態
        if (user.status === 'pending') {
          message.warning('待激活用戶無法直接切換狀態，請先激活用戶');
          return;
        }
        if (user.status === 'locked') {
          message.warning('鎖定用戶無法直接切換狀態，請聯繫管理員');
          return;
        }

        const statusText = newStatus === 'active' ? '啟用' : '停用';
        modal.confirm({
          title: `確定要${statusText}此用戶嗎？`,
          content: `${statusText}用戶 "${user.name}" 的帳號。${newStatus === 'inactive' ? '停用後用戶將無法登入系統，但保留所有權限設定。' : '啟用後用戶可以正常使用系統。'}`,
          okText: '確定',
          cancelText: '取消',
          onOk() {
            setUsers(users.map(u => u.key === userKey ? { ...u, status: newStatus } : u));
            message.success(`用戶${statusText}成功`);
          }
        });
      };

      const handleUserDelete = (user) => {
        confirmDelete('用戶', () => {
          setUsers(users.filter(u => u.key !== user.key));
        }, `用戶 "${user.name}"`);
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `確定要刪除 ${selectedRowKeys.length} 位用戶嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setUsers(users.filter(u => !selectedRowKeys.includes(u.key)));
            setSelectedRowKeys([]);
            message.success('批次刪除成功');
          }
        });
      };

      const userColumns = [
        {
          title: '啟用', key: 'enable', width: 80, render: (_, record) => (
            <Tooltip title={record.status === 'active' ? '停用用戶' : record.status === 'inactive' ? '啟用用戶' : '切換狀態'}>
              <Switch
                checked={record.status === 'active'}
                disabled={record.status === 'pending' || record.status === 'locked'}
                onChange={(checked) => handleToggleUserStatus(record.key, checked ? 'active' : 'inactive')}
              />
            </Tooltip>
          )
        },
        { title: '姓名', dataIndex: 'name', sorter: (a, b) => a.name.localeCompare(b.name) },
        { title: '電子郵件', dataIndex: 'email', sorter: (a, b) => a.email.localeCompare(b.email) },
        { title: '團隊', dataIndex: 'teams', render: ids => getTeamNames(ids).join(', ') },
        {
          title: '角色', dataIndex: 'roles', render: ids => ids.map(id => {
            const role = mockRoles.find(r => r.id === id);
            return <Tag key={id} color={role && role.color}>{getRoleNames([id])}</Tag>;
          })
        },
        { title: '最後登入', dataIndex: 'lastLogin', render: time => time ? time.fromNow() : '從未登入', sorter: (a, b) => (a.lastLogin || dayjs(0)).valueOf() - (b.lastLogin || dayjs(0)).valueOf() },
        {
          title: '管理', key: 'action', width: 120, render: (_, record) => (
            <Space>
              <Tooltip title="編輯">
                <Button type="text" icon={<EditOutlined />} onClick={() => showUserModal(record)} />
              </Tooltip>
              <Tooltip title="刪除">
                <Button type="text" danger icon={<DeleteOutlined />} onClick={() => handleUserDelete(record)} />
              </Tooltip>
            </Space>
          )
        }
      ];

      // 篩選用戶
      const filteredUsers = users.filter(user =>
        user.name.toLowerCase().includes(userSearchText.toLowerCase()) ||
        user.email.toLowerCase().includes(userSearchText.toLowerCase())
      );

      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      return (
        <React.Fragment>

          {/* 工具列 */}
          <div className="toolbar-actions">
            <div className="toolbar-group">
              <Input.Search
                placeholder="搜尋用戶姓名或電子郵件..."
                onChange={e => setUserSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <PlatformButton variant="secondary" icon={<FilterOutlined />}>
                篩選
              </PlatformButton>
            </div>
            <div className="toolbar-group">
              <PlatformButton variant="secondary" icon={<DownloadOutlined />}>匯出</PlatformButton>
              <PlatformButton variant="primary" icon={<PlusOutlined />} onClick={() => showUserModal()}>新增用戶</PlatformButton>
            </div>
          </div>
          <div className="table-wrapper">
            <Table
              rowSelection={rowSelection}
              dataSource={filteredUsers}
              columns={userColumns}
              rowKey="key"
              className="transparent-bg"
              pagination={{ pageSize: 10, position: ['bottomRight'] }}
              size="small"
            />
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>已選擇 <span className="batch-count">{selectedRowKeys.length}</span> 項</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>批次刪除</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          {/* 用戶編輯模態框 */}
          <Modal
            title={null}
            open={isUserModalOpen}
            onCancel={handleUserCancel}
            footer={null}
            width={700}
            centered
            className="user-edit-modal"
            style={{
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
              borderRadius: '12px'
            }}
          >
            {/* Modal Header */}
            <div className="modal-header" style={{
              borderBottom: '1px solid rgba(255, 255, 255, 0.08)',
              paddingBottom: '20px',
              marginBottom: '24px'
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                <div style={{
                  width: '48px',
                  height: '48px',
                  borderRadius: '50%',
                  background: 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  fontSize: '20px'
                }}>
                  👤
                </div>
                <div>
                  <Title level={3} style={{ margin: 0, color: 'var(--text-primary)' }}>
                    {editingUser ? '編輯用戶' : '新增用戶'}
                  </Title>
                  <Paragraph type="secondary" style={{ marginBottom: 0, marginTop: 4, fontSize: '13px' }}>
                    {editingUser ? '修改用戶基本資訊與權限設定' : '建立新用戶並設定基本資訊與權限'}
                  </Paragraph>
                </div>
              </div>
            </div>

            <Form form={userForm} layout="vertical" onFinish={handleUserFinish}>
              {/* 基本資訊區塊 */}
              <div style={{
                background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                border: '1px solid rgba(255, 255, 255, 0.08)',
                borderRadius: '12px',
                padding: '24px',
                marginBottom: '24px'
              }}>
                <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
                  <div style={{
                    width: '6px',
                    height: '24px',
                    background: 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)',
                    borderRadius: '3px',
                    marginRight: '12px'
                  }} />
                  <Title level={5} style={{ margin: 0, color: 'var(--text-primary)', fontWeight: '600' }}>
                    基本資訊
                  </Title>
                </div>

                <Row gutter={[24, 16]}>
                  <Col span={12}>
                    <Form.Item
                      name="name"
                      label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>用戶姓名</span>}
                      rules={[{ required: true, message: '請輸入用戶姓名' }]}
                    >
                      <Input
                        placeholder="請輸入用戶姓名"
                        style={{ height: '44px' }}
                        prefix={<UserOutlined style={{ color: 'var(--text-tertiary)' }} />}
                      />
                    </Form.Item>
                  </Col>
                  <Col span={12}>
                    <Form.Item
                      name="email"
                      label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>電子郵件</span>}
                      rules={[
                        { required: true, message: '請輸入電子郵件' },
                        { type: 'email', message: '請輸入有效的電子郵件地址' }
                      ]}
                    >
                      <Input
                        placeholder="請輸入電子郵件地址"
                        style={{ height: '44px' }}
                        prefix={<MailOutlined style={{ color: 'var(--text-tertiary)' }} />}
                      />
                    </Form.Item>
                  </Col>
                </Row>
              </div>

              {/* 權限設定區塊 */}
              <div style={{
                background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                border: '1px solid rgba(255, 255, 255, 0.08)',
                borderRadius: '12px',
                padding: '24px',
                marginBottom: '24px'
              }}>
                <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
                  <div style={{
                    width: '6px',
                    height: '24px',
                    background: 'linear-gradient(135deg, #52c41a 0%, #389e0d 100%)',
                    borderRadius: '3px',
                    marginRight: '12px'
                  }} />
                  <Title level={5} style={{ margin: 0, color: 'var(--text-primary)', fontWeight: '600' }}>
                    權限設定
                  </Title>
                </div>

                <Row gutter={[24, 16]}>
                  <Col span={12}>
                    <Form.Item
                      name="teams"
                      label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>所屬團隊</span>}
                    >
                      <Select
                        mode="multiple"
                        placeholder="請選擇所屬團隊"
                        style={{ minHeight: '44px' }}
                        options={Object.entries(teamNameMap).map(([key, name]) => ({ label: name, value: key }))}
                      />
                    </Form.Item>
                  </Col>
                  <Col span={12}>
                    <Form.Item
                      name="roles"
                      label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>角色</span>}
                      rules={[{ required: true, message: '請選擇至少一個角色' }]}
                    >
                      <Select
                        mode="multiple"
                        placeholder="請選擇用戶角色"
                        style={{ minHeight: '44px' }}
                        options={mockRoles.map(r => ({ label: r.name, value: r.id }))}
                      />
                    </Form.Item>
                  </Col>
                </Row>
              </div>

              {/* 底部按鈕區域 */}
              <div className="modal-footer">
                <div></div>
                <div>
                  <Button onClick={handleUserCancel}>
                    取消
                  </Button>
                  <Button type="primary" htmlType="submit">
                    {editingUser ? '更新用戶' : '新增用戶'}
                  </Button>
                </div>
              </div>
            </Form>
          </Modal>
        </React.Fragment >
      );
    };

    const TeamManagementPage = () => {
      const initialTeams = [
        { key: 'team_1', name: 'Developers', description: '負責開發與維護的核心團隊', members: ['user_2', 'user_4'], subscribers: ['user_1', 'slack_devops'], createdAt: dayjs().subtract(60, 'day'), owner: 'user_2' },
        { key: 'team_2', name: 'Viewers', description: '僅有檢視權限的觀察員', members: ['user_3'], subscribers: ['user_2'], createdAt: dayjs().subtract(45, 'day'), owner: 'user_1' },
        { key: 'team_3', name: 'Administrators', description: '平台最高權限管理者', members: ['user_1', 'user_4'], subscribers: ['user_1', 'slack_network', 'email_security', 'oncall_security'], createdAt: dayjs().subtract(90, 'day'), owner: 'user_1' },
      ];

      const [teams, setTeams] = useLocalStorageState('sre-teams', initialTeams);
      const [isTeamModalOpen, setIsTeamModalOpen] = useState(false);
      const [editingTeam, setEditingTeam] = useState(null);
      const [teamSearchText, setTeamSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [teamForm] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      const mockUsers = [
        { key: 'user_1', name: '王工程師', email: 'wang@example.com' },
        { key: 'user_2', name: '陳經理', email: 'chen@example.com' },
        { key: 'user_3', name: '李開發', email: 'li@example.com' },
        { key: 'user_4', name: '張管理員', email: 'zhang@example.com' },
      ];

      const showTeamModal = (team = null) => {
        setEditingTeam(team);
        teamForm.setFieldsValue(team || { name: '', description: '' });
        setIsTeamModalOpen(true);
      };
      const handleTeamCancel = () => setIsTeamModalOpen(false);
      const handleTeamFinish = (values) => {
        message.success(`團隊 ${editingTeam ? '更新' : '新增'}成功`);
        handleTeamCancel();
      };
      const handleTeamDelete = (team) => {
        confirmDelete('團隊', () => {
          setTeams(teams.filter(t => t.key !== team.key));
        }, `團隊 "${team.name}"`);
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `確定要刪除 ${selectedRowKeys.length} 個團隊嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setTeams(teams.filter(t => !selectedRowKeys.includes(t.key)));
            setSelectedRowKeys([]);
            message.success('批次刪除成功');
          }
        });
      };

      const teamColumns = [
        { title: '團隊名稱', dataIndex: 'name', sorter: (a, b) => a.name.localeCompare(b.name) },
        { title: '成員數', dataIndex: 'members', render: m => m ? m.length : 0, sorter: (a, b) => (a.members?.length || 0) - (b.members?.length || 0) },
        { title: '訂閱者數', dataIndex: 'subscribers', render: s => s ? s.length : 0, sorter: (a, b) => (a.subscribers?.length || 0) - (b.subscribers?.length || 0) },
        { title: '負責人', dataIndex: 'owner', render: owner => mockUsers.find(u => u.key === owner)?.name || '未設定' },
        { title: '描述', dataIndex: 'description', render: desc => desc || '無描述' },
        { title: '創建時間', dataIndex: 'createdAt', render: time => time ? time.format('YYYY-MM-DD') : '未知', sorter: (a, b) => (a.createdAt || dayjs(0)).valueOf() - (b.createdAt || dayjs(0)).valueOf() },
        { title: '操作', key: 'action', width: 120, align: 'center', render: (_, record) => <TableRowActions onEdit={() => showTeamModal(record)} onDelete={() => handleTeamDelete(record)} /> }
      ];

      const filteredTeams = teams.filter(team => team.name.toLowerCase().includes(teamSearchText.toLowerCase()));

      const onSelectChange = (keys) => setSelectedRowKeys(keys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange };

      return (
        <React.Fragment>
          <div className="toolbar-actions">
            <div className="toolbar-group">
              <Input.Search placeholder="搜尋團隊名稱或描述..." onChange={e => setTeamSearchText(e.target.value)} style={{ width: 300 }} allowClear />
            </div>
            <div className="toolbar-group">
              <PlatformButton variant="primary" icon={<PlusOutlined />} onClick={() => showTeamModal()}>新增團隊</PlatformButton>
            </div>
          </div>

          <PlatformTableContainer>
            <Table rowSelection={rowSelection} dataSource={filteredTeams} columns={teamColumns} rowKey="key" size="small" />
          </PlatformTableContainer>

          <BatchActionToolbar selectedCount={selectedRowKeys.length} onClear={() => setSelectedRowKeys([])} actions={[{ text: '批次刪除', variant: 'danger', icon: <DeleteOutlined />, onClick: handleBatchDelete }]} />

          <PlatformModal title={editingTeam ? '編輯團隊' : '新增團隊'} visible={isTeamModalOpen} onClose={handleTeamCancel} width={900} footer={<ModalActions onCancel={handleTeamCancel} onConfirm={() => teamForm.submit()} confirmText={editingTeam ? '更新團隊' : '創建團隊'} />}>
            <Form form={teamForm} layout="vertical" onFinish={handleTeamFinish} style={{ marginTop: 24 }}>
              <SettingsSection title="基本資訊">
                <SettingsFormRow label="團隊名稱" required><Form.Item name="name" noStyle rules={[{ required: true }]}><Input /></Form.Item></SettingsFormRow>
                <SettingsFormRow label="負責人" required><Form.Item name="owner" noStyle rules={[{ required: true }]}><Select options={mockUsers.map(u => ({ label: u.name, value: u.key }))} /></Form.Item></SettingsFormRow>
                <SettingsFormRow label="團隊描述"><Form.Item name="description" noStyle><TextArea rows={3} /></Form.Item></SettingsFormRow>
              </SettingsSection>
              <SettingsSection title="團隊成員">
                <Form.Item noStyle name="members"><Transfer dataSource={mockUsers} showSearch targetKeys={selectedRowKeys} onChange={setSelectedRowKeys} render={item => item.title} /></Form.Item>
              </SettingsSection>
            </Form>
          </PlatformModal>
        </React.Fragment >
      );
    };

    const RoleManagementPage = () => {
      const permissionTreeData = [
        {
          title: '資源管理', key: 'resources', children: [
            { title: '讀取資源列表', key: 'res:list:read' },
            { title: '寫入資源', key: 'res:list:write' },
            { title: '讀取資源群組', key: 'res:group:read' },
            { title: '寫入資源群組', key: 'res:group:write' },
          ]
        },
        {
          title: '事件管理', key: 'incidents', children: [
            { title: '讀取事件', key: 'inc:list:read' },
            { title: '確認/解決事件', key: 'inc:list:update' },
            { title: '讀取告警規則', key: 'inc:rule:read' },
            { title: '寫入告警規則', key: 'inc:rule:write' },
          ]
        },
      ];
      const initialRoles = [
        { key: 'super_admin', name: '超級管理員', isBuiltIn: true, permissions: ['resources', 'incidents'] },
        { key: 'team_manager', name: '團隊管理員', isBuiltIn: true, permissions: ['res:list:read', 'res:list:write', 'inc:list:read', 'inc:rule:write'] },
        { key: 'viewer', name: '唯讀用戶', isBuiltIn: true, permissions: ['res:list:read', 'inc:list:read'] },
        { key: 'custom_role_1', name: '自定義DBA角色', isBuiltIn: false, permissions: ['res:list:read', 'res:group:write'] },
      ];

      const [roles, setRoles] = useLocalStorageState('sre-roles', initialRoles);
      const [selectedRoleKey, setSelectedRoleKey] = useState('super_admin');
      const [checkedKeys, setCheckedKeys] = useState([]);
      const [isCreateRoleModalOpen, setIsCreateRoleModalOpen] = useState(false);
      const [roleForm] = Form.useForm();
      const { message } = antd.App.useApp();

      const selectedRole = roles.find(r => r.key === selectedRoleKey);

      useEffect(() => {
        if (selectedRole) {
          setCheckedKeys(selectedRole.permissions);
        }
      }, [selectedRole]);

      const handleSave = () => message.success(`角色 "${selectedRole.name}" 的權限已更新`);

      const handleCreateRoleFinish = (values) => {
        const newRole = { key: `custom_role_${Date.now()}`, name: values.name, isBuiltIn: false, permissions: checkedKeys };
        setRoles([...roles, newRole]);
        setSelectedRoleKey(newRole.key);
        message.success(`角色 "${values.name}" 建立成功`);
        setIsCreateRoleModalOpen(false);
      };

      return (
        <React.Fragment>
          <Row gutter={24}>
            <Col span={8}>
              <SettingsSection title="角色列表" actions={<PlatformButton variant="primary" size="small" icon={<PlusOutlined />} onClick={() => setIsCreateRoleModalOpen(true)}>新增角色</PlatformButton>}>
                <List
                  dataSource={roles}
                  renderItem={item => (
                    <List.Item onClick={() => setSelectedRoleKey(item.key)} style={{ background: selectedRoleKey === item.key ? 'var(--bg-active)' : 'transparent' }} className="role-list-item">
                      <div style={{ display: 'flex', justifyContent: 'space-between', width: '100%' }}>
                        <span>{item.name}</span>
                        {item.isBuiltIn && <Tag size="small">內建</Tag>}
                      </div>
                    </List.Item>
                  )}
                />
              </SettingsSection>
            </Col>
            <Col span={16}>
              {selectedRole ? (
                <SettingsSection title={selectedRole.name} actions={!selectedRole.isBuiltIn && <PlatformButton variant="primary" onClick={handleSave}>儲存變更</PlatformButton>}>
                  <Tree checkable treeData={permissionTreeData} checkedKeys={checkedKeys} onCheck={setCheckedKeys} disabled={selectedRole.isBuiltIn} defaultExpandAll />
                </SettingsSection>
              ) : (
                <Empty description="請從左側選擇一個角色" />
              )}
            </Col>
          </Row>

          <PlatformModal title="新增角色" visible={isCreateRoleModalOpen} onClose={() => setIsCreateRoleModalOpen(false)} footer={<ModalActions onCancel={() => setIsCreateRoleModalOpen(false)} onConfirm={() => roleForm.submit()} confirmText="建立角色" />}>
            <Form form={roleForm} layout="vertical" onFinish={handleCreateRoleFinish} style={{ marginTop: 24 }}>
              <SettingsFormRow label="角色名稱" required><Form.Item name="name" noStyle rules={[{ required: true }]}><Input /></Form.Item></SettingsFormRow>
              <SettingsFormRow label="權限設定">
                <Tree checkable treeData={permissionTreeData} checkedKeys={checkedKeys} onCheck={setCheckedKeys} defaultExpandAll />
              </SettingsFormRow>
            </Form>
          </PlatformModal>
        </React.Fragment>
      );
    };

    // 智能標籤輸入組件
    const SmartTagInput = ({ value = {}, onChange, placeholder = "輸入標籤...", style }) => {
      const [tags] = useLocalStorageState('sre-unified-tags', []);
      const [currentKey, setCurrentKey] = useState('');
      const [currentValue, setCurrentValue] = useState('');
      const [keyInputMode, setKeyInputMode] = useState(true);
      const { message } = antd.App.useApp();

      // 從標籤管理系統獲取 Key 選項
      const keyOptions = tags.map(tag => ({
        value: tag.name,
        label: tag.displayName || tag.name,
        description: tag.description,
        required: tag.required,
        valueCount: tag.values.length,
        values: tag.values
      }));

      // 當前選中的標籤定義
      const selectedTagDef = tags.find(tag => tag.name === currentKey);

      // 生成值選項（基於標籤的預設值）
      const getValueOptions = (keyName) => {
        const tagDef = tags.find(tag => tag.name === keyName);
        if (!tagDef || !tagDef.values) return [];

        return tagDef.values.map(val => ({
          value: val.value,
          label: val.displayName || val.value,
          color: val.color,
          description: val.displayName,
          usageCount: val.usageCount
        }));
      };

      // 驗證值是否存在於標籤的預設值列表中
      const validateValue = (keyName, inputValue) => {
        const tagDef = tags.find(tag => tag.name === keyName);
        if (!tagDef) return true;

        // 如果標籤有預設值列表，檢查是否在列表中
        if (tagDef.values && tagDef.values.length > 0) {
          return tagDef.values.some(val => val.value === inputValue);
        }

        // 如果沒有預設值列表，允許任意值
        return true;
      };

      // 處理標籤添加
      const handleAddTag = () => {
        if (!currentKey || !currentValue) return;

        // 驗證值
        if (!validateValue(currentKey, currentValue)) {
          const tagDef = tags.find(tag => tag.name === currentKey);
          if (tagDef?.values && tagDef.values.length > 0) {
            const validValues = tagDef.values.map(val => val.value).join(', ');
            message.error(`"${currentKey}" 的值必須是: ${validValues}`);
          } else {
            message.error(`"${currentKey}" 的值格式不正確`);
          }
          return;
        }

        // 添加標籤
        const newTags = { ...value, [currentKey]: currentValue };
        onChange?.(newTags);

        // 重置輸入
        setCurrentKey('');
        setCurrentValue('');
        setKeyInputMode(true);
      };

      // 處理標籤刪除
      const handleRemoveTag = (key) => {
        const newTags = { ...value };
        delete newTags[key];
        onChange?.(newTags);
      };

      // 處理 Key 選擇
      const handleKeySelect = (selectedKey) => {
        setCurrentKey(selectedKey);
        setCurrentValue('');
        setKeyInputMode(false);
      };

      // 處理 Key 輸入
      const handleKeyInput = (inputKey) => {
        setCurrentKey(inputKey);
      };

      return (
        <div style={style}>
          {/* 現有標籤顯示 */}
          <div style={{ marginBottom: 8 }}>
            <Space size={[4, 4]} wrap>
              {Object.entries(value || {}).map(([key, val]) => {
                const tagDef = tags.find(tag => tag.name === key);
                const valueDef = tagDef?.values?.find(v => v.value === val);

                // 使用值定義中的顏色，如果沒有則使用標籤分類的預設顏色
                const tagColor = valueDef?.color ||
                  (tagDef?.category === 'infrastructure' ? '#1890ff' :
                    tagDef?.category === 'application' ? '#52c41a' :
                      tagDef?.category === 'organization' ? '#fa8c16' :
                        tagDef?.category === 'business' ? '#722ed1' :
                          tagDef?.category === 'finance' ? '#eb2f96' :
                            tagDef?.category === 'security' ? '#f5222d' : '#1890ff');

                return (
                  <Tag
                    key={key}
                    closable
                    color={tagColor}
                    onClose={() => handleRemoveTag(key)}
                    style={{ fontWeight: 500 }}
                  >
                    <strong>{tagDef?.displayName || key}</strong>: {valueDef?.displayName || val}
                  </Tag>
                );
              })}
            </Space>
          </div>

          {/* 標籤輸入區域 */}
          <div style={{ display: 'flex', gap: 8, alignItems: 'flex-start' }}>
            {keyInputMode ? (
              // Key 輸入模式
              <div style={{ flex: 1 }}>
                <Select
                  showSearch
                  placeholder="選擇標籤 Key..."
                  style={{ width: '100%' }}
                  value={currentKey || undefined}
                  onSelect={handleKeySelect}
                  onSearch={handleKeyInput}
                  filterOption={(input, option) =>
                    option?.value?.toLowerCase().includes(input.toLowerCase()) ||
                    option?.label?.toLowerCase().includes(input.toLowerCase())
                  }
                  dropdownRender={(menu) => (
                    <div>
                      {menu}
                      {currentKey && !keyOptions.find(opt => opt.value === currentKey) && (
                        <div style={{ padding: 8, borderTop: '1px solid #f0f0f0' }}>
                          <Button
                            type="link"
                            size="small"
                            onClick={() => {
                              message.info('自定義 Key 功能需要管理員權限');
                            }}
                          >
                            + 創建新 Key "{currentKey}"
                          </Button>
                        </div>
                      )}
                    </div>
                  )}
                >
                  {keyOptions.map(option => (
                    <Select.Option key={option.value} value={option.value} label={option.label}>
                      <div>
                        <div style={{ fontWeight: 500 }}>
                          {option.label}
                          {option.required && <Tag size="small" color="red" style={{ marginLeft: 4 }}>必填</Tag>}
                        </div>
                        <div style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>
                          {option.description}
                        </div>
                      </div>
                    </Select.Option>
                  ))}
                </Select>
              </div>
            ) : (
              // 值輸入模式
              <div style={{ flex: 1, display: 'flex', gap: 8 }}>
                <Select
                  disabled
                  value={selectedTagDef?.displayName || currentKey}
                  style={{ width: 150 }}
                />
                <div style={{ flex: 1 }}>
                  {selectedTagDef?.values && selectedTagDef.values.length > 0 ? (
                    <Select
                      placeholder="選擇值..."
                      value={currentValue || undefined}
                      onChange={setCurrentValue}
                      style={{ width: '100%' }}
                      showSearch
                      filterOption={(input, option) =>
                        option?.label?.toLowerCase().includes(input.toLowerCase()) ||
                        option?.value?.toLowerCase().includes(input.toLowerCase())
                      }
                    >
                      {getValueOptions(currentKey).map(option => (
                        <Select.Option key={option.value} value={option.value} label={option.label}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                              <Tag color={option.color} style={{ margin: 0 }}>
                                {option.value}
                              </Tag>
                              <span>{option.description}</span>
                            </div>
                            <Text type="secondary" style={{ fontSize: '11px' }}>
                              {option.usageCount} 次使用
                            </Text>
                          </div>
                        </Select.Option>
                      ))}
                    </Select>
                  ) : (
                    <Input
                      placeholder="輸入標籤值..."
                      value={currentValue}
                      onChange={(e) => setCurrentValue(e.target.value)}
                      onPressEnter={handleAddTag}
                    />
                  )}
                </div>
                <Button
                  type="primary"
                  size="small"
                  onClick={handleAddTag}
                  disabled={!currentKey || !currentValue}
                >
                  添加
                </Button>
                <Button
                  size="small"
                  onClick={() => {
                    setKeyInputMode(true);
                    setCurrentKey('');
                    setCurrentValue('');
                  }}
                >
                  取消
                </Button>
              </div>
            )}
          </div>

          {/* Key 描述和提示 */}
          {selectedTagDef && !keyInputMode && (
            <div style={{ marginTop: 4, fontSize: '12px', color: 'var(--text-secondary)' }}>
              {selectedTagDef.description}
              {selectedTagDef.values && selectedTagDef.values.length > 0 && (
                <div>
                  可選值: {selectedTagDef.values.slice(0, 3).map(val => val.value).join(', ')}
                  {selectedTagDef.values.length > 3 && '...等'}
                  {` (${selectedTagDef.values.length} 個)`}
                </div>
              )}
            </div>
          )}
        </div>
      );
    };


    // Settings Administration Page - Card navigation style
    const SettingsAdministrationPage = ({ onNavigate }) => {
      // Define settings cards using the exact pattern from Management Center
      const settingsCards = [
        {
          key: 'user-management',
          icon: <UserOutlined />,
          title: '人員管理',
          description: '管理使用者帳號與權限。',
          category: '用戶與權限',
          features: ['角色配置', 'SSO整合', '密碼策略'],
          enabled: true
        },
        {
          key: 'team-management',
          icon: <TeamOutlined />,
          title: '團隊管理',
          description: '管理團隊結構與成員配置。',
          category: '用戶與權限',
          features: ['階層架構', '權限繼承', '成員管理'],
          enabled: true
        },
        {
          key: 'role-management',
          icon: <ApartmentOutlined />,
          title: '角色管理',
          description: '定義系統角色與其權限。',
          category: '用戶與權限',
          features: ['RBAC控制', '自訂角色', '權限模板'],
          enabled: true
        },
        {
          key: 'notification-strategies',
          icon: <ApartmentOutlined />,
          title: '通知策略',
          description: '設定告警通知的路由策略。',
          category: '通知管理',
          features: ['智能路由', '升級規則', '值班整合'],
          enabled: true
        },
        {
          key: 'notification-channels',
          icon: <BellOutlined />,
          title: '通知管道',
          description: '管理系統通知管道。',
          category: '通知管理',
          features: ['多元管道', '模板管理', '送達確認'],
          enabled: true
        },
        {
          key: 'tag-management',
          icon: <TagsOutlined />,
          title: '標籤管理',
          description: '管理全域標籤與分類。',
          category: '平台設定',
          features: ['標籤標準化', '層級標籤', '標籤驗證'],
          enabled: true
        },
        {
          key: 'email-settings',
          icon: <MailOutlined />,
          title: '郵件設定',
          description: '配置 SMTP 伺服器與郵件模板。',
          category: '平台設定',
          features: ['SMTP設定', '郵件模板', '發送記錄'],
          enabled: true
        },
        {
          key: 'auth-settings',
          icon: <SafetyOutlined />,
          title: '身份驗證',
          description: '配置登入方式與安全策略。',
          category: '平台設定',
          features: ['SSO整合', '多因素認證', '密碼策略'],
          enabled: true
        },
        {
          key: 'platform-diagnostics',
          icon: <MonitorOutlined />,
          title: '平台診斷',
          description: '監控平台健康狀態與效能。',
          category: '平台維運',
          features: ['健康檢查', '效能監控', '系統資源'],
          enabled: true
        },
        {
          key: 'audit-logs',
          icon: <AuditOutlined />,
          title: '審計日誌',
          description: '追蹤平台操作與安全事件。',
          category: '平台維運',
          features: ['操作追蹤', '安全分析', '合規報告'],
          enabled: true
        }
      ];


      return (
        <React.Fragment>
          <Title level={2} className="page-title" style={{ marginBottom: '2px' }}>設定</Title>
          <Paragraph className="page-subtitle" type="secondary" style={{ marginBottom: '4px' }}>
            配置平台的人員、權限與系統功能設定。
          </Paragraph>
          {/* 分組顯示設定功能 */}
          <div style={{ marginTop: '16px' }}>
            {/* 用戶與權限組 */}
            <div style={{ marginBottom: '24px' }}>
              <Title level={5} style={{
                color: 'var(--text-secondary)',
                fontWeight: '500',
                marginBottom: '8px',
                fontSize: '16px'
              }}>
                用戶與權限
              </Title>
              <Row gutter={[16, 16]}>
                {settingsCards.filter(item => item.category === '用戶與權限').map(item => (
                  <Col key={item.key} xs={24} md={12} lg={8}>
                    <Badge.Ribbon
                      text="即將推出"
                      style={{ display: !item.enabled ? 'block' : 'none' }}
                    >
                      <div
                        className={`nav-item ${!item.enabled ? 'disabled-card' : ''}`}
                        onClick={() => item.enabled && onNavigate(item.key)}
                        style={{ height: '100%' }}
                      >
                        <div className="nav-item-content" style={{ flexDirection: 'column', alignItems: 'flex-start' }}>
                          <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px', marginBottom: '6px', width: '100%' }}>
                            <div className="nav-item-icon" style={{
                              background: 'rgba(24, 144, 255, 0.1)',
                              padding: '6px',
                              borderRadius: '8px',
                              fontSize: '20px',
                              opacity: item.enabled ? 1 : 0.5
                            }}>
                              {item.icon}
                            </div>
                            <div className="nav-item-text" style={{ flex: 1 }}>
                              <Title level={5} className="nav-item-title" style={{ marginBottom: '4px' }}>
                                {item.title}
                              </Title>
                              <Paragraph className="nav-item-description" style={{ marginBottom: 0 }}>{item.description}</Paragraph>
                            </div>
                          </div>
                        </div>
                      </div>
                    </Badge.Ribbon>
                  </Col>
                ))}
              </Row>
            </div>
            {/* 通知管理組 */}
            <div style={{ marginBottom: '24px' }}>
              <Title level={5} style={{
                color: 'var(--text-secondary)',
                fontWeight: '500',
                marginBottom: '8px',
                fontSize: '16px'
              }}>
                通知管理
              </Title>
              <Row gutter={[16, 16]}>
                {settingsCards.filter(item => item.category === '通知管理').map(item => (
                  <Col key={item.key} xs={24} md={12} lg={8}>
                    <Badge.Ribbon
                      text="即將推出"
                      style={{ display: !item.enabled ? 'block' : 'none' }}
                    >
                      <div
                        className={`nav-item ${!item.enabled ? 'disabled-card' : ''}`}
                        onClick={() => item.enabled && onNavigate(item.key)}
                        style={{ height: '100%' }}
                      >
                        <div className="nav-item-content" style={{ flexDirection: 'column', alignItems: 'flex-start' }}>
                          <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px', marginBottom: '6px', width: '100%' }}>
                            <div className="nav-item-icon" style={{
                              background: 'rgba(24, 144, 255, 0.1)',
                              padding: '6px',
                              borderRadius: '8px',
                              fontSize: '20px',
                              opacity: item.enabled ? 1 : 0.5
                            }}>
                              {item.icon}
                            </div>
                            <div className="nav-item-text" style={{ flex: 1 }}>
                              <Title level={5} className="nav-item-title" style={{ marginBottom: '4px' }}>
                                {item.title}
                              </Title>
                              <Paragraph className="nav-item-description" style={{ marginBottom: 0 }}>{item.description}</Paragraph>
                            </div>
                          </div>
                        </div>
                      </div>
                    </Badge.Ribbon>
                  </Col>
                ))}
              </Row>
            </div>
            {/* 平台設定組 */}
            <div style={{ marginBottom: '24px' }}>
              <Title level={5} style={{
                color: 'var(--text-secondary)',
                fontWeight: '500',
                marginBottom: '8px',
                fontSize: '16px'
              }}>
                平台設定
              </Title>
              <Row gutter={[16, 16]}>
                {settingsCards.filter(item => item.category === '平台設定').map(item => (
                  <Col key={item.key} xs={24} md={12} lg={8}>
                    <Badge.Ribbon
                      text="即將推出"
                      style={{ display: !item.enabled ? 'block' : 'none' }}
                    >
                      <div
                        className={`nav-item ${!item.enabled ? 'disabled-card' : ''}`}
                        onClick={() => item.enabled && onNavigate(item.key)}
                        style={{ height: '100%' }}
                      >
                        <div className="nav-item-content" style={{ flexDirection: 'column', alignItems: 'flex-start' }}>
                          <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px', marginBottom: '6px', width: '100%' }}>
                            <div className="nav-item-icon" style={{
                              background: 'rgba(24, 144, 255, 0.1)',
                              padding: '6px',
                              borderRadius: '8px',
                              fontSize: '20px',
                              opacity: item.enabled ? 1 : 0.5
                            }}>
                              {item.icon}
                            </div>
                            <div className="nav-item-text" style={{ flex: 1 }}>
                              <Title level={5} className="nav-item-title" style={{ marginBottom: '2px' }}>
                                {item.title}
                              </Title>
                              <Paragraph className="nav-item-description" style={{ marginBottom: 0 }}>{item.description}</Paragraph>
                            </div>
                          </div>
                        </div>
                      </div>
                    </Badge.Ribbon>
                  </Col>
                ))}
              </Row>
            </div>
            {/* 平台維運組 */}
            <div style={{ marginBottom: '24px' }}>
              <Title level={5} style={{
                color: 'var(--text-secondary)',
                fontWeight: '500',
                marginBottom: '8px',
                fontSize: '16px'
              }}>
                平台維運
              </Title>
              <Row gutter={[16, 16]}>
                {settingsCards.filter(item => item.category === '平台維運').map(item => (
                  <Col key={item.key} xs={24} md={12} lg={8}>
                    <Badge.Ribbon
                      text="即將推出"
                      style={{ display: !item.enabled ? 'block' : 'none' }}
                    >
                      <div
                        className={`nav-item ${!item.enabled ? 'disabled-card' : ''}`}
                        onClick={() => item.enabled && onNavigate(item.key)}
                        style={{ height: '100%' }}
                      >
                        <div className="nav-item-content" style={{ flexDirection: 'column', alignItems: 'flex-start' }}>
                          <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px', marginBottom: '6px', width: '100%' }}>
                            <div className="nav-item-icon" style={{
                              background: 'rgba(24, 144, 255, 0.1)',
                              padding: '6px',
                              borderRadius: '8px',
                              fontSize: '20px',
                              opacity: item.enabled ? 1 : 0.5
                            }}>
                              {item.icon}
                            </div>
                            <div className="nav-item-text" style={{ flex: 1 }}>
                              <Title level={5} className="nav-item-title" style={{ marginBottom: '2px' }}>
                                {item.title}
                              </Title>
                              <Paragraph className="nav-item-description" style={{ marginBottom: 0 }}>{item.description}</Paragraph>
                            </div>
                          </div>
                        </div>
                      </div>
                    </Badge.Ribbon>
                  </Col>
                ))}
              </Row>
            </div>
          </div>
        </React.Fragment>
      );
    };

    // === 🏷️ 優化後的標籤管理頁面 ===
    const TagKeyManagementPage = () => {
      // 標籤分類系統
      const tagCategories = [
        { id: 'infrastructure', name: '基礎設施', color: '#1890ff', icon: <HddOutlined />, description: '服務器、網絡、存儲等基礎設施相關標籤' },
        { id: 'application', name: '應用程序', color: '#52c41a', icon: <CodeOutlined />, description: '應用服務、微服務等應用相關標籤' },
        { id: 'organization', name: '組織結構', color: '#fa8c16', icon: <TeamOutlined />, description: '團隊、部門、責任人等組織相關標籤' },
        { id: 'business', name: '業務屬性', color: '#722ed1', icon: <BuildOutlined />, description: '項目、產品線、客戶等業務相關標籤' },
        { id: 'finance', name: '成本管理', color: '#eb2f96', icon: <DollarOutlined />, description: '成本中心、預算、計費等財務相關標籤' },
        { id: 'security', name: '安全合規', color: '#f5222d', icon: <SafetyOutlined />, description: '安全等級、合規要求等安全相關標籤' }
      ];

      // 預設的標籤數據（包含name和values）
      const initialTags = [
        {
          id: 'team_1',
          name: 'environment',
          displayName: '環境',
          description: '部署環境標識，用於區分不同的運行環境',
          category: 'infrastructure',
          required: true,
          values: [
            { id: 'env_prod', value: 'production', displayName: '生產環境', color: '#f5222d', usageCount: 45, createdAt: dayjs().subtract(30, 'day') },
            { id: 'env_stage', value: 'staging', displayName: '預發環境', color: '#fa8c16', usageCount: 32, createdAt: dayjs().subtract(25, 'day') },
            { id: 'env_dev', value: 'development', displayName: '開發環境', color: '#52c41a', usageCount: 28, createdAt: dayjs().subtract(20, 'day') },
            { id: 'env_test', value: 'testing', displayName: '測試環境', color: '#1890ff', usageCount: 15, createdAt: dayjs().subtract(15, 'day') }
          ],
          totalUsage: 120,
          createdAt: dayjs().subtract(30, 'day'),
          updatedAt: dayjs().subtract(5, 'day')
        },
        {
          id: 'team_2',
          name: 'team',
          displayName: '負責團隊',
          description: '資源或服務的責任團隊',
          category: 'organization',
          required: false,
          values: [
            { id: 'team_fe', value: 'frontend', displayName: '前端團隊', color: '#722ed1', usageCount: 25, createdAt: dayjs().subtract(20, 'day') },
            { id: 'team_be', value: 'backend', displayName: '後端團隊', color: '#52c41a', usageCount: 35, createdAt: dayjs().subtract(18, 'day') },
            { id: 'team_ops', value: 'devops', displayName: 'DevOps 團隊', color: '#1890ff', usageCount: 18, createdAt: dayjs().subtract(15, 'day') },
            { id: 'team_qa', value: 'qa', displayName: 'QA 團隊', color: '#fa8c16', usageCount: 12, createdAt: dayjs().subtract(12, 'day') },
            { id: 'team_data', value: 'data', displayName: '數據團隊', color: '#13c2c2', usageCount: 8, createdAt: dayjs().subtract(10, 'day') }
          ],
          totalUsage: 98,
          createdAt: dayjs().subtract(25, 'day'),
          updatedAt: dayjs().subtract(3, 'day')
        },
        {
          id: 'team_3',
          name: 'priority',
          displayName: '優先級',
          description: '資源或告警的優先級別',
          category: 'business',
          required: false,
          values: [
            { id: 'pri_crit', value: 'critical', displayName: '緊急', color: '#f5222d', usageCount: 8, createdAt: dayjs().subtract(15, 'day') },
            { id: 'pri_high', value: 'high', displayName: '高', color: '#fa8c16', usageCount: 22, createdAt: dayjs().subtract(12, 'day') },
            { id: 'pri_med', value: 'medium', displayName: '中', color: '#1890ff', usageCount: 45, createdAt: dayjs().subtract(10, 'day') },
            { id: 'pri_low', value: 'low', displayName: '低', color: '#52c41a', usageCount: 31, createdAt: dayjs().subtract(8, 'day') }
          ],
          totalUsage: 106,
          createdAt: dayjs().subtract(15, 'day'),
          updatedAt: dayjs().subtract(2, 'day')
        },
        {
          id: 'team_4',
          name: 'security-level',
          displayName: '安全等級',
          description: '資源的安全分級，用於訪問控制',
          category: 'security',
          required: true,
          values: [
            { id: 'sec_pub', value: 'public', displayName: '公開', color: '#52c41a', usageCount: 45, createdAt: dayjs().subtract(35, 'day') },
            { id: 'sec_int', value: 'internal', displayName: '內部', color: '#1890ff', usageCount: 38, createdAt: dayjs().subtract(30, 'day') },
            { id: 'sec_conf', value: 'confidential', displayName: '機密', color: '#fa8c16', usageCount: 25, createdAt: dayjs().subtract(25, 'day') },
            { id: 'sec_rest', value: 'restricted', displayName: '限制', color: '#f5222d', usageCount: 12, createdAt: dayjs().subtract(20, 'day') }
          ],
          totalUsage: 120,
          createdAt: dayjs().subtract(35, 'day'),
          updatedAt: dayjs().subtract(7, 'day')
        },
        {
          id: 'team_5',
          name: 'service-type',
          displayName: '服務類型',
          description: '應用或服務的類型分類',
          category: 'application',
          required: false,
          values: [
            { id: 'svc_web', value: 'web-server', displayName: 'Web 服務器', color: '#52c41a', usageCount: 32, createdAt: dayjs().subtract(25, 'day') },
            { id: 'svc_db', value: 'database', displayName: '數據庫', color: '#1890ff', usageCount: 28, createdAt: dayjs().subtract(22, 'day') },
            { id: 'svc_cache', value: 'cache', displayName: '緩存服務', color: '#fa8c16', usageCount: 15, createdAt: dayjs().subtract(18, 'day') },
            { id: 'svc_lb', value: 'load-balancer', displayName: '負載均衡器', color: '#722ed1', usageCount: 12, createdAt: dayjs().subtract(15, 'day') },
            { id: 'svc_api', value: 'api-gateway', displayName: 'API 網關', color: '#13c2c2', usageCount: 8, createdAt: dayjs().subtract(12, 'day') }
          ],
          totalUsage: 95,
          createdAt: dayjs().subtract(28, 'day'),
          updatedAt: dayjs().subtract(4, 'day')
        }
      ];

      const [tags, setTags] = useLocalStorageState('sre-unified-tags', initialTags);
      const [selectedCategory, setSelectedCategory] = React.useState('all');
      const [searchText, setSearchText] = React.useState('');
      const [isTagModalOpen, setIsTagModalOpen] = React.useState(false);
      const [isValueModalOpen, setIsValueModalOpen] = React.useState(false);
      const [editingTag, setEditingTag] = React.useState(null);
      const [editingValue, setEditingValue] = React.useState(null);
      const [selectedTagForValue, setSelectedTagForValue] = React.useState(null);
      const [inlineEditingId, setInlineEditingId] = React.useState(null);
      const [inlineEditForm, setInlineEditForm] = React.useState({});
      const [displayNameManuallyChanged, setDisplayNameManuallyChanged] = React.useState(false);
      const [tagDisplayNameManuallyChanged, setTagDisplayNameManuallyChanged] = React.useState(false);
      const [selectedRowKeys, setSelectedRowKeys] = React.useState([]);
      const [tagForm] = Form.useForm();
      const [valueForm] = Form.useForm();
      const { modal, message } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // 計算統計信息
      const tagStats = React.useMemo(() => {
        const totalTags = tags.length;
        const totalValues = tags.reduce((sum, tag) => sum + tag.values.length, 0);
        const totalUsage = tags.reduce((sum, tag) => sum + tag.totalUsage, 0);
        const byCategory = tagCategories.map(cat => ({
          ...cat,
          count: tags.filter(tag => tag.category === cat.id).length
        }));

        return { totalTags, totalValues, totalUsage, byCategory };
      }, [tags]);

      // 過濾數據
      const filteredTags = React.useMemo(() => {
        return tags.filter(tag => {
          const matchesCategory = selectedCategory === 'all' || tag.category === selectedCategory;
          const matchesSearch = searchText === '' ||
            tag.name.toLowerCase().includes(searchText.toLowerCase()) ||
            tag.displayName.toLowerCase().includes(searchText.toLowerCase()) ||
            tag.description.toLowerCase().includes(searchText.toLowerCase()) ||
            tag.values.some(val =>
              val.value.toLowerCase().includes(searchText.toLowerCase()) ||
              val.displayName.toLowerCase().includes(searchText.toLowerCase())
            );
          return matchesCategory && matchesSearch;
        });
      }, [tags, selectedCategory, searchText]);

      // 標籤管理函數
      const handleCreateTag = () => {
        setEditingTag(null);
        tagForm.resetFields();
        setIsTagModalOpen(true);
      };

      const handleEditTag = (record) => {
        setEditingTag(record);
        tagForm.setFieldsValue(record);
        setIsTagModalOpen(true);
      };

      const handleDeleteTag = (id) => {
        confirmDelete('標籤', () => {
          setTags(prev => prev.filter(item => item.id !== id));
        });
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `確定要刪除 ${selectedRowKeys.length} 個標籤嗎？`,
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setTags(tags.filter(t => !selectedRowKeys.includes(t.id)));
            setSelectedRowKeys([]);
            message.success('批次刪除成功');
          }
        });
      };

      const handleTagSubmit = (values) => {
        if (editingTag) {
          // 編輯現有標籤
          setTags(prev => prev.map(item =>
            item.id === editingTag.id
              ? { ...item, ...values, updatedAt: dayjs() }
              : item
          ));
        } else {
          // 新增標籤
          const newTag = {
            ...values,
            id: `t_${Date.now()}`,
            values: [],
            totalUsage: 0,
            createdAt: dayjs(),
            updatedAt: dayjs()
          };
          setTags(prev => [...prev, newTag]);
        }
        setIsTagModalOpen(false);
        tagForm.resetFields();
      };

      const handleTagCancel = () => {
        setIsTagModalOpen(false);
        tagForm.resetFields();
        setEditingTag(null);
        setTagDisplayNameManuallyChanged(false); // 重置自動同步狀態
      };

      // 值管理函數
      const handleCreateValue = (tag) => {
        setSelectedTagForValue(tag);
        setEditingValue(null);
        valueForm.resetFields();
        setDisplayNameManuallyChanged(false); // 重置自動同步狀態
        setIsValueModalOpen(true);
      };

      const handleEditValue = (tag, value) => {
        setSelectedTagForValue(tag);
        setEditingValue(value);
        valueForm.setFieldsValue(value);
        setDisplayNameManuallyChanged(true); // 編輯模式下不自動同步
        setIsValueModalOpen(true);
      };

      // 處理標籤值輸入變化 - 自動同步到顯示名稱
      const handleValueInputChange = (e) => {
        const inputValue = e.target.value;
        // 只有在顯示名稱沒有被手動修改過的情況下才自動同步
        if (!displayNameManuallyChanged) {
          valueForm.setFieldValue('displayName', inputValue);
        }
      };

      // 處理顯示名稱輸入變化 - 標記為手動修改
      const handleDisplayNameChange = (e) => {
        setDisplayNameManuallyChanged(true);
      };

      // 處理標籤名稱輸入變化 - 自動同步到顯示名稱
      const handleTagNameChange = (e) => {
        const inputValue = e.target.value;
        // 只有在顯示名稱沒有被手動修改過的情況下才自動同步
        if (!tagDisplayNameManuallyChanged) {
          tagForm.setFieldValue('displayName', inputValue);
        }
      };

      // 處理標籤顯示名稱輸入變化 - 標記為手動修改
      const handleTagDisplayNameChange = (e) => {
        setTagDisplayNameManuallyChanged(true);
      };

      // 行內編輯相關函數
      const handleInlineEdit = (value) => {
        setInlineEditingId(value.id);
        setInlineEditForm({
          value: value.value,
          displayName: value.displayName,
          color: value.color
        });
      };

      const handleInlineCancel = () => {
        setInlineEditingId(null);
        setInlineEditForm({});
      };

      const handleInlineSave = (tagId, valueId) => {
        setTags(prev => prev.map(tag =>
          tag.id === tagId
            ? {
              ...tag,
              values: tag.values.map(val =>
                val.id === valueId
                  ? { ...val, ...inlineEditForm }
                  : val
              )
            }
            : tag
        ));
        setInlineEditingId(null);
        setInlineEditForm({});
        message.success('標籤值已更新');
      };

      const handleDeleteValue = (tagId, valueId) => {
        setTags(prev => prev.map(tag =>
          tag.id === tagId
            ? {
              ...tag,
              values: tag.values.filter(val => val.id !== valueId),
              totalUsage: tag.values.filter(val => val.id !== valueId).reduce((sum, val) => sum + val.usageCount, 0),
              updatedAt: dayjs()
            }
            : tag
        ));
      };

      const handleToggleRequired = (tagId, checked) => {
        setTags(prev => prev.map(tag =>
          tag.id === tagId
            ? { ...tag, required: checked, updatedAt: dayjs() }
            : tag
        ));
      };

      const handleValueSubmit = (values) => {
        const processedValue = {
          ...values,
          id: editingValue ? editingValue.id : `val_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          usageCount: editingValue ? editingValue.usageCount : 0,
          createdAt: editingValue ? editingValue.createdAt : dayjs()
        };

        setTags(prev => prev.map(tag => {
          if (tag.id === selectedTagForValue.id) {
            const updatedValues = editingValue
              ? tag.values.map(val => val.id === editingValue.id ? processedValue : val)
              : [...tag.values, processedValue];

            return {
              ...tag,
              values: updatedValues,
              totalUsage: updatedValues.reduce((sum, val) => sum + val.usageCount, 0),
              updatedAt: dayjs()
            };
          }
          return tag;
        }));

        setIsValueModalOpen(false);
        valueForm.resetFields();
        setEditingValue(null);
        setSelectedTagForValue(null);
      };

      const handleValueCancel = () => {
        setIsValueModalOpen(false);
        valueForm.resetFields();
        setEditingValue(null);
        setSelectedTagForValue(null);
        setDisplayNameManuallyChanged(false); // 重置自動同步狀態
      };

      // 表格欄位
      const columns = [
        {
          title: '標籤名稱',
          dataIndex: 'name',
          key: 'name',
          width: '18%',
          sorter: (a, b) => a.name.localeCompare(b.name),
          render: (name, record) => (
            <div style={{ minWidth: 0 }}>
              <div style={{
                fontWeight: 600,
                fontSize: '14px',
                color: 'var(--text-primary)',
                marginBottom: '2px',
                textOverflow: 'ellipsis',
                overflow: 'hidden',
                whiteSpace: 'nowrap'
              }}>
                {record.displayName}
              </div>
              <div style={{
                fontSize: '12px',
                color: 'var(--text-tertiary)',
                fontFamily: 'monospace',
                textOverflow: 'ellipsis',
                overflow: 'hidden',
                whiteSpace: 'nowrap'
              }}>
                {name}
              </div>
            </div>
          ),
        },
        {
          title: '分類',
          dataIndex: 'category',
          key: 'category',
          width: '12%',
          filters: tagCategories.map(cat => ({ text: cat.name, value: cat.id })),
          onFilter: (value, record) => record.category === value,
          render: (category) => {
            const cat = tagCategories.find(c => c.id === category);
            return cat ? (
              <div style={{
                display: 'inline-flex',
                alignItems: 'center',
                gap: '4px',
                padding: '3px 8px',
                background: `${cat.color}15`,
                border: `1px solid ${cat.color}30`,
                borderRadius: '12px',
                fontSize: '12px',
                fontWeight: 500
              }}>
                <div
                  style={{
                    width: '6px',
                    height: '6px',
                    borderRadius: '50%',
                    backgroundColor: cat.color,
                    flexShrink: 0
                  }}
                />
                <span style={{ color: cat.color }}>{cat.name}</span>
              </div>
            ) : null;
          },
        },
        {
          title: '標籤值',
          dataIndex: 'values',
          key: 'values',
          width: '35%',
          render: (values, record) => {
            const displayValues = values.slice(0, 4);
            const hiddenCount = values.length - displayValues.length;

            const tooltipContent = (
              <div style={{
                display: 'flex',
                flexDirection: 'column',
                gap: '4px',
                maxWidth: '300px'
              }}>
                {values.map(val => (
                  <div key={val.id} style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    padding: '4px 0'
                  }}>
                    <div
                      style={{
                        width: '12px',
                        height: '12px',
                        borderRadius: '2px',
                        backgroundColor: val.color,
                        flexShrink: 0
                      }}
                    />
                    <span style={{ fontWeight: 500 }}>{val.displayName}</span>
                    <span style={{ color: 'var(--text-tertiary)', fontSize: '12px' }}>({val.value})</span>
                  </div>
                ))}
              </div>
            );

            return (
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px', flexWrap: 'wrap' }}>
                <Space wrap size={[4, 4]} align="center" style={{ flex: 1 }}>
                  {displayValues.map(val => (
                    <div key={val.id} style={{
                      display: 'inline-flex',
                      alignItems: 'center',
                      gap: '4px',
                      padding: '2px 6px',
                      background: `${val.color}20`,
                      border: `1px solid ${val.color}40`,
                      borderRadius: '4px',
                      fontSize: '12px',
                      fontWeight: 500
                    }}>
                      <div
                        style={{
                          width: '6px',
                          height: '6px',
                          borderRadius: '50%',
                          backgroundColor: val.color,
                          flexShrink: 0
                        }}
                      />
                      <span style={{ color: val.color }}>{val.displayName}</span>
                    </div>
                  ))}
                  {hiddenCount > 0 && (
                    <Tooltip title={tooltipContent} placement="topLeft">
                      <div style={{
                        display: 'inline-flex',
                        alignItems: 'center',
                        padding: '2px 6px',
                        background: 'rgba(255,255,255,0.1)',
                        border: '1px solid rgba(255,255,255,0.2)',
                        borderRadius: '4px',
                        fontSize: '12px',
                        cursor: 'pointer',
                        color: 'var(--text-secondary)'
                      }}>
                        +{hiddenCount}
                      </div>
                    </Tooltip>
                  )}
                </Space>
                <Tooltip title="新增標籤值">
                  <Button
                    type="text"
                    size="small"
                    icon={<PlusOutlined />}
                    onClick={() => handleCreateValue(record)}
                    style={{
                      width: '24px',
                      height: '24px',
                      padding: 0,
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      fontSize: '12px',
                      color: 'var(--text-tertiary)',
                      borderRadius: '4px'
                    }}
                  />
                </Tooltip>
              </div>
            )
          }
        },
        {
          title: '必填',
          dataIndex: 'required',
          key: 'required',
          width: '8%',
          filters: [
            { text: '必填', value: true },
            { text: '選填', value: false },
          ],
          onFilter: (value, record) => record.required === value,
          render: (required, record) => (
            <Tooltip title={`開啟後，所有'生產環境'的'資料庫'類型資源都必須包含此標籤。`}>
              <Switch checked={required} onChange={(checked) => handleToggleRequired(record.id, checked)} />
            </Tooltip>
          ),
        },
        {
          title: '使用次數',
          dataIndex: 'totalUsage',
          key: 'totalUsage',
          width: '10%',
          sorter: (a, b) => a.totalUsage - b.totalUsage,
          render: (count) => (
            <div style={{
              display: 'flex',
              alignItems: 'center',
              gap: '6px'
            }}>
              <div style={{
                width: '8px',
                height: '8px',
                borderRadius: '50%',
                backgroundColor: count > 50 ? '#52c41a' : count > 10 ? '#fa8c16' : 'var(--text-tertiary)'
              }} />
              <Text style={{
                color: count > 50 ? '#52c41a' : count > 10 ? '#fa8c16' : 'var(--text-tertiary)',
                fontSize: '13px',
                fontWeight: 500
              }}>
                {count.toLocaleString()}
              </Text>
            </div>
          ),
        },
        {
          title: '操作',
          key: 'action',
          width: '15%',
          fixed: 'right',
          render: (_, record) => (
            <Space size="small" style={{ display: 'flex', justifyContent: 'flex-end' }}>
              <Tooltip title="新增值">
                <Button
                  type="text"
                  size="small"
                  icon={<PlusOutlined />}
                  onClick={() => handleCreateValue(record)}
                  style={{
                    width: '28px',
                    height: '28px',
                    padding: 0,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '12px'
                  }}
                />
              </Tooltip>
              <Tooltip title="編輯">
                <Button
                  type="text"
                  size="small"
                  icon={<EditOutlined />}
                  onClick={() => handleEditTag(record)}
                  style={{
                    width: '28px',
                    height: '28px',
                    padding: 0,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '12px'
                  }}
                />
              </Tooltip>
              <Tooltip title="刪除">
                <Button
                  type="text"
                  danger
                  size="small"
                  icon={<DeleteOutlined />}
                  onClick={() => handleDeleteTag(record.id)}
                  style={{
                    width: '28px',
                    height: '28px',
                    padding: 0,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '12px'
                  }}
                />
              </Tooltip>
            </Space>
          ),
        },
      ];

      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      return (
        <React.Fragment>

          {/* 分類篩選區 */}
          <div style={{
            display: 'flex',
            alignItems: 'center',
            gap: '16px',
            marginBottom: 'var(--spacing-lg)',
            flexWrap: 'wrap'
          }}>
            <Button.Group style={{
              borderRadius: '8px',
              overflow: 'hidden',
              boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',
              border: '1px solid rgba(255, 255, 255, 0.15)'
            }}>
              <Button
                type={selectedCategory === 'all' ? 'primary' : 'default'}
                onClick={() => setSelectedCategory('all')}
                style={{
                  height: '36px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  padding: '0 16px',
                  fontWeight: 500,
                  border: 'none',
                  borderRadius: '0',
                  background: selectedCategory === 'all' ? '#1890ff' : 'rgba(255, 255, 255, 0.05)',
                  color: selectedCategory === 'all' ? '#fff' : 'rgba(255, 255, 255, 0.85)',
                  borderRight: '1px solid rgba(255, 255, 255, 0.1)',
                  transition: 'all 0.2s ease'
                }}
              >
                <span style={{ fontSize: '13px' }}>全部</span>
                <div style={{
                  background: selectedCategory === 'all' ? 'rgba(255, 255, 255, 0.25)' : 'rgba(24, 144, 255, 0.15)',
                  color: selectedCategory === 'all' ? '#fff' : '#1890ff',
                  padding: '2px 6px',
                  borderRadius: '8px',
                  fontSize: '11px',
                  fontWeight: 600,
                  minWidth: '20px',
                  textAlign: 'center',
                  lineHeight: '14px'
                }}>
                  {tagStats.totalTags}
                </div>
              </Button>
              {tagStats.byCategory.map((cat, index) => (
                <Button
                  key={cat.id}
                  type={selectedCategory === cat.id ? 'primary' : 'default'}
                  onClick={() => setSelectedCategory(cat.id)}
                  style={{
                    height: '36px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    padding: '0 14px',
                    fontWeight: 500,
                    border: 'none',
                    borderRadius: '0',
                    background: selectedCategory === cat.id ? cat.color : 'rgba(255, 255, 255, 0.05)',
                    color: selectedCategory === cat.id ? '#fff' : 'rgba(255, 255, 255, 0.85)',
                    borderRight: index < tagStats.byCategory.length - 1 ? '1px solid rgba(255, 255, 255, 0.1)' : 'none',
                    transition: 'all 0.2s ease'
                  }}
                >
                  <div style={{
                    width: '6px',
                    height: '6px',
                    borderRadius: '50%',
                    background: selectedCategory === cat.id ? '#fff' : cat.color,
                    opacity: selectedCategory === cat.id ? 0.9 : 0.8
                  }} />
                  <span style={{ fontSize: '13px' }}>
                    {cat.name}
                  </span>
                  <div style={{
                    background: selectedCategory === cat.id ? 'rgba(255, 255, 255, 0.25)' : `${cat.color}20`,
                    color: selectedCategory === cat.id ? '#fff' : cat.color,
                    padding: '2px 6px',
                    borderRadius: '8px',
                    fontSize: '11px',
                    fontWeight: 600,
                    minWidth: '18px',
                    textAlign: 'center',
                    lineHeight: '14px'
                  }}>
                    {cat.count}
                  </div>
                </Button>
              ))}
            </Button.Group>
          </div>

          {/* 工具列 */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="搜尋標籤名稱或值..."
                onChange={(e) => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
                value={searchText}
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                篩選
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>匯出</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={handleCreateTag}>
                新增標籤
              </Button>
            </Space>
          </Space>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>已選擇 <span className="batch-count">{selectedRowKeys.length}</span> 項</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>批次刪除</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          {/* 標籤表格 */}
          <div className="table-wrapper">
            {
              filteredTags.length > 0 ?
                <Table
                  rowSelection={rowSelection}
                  columns={[
                    {
                      title: '標籤名稱',
                      dataIndex: 'name',
                      key: 'name',
                      width: '15%',
                      sorter: (a, b) => a.name.localeCompare(b.name),
                      render: (text, record) => (
                        <div style={{ padding: '4px 0' }}>
                          <div style={{
                            fontWeight: 600,
                            fontSize: '14px',
                            color: 'rgba(255, 255, 255, 0.9)',
                            marginBottom: '4px',
                            letterSpacing: '0.3px'
                          }}>
                            {record.displayName}
                          </div>
                          <div style={{
                            fontSize: '11px',
                            color: 'rgba(255, 255, 255, 0.5)',
                            fontFamily: 'SFMono-Regular, Consolas, "Liberation Mono", Menlo, Courier, monospace',
                            background: 'rgba(255, 255, 255, 0.05)',
                            padding: '2px 6px',
                            borderRadius: '4px',
                            border: '1px solid rgba(255, 255, 255, 0.1)',
                            display: 'inline-block'
                          }}>
                            {text}
                          </div>
                        </div>
                      ),
                    },
                    {
                      title: '分類',
                      dataIndex: 'category',
                      key: 'category',
                      width: '12%',
                      filters: tagCategories.map(cat => ({ text: cat.name, value: cat.id })),
                      onFilter: (value, record) => record.category === value,
                      render: (category) => {
                        const cat = tagCategories.find(c => c.id === category);
                        return cat ? (
                          <div style={{
                            display: 'inline-flex',
                            alignItems: 'center',
                            gap: '6px',
                            background: `${cat.color}15`,
                            border: `1px solid ${cat.color}40`,
                            borderRadius: '18px',
                            padding: '4px 12px',
                            fontSize: '12px',
                            fontWeight: 500,
                            color: 'rgba(255, 255, 255, 0.9)',
                            whiteSpace: 'nowrap'
                          }}>
                            <div style={{
                              width: '6px',
                              height: '6px',
                              borderRadius: '50%',
                              background: cat.color,
                              flexShrink: 0
                            }} />
                            <span>{cat.name}</span>
                          </div>
                        ) : null;
                      },
                    },
                    {
                      title: '標籤值',
                      key: 'values',
                      width: '45%',
                      render: (_, record) => {
                        const maxDisplay = 3; // 最多顯示3個
                        const displayValues = record.values.slice(0, maxDisplay);
                        const hiddenCount = record.values.length - displayValues.length;

                        return (
                          <div style={{
                            display: 'flex',
                            flexWrap: 'wrap',
                            gap: '6px',
                            alignItems: 'center',
                            minHeight: '24px'
                          }}>
                            {displayValues.map(value => (
                              <div
                                key={value.id}
                                style={{
                                  display: 'inline-flex',
                                  alignItems: 'center',
                                  gap: '4px',
                                  padding: '3px 8px',
                                  fontSize: '12px',
                                  fontWeight: 500,
                                  borderRadius: '4px',
                                  background: `${value.color || '#666'}20`,
                                  border: `1px solid ${value.color || '#666'}40`,
                                  color: value.color || '#fff',
                                  cursor: 'pointer',
                                  transition: 'all 0.2s ease'
                                }}
                                onClick={() => handleEditValue(record, value)}
                                onMouseEnter={(e) => {
                                  e.target.style.background = `${value.color || '#666'}30`;
                                  e.target.style.borderColor = `${value.color || '#666'}60`;
                                }}
                                onMouseLeave={(e) => {
                                  e.target.style.background = `${value.color || '#666'}20`;
                                  e.target.style.borderColor = `${value.color || '#666'}40`;
                                }}
                              >
                                <div style={{
                                  width: '6px',
                                  height: '6px',
                                  borderRadius: '50%',
                                  backgroundColor: value.color || '#666',
                                  flexShrink: 0
                                }} />
                                <span>{value.displayName}</span>
                              </div>
                            ))}
                            {hiddenCount > 0 && (
                              <Tooltip
                                title={
                                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px', maxWidth: '300px' }}>
                                    {record.values.slice(maxDisplay).map(val => (
                                      <div
                                        key={val.id}
                                        style={{
                                          display: 'inline-flex',
                                          alignItems: 'center',
                                          gap: '3px',
                                          padding: '2px 6px',
                                          fontSize: '11px',
                                          fontWeight: 500,
                                          borderRadius: '4px',
                                          background: `${val.color || '#666'}25`,
                                          border: `1px solid ${val.color || '#666'}50`,
                                          color: val.color || '#fff'
                                        }}
                                      >
                                        <div style={{
                                          width: '4px',
                                          height: '4px',
                                          borderRadius: '50%',
                                          backgroundColor: val.color || '#666'
                                        }} />
                                        <span>{val.displayName}</span>
                                      </div>
                                    ))}
                                  </div>
                                }
                                placement="topLeft"
                              >
                                <div style={{
                                  display: 'inline-flex',
                                  alignItems: 'center',
                                  justifyContent: 'center',
                                  background: 'rgba(255, 255, 255, 0.1)',
                                  color: 'rgba(255, 255, 255, 0.7)',
                                  padding: '2px 8px',
                                  borderRadius: '12px',
                                  fontSize: '11px',
                                  cursor: 'pointer',
                                  border: '1px solid rgba(255, 255, 255, 0.15)',
                                  transition: 'all 0.2s ease'
                                }}>
                                  +{hiddenCount}
                                </div>
                              </Tooltip>
                            )}
                            {record.values.length === 0 && (
                              <span style={{
                                color: 'rgba(255, 255, 255, 0.4)',
                                fontSize: '12px',
                                fontStyle: 'italic'
                              }}>
                                暫無值
                              </span>
                            )}
                          </div>
                        );
                      },
                    },
                    {
                      title: '必填',
                      dataIndex: 'required',
                      key: 'required',
                      width: '8%',
                      align: 'center',
                      filters: [
                        { text: '必填', value: true },
                        { text: '選填', value: false },
                      ],
                      onFilter: (value, record) => record.required === value,
                      render: (required) => (
                        <div style={{ display: 'flex', justifyContent: 'center' }}>
                          <div style={{
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            width: '18px',
                            height: '18px',
                            borderRadius: '50%',
                            background: required ? 'rgba(245, 34, 45, 0.1)' : 'rgba(255, 255, 255, 0.05)',
                            border: `1px solid ${required ? 'rgba(245, 34, 45, 0.3)' : 'rgba(255, 255, 255, 0.15)'}`,
                            fontSize: '11px',
                            fontWeight: 600,
                            color: required ? '#f5222d' : 'rgba(255, 255, 255, 0.5)',
                            lineHeight: 1
                          }}>
                            {required ? '!' : ''}
                          </div>
                        </div>
                      ),
                    },
                    {
                      title: '使用次數',
                      dataIndex: 'totalUsage',
                      key: 'totalUsage',
                      width: '8%',
                      sorter: (a, b) => a.totalUsage - b.totalUsage,
                      render: (count) => (
                        <Text style={{ color: 'rgba(255, 255, 255, 0.9)' }}>
                          {count.toLocaleString()}
                        </Text>
                      ),
                    },
                    {
                      title: '操作',
                      key: 'action',
                      width: '20%',
                      align: 'center',
                      fixed: 'right',
                      render: (_, record) => (
                        <div style={{
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          gap: '4px'
                        }}>
                          <Tooltip title="新增值">
                            <Button
                              type="text"
                              size="small"
                              icon={<PlusOutlined />}
                              onClick={() => handleCreateValue(record)}
                              style={{
                                width: '28px',
                                height: '28px',
                                padding: 0,
                                fontSize: '12px',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                borderRadius: '4px',
                                color: 'var(--brand-primary)',
                                backgroundColor: 'transparent',
                                border: '1px solid var(--brand-primary)',
                                transition: 'all 0.2s ease'
                              }}
                            />
                          </Tooltip>
                          <Tooltip title="編輯">
                            <Button
                              type="text"
                              size="small"
                              icon={<EditOutlined />}
                              onClick={() => handleEditTag(record)}
                              style={{
                                width: '28px',
                                height: '28px',
                                padding: 0,
                                fontSize: '12px',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                borderRadius: '4px',
                                color: 'var(--text-tertiary)'
                              }}
                            />
                          </Tooltip>
                          <Tooltip title="刪除">
                            <Button
                              type="text"
                              danger
                              size="small"
                              icon={<DeleteOutlined />}
                              onClick={() => handleDeleteTag(record.id)}
                              style={{
                                width: '28px',
                                height: '28px',
                                padding: 0,
                                fontSize: '12px',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                borderRadius: '4px'
                              }}
                            />
                          </Tooltip>
                        </div>
                      ),
                    },
                  ]}
                  dataSource={filteredTags}
                  rowKey="id"
                  scroll={{ x: 1100 }}
                  pagination={{
                    total: filteredTags.length,
                    pageSize: 10,
                    showSizeChanger: true,
                    showQuickJumper: true,
                    showTotal: (total, range) => `第 ${range[0]}-${range[1]} 項，共 ${total} 項`,
                    responsive: true,
                    position: ['bottomRight'],
                    size: 'small'
                  }}
                  locale={{
                    emptyText: (
                      <div style={{ padding: '40px 20px', textAlign: 'center' }}>
                        <div style={{ fontSize: '48px', marginBottom: '16px', opacity: 0.3 }}>🏷️</div>
                        <div style={{ color: 'rgba(255, 255, 255, 0.7)', marginBottom: '8px' }}>暫無標籤資料</div>
                        <div style={{ color: 'rgba(255, 255, 255, 0.5)', fontSize: '12px' }}>建立第一個標籤來開始管理</div>
                      </div>
                    )
                  }}
                  size="small"
                  className="transparent-bg"
                  rowClassName={(record) =>
                    record.required ? 'required-tag-row' : ''
                  }
                /> :
                <Empty description="尚無任何標籤">
                  <Button type="primary" icon={<PlusOutlined />} onClick={handleCreateTag}>立即新增標籤</Button>
                </Empty>
            }
          </div>

          {/* 新增/編輯標籤彈窗 */}
          <Modal
            title={editingTag ? '編輯標籤' : '新增標籤'}
            open={isTagModalOpen}
            onCancel={handleTagCancel}
            footer={null}
            width={600}
          >
            <Form
              form={tagForm}
              layout="vertical"
              onFinish={handleTagSubmit}
              autoComplete="off"
            >
              <Row gutter={16}>
                <Col span={12}>
                  <Form.Item
                    label="標籤名稱"
                    name="name"
                    rules={[
                      { required: true, message: '請輸入標籤名稱' },
                      { pattern: /^[a-z][a-z0-9_-]*$/, message: '只能包含小寫字母、數字、下劃線和連字符，且須以字母開頭' },
                      { max: 50, message: '標籤名稱不能超過50個字符' }
                    ]}
                  >
                    <Input placeholder="例如：environment, team" onChange={handleTagNameChange} />
                  </Form.Item>
                </Col>
                <Col span={12}>
                  <Form.Item
                    label={
                      <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                        <span>顯示名稱</span>
                        {!tagDisplayNameManuallyChanged && (
                          <span style={{
                            fontSize: '11px',
                            color: 'rgba(255, 255, 255, 0.5)',
                            fontWeight: 400,
                            fontStyle: 'italic'
                          }}>
                            (自動同步)
                          </span>
                        )}
                      </div>
                    }
                    name="displayName"
                    rules={[
                      { required: true, message: '請輸入顯示名稱' },
                      { max: 100, message: '顯示名稱不能超過100個字符' }
                    ]}
                  >
                    <Input placeholder="例如：環境, 團隊" onChange={handleTagDisplayNameChange} />
                  </Form.Item>
                </Col>
              </Row>

              <Row gutter={16}>
                <Col span={12}>
                  <Form.Item
                    label="分類"
                    name="category"
                    rules={[{ required: true, message: '請選擇分類' }]}
                  >
                    <Select placeholder="選擇標籤分類">
                      {tagCategories.map(cat => (
                        <Select.Option key={cat.id} value={cat.id}>
                          <div style={{
                            display: 'inline-flex',
                            alignItems: 'center',
                            gap: '6px',
                            padding: '0 12px',
                            height: '26px',
                            background: `${cat.color}15`,
                            border: `1px solid ${cat.color}30`,
                            borderRadius: '12px',
                            fontSize: '12px',
                            fontWeight: 500,
                            color: cat.color,
                            margin: '7px 0',
                            boxSizing: 'border-box'
                          }}>
                            <div style={{
                              width: '6px',
                              height: '6px',
                              borderRadius: '50%',
                              backgroundColor: cat.color,
                              flexShrink: 0
                            }} />
                            <span>{cat.name}</span>
                          </div>
                        </Select.Option>
                      ))}
                    </Select>
                  </Form.Item>
                </Col>
                <Col span={12}>
                  <Form.Item
                    name="required"
                    valuePropName="checked"
                  >
                    <Checkbox>必填標籤</Checkbox>
                  </Form.Item>
                </Col>
              </Row>

              <Form.Item
                label="描述"
                name="description"
                rules={[
                  { required: true, message: '請輸入描述' },
                  { max: 500, message: '描述不能超過500個字符' }
                ]}
              >
                <Input.TextArea
                  rows={3}
                  placeholder="請詳細描述此標籤的用途和使用場景..."
                  showCount
                  maxLength={500}
                />
              </Form.Item>

              <Form.Item style={{ marginBottom: 0, marginTop: '24px' }}>
                <div style={{
                  display: 'flex',
                  justifyContent: 'flex-end',
                  gap: '8px'
                }}>
                  <Button onClick={handleTagCancel}>
                    取消
                  </Button>
                  <Button type="primary" htmlType="submit">
                    {editingTag ? '更新' : '創建'}
                  </Button>
                </div>
              </Form.Item>
            </Form>
          </Modal>

          {/* 管理標籤值彈窗 */}
          <Modal
            title={
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <SettingOutlined />
                <span>管理標籤值: {selectedTagForValue?.displayName}</span>
              </div>
            }
            open={isValueModalOpen}
            onCancel={handleValueCancel}
            footer={null}
            width={800}
            style={{ top: 20 }}
          >
            <div style={{ display: 'flex', gap: '24px', minHeight: '500px' }}>
              {/* 左側：表單區域 */}
              <div style={{
                flex: '0 0 320px',
                padding: '20px',
                background: 'rgba(255, 255, 255, 0.03)',
                borderRadius: '8px',
                border: '1px solid rgba(255, 255, 255, 0.08)'
              }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  marginBottom: '20px',
                  paddingBottom: '16px',
                  borderBottom: '1px solid rgba(255, 255, 255, 0.1)'
                }}>
                  <div style={{
                    width: '6px',
                    height: '6px',
                    borderRadius: '50%',
                    background: '#1890ff'
                  }} />
                  <h4 style={{
                    margin: 0,
                    color: 'rgba(255, 255, 255, 0.9)',
                    fontSize: '14px',
                    fontWeight: 600
                  }}>
                    {editingValue ? '編輯標籤值' : '新增標籤值'}
                  </h4>
                </div>

                <Form
                  form={valueForm}
                  layout="vertical"
                  onFinish={handleValueSubmit}
                  autoComplete="off"
                >
                  <Form.Item
                    name="value"
                    label="標籤值"
                    rules={[{ required: true, message: '請輸入標籤值' }]}
                    style={{ marginBottom: '20px' }}
                  >
                    <Input
                      placeholder="例如: production, staging"
                      onChange={handleValueInputChange}
                      style={{
                        background: 'rgba(255, 255, 255, 0.05)',
                        border: '1px solid rgba(255, 255, 255, 0.15)',
                        color: 'rgba(255, 255, 255, 0.9)'
                      }}
                    />
                  </Form.Item>

                  <Form.Item
                    name="displayName"
                    label={
                      <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                        <span>顯示名稱</span>
                        {!displayNameManuallyChanged && (
                          <span style={{
                            fontSize: '11px',
                            color: 'rgba(255, 255, 255, 0.5)',
                            fontWeight: 400,
                            fontStyle: 'italic'
                          }}>
                            (自動同步)
                          </span>
                        )}
                      </div>
                    }
                    rules={[{ required: true, message: '請輸入顯示名稱' }]}
                    style={{ marginBottom: '20px' }}
                  >
                    <Input
                      placeholder="例如: 生產環境, 測試環境"
                      onChange={handleDisplayNameChange}
                      style={{
                        background: 'rgba(255, 255, 255, 0.05)',
                        border: '1px solid rgba(255, 255, 255, 0.15)',
                        color: 'rgba(255, 255, 255, 0.9)'
                      }}
                    />
                  </Form.Item>

                  <Form.Item
                    name="color"
                    label="顏色"
                    rules={[{ required: true, message: '請選擇顏色' }]}
                    style={{ marginBottom: '24px' }}
                  >
                    <Select placeholder="選擇顏色">
                      {['#f5222d', '#fa541c', '#fa8c16', '#faad14', '#fadb14', '#a0d911', '#52c41a', '#13c2c2', '#1890ff', '#2f54eb', '#722ed1', '#eb2f96'].map(color => (
                        <Select.Option key={color} value={color}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                            <div style={{ width: '16px', height: '16px', backgroundColor: color, borderRadius: '4px' }}></div>
                            <span style={{ fontFamily: 'monospace', fontSize: '12px' }}>{color}</span>
                          </div>
                        </Select.Option>
                      ))}
                    </Select>
                  </Form.Item>

                  <div style={{ display: 'flex', gap: '8px', justifyContent: 'flex-end' }}>
                    {editingValue && (
                      <Button
                        onClick={() => {
                          setEditingValue(null);
                          valueForm.resetFields();
                        }}
                        style={{
                          background: 'rgba(255, 255, 255, 0.05)',
                          border: '1px solid rgba(255, 255, 255, 0.15)',
                          color: 'rgba(255, 255, 255, 0.7)'
                        }}
                      >
                        取消
                      </Button>
                    )}
                    <Button type="primary" htmlType="submit">
                      {editingValue ? '更新' : '新增'}
                    </Button>
                  </div>
                </Form>
              </div>

              {/* 右側：列表區域 */}
              <div style={{ flex: 1 }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'space-between',
                  marginBottom: '16px',
                  paddingBottom: '12px',
                  borderBottom: '1px solid rgba(255, 255, 255, 0.1)'
                }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <h4 style={{
                      margin: 0,
                      color: 'rgba(255, 255, 255, 0.9)',
                      fontSize: '14px',
                      fontWeight: 600
                    }}>
                      現有值列表 ({selectedTagForValue?.values?.length || 0})
                    </h4>
                  </div>
                </div>

                <div style={{
                  maxHeight: '420px',
                  overflowY: 'auto',
                  paddingRight: '8px'
                }}>
                  {(selectedTagForValue?.values || []).length > 0 ? (
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                      {selectedTagForValue.values.map((item) => (
                        <div
                          key={item.id}
                          style={{
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'space-between',
                            padding: '12px 16px',
                            background: 'rgba(255, 255, 255, 0.03)',
                            border: '1px solid rgba(255, 255, 255, 0.08)',
                            borderRadius: '6px',
                            transition: 'all 0.2s ease'
                          }}
                          onMouseEnter={(e) => {
                            e.target.style.background = 'rgba(255, 255, 255, 0.05)';
                            e.target.style.borderColor = 'rgba(255, 255, 255, 0.15)';
                          }}
                          onMouseLeave={(e) => {
                            e.target.style.background = 'rgba(255, 255, 255, 0.03)';
                            e.target.style.borderColor = 'rgba(255, 255, 255, 0.08)';
                          }}
                        >
                          <div style={{ display: 'flex', alignItems: 'center', gap: '12px', flex: 1 }}>
                            {/* 顏色選擇器 - 編輯模式或普通模式 */}
                            {inlineEditingId === item.id ? (
                              <Select
                                value={inlineEditForm.color}
                                onChange={(color) => setInlineEditForm(prev => ({ ...prev, color }))}
                                style={{
                                  width: '80px',
                                  background: 'rgba(255, 255, 255, 0.05)',
                                  border: '1px solid rgba(255, 255, 255, 0.15)'
                                }}
                                size="small"
                                dropdownStyle={{ backgroundColor: '#1f1f1f', border: '1px solid rgba(255, 255, 255, 0.15)' }}
                              >
                                {['#f5222d', '#fa541c', '#fa8c16', '#faad14', '#fadb14', '#a0d911', '#52c41a', '#13c2c2', '#1890ff', '#2f54eb', '#722ed1', '#eb2f96'].map(color => (
                                  <Select.Option key={color} value={color}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                                      <div style={{ width: '12px', height: '12px', backgroundColor: color, borderRadius: '50%' }}></div>
                                    </div>
                                  </Select.Option>
                                ))}
                              </Select>
                            ) : (
                              <div style={{
                                width: '12px',
                                height: '12px',
                                backgroundColor: item.color,
                                borderRadius: '50%'
                              }} />
                            )}

                            <div style={{ flex: 1 }}>
                              {/* 顯示名稱 - 編輯模式或普通模式 */}
                              {inlineEditingId === item.id ? (
                                <Input
                                  value={inlineEditForm.displayName}
                                  onChange={(e) => setInlineEditForm(prev => ({ ...prev, displayName: e.target.value }))}
                                  size="small"
                                  style={{
                                    marginBottom: '4px',
                                    background: 'rgba(255, 255, 255, 0.05)',
                                    border: '1px solid rgba(255, 255, 255, 0.15)',
                                    color: 'rgba(255, 255, 255, 0.9)'
                                  }}
                                />
                              ) : (
                                <div style={{
                                  color: 'rgba(255, 255, 255, 0.9)',
                                  fontWeight: 500,
                                  fontSize: '13px',
                                  marginBottom: '2px'
                                }}>
                                  {item.displayName}
                                </div>
                              )}

                              {/* 標籤值 - 編輯模式或普通模式 */}
                              {inlineEditingId === item.id ? (
                                <Input
                                  value={inlineEditForm.value}
                                  onChange={(e) => setInlineEditForm(prev => ({ ...prev, value: e.target.value }))}
                                  size="small"
                                  style={{
                                    fontFamily: 'monospace',
                                    background: 'rgba(255, 255, 255, 0.05)',
                                    border: '1px solid rgba(255, 255, 255, 0.15)',
                                    color: 'rgba(255, 255, 255, 0.9)'
                                  }}
                                />
                              ) : (
                                <div style={{
                                  display: 'flex',
                                  alignItems: 'center',
                                  gap: '8px',
                                  fontSize: '11px',
                                  color: 'rgba(255, 255, 255, 0.6)'
                                }}>
                                  <span style={{ fontFamily: 'monospace' }}>{item.value}</span>
                                  <span>•</span>
                                  <span>使用 {item.usageCount} 次</span>
                                </div>
                              )}
                            </div>
                          </div>
                          <div style={{ display: 'flex', gap: '4px' }}>
                            {inlineEditingId === item.id ? (
                              // 編輯模式：顯示儲存和取消按鈕
                              <>
                                <Tooltip title="儲存">
                                  <Button
                                    type="text"
                                    size="small"
                                    icon={<CheckOutlined />}
                                    onClick={() => handleInlineSave(selectedTagForValue.id, item.id)}
                                    style={{
                                      width: '28px',
                                      height: '28px',
                                      color: '#52c41a'
                                    }}
                                  />
                                </Tooltip>
                                <Tooltip title="取消">
                                  <Button
                                    type="text"
                                    size="small"
                                    icon={<CloseOutlined />}
                                    onClick={handleInlineCancel}
                                    style={{
                                      width: '28px',
                                      height: '28px',
                                      color: 'rgba(255, 255, 255, 0.6)'
                                    }}
                                  />
                                </Tooltip>
                              </>
                            ) : (
                              // 普通模式：顯示編輯和刪除按鈕
                              <>
                                <Tooltip title="編輯">
                                  <Button
                                    type="text"
                                    size="small"
                                    icon={<EditOutlined />}
                                    onClick={() => handleInlineEdit(item)}
                                    style={{
                                      width: '28px',
                                      height: '28px',
                                      color: 'rgba(255, 255, 255, 0.6)'
                                    }}
                                  />
                                </Tooltip>
                                <Tooltip title="刪除">
                                  <Button
                                    type="text"
                                    danger
                                    size="small"
                                    icon={<DeleteOutlined />}
                                    onClick={() => handleDeleteValue(selectedTagForValue.id, item.id)}
                                    style={{
                                      width: '28px',
                                      height: '28px'
                                    }}
                                  />
                                </Tooltip>
                              </>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <div style={{
                      textAlign: 'center',
                      padding: '60px 20px',
                      color: 'rgba(255, 255, 255, 0.5)'
                    }}>
                      <div style={{ fontSize: '32px', marginBottom: '12px' }}>📝</div>
                      <div style={{ fontSize: '14px', marginBottom: '8px' }}>暫無標籤值</div>
                      <div style={{ fontSize: '12px' }}>使用左側表單新增第一個標籤值</div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </Modal>
        </React.Fragment>
      );
    };

    const NotificationChannelsPage = () => {
      const initialChannels = [
        { key: 'nc_1', name: 'Default Email', type: 'Email', enabled: true, lastTest: { result: 'success', time: dayjs().subtract(1, 'day') } },
        { key: 'nc_2', name: 'On-call Slack', type: 'Slack', enabled: true, lastTest: { result: 'success', time: dayjs().subtract(2, 'hour') } },
        { key: 'nc_3', name: 'Billing Webhook', type: 'Webhook', enabled: false, lastTest: { result: 'failed', time: dayjs().subtract(3, 'day'), message: 'Connection timed out' } },
      ];

      const [channels, setChannels] = useLocalStorageState('sre-channels', initialChannels);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingChannel, setEditingChannel] = useState(null);
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();

      const handleDelete = (key) => {
        modal.confirm({
          title: '確定要刪除此通知管道嗎？',
          icon: <ExclamationCircleOutlined />,
          content: '此操作無法復原。',
          okText: '確定',
          okType: 'danger',
          cancelText: '取消',
          onOk() {
            setChannels(channels.filter(c => c.key !== key));
            message.success('通知管道刪除成功');
          }
        });
      };

      const channelType = Form.useWatch('type', form);

      const showModal = (channel = null) => {
        setEditingChannel(channel);
        form.setFieldsValue(channel || { name: '', type: 'Email', enabled: true });
        setIsModalOpen(true);
      };
      const handleCancel = () => setIsModalOpen(false);
      const onFinish = (values) => message.success('儲存成功');
      const handleTest = () => {
        message.loading({ content: "正在發送測試訊息...", key: "test" });
        setTimeout(() => message.success({ content: "測試訊息發送成功", key: "test" }), 1000);
      }

      const columns = [
        { title: '啟用', dataIndex: 'enabled', width: '8%', render: e => <Switch defaultChecked={e} /> },
        { title: '名稱', dataIndex: 'name', width: '20%' },
        { title: '類型', dataIndex: 'type', width: '15%' },
        { title: '最近測試結果', dataIndex: 'lastTest', width: '15%', render: lt => <Tag color={lt && lt.result === 'success' ? 'green' : 'red'}>{lt && lt.result ? lt.result.toUpperCase() : 'UNKNOWN'}</Tag> },
        { title: '最近測試時間', dataIndex: 'lastTest', width: '20%', render: lt => lt && lt.time ? lt.time.fromNow() : '未知' },
        {
          title: '操作', key: 'action', width: '22%', render: (_, record) => (
            <Space size="small">
              <Tooltip title="編輯">
                <Button type="text" icon={<EditOutlined />} onClick={() => showModal(record)} />
              </Tooltip>
              <Tooltip title="刪除">
                <Button type="text" danger icon={<DeleteOutlined />} onClick={() => handleDelete(record.key)} />
              </Tooltip>
            </Space>
          )
        },
      ];

      return (
        <React.Fragment>
          {/* 工具列 */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="搜尋管道名稱或類型..."
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                篩選
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>匯出</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>
                新增通知管道
              </Button>
            </Space>
          </Space>

          <div className="table-wrapper">
            <Table columns={columns} dataSource={channels} rowKey="key" className="transparent-bg" />
          </div>
          <Modal title={editingChannel ? "編輯通知管道" : "新增通知管道"} open={isModalOpen} onCancel={handleCancel}
            footer={
              <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '12px' }}>
                <Button key="back" onClick={handleCancel}>取消</Button>
                <Button key="test" onClick={handleTest}>發送測試</Button>
                <Button key="submit" type="primary" onClick={() => form.submit()}>儲存</Button>
              </div>
            }
          >
            <Form form={form} layout="vertical" onFinish={onFinish} style={{ marginTop: 24 }}>
              <Form.Item name="name" label="名稱" rules={[{ required: true }]}><Input /></Form.Item>
              <Form.Item name="type" label="管道類型" rules={[{ required: true }]}>
                <Select>
                  <Select.Option value="Email">Email</Select.Option>
                  <Select.Option value="Webhook">Webhook (通用)</Select.Option>
                  <Select.Option value="Slack">Slack</Select.Option>
                  <Select.Option value="LINE Notify">LINE Notify</Select.Option>
                  <Select.Option value="SMS">SMS</Select.Option>
                </Select>
              </Form.Item>

              {channelType === 'Email' && (
                <React.Fragment>
                  <Form.Item name="to" label="收件人 (To)" rules={[{ required: true }]}><Input /></Form.Item>
                  <Form.Item name="cc" label="副本 (CC)"><Input /></Form.Item>
                  <Form.Item name="bcc" label="密件副本 (BCC)"><Input /></Form.Item>
                </React.Fragment>
              )}
              {channelType === 'Webhook' && (
                <React.Fragment>
                  <Form.Item name="webhook_url" label="Webhook URL" rules={[{ required: true, type: 'url' }]}><Input /></Form.Item>
                  <Form.Item name="webhook_method" label="HTTP 方法 (Method)" initialValue="POST">
                    <Select>
                      <Select.Option value="POST">POST</Select.Option>
                      <Select.Option value="PUT">PUT</Select.Option>
                    </Select>
                  </Form.Item>
                </React.Fragment>
              )}
              {channelType === 'Slack' && (
                <React.Fragment>
                  <Form.Item name="slack_url" label="Incoming Webhook URL" rules={[{ required: true, type: 'url' }]}><Input /></Form.Item>
                  <Form.Item name="slack_mention" label="提及對象 (Mention)"><Input placeholder="@channel, @here, or user_id" /></Form.Item>
                </React.Fragment>
              )}
              {channelType === 'LINE Notify' && (
                <Form.Item name="line_token" label="存取權杖 (Access Token)" rules={[{ required: true }]}><Input.Password /></Form.Item>
              )}
              {channelType === 'SMS' && (
                <Form.Item name="sms_recipient" label="收件人手機號碼" rules={[{ required: true }]}><Input placeholder="例如: +886912345678" /></Form.Item>
              )}
            </Form>
          </Modal>
        </React.Fragment >
      )
    };

    // 通知歷史頁面組件
    const NotificationHistoryPage = () => {
      const [dateRange, setDateRange] = useState([dayjs().subtract(7, 'days'), dayjs()]);
      const [statusFilter, setStatusFilter] = useState([]);
      const [channelFilter, setChannelFilter] = useState('');
      const [searchText, setSearchText] = useState('');
      const [isDetailOpen, setIsDetailOpen] = useState(false);
      const [selectedNotification, setSelectedNotification] = useState(null);

      // 模擬通知歷史數據
      const notificationHistory = [
        {
          id: 'n_1',
          timestamp: dayjs().subtract(2, 'hours'),
          status: 'SUCCESS',
          channel: 'Slack: #sre-alerts',
          alert: 'CPU high on db-prod-01',
          actor: 'system',
          message: '資料庫伺服器 CPU 使用率過高，已持續 15 分鐘超過 85%',
          errorMessage: null,
          payload: '{"channel": "#sre-alerts", "text": "CPU high on db-prod-01", "severity": "critical"}'
        },
        {
          id: 'n_2',
          timestamp: dayjs().subtract(4, 'hours'),
          status: 'FAILED',
          channel: 'Email: sre-team@company.com',
          alert: 'Memory high on web-prod-02',
          actor: 'system',
          message: 'Web 伺服器記憶體使用率異常',
          errorMessage: 'SMTP server timeout: connection refused',
          payload: '{"to": "sre-team@company.com", "subject": "Memory high on web-prod-02", "body": "..."}'
        },
        {
          id: 'n_3',
          timestamp: dayjs().subtract(1, 'day'),
          status: 'SUCCESS',
          channel: 'PagerDuty: SRE-OnCall',
          alert: 'Disk space low on storage-01',
          actor: 'system',
          message: '儲存空間不足警告',
          errorMessage: null,
          payload: '{"routing_key": "sre-oncall", "event_action": "trigger", "description": "Disk space low"}'
        },
        {
          id: 'n_4',
          timestamp: dayjs().subtract(2, 'days'),
          status: 'FAILED',
          channel: 'Webhook: monitoring-api',
          alert: 'Service down on api-gateway',
          actor: 'system',
          message: 'API 閘道器服務不可用',
          errorMessage: 'HTTP 500: Internal Server Error from webhook endpoint',
          payload: '{"alert": "Service down", "service": "api-gateway", "severity": "critical"}'
        },
        {
          id: 'n_5',
          timestamp: dayjs().subtract(3, 'days'),
          status: 'SUCCESS',
          channel: 'Teams: SRE Alerts',
          alert: 'Database connection pool exhausted',
          actor: 'system',
          message: '資料庫連接池耗盡，已自動重啟服務',
          errorMessage: null,
          payload: '{"webhook_url": "https://outlook.office.com/webhook/...", "title": "Database Alert", "text": "..."}'
        },
        {
          id: 'n_6',
          timestamp: dayjs().subtract(5, 'days'),
          status: 'FAILED',
          channel: 'SMS: +886912345678',
          alert: 'Critical service outage',
          actor: 'system',
          message: '核心服務完全不可用',
          errorMessage: 'SMS provider rejected: insufficient balance',
          payload: '{"to": "+886912345678", "message": "Critical service outage detected"}'
        }
      ];

      // 篩選數據
      const filteredData = notificationHistory.filter(item => {
        const statusMatch = statusFilter.length === 0 || statusFilter.includes(item.status);
        const channelMatch = !channelFilter || item.channel.toLowerCase().includes(channelFilter.toLowerCase());
        const searchMatch = !searchText ||
          item.alert.toLowerCase().includes(searchText.toLowerCase()) ||
          item.channel.toLowerCase().includes(searchText.toLowerCase());
        const dateMatch = (!dateRange[0] || item.timestamp.isAfter(dateRange[0].startOf('day'))) &&
          (!dateRange[1] || item.timestamp.isBefore(dateRange[1].endOf('day')));

        return statusMatch && channelMatch && searchMatch && dateMatch;
      });

      // 表格欄位
      const columns = [
        {
          title: '時間',
          dataIndex: 'timestamp',
          width: '180px',
          render: (timestamp) => timestamp.format('YYYY-MM-DD HH:mm:ss'),
          sorter: (a, b) => a.timestamp.unix() - b.timestamp.unix(),
          defaultSortOrder: 'descend'
        },
        {
          title: '狀態',
          dataIndex: 'status',
          width: '100px',
          render: (status) => (
            <Tag color={status === 'SUCCESS' ? 'success' : 'error'}>
              {status}
            </Tag>
          ),
          filters: [
            { text: 'SUCCESS', value: 'SUCCESS' },
            { text: 'FAILED', value: 'FAILED' }
          ],
          onFilter: (value, record) => record.status === value
        },
        {
          title: '接收管道',
          dataIndex: 'channel',
          width: '200px',
          render: (channel) => <span style={{ fontSize: '12px' }}>{channel}</span>
        },
        {
          title: '關聯告警',
          dataIndex: 'alert',
          render: (alert, record) => (
            <a
              href="#"
              onClick={(e) => {
                e.preventDefault();
                // 這裡可以跳轉到事件詳情頁面
                console.log('Navigate to alert:', record.alert);
              }}
              style={{ color: '#1890ff' }}
            >
              {alert}
            </a>
          )
        },
        {
          title: '操作者',
          dataIndex: 'actor',
          width: '100px',
          render: (actor) => <span style={{ fontSize: '12px' }}>{actor}</span>
        },
        {
          title: '操作',
          key: 'action',
          width: '80px',
          render: (_, record) => (
            <Button
              type="text"
              size="small"
              icon={<InfoCircleOutlined />}
              onClick={() => {
                setSelectedNotification(record);
                setIsDetailOpen(true);
              }}
            />
          )
        }
      ];

      return (
        <div>
          {/* 工具列 */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <RangePicker
                showTime
                value={dateRange}
                onChange={setDateRange}
                style={{ width: 400 }}
                placeholder={['開始時間', '結束時間']}
              />
              <Input.Search
                placeholder="搜尋告警摘要、資源名稱..."
                onChange={e => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                篩選
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>匯出</Button>
            </Space>
          </Space>

          {/* 通知歷史表格 */}
          <Card
            className="dashboard-card"
            title={
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <HistoryOutlined style={{ color: '#1890ff' }} />
                <span>通知歷史</span>
                <Badge count={filteredData.length} style={{ backgroundColor: '#1890ff' }} />
              </div>
            }
            bodyStyle={{ padding: '0' }}
          >
            <Table
              columns={columns}
              dataSource={filteredData}
              rowKey="id"
              size="small"
              pagination={{
                pageSize: 20,
                showSizeChanger: true,
                showQuickJumper: true,
                showTotal: (total, range) => `第 ${range[0]}-${range[1]} 條，共 ${total} 條`
              }}
              rowClassName={(record) => record.status === 'FAILED' ? 'row-error' : ''}
              scroll={{ x: 800 }}
            />
          </Card>

          {/* 詳情側邊欄 */}
          <Drawer
            title="通知詳情"
            placement="right"
            width={500}
            open={isDetailOpen}
            onClose={() => {
              setIsDetailOpen(false);
              setSelectedNotification(null);
            }}
          >
            {selectedNotification && (
              <div style={{ padding: '8px 0' }}>
                <Descriptions column={1} size="small">
                  <Descriptions.Item label="時間">
                    {selectedNotification.timestamp.format('YYYY-MM-DD HH:mm:ss')}
                  </Descriptions.Item>
                  <Descriptions.Item label="狀態">
                    <Tag color={selectedNotification.status === 'SUCCESS' ? 'success' : 'error'}>
                      {selectedNotification.status}
                    </Tag>
                  </Descriptions.Item>
                  <Descriptions.Item label="接收管道">
                    {selectedNotification.channel}
                  </Descriptions.Item>
                  <Descriptions.Item label="關聯告警">
                    <a href="#" style={{ color: '#1890ff' }}>{selectedNotification.alert}</a>
                  </Descriptions.Item>
                  <Descriptions.Item label="操作者">
                    {selectedNotification.actor}
                  </Descriptions.Item>
                </Descriptions>

                <Divider />

                <div style={{ marginBottom: '16px' }}>
                  <div style={{ fontWeight: 500, marginBottom: '8px' }}>通知內容預覽</div>
                  <div style={{
                    padding: '12px',
                    backgroundColor: 'rgba(0, 0, 0, 0.04)',
                    borderRadius: '4px',
                    fontSize: '12px',
                    fontFamily: 'monospace'
                  }}>
                    {selectedNotification.message}
                  </div>
                </div>

                {selectedNotification.errorMessage && (
                  <div style={{ marginBottom: '16px' }}>
                    <div style={{ fontWeight: 500, marginBottom: '8px', color: '#ff4d4f' }}>錯誤訊息</div>
                    <div style={{
                      padding: '12px',
                      backgroundColor: 'rgba(255, 77, 79, 0.1)',
                      borderRadius: '4px',
                      border: '1px solid rgba(255, 77, 79, 0.2)',
                      fontSize: '12px',
                      color: '#ff4d4f'
                    }}>
                      {selectedNotification.errorMessage}
                    </div>
                  </div>
                )}

                <div>
                  <div style={{ fontWeight: 500, marginBottom: '8px' }}>原始 Payload</div>
                  <div style={{
                    padding: '12px',
                    backgroundColor: 'rgba(0, 0, 0, 0.04)',
                    borderRadius: '4px',
                    fontSize: '11px',
                    fontFamily: 'monospace',
                    maxHeight: '200px',
                    overflowY: 'auto'
                  }}>
                    <pre>{selectedNotification.payload}</pre>
                  </div>
                </div>
              </div>
            )}
          </Drawer>
        </div>
      );
    };

    // 郵件設定頁面組件
    const EmailSettingsPage = () => {
      const [form] = Form.useForm();
      const { message } = antd.App.useApp();

      return (
        <React.Fragment>
          <Form form={form} layout="vertical">
            <Form.Item name="smtp_host" label="SMTP 伺服器" style={{ marginBottom: 8, maxWidth: '600px' }}>
              <Input placeholder="例如: smtp.gmail.com" />
            </Form.Item>
            <Form.Item name="smtp_port" label="埠號" style={{ marginBottom: 8, maxWidth: '600px' }}>
              <InputNumber placeholder="例如: 587" className="select-full" />
            </Form.Item>
            <Form.Item name="smtp_user" label="使用者名稱" style={{ marginBottom: 8, maxWidth: '600px' }}>
              <Input placeholder="輸入郵件帳號" />
            </Form.Item>
            <Form.Item name="smtp_pass" label="密碼" style={{ marginBottom: 12, maxWidth: '600px' }}>
              <Input.Password placeholder="輸入郵件密碼" />
            </Form.Item>

            {/* 操作按鈕 */}
            <div style={{ maxWidth: '600px', marginBottom: '12px' }}>
              <Form.Item style={{ marginBottom: 0 }}>
                <Space size="middle" style={{ width: '100%', justifyContent: 'flex-end' }}>
                  <Button className="modal-footer-btn">還原預設值</Button>
                  <Button type="primary" className="modal-footer-btn" onClick={() => message.success('郵件設定已儲存')}>
                    儲存
                  </Button>
                </Space>
              </Form.Item>
            </div>
          </Form>
        </React.Fragment>
      );
    };

    // 身份驗證設定頁面組件
    const AuthSettingsPage = () => {
      const [form] = Form.useForm();
      const { message } = antd.App.useApp();

      return (
        <React.Fragment>
          <Form form={form} layout="vertical">
            <Form.Item name="oidc_enabled" label="啟用 OIDC" style={{ marginBottom: 8, maxWidth: '600px' }}>
              <Select placeholder="選擇是否啟用">
                <Select.Option value={true}>啟用</Select.Option>
                <Select.Option value={false}>停用</Select.Option>
              </Select>
            </Form.Item>
            <Form.Item name="oidc_client_id" label="客戶端 ID" style={{ marginBottom: 8, maxWidth: '600px' }}>
              <Input placeholder="輸入客戶端 ID" />
            </Form.Item>
            <Form.Item name="oidc_client_secret" label="客戶端密鑰" style={{ marginBottom: 12, maxWidth: '600px' }}>
              <Input.Password placeholder="輸入客戶端密鑰" />
            </Form.Item>

            {/* 操作按鈕 */}
            <div style={{ maxWidth: '600px', marginBottom: '12px' }}>
              <Form.Item style={{ marginBottom: 0 }}>
                <Space size="middle" style={{ width: '100%', justifyContent: 'flex-end' }}>
                  <Button className="modal-footer-btn">還原預設值</Button>
                  <Button type="primary" className="modal-footer-btn" onClick={() => message.success('身份驗證設定已儲存')}>
                    儲存
                  </Button>
                </Space>
              </Form.Item>
            </div>
          </Form>
        </React.Fragment>
      );
    };

    // 平台設定頁面組件
    const PlatformSettingsPage = ({ onNavigate, pageKey }) => {
      const tabKey = ['tag-management', 'email-settings', 'auth-settings'].includes(pageKey) ? pageKey : 'tag-management';

      // 平台設定統計資料
      const settingsStats = {
        totalTags: 42,
        activeTags: 38,
        emailTemplates: 15,
        authSessions: 156,
        configChanges: 7,
        lastBackup: '2小時前'
      };

      return (
        <React.Fragment>
          <PageHeader
            title="平台設定管理"
            subtitle="管理平台基本配置，包括標籤系統、郵件設定和身份驗證機制"
            icon={<SettingOutlined />}
          />

          {/* 平台設定 KPI 儀表板 */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="標籤總數"
                  value={settingsStats.totalTags}
                  unit="個"
                  trend="+2.4%"
                  status="success"
                  description={`${settingsStats.activeTags} 個啟用中`}
                  icon={<TagsOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="郵件模板"
                  value={settingsStats.emailTemplates}
                  unit="個"
                  trend="0%"
                  status="info"
                  description="通知模板配置"
                  icon={<MailOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="活躍會話"
                  value={settingsStats.authSessions}
                  unit="個"
                  trend="+8.7%"
                  status="success"
                  description="用戶登入會話"
                  icon={<LockOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="配置異動"
                  value={settingsStats.configChanges}
                  unit="次"
                  trend="+40%"
                  status="warning"
                  description={`最後備份：${settingsStats.lastBackup}`}
                  icon={<FileProtectOutlined />}
                />
              </Col>
            </Row>
          </div>
          <Tabs
            defaultActiveKey={tabKey}
            onChange={(key) => onNavigate(key)}
            style={{
              '--tab-bar-margin': '0 0 var(--spacing-lg) 0'
            }}
          >
            <Tabs.TabPane
              tab={
                <span>
                  <TagsOutlined />
                  標籤管理
                </span>
              }
              key="tag-management"
            >
              <TagKeyManagementPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <MailOutlined />
                  郵件設定
                </span>
              }
              key="email-settings"
            >
              <EmailSettingsPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <LockOutlined />
                  身份驗證
                </span>
              }
              key="auth-settings"
            >
              <AuthSettingsPage />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    const SystemSettingsPage = () => {
      const [form] = Form.useForm();
      const { message } = antd.App.useApp();

      const handleSave = () => {
        form.validateFields().then(values => {
          console.log('保存設定:', values);
          message.success('設定已儲存');
        }).catch(err => {
          console.error('驗證錯誤:', err);
        });
      };

      const handleReset = () => {
        form.resetFields();
        message.info('已還原為預設值');
      };

      return (
        <SettingsLayout>
          <SettingsSection
            title="基本設定"
            description="配置系統的基本參數和偏好設定"
            actions={
              <Space>
                <PlatformButton onClick={handleReset}>
                  還原預設值
                </PlatformButton>
                <PlatformButton type="primary" onClick={handleSave}>
                  儲存設定
                </PlatformButton>
              </Space>
            }
          >
            <Form form={form} layout="vertical" className="settings-form">
              <SettingsFormRow
                label="系統名稱"
                description="設定系統顯示名稱，用於介面標題和通知訊息"
                required
              >
                <Input
                  placeholder="請輸入系統名稱"
                  style={{ width: '100%' }}
                />
              </SettingsFormRow>

              <SettingsFormRow
                label="系統時區"
                description="選擇系統預設時區，影響日誌和報告的時間顯示"
              >
                <Select
                  placeholder="選擇時區"
                  style={{ width: '100%' }}
                >
                  <Select.Option value="Asia/Taipei">
                    Asia/Taipei (GMT+8) - 台北時間
                  </Select.Option>
                  <Select.Option value="UTC">
                    UTC (GMT+0) - 世界協調時間
                  </Select.Option>
                  <Select.Option value="America/New_York">
                    America/New_York (GMT-5/-4) - 紐約時間
                  </Select.Option>
                  <Select.Option value="Europe/London">
                    Europe/London (GMT+0/+1) - 倫敦時間
                  </Select.Option>
                </Select>
              </SettingsFormRow>
            </Form>
          </SettingsSection>

          <SettingsSection
            title="通知設定"
            description="管理系統通知和告警的配置"
          >
            <Form.Item>
              <SettingsFormRow
                label="預設通知管道"
                description="選擇接收系統通知的預設管道"
              >
                <Select
                  placeholder="選擇通知管道"
                  style={{ width: '100%' }}
                >
                  <Select.Option value="email">電子郵件</Select.Option>
                  <Select.Option value="slack">Slack</Select.Option>
                  <Select.Option value="webhook">Webhook</Select.Option>
                </Select>
              </SettingsFormRow>

              <SettingsFormRow
                label="通知頻率限制"
                description="設定相同類型告警的最小通知間隔（分鐘）"
              >
                <InputNumber
                  min={1}
                  max={1440}
                  placeholder="15"
                  style={{ width: '100%' }}
                  addonAfter="分鐘"
                />
              </SettingsFormRow>
            </Form.Item>
          </SettingsSection>

          <SettingsSection
            title="安全設定"
            description="配置系統安全相關參數"
          >
            <Form.Item>
              <SettingsFormRow
                label="會話過期時間"
                description="用戶閒置多久後自動登出（小時）"
              >
                <InputNumber
                  min={1}
                  max={24}
                  placeholder="8"
                  style={{ width: '100%' }}
                  addonAfter="小時"
                />
              </SettingsFormRow>

              <SettingsFormRow
                label="登入失敗鎖定"
                description="連續登入失敗幾次後鎖定帳戶"
              >
                <InputNumber
                  min={3}
                  max={10}
                  placeholder="5"
                  style={{ width: '100%' }}
                  addonAfter="次"
                />
              </SettingsFormRow>
            </Form.Item>
          </SettingsSection>
        </SettingsLayout>
      );
    };
    const PlatformDiagnosticsPage = () => {
      const scriptHealthData = [
        { key: 1, name: 'Auto-scaling for Web Servers', total: 150, failed: 8, rate: 5.3 },
        { key: 2, name: 'Increase Database Disk Volume', total: 30, failed: 0, rate: 0 },
        { key: 3, name: 'Daily Backup', total: 7, failed: 1, rate: 14.3 },
      ];
      const channelHealthData = [
        { key: 1, name: 'On-call Slack', total: 532, failed: 1, rate: 0.2 },
        { key: 2, name: 'Default Email', total: 1024, failed: 0, rate: 0 },
        { key: 3, name: 'Billing Webhook', total: 50, failed: 6, rate: 12.0 },
      ];

      const healthColumns = [
        {
          title: <span style={{ color: 'rgba(255, 255, 255, 0.9)', fontWeight: '600' }}>名稱</span>,
          dataIndex: 'name',
          width: '40%',
          render: (name) => (
            <span style={{ color: 'rgba(255, 255, 255, 0.85)', fontWeight: '500' }}>{name}</span>
          )
        },
        {
          title: <span style={{ color: 'rgba(255, 255, 255, 0.9)', fontWeight: '600' }}>總次數</span>,
          dataIndex: 'total',
          width: '20%',
          align: 'center',
          render: (total) => (
            <span style={{ color: 'rgba(255, 255, 255, 0.75)', fontWeight: '500' }}>{total}</span>
          )
        },
        {
          title: <span style={{ color: 'rgba(255, 255, 255, 0.9)', fontWeight: '600' }}>失敗率</span>,
          dataIndex: 'rate',
          width: '40%',
          align: 'center',
          render: (rate) => (
            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
              <Progress
                percent={rate}
                status={rate > 5 ? 'exception' : 'normal'}
                size="small"
                style={{ flex: 1, minWidth: '80px' }}
                strokeColor={rate > 10 ? '#ff4d4f' : rate > 5 ? '#faad14' : '#52c41a'}
                trailColor="rgba(255, 255, 255, 0.1)"
              />
              <span style={{
                color: rate > 10 ? '#ff4d4f' : rate > 5 ? '#faad14' : '#52c41a',
                fontSize: '13px',
                fontWeight: '600',
                minWidth: '35px'
              }}>
                {rate}%
              </span>
            </div>
          )
        }
      ];

      return (
        <React.Fragment>
          <div style={{ marginBottom: 24 }}>
            <Radio.Group defaultValue="24h">
              <Radio.Button value="24h">過去 24 小時</Radio.Button>
              <Radio.Button value="7d">過去 7 天</Radio.Button>
            </Radio.Group>
          </div>

          <Row gutter={[24, 24]}>
            <Col span={12}>
              <div style={{ marginBottom: '24px' }}>
                <Title level={4} style={{ marginBottom: '16px', color: 'rgba(255, 255, 255, 0.85)', display: 'flex', alignItems: 'center', gap: '8px' }}>
                  <span style={{ color: '#52c41a', fontSize: '8px' }}>●</span>
                  自動化健康度
                </Title>
                <div className="table-wrapper" style={{ background: 'rgba(255, 255, 255, 0.05)', borderRadius: '8px' }}>
                  <Table
                    columns={healthColumns}
                    dataSource={scriptHealthData}
                    rowClassName={(record) => record.rate > 10 ? 'row-highlight' : ''}
                    pagination={false}
                    className="transparent-bg"
                    size="small"
                  />
                </div>
              </div>
            </Col>
            <Col span={12}>
              <div style={{ marginBottom: '24px' }}>
                <Title level={4} style={{ marginBottom: '16px', color: 'rgba(255, 255, 255, 0.85)', display: 'flex', alignItems: 'center', gap: '8px' }}>
                  <span style={{ color: '#1890ff', fontSize: '8px' }}>●</span>
                  通知管道健康度
                </Title>
                <div className="table-wrapper" style={{ background: 'rgba(255, 255, 255, 0.05)', borderRadius: '8px' }}>
                  <Table
                    columns={healthColumns}
                    dataSource={channelHealthData}
                    rowClassName={(record) => record.rate > 10 ? 'row-highlight' : ''}
                    pagination={false}
                    className="transparent-bg"
                    size="small"
                  />
                </div>
              </div>
            </Col>
          </Row>
        </React.Fragment>
      );
    };

    const AuditLogsPage = () => {
      const [drawer, setDrawer] = useState({ open: false, data: null });
      const initialLogs = [
        { key: 1, time: dayjs().subtract(5, 'minutes'), user: 'admin', action: 'execute', type: 'Script', id: 's_1', result: 'success' },
        { key: 2, time: dayjs().subtract(1, 'hour'), user: 'admin', action: 'update', type: 'AlertRule', id: 'rule_2', result: 'success', diff: { before: 'severity: warning', after: 'severity: critical' } },
        { key: 3, time: dayjs().subtract(3, 'hour'), user: 'dev_user', action: 'login', type: 'User', id: 'dev_user', result: 'success' },
        { key: 4, time: dayjs().subtract(4, 'hour'), user: 'system', action: 'create', type: 'Incident', id: 'i_4', result: 'failure', message: 'Rate limit exceeded' },
      ];

      const showDrawer = (record) => setDrawer({ open: true, data: record });
      const closeDrawer = () => setDrawer({ open: false, data: null });

      // 將資源ID轉換為資源名稱的輔助函數
      const getResourceName = (type, id) => {
        const resourceMap = {
          'Script': { 's_1': '每日備份腳本', 's_2': '清理腳本', 's_3': '監控腳本' },
          'AlertRule': { 'rule_1': 'CPU告警規則', 'rule_2': '記憶體告警規則', 'rule_3': '磁碟告警規則' },
          'User': { 'admin': '管理員', 'dev_user': '開發人員', 'system': '系統' },
          'Incident': { 'i_1': '服務中斷事件', 'i_2': '效能問題', 'i_3': '配置錯誤', 'i_4': '網路問題' }
        };
        return resourceMap[type]?.[id] || id;
      };

      const columns = [
        { title: '時間', dataIndex: 'time', render: t => t ? t.format('YYYY-MM-DD HH:mm:ss') : '-', width: '16%' },
        { title: '操作者', dataIndex: 'user', width: '10%' },
        { title: '動作', dataIndex: 'action', render: a => <Tag>{a ? a.toUpperCase() : 'UNKNOWN'}</Tag>, width: '8%' },
        { title: '資源類型', dataIndex: 'type', width: '10%' },
        { title: '腳本名稱', dataIndex: 'id', render: (id, record) => record.type === 'Script' ? getResourceName(record.type, id) : '-', width: '14%' },
        { title: '資源名稱', dataIndex: 'id', render: (id, record) => record.type !== 'Script' ? getResourceName(record.type, id) : '-', width: '14%' },
        { title: '結果', dataIndex: 'result', render: r => <Tag color={r === 'success' ? 'green' : 'red'}>{r ? r.toUpperCase() : 'UNKNOWN'}</Tag>, width: '8%' },
        {
          title: '操作', key: 'action', render: (_, record) => (
            <Tooltip title="查看詳情">
              <Button type="text" icon={<InfoCircleOutlined />} onClick={() => showDrawer(record)} />
            </Tooltip>
          ), width: '10%'
        },
      ];

      return (
        <React.Fragment>
          {/* 工具列 */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <RangePicker showTime />
              <Input placeholder="搜尋使用者..." style={{ width: 200 }} />
              <Select placeholder="動作類型" style={{ width: 150 }}>
                <Select.Option value="create">Create</Select.Option>
                <Select.Option value="update">Update</Select.Option>
                <Select.Option value="delete">Delete</Select.Option>
                <Select.Option value="login">Login</Select.Option>
              </Select>
              <Button className="toolbar-btn" icon={<SearchOutlined />}>
                查詢
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>匯出</Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            <Table columns={columns} dataSource={initialLogs} rowKey="key" rowClassName={r => r.result === 'failure' ? 'row-highlight' : ''} className="transparent-bg" size="small" />
          </div>
          <Drawer title="日誌詳情" onClose={closeDrawer} open={drawer.open} width={500}>
            {drawer.data && (
              <List>
                <List.Item><Text strong>時間:</Text> {drawer.data.time ? drawer.data.time.format('YYYY-MM-DD HH:mm:ss') : '-'}</List.Item>
                <List.Item><Text strong>操作者:</Text> {drawer.data.user}</List.Item>
                <List.Item><Text strong>動作:</Text> {drawer.data.action}</List.Item>
                <List.Item><Text strong>資源:</Text> {drawer.data.type} ({drawer.data.id})</List.Item>
                <List.Item><Text strong>結果:</Text> <Tag color={drawer.data && drawer.data.result === 'success' ? 'green' : 'red'}>{drawer.data && drawer.data.result ? drawer.data.result.toUpperCase() : 'UNKNOWN'}</Tag></List.Item>
                {drawer.data.message && <List.Item><Text strong>訊息:</Text> {drawer.data.message}</List.Item>}
                {drawer.data.diff && (
                  <List.Item>
                    <pre>
                      <strong>變更差異:</strong><br />
                      - {drawer.data.diff.before}<br />
                      + {drawer.data.diff.after}
                    </pre>
                  </List.Item>
                )}
              </List>
            )}
          </Drawer>
        </React.Fragment>
      );
    };

    // 通用佔位符頁面組件 - 統一使用PageHeader
    const PlaceholderPage = ({ title, subtitle, icon }) => {
      return (
        <React.Fragment>
          <PageHeader
            title={title}
            subtitle={subtitle}
            icon={icon}
          />
          <div style={{
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            height: '50vh',
            textAlign: 'center'
          }}>
            <div style={{
              fontSize: '64px',
              color: 'var(--text-quaternary)',
              marginBottom: 'var(--spacing-xl)'
            }}>
              {icon || <FileTextOutlined />}
            </div>
            <Title level={3} style={{
              color: 'var(--text-secondary)',
              marginBottom: 'var(--spacing-md)'
            }}>
              即將推出
            </Title>
            <div style={{
              padding: 'var(--spacing-lg)',
              backgroundColor: 'var(--bg-secondary)',
              borderRadius: 'var(--border-radius)',
              border: '1px dashed var(--border-base)',
              color: 'var(--text-tertiary)',
              fontSize: '14px',
              maxWidth: '400px'
            }}>
              🚧 此功能正在開發中，敬請期待
            </div>
          </div>
        </React.Fragment>
      );
    };

    // 個人資訊組件
    const PersonalInfoPage = () => {
      const [form] = Form.useForm();
      return (
        <div style={{ maxWidth: 500, paddingTop: 16 }}>
          <Form layout="vertical" form={form}>
            <Form.Item label="姓名" name="name" initialValue="Admin User">
              <Input />
            </Form.Item>
            <Form.Item label="電子郵件" name="email" initialValue="admin@example.com">
              <Input disabled />
            </Form.Item>
            <Form.Item style={{ marginBottom: 0 }}>
              <div style={{ width: '100%', display: 'flex', justifyContent: 'flex-end' }}>
                <Button type="primary" onClick={() => message.success('個人資訊已更新')}>
                  更新個人資訊
                </Button>
              </div>
            </Form.Item>
          </Form>
        </div>
      );
    };

    // 密碼安全組件
    const PasswordSecurityPage = () => {
      const [form] = Form.useForm();
      return (
        <div style={{ maxWidth: 500, paddingTop: 16 }}>
          <Form layout="vertical" form={form}>
            <Form.Item label="目前密碼" name="currentPassword">
              <Input.Password />
            </Form.Item>
            <Form.Item label="新密碼" name="newPassword">
              <Input.Password />
            </Form.Item>
            <Form.Item label="確認新密碼" name="confirmPassword">
              <Input.Password />
            </Form.Item>
            <Form.Item style={{ marginBottom: 0 }}>
              <div style={{ width: '100%', display: 'flex', justifyContent: 'flex-end' }}>
                <Button type="primary" onClick={() => message.success('密碼已更新')}>
                  更新密碼
                </Button>
              </div>
            </Form.Item>
          </Form>
        </div>
      );
    };

    // 偏好設定組件
    const PreferencesPage = ({ themeMode, setThemeMode }) => {
      const [form] = Form.useForm();
      return (
        <div style={{ maxWidth: 500, paddingTop: 16 }}>
          <Form layout="vertical" form={form}>
            <Form.Item label="介面主題" name="theme">
              <Select value={themeMode} onChange={setThemeMode}>
                <Select.Option value="dark">Dark</Select.Option>
                <Select.Option value="light">Light</Select.Option>
              </Select>
            </Form.Item>
            <Form.Item label="預設頁面" name="homeDashboard" initialValue="default">
              <Select>
                <Select.Option value="default">Default</Select.Option>
              </Select>
            </Form.Item>
            <Form.Item label="時區" name="timezone" initialValue="utc">
              <Select>
                <Select.Option value="utc">UTC</Select.Option>
                <Select.Option value="local">Browser Time</Select.Option>
              </Select>
            </Form.Item>
            <Form.Item style={{ marginBottom: 0 }}>
              <div style={{ width: '100%', display: 'flex', justifyContent: 'flex-end' }}>
                <Button type="primary" onClick={() => message.success('偏好設定已儲存')}>
                  儲存偏好設定
                </Button>
              </div>
            </Form.Item>
          </Form>
        </div>
      );
    };

    const ProfilePage = ({ themeMode, setThemeMode }) => {
      const [activeTab, setActiveTab] = useState('personal-info');

      return (
        <React.Fragment>
          <div style={{ marginBottom: 'var(--spacing-lg)' }}>
            <Title level={2} className="page-title" style={{ marginBottom: '4px' }}>個人資料與偏好設定</Title>
            <Paragraph className="page-subtitle" type="secondary" style={{ margin: 0 }}>
              管理您的個人資訊、密碼與通知偏好。
            </Paragraph>
          </div>
          <Tabs activeKey={activeTab} onChange={setActiveTab}>
            <Tabs.TabPane tab="個人資訊" key="personal-info">
              <PersonalInfoPage />
            </Tabs.TabPane>
            <Tabs.TabPane tab="密碼安全" key="password-security">
              <PasswordSecurityPage />
            </Tabs.TabPane>
            <Tabs.TabPane tab="偏好設定" key="preferences">
              <PreferencesPage themeMode={themeMode} setThemeMode={setThemeMode} />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    const UserPermissionsPage = ({ onNavigate, pageKey }) => {
      const tabKey = ['user-management', 'team-management', 'role-management'].includes(pageKey) ? pageKey : 'user-management';

      // 用戶與權限統計資料
      const userStats = {
        totalUsers: 156,
        activeUsers: 142,
        totalTeams: 12,
        totalRoles: 8,
        onlineUsers: 89,
        pendingInvitations: 5
      };

      return (
        <div className="page-container">
          {/* 統一頁面標題 */}
          <div className="page-header-unified">
            <div className="page-title-section">
              <div className="page-title-icon">
                👤
              </div>
              <div>
                <h1 className="page-title-text">用戶與權限管理</h1>
                <p className="page-subtitle">管理平台用戶帳戶、團隊組織架構和權限角色配置</p>
              </div>
            </div>
            <div className="page-actions">
              <button className="platform-btn platform-btn-ghost platform-btn-sm">
                📊 匯出用戶報告
              </button>
              <button className="platform-btn platform-btn-primary platform-btn-sm">
                ➕ 邀請用戶
              </button>
            </div>
          </div>

          {/* 統一 KPI 卡片系統 */}
          <div className="kpi-grid-unified">
            <div className="kpi-card-unified">
              <div className="kpi-header">
                <span className="kpi-label">總用戶數</span>
                <div className="kpi-trend positive">↗ +5.2%</div>
              </div>
              <div className="kpi-value">{userStats.totalUsers}</div>
              <div className="kpi-subtitle">{userStats.activeUsers} 個啟用中</div>
            </div>

            <div className="kpi-card-unified">
              <div className="kpi-header">
                <span className="kpi-label">在線用戶</span>
                <div className="kpi-trend positive">↗ +12.1%</div>
              </div>
              <div className="kpi-value">{userStats.onlineUsers}</div>
              <div className="kpi-subtitle">目前活躍用戶</div>
            </div>

            <div className="kpi-card-unified">
              <div className="kpi-header">
                <span className="kpi-label">團隊數量</span>
                <div className="kpi-trend neutral">→ 0%</div>
              </div>
              <div className="kpi-value">{userStats.totalTeams}</div>
              <div className="kpi-subtitle">組織架構穩定</div>
            </div>

            <div className="kpi-card-unified">
              <div className="kpi-header">
                <span className="kpi-label">待處理邀請</span>
                <div className="kpi-trend negative">↗ +25%</div>
              </div>
              <div className="kpi-value">{userStats.pendingInvitations}</div>
              <div className="kpi-subtitle">需要跟進處理</div>
            </div>
          </div>
          {/* 統一標籤導航 */}
          <div className="tab-navigation">
            <button
              className={`tab-item ${tabKey === 'user-management' ? 'active' : ''}`}
              onClick={() => onNavigate('user-management')}
            >
              👤 人員管理
            </button>
            <button
              className={`tab-item ${tabKey === 'team-management' ? 'active' : ''}`}
              onClick={() => onNavigate('team-management')}
            >
              👥 團隊管理
            </button>
            <button
              className={`tab-item ${tabKey === 'role-management' ? 'active' : ''}`}
              onClick={() => onNavigate('role-management')}
            >
              🔒 角色權限
            </button>
          </div>

          {/* 標籤內容 */}
          <div className="tab-content">
            {tabKey === 'user-management' && (
              <div className="table-container-unified">
                <div className="table-header-unified">
                  <h3 className="table-title">用戶列表</h3>
                  <div className="table-actions">
                    <div className="search-input-container">
                      <input
                        type="text"
                        className="table-search"
                        placeholder="搜尋用戶名稱或信箱..."
                      />
                      <div className="search-input-icon">🔍</div>
                    </div>
                    <div className="table-density-controls">
                      <button className="table-density-btn active" title="緊湊">⊞</button>
                      <button className="table-density-btn" title="標準">⊠</button>
                      <button className="table-density-btn" title="舒適">⊡</button>
                    </div>
                    <button className="platform-btn platform-btn-primary platform-btn-sm">
                      ➕ 新增用戶
                    </button>
                  </div>
                </div>
                <table className="table-unified">
                  <thead>
                    <tr>
                      <th>用戶</th>
                      <th>角色</th>
                      <th>團隊</th>
                      <th className="hide-on-mobile">最後登入</th>
                      <th className="hide-on-tablet">狀態</th>
                      <th>操作</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                          <div className="loading-skeleton circle"></div>
                          <div>
                            <div style={{ fontWeight: '500' }}>張小明</div>
                            <div style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>zhang@company.com</div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <span className="status-indicator healthy">
                          <span className="status-dot"></span>
                          管理員
                        </span>
                      </td>
                      <td>平台運維團隊</td>
                      <td className="hide-on-mobile">2小時前</td>
                      <td className="hide-on-tablet">
                        <span className="status-indicator healthy">
                          <span className="status-dot"></span>
                          活躍
                        </span>
                      </td>
                      <td>
                        <div className="table-row-actions">
                          <button className="table-action-btn" title="編輯">✏️</button>
                          <button className="table-action-btn" title="重設密碼">🔑</button>
                          <button className="table-action-btn danger" title="停用">🚫</button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            )}
            {tabKey === 'team-management' && (
              <div className="empty-state">
                <div className="empty-state-icon">👥</div>
                <h3 className="empty-state-title">團隊管理</h3>
                <p className="empty-state-desc">管理組織團隊架構，設定團隊成員和權限配置。</p>
                <div className="empty-state-action">
                  <button className="platform-btn platform-btn-primary">建立新團隊</button>
                </div>
              </div>
            )}
            {tabKey === 'role-management' && (
              <div className="empty-state">
                <div className="empty-state-icon">🔒</div>
                <h3 className="empty-state-title">角色權限管理</h3>
                <p className="empty-state-desc">設定和管理用戶角色，配置細緻的權限控制。</p>
                <div className="empty-state-action">
                  <button className="platform-btn platform-btn-primary">建立新角色</button>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    const NotificationManagementPage = ({ onNavigate, pageKey }) => {
      const tabKey = ['notification-strategies', 'notification-channels', 'notification-history'].includes(pageKey) ? pageKey : 'notification-strategies';

      // 通知系統統計資料
      const notificationStats = {
        totalChannels: 8,
        activeChannels: 6,
        todayNotifications: 47,
        deliveryRate: 97.3,
        failedNotifications: 2,
        avgResponseTime: 1.2
      };

      return (
        <React.Fragment>
          <PageHeader
            title="通知管理"
            subtitle="配置通知策略和訊息傳送管道，確保關鍵資訊及時傳達"
            icon={<BellOutlined />}
          />

          {/* 通知系統 KPI 總覽 */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} md={8}>
                <ContextualKPICard
                  title="通知管道"
                  value={notificationStats.activeChannels}
                  unit={`/${notificationStats.totalChannels}`}
                  trend="stable"
                  status="success"
                  description="已啟用的通知管道"
                  icon={<BellOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={8}>
                <ContextualKPICard
                  title="今日通知量"
                  value={notificationStats.todayNotifications}
                  unit="則"
                  trend="up"
                  status="info"
                  description={`${notificationStats.failedNotifications} 則發送失敗`}
                  icon={<MailOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={8}>
                <ContextualKPICard
                  title="送達率"
                  value={notificationStats.deliveryRate}
                  unit="%"
                  trend={notificationStats.deliveryRate >= 95 ? 'up' : 'down'}
                  status={notificationStats.deliveryRate >= 95 ? 'success' : 'warning'}
                  description={`平均回應時間 ${notificationStats.avgResponseTime}s`}
                  icon={<CheckCircleOutlined />}
                />
              </Col>
            </Row>
          </div>

          {/* 卡片式分組佈局 */}
          <div style={{ marginBottom: 'var(--spacing-lg)' }}>
            <Row gutter={[24, 24]}>
              {/* 管道狀態概覽 */}
              <Col xs={24}>
                <Card
                  className="dashboard-card"
                  title={
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <MonitorOutlined style={{ color: '#1890ff' }} />
                      <span>管道狀態概覽</span>
                    </div>
                  }
                  bodyStyle={{ padding: '16px' }}
                >
                  <Row gutter={[16, 16]}>
                    {[
                      { name: 'Email', status: 'active', lastTest: '2小時前', rate: '99.2%' },
                      { name: 'Slack', status: 'active', lastTest: '1小時前', rate: '98.7%' },
                      { name: 'Teams', status: 'active', lastTest: '30分鐘前', rate: '97.8%' },
                      { name: 'Webhook', status: 'warning', lastTest: '失敗', rate: '0%' },
                      { name: 'PagerDuty', status: 'active', lastTest: '15分鐘前', rate: '100%' },
                      { name: 'SMS', status: 'inactive', lastTest: '未測試', rate: '-' }
                    ].map(channel => (
                      <Col xs={24} sm={8} md={4} key={channel.name}>
                        <div style={{
                          padding: '12px',
                          backgroundColor: 'rgba(255, 255, 255, 0.02)',
                          borderRadius: '6px',
                          border: '1px solid rgba(255, 255, 255, 0.06)'
                        }}>
                          <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
                            <div style={{ marginRight: '8px' }}>
                              {channel.status === 'active' ? (
                                <Badge status="success" />
                              ) : channel.status === 'warning' ? (
                                <Badge status="warning" />
                              ) : (
                                <Badge status="default" />
                              )}
                            </div>
                            <span style={{ fontWeight: 500 }}>{channel.name}</span>
                          </div>
                          <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                            <div>成功率: {channel.rate}</div>
                            <div>最後測試: {channel.lastTest}</div>
                          </div>
                        </div>
                      </Col>
                    ))}
                  </Row>
                </Card>
              </Col>
            </Row>
          </div>

          <Tabs
            defaultActiveKey={tabKey}
            onChange={(key) => onNavigate(key)}
            style={{
              '--tab-bar-margin': '0 0 var(--spacing-lg) 0'
            }}
          >
            <Tabs.TabPane
              tab={
                <span>
                  <SettingOutlined />
                  通知策略
                </span>
              }
              key="notification-strategies"
            >
              <NotificationStrategiesPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <BellOutlined />
                  通知管道
                </span>
              }
              key="notification-channels"
            >
              <NotificationChannelsPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <HistoryOutlined />
                  通知歷史
                </span>
              }
              key="notification-history"
            >
              <NotificationHistoryPage />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    const PlatformOperationsPage = ({ onNavigate, pageKey }) => {
      const tabKey = ['platform-diagnostics', 'audit-logs'].includes(pageKey) ? pageKey : 'platform-diagnostics';

      return (
        <React.Fragment>
          <PageHeader
            title="平台維運"
            subtitle="監控和審計平台自身的健康與活動"
            icon={<ControlOutlined />}
          />
          <Tabs defaultActiveKey={tabKey} onChange={(key) => onNavigate(key)}>
            <Tabs.TabPane tab="平台診斷" key="platform-diagnostics">
              <PlatformDiagnosticsPage />
            </Tabs.TabPane>
            <Tabs.TabPane tab="審計日誌" key="audit-logs">
              <AuditLogsPage />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };


    // --- Main App Component ---
    const MainApp = ({ themeMode, setThemeMode }) => {
      const [currentPage, setCurrentPage] = useState('home');
      const [pageParams, setPageParams] = useState({});
      const [collapsed, setCollapsed] = useState(false);
      const [isSearchModalOpen, setIsSearchModalOpen] = useState(false);

      // 增強的導航函數，支持參數傳遞
      const navigateToPage = (pageKey, params = {}) => {
        setCurrentPage(pageKey);
        setPageParams(params);
      };

      const { message } = antd.App.useApp();

      const initialScripts = [
        { key: 's_1', name: 'Auto-scaling for Web Servers', type: 'Python', description: '自動擴展 Web 伺服器實例', creator: 'admin', code: '# Python script to scale web servers\nprint("Scaling up web servers...")', params: [{ name: 'instance_count', type: 'number', label: '實例數量' }], status: 'active', category: 'deployment', executionCount: 45 },
        { key: 's_2', name: 'Increase Database Disk Volume', type: 'Bash', description: '增加資料庫磁碟區容量', creator: 'admin', code: '#!/bin/bash\n# Bash script to increase disk volume\necho "Increasing DB disk size..."', params: [{ name: 'increase_gb', type: 'number', label: '增加容量 (GB)' }], status: 'active', category: 'maintenance', executionCount: 32 },
        { key: 's_3', name: 'Daily Backup', type: 'Python', description: '每日資料庫備份', creator: 'dev_user', code: '# Python script for daily backup\nprint("Starting daily backup...")', status: 'active', category: 'maintenance', executionCount: 28 },
        { key: 's_4', name: 'System Health Check', type: 'Bash', description: '系統健康狀態檢查', creator: 'ops_team', code: '#!/bin/bash\n# System health check script\necho "Checking system health..."', params: [{ name: 'check_type', type: 'select', label: '檢查類型', options: ['basic', 'detailed', 'comprehensive'] }], status: 'active', category: 'monitoring', executionCount: 156 },
        { key: 's_5', name: 'Log Rotation', type: 'Python', description: '應用程式日誌輪替', creator: 'dev_team', code: '# Python script for log rotation\nprint("Rotating application logs...")', params: [{ name: 'retention_days', type: 'number', label: '保留天數' }], status: 'active', category: 'maintenance', executionCount: 89 },
        { key: 's_6', name: 'Cache Warmup', type: 'Bash', description: '快取預熱腳本', creator: 'cache_admin', code: '#!/bin/bash\n# Cache warmup script\necho "Warming up cache..."', params: [{ name: 'warmup_urls', type: 'textarea', label: '預熱 URL 列表' }], status: 'active', category: 'performance', executionCount: 67 },
      ];
      const initialExecutions = [
        { key: 'e_1', scriptName: 'Auto-scaling for Web Servers', trigger: { type: 'Event', eventId: 'i_2', eventSummary: 'Disk space low on web-prod-02' }, status: 'success', startTime: dayjs().subtract(2, 'hour'), duration: '5.2s' },
        { key: 'e_2', scriptName: 'Increase Database Disk Volume', trigger: { type: 'Manual', user: 'admin' }, status: 'failed', startTime: dayjs().subtract(1, 'day'), duration: '2.1s' },
        { key: 'e_3', scriptName: 'Daily Backup', trigger: { type: 'Schedule', id: 'sch_1' }, status: 'success', startTime: dayjs().subtract(1, 'day').hour(2), duration: '15m 30s' },
      ];

      const [scripts, setScripts] = useLocalStorageState('sre-scripts', initialScripts);
      const [executions, setExecutions] = useLocalStorageState('sre-executions', initialExecutions);

      const addExecution = (newExecution) => {
        setExecutions(function (prev) { return [newExecution, ...prev] });
      };

      const handleLogout = () => { message.success('已成功登出'); setTimeout(() => window.location.reload(), 500); }
      const handleMenuClick = ({ key }) => {
        // 處理所有選單項目點擊，包括父選單和子選單
        setCurrentPage(key);
      };

      const handleSubMenuTitleClick = ({ key, domEvent }) => {
        // 阻止預設的展開/收合行為
        domEvent.stopPropagation();
        // 直接導航到父選單頁面
        setCurrentPage(key);
      };
      const getItem = (label, key, icon, children) => {
        const item = {
          key,
          icon,
          children,
          label,
          disabled: false
        };

        // 如果有子項目，為父選單標題新增點擊事件
        if (children) {
          item.onTitleClick = handleSubMenuTitleClick;
        }

        return item;
      };
      const sideMenuItems = [
        getItem('首頁', 'home', <DashboardOutlined />),
        getItem('儀表板', 'dashboard', <BarChartOutlined />, [
          getItem('告警與資源洞察', 'alerts-insights', <ExclamationCircleOutlined />),
        ]),
        getItem('事件', 'incidents', <HistoryOutlined />),
        getItem('資源', 'resources', <HddOutlined />),
        getItem('分析', 'analyzing', <BarChartOutlined />),
        getItem('自動化', 'automation', <CodeOutlined />),
        getItem('設定', 'settings', <SettingOutlined />, [
          getItem('用戶與權限', 'user-permissions', <UserOutlined />),
          getItem('通知管理', 'notification-management', <BellOutlined />),
          getItem('平台設定', 'platform-settings', <SettingOutlined />),
          getItem('平台維運', 'platform-operations', <ControlOutlined />),
        ]),
      ];

      useEffect(() => {
        const handleKeyDown = (e) => {
          if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            setIsSearchModalOpen(true);
          }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, []);

      const PageContent = () => {
        const pageKey = currentPage;

        if (['home'].includes(pageKey)) {
          return <HomePage themeMode={themeMode} onNavigate={navigateToPage} />;
        }
        if (['alerts-insights'].includes(pageKey)) {
          return <AlertsInsightsPage themeMode={themeMode} onNavigate={navigateToPage} />;
        }
        if (['incidents', 'incident-list', 'alerting-rules', 'silences'].includes(pageKey)) {
          return <IncidentsPage onNavigate={navigateToPage} pageKey={pageKey} />;
        }
        if (['resources', 'resource-overview', 'resource-list', 'resource-groups', 'resource-topology'].includes(pageKey)) {
          return <ResourcesPage onNavigate={navigateToPage} pageKey={pageKey} themeMode={themeMode} />;
        }
        if (['analyzing', 'capacity-planning', 'performance-insights', 'cost-analysis', 'incident-trends', 'mttr-analysis', 'sla-reports'].includes(pageKey)) {
          return <AnalyzingPage onNavigate={navigateToPage} pageKey={pageKey} themeMode={themeMode} />;
        }
        if (['automation', 'scripts', 'schedules', 'executions'].includes(pageKey)) {
          return <AutomationCenterPage onNavigate={navigateToPage} pageKey={pageKey} scripts={scripts} setScripts={setScripts} addExecution={addExecution} executions={executions} setExecutions={setExecutions} />;
        }
        if (['user-permissions', 'user-management', 'team-management', 'role-management'].includes(pageKey)) {
          return <UserPermissionsPage onNavigate={navigateToPage} pageKey={pageKey} />;
        }
        if (['notification-management', 'notification-strategies', 'notification-channels', 'notification-history'].includes(pageKey)) {
          return <NotificationManagementPage onNavigate={navigateToPage} pageKey={pageKey} />;
        }
        if (['platform-operations', 'platform-diagnostics', 'audit-logs'].includes(pageKey)) {
          return <PlatformOperationsPage onNavigate={navigateToPage} pageKey={pageKey} />;
        }
        // Settings administration page with card navigation
        if (pageKey === 'settings') {
          return <SettingsAdministrationPage onNavigate={navigateToPage} />;
        }
        if (['platform-settings', 'tag-management', 'email-settings', 'auth-settings'].includes(pageKey)) {
          return <PlatformSettingsPage onNavigate={navigateToPage} pageKey={pageKey} />;
        }
        if (['profile'].includes(pageKey)) {
          return <ProfilePage themeMode={themeMode} setThemeMode={setThemeMode} />;
        }

        // Fallback for any other pages that might have been missed, or for placeholder pages
        switch (pageKey) {
          case 'executive-dashboard': return <PlaceholderPage title="管理儀表板" subtitle="為管理層提供綜合性最佳化的運營報告。" icon={<PieChartOutlined />} />;
          case 'custom-reports': return <PlaceholderPage title="自訂報告" subtitle="建立和排程自訂報告以滿足特定需求。" icon={<FileTextOutlined />} />;
          default: return <HomePage themeMode={themeMode} onNavigate={navigateToPage} />;
        }
      };

      const findLabel = (key, menu) => {
        for (const item of menu) {
          if (item.key === key) return { parent: null, parentKey: null, child: item.label };
          if (item.children) {
            for (const child of item.children) {
              if (child.key === key) return { parent: item.label, parentKey: item.key, child: child.label };
              if (child.children) {
                for (const grandChild of child.children) {
                  if (grandChild.key === key) return { parent: child.label, parentKey: child.key, child: grandChild.label };
                }
              }
            }
          }
        }
        // Fallback for pages not in the menu, like Profile
        if (key === 'profile') {
          return { parent: null, parentKey: null, child: '個人資料' };
        }
        return { parent: null, parentKey: null, child: '總覽' };
      };

      const { parent, parentKey, child } = findLabel(currentPage, sideMenuItems);
      const breadcrumbItems = [{ title: <a onClick={() => setCurrentPage('home')}>Home</a> }];
      if (parent) {
        breadcrumbItems.push({ title: <a onClick={() => setCurrentPage(parentKey)}>{parent}</a> });
      }
      if (child && child !== '總覽' && child !== parent) {
        breadcrumbItems.push({ title: child });
      }

      const userMenuItems = [
        {
          key: 'user-info',
          type: 'group',
          label: (
            <div style={{
              padding: '8px 0',
              borderBottom: '1px solid var(--border-light)'
            }}>
              <div style={{ fontWeight: 600, color: 'var(--text-primary)' }}>Admin User</div>
              <div style={{ fontSize: '12px', color: 'var(--text-tertiary)' }}>admin@sre-platform.com</div>
            </div>
          ),
          style: { cursor: 'default' }
        },
        {
          key: 'profile',
          label: (
            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
              <UserOutlined />
              <span>個人資料</span>
            </div>
          ),
          onClick: () => setCurrentPage('profile')
        },
        {
          key: 'help',
          label: (
            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
              <QuestionCircleOutlined />
              <span>幫助中心</span>
            </div>
          ),
          onClick: () => message.info('開啟幫助中心')
        },
        { type: 'divider' },
        {
          key: 'logout',
          label: (
            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
              <LogoutOutlined style={{ color: 'var(--brand-danger)' }} />
              <span style={{ color: 'var(--brand-danger)' }}>登出</span>
            </div>
          ),
          onClick: handleLogout,
          danger: true
        }
      ];

      const NotificationCenter = () => {
        const [notifications, setNotifications] = useState([
          { id: 1, type: 'error', title: 'CPU high on db-prod-01', description: '資源 db-prod-01 CPU 使用率超過 90%', time: dayjs().subtract(5, 'minutes'), read: false, severity: 'critical' },
          { id: 2, type: 'system', title: 'Script "Daily Backup" executed successfully', description: '每日備份腳本已成功執行', time: dayjs().subtract(2, 'hours'), read: false, severity: 'info' },
          { id: 3, type: 'warning', title: 'Disk space low on web-prod-02', description: '資源 web-prod-02 磁碟空間低於 15%', time: dayjs().subtract(1, 'day'), read: true, severity: 'warning' },
          { id: 4, type: 'success', title: '備份任務完成', description: '所有數據庫備份已成功完成', time: dayjs().subtract(3, 'hours'), read: true, severity: 'success' },
        ]);
        const unreadCount = notifications.filter(n => !n.read).length;

        const handleMarkAllAsRead = () => {
          setNotifications(notifications.map(n => ({ ...n, read: true })));
          message.success('所有通知已標為已讀');
        }

        const getNotificationIcon = (type, severity) => {
          const iconMap = {
            error: <ExclamationCircleOutlined />,
            warning: <AlertOutlined />,
            system: <InfoCircleOutlined />,
            success: <CheckCircleOutlined />
          };
          return iconMap[type] || <InfoCircleOutlined />;
        };

        const getNotificationColor = (severity) => {
          const colorMap = {
            critical: 'var(--brand-danger)',
            warning: 'var(--brand-warning)',
            info: 'var(--brand-primary)',
            success: 'var(--brand-success)'
          };
          return colorMap[severity] || 'var(--brand-info)';
        };

        const content = (
          <div className="notification-dropdown" style={{
            width: 380,
            maxHeight: '520px',
            overflow: 'hidden',
            borderRadius: 'var(--radius-lg)',
            background: 'var(--bg-elevated)',
            boxShadow: 'var(--shadow-2xl)'
          }}>
            {/* 標題區 */}
            <div style={{
              padding: '12px 16px',
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.05) 100%)',
              borderBottom: '1px solid var(--border-light)',
              backdropFilter: 'blur(10px)',
              position: 'sticky',
              top: 0,
              zIndex: 1
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                  <div style={{
                    width: '32px',
                    height: '32px',
                    borderRadius: 'var(--radius-md)',
                    background: 'linear-gradient(135deg, rgba(24, 144, 255, 0.2) 0%, rgba(24, 144, 255, 0.1) 100%)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center'
                  }}>
                    <BellOutlined style={{ fontSize: '16px', color: 'var(--brand-primary)' }} />
                  </div>
                  <div>
                    <Title level={5} style={{ margin: 0, fontSize: '16px', fontWeight: '600' }}>通知中心</Title>
                    <Text type="secondary" style={{ fontSize: '12px' }}>
                      {unreadCount > 0 ? `${unreadCount} 則未讀通知` : '沒有新通知'}
                    </Text>
                  </div>
                </div>
                {unreadCount > 0 && (
                  <Button
                    type="text"
                    size="small"
                    onClick={handleMarkAllAsRead}
                    style={{
                      color: 'var(--brand-primary)',
                      fontSize: '13px',
                      fontWeight: '500'
                    }}
                  >
                    全部已讀
                  </Button>
                )}
              </div>
            </div>

            {/* 通知列表 */}
            <div style={{
              maxHeight: '420px',
              overflowY: 'auto',
              overflowX: 'hidden'
            }}>
              <List
                dataSource={notifications}
                renderItem={item => (
                  <List.Item
                    onClick={() => {
                      if (!item.read) {
                        setNotifications(notifications.map(n =>
                          n.id === item.id ? { ...n, read: true } : n
                        ));
                      }
                      message.info(`跳轉至 ${item.title} 相關頁面`);
                    }}
                    style={{
                      cursor: 'pointer',
                      padding: '12px 16px',
                      borderBottom: '1px solid var(--border-light)',
                      background: item.read ? 'transparent' : 'linear-gradient(135deg, rgba(24, 144, 255, 0.04) 0%, rgba(24, 144, 255, 0.02) 100%)',
                      transition: 'all 0.2s ease'
                    }}
                    className="notification-item"
                  >
                    <List.Item.Meta
                      avatar={
                        <div style={{ position: 'relative' }}>
                          <Avatar
                            icon={getNotificationIcon(item.type, item.severity)}
                            style={{
                              backgroundColor: `${getNotificationColor(item.severity)}15`,
                              color: getNotificationColor(item.severity),
                              border: `1px solid ${getNotificationColor(item.severity)}30`,
                              boxShadow: `0 0 12px ${getNotificationColor(item.severity)}20`
                            }}
                            size={36}
                          />
                          {!item.read && (
                            <span style={{
                              position: 'absolute',
                              top: '-2px',
                              right: '-2px',
                              width: '8px',
                              height: '8px',
                              borderRadius: '50%',
                              background: 'var(--brand-primary)',
                              border: '2px solid var(--bg-elevated)',
                              boxShadow: '0 0 4px var(--brand-primary)'
                            }} />
                          )}
                        </div>
                      }
                      title={
                        <div style={{ marginBottom: '2px' }}>
                          <span style={{
                            fontWeight: item.read ? '400' : '600',
                            color: item.read ? 'var(--text-secondary)' : 'var(--text-primary)',
                            fontSize: '14px',
                            lineHeight: '1.4'
                          }}>
                            {item.title}
                          </span>
                        </div>
                      }
                      description={
                        <div>
                          <div style={{
                            color: item.read ? 'var(--text-tertiary)' : 'var(--text-secondary)',
                            fontSize: '13px',
                            marginBottom: '4px',
                            lineHeight: '1.4'
                          }}>
                            {item.description}
                          </div>
                          <div style={{
                            color: 'var(--text-tertiary)',
                            fontSize: '12px',
                            fontWeight: '500'
                          }}>
                            {item.time.fromNow()}
                          </div>
                        </div>
                      }
                    />
                  </List.Item>
                )}
              />
            </div>

            {/* 底部操作 */}
            <div style={{
              padding: '12px',
              textAlign: 'center',
              borderTop: '1px solid var(--border-light)',
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.03) 100%)'
            }}>
              <Button
                type="link"
                onClick={() => {
                  setCurrentPage('notifications');
                  message.info("導向通知管理頁面");
                }}
                style={{
                  color: 'var(--brand-primary)',
                  fontWeight: '500'
                }}
              >
                查看所有通知
              </Button>
            </div>
          </div>
        );

        return (
          <Popover
            content={content}
            trigger="click"
            placement="bottomRight"
            overlayClassName="notification-popover"
          >
            <Button
              type="text"
              style={{
                padding: '4px 8px',
                height: 'auto',
                display: 'flex',
                alignItems: 'center',
                gap: '4px'
              }}
            >
              <Badge count={unreadCount} offset={[-2, 2]} style={{
                '--ant-badge-height': '18px',
                '--ant-badge-dot-size': '8px'
              }}>
                <BellOutlined style={{
                  fontSize: '18px',
                  color: 'var(--text-secondary)'
                }} />
              </Badge>
            </Button>
          </Popover>
        );
      };

      const GlobalSearch = () => {
        const [query, setQuery] = useState('');
        const mockResults = [
          { type: '資源', items: [{ key: 'host_1', name: 'db-prod-01', desc: '10.0.0.10' }] },
          { type: '事件', items: [{ key: 'i_1', name: 'CPU high on db-prod-01', desc: 'Firing' }] },
          { type: '自動化腳本', items: [{ key: 's_1', name: 'Auto-scaling for Web Servers', desc: 'Python Script' }] },
        ];

        const filteredResults = query ? mockResults.map(function (group) {
          return {
            ...group,
            items: group.items.filter(function (item) {
              return item.name.toLowerCase().includes(query.toLowerCase())
            })
          }
        }).filter(function (group) { return group.items.length > 0 }) : [];

        return (
          <Modal open={isSearchModalOpen} onCancel={() => setIsSearchModalOpen(false)} footer={null} closable={false} width={600} style={{ top: 50 }}>
            <Input size="large" placeholder="搜尋資源、事件、腳本..." prefix={<SearchOutlined />} onChange={(e) => setQuery(e.target.value)} autoFocus />
            {query && <List
              style={{ marginTop: 16 }}
              dataSource={filteredResults}
              renderItem={group => (
                <List
                  header={<Divider orientation="left">{group.type}</Divider>}
                  dataSource={group.items}
                  renderItem={item => <List.Item style={{ cursor: 'pointer' }} onClick={() => message.info(`跳轉至 ${item.name} 詳情`)}>{item.name}</List.Item>}
                />
              )}
            />}
          </Modal>
        );
      };

      return (
        <Layout style={{ minHeight: '100vh' }}>
          <Layout.Sider trigger={null} collapsible collapsed={collapsed} width={220}>
            <div style={{
              height: '48px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: collapsed ? 'center' : 'flex-start',
              cursor: 'pointer',
              gap: '10px',
              padding: '0 16px',
              transition: 'all 0.3s ease',
              borderBottom: '1px solid var(--border-light)'
            }} onClick={() => setCurrentPage('home')}>
              <div style={{
                width: '30px',
                height: '30px',
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                borderRadius: '6px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                boxShadow: '0 4px 16px rgba(102, 126, 234, 0.3)',
                transition: 'all 0.3s ease'
              }}>
                <DeploymentUnitOutlined style={{
                  fontSize: '18px',
                  color: 'white',
                  transition: 'all 0.3s ease'
                }} />
              </div>
              {!collapsed && (
                <Title level={4} style={{
                  margin: 0,
                  color: 'var(--text-primary)',
                  fontWeight: '600',
                  fontSize: '18px',
                  letterSpacing: '-0.3px'
                }}>SRE Platform</Title>
              )}
            </div>
            <Menu
              theme="dark"
              mode="inline"
              selectedKeys={[currentPage]}
              defaultOpenKeys={['dashboard', 'settings']}
              items={sideMenuItems}
              onClick={handleMenuClick}
            />
          </Layout.Sider>
          <Layout>
            <Layout.Header style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0 16px' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                <Button
                  type="text"
                  icon={collapsed ? <MenuUnfoldOutlined /> : <MenuFoldOutlined />}
                  onClick={() => setCollapsed(!collapsed)}
                  style={{
                    color: 'rgba(255, 255, 255, 0.8)',
                    fontSize: '14px',
                    width: '32px',
                    height: '32px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    marginLeft: '-8px'
                  }}
                />
                <Breadcrumb items={breadcrumbItems} />
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
                <Input prefix={<SearchOutlined />} placeholder="Search... (Ctrl+K)" style={{ width: 250 }} onClick={() => setIsSearchModalOpen(true)} readOnly />
                <NotificationCenter />
                <Dropdown
                  menu={{
                    items: userMenuItems,
                    style: {
                      minWidth: 200,
                      borderRadius: 'var(--radius-lg)',
                      padding: '4px'
                    }
                  }}
                  placement="bottomRight"
                  overlayClassName="user-dropdown-menu"
                >
                  <Button
                    type="text"
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px',
                      padding: '4px 12px',
                      height: '36px',
                      borderRadius: 'var(--radius-md)',
                      transition: 'all 0.2s ease'
                    }}
                    className="user-menu-trigger"
                  >
                    <Avatar
                      size={28}
                      icon={<UserOutlined />}
                      style={{
                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        fontSize: '14px'
                      }}
                    />
                    <span style={{
                      color: 'var(--text-primary)',
                      fontWeight: '500',
                      fontSize: '14px'
                    }}>
                      admin
                    </span>
                    <DownOutlined style={{
                      fontSize: '10px',
                      color: 'var(--text-secondary)'
                    }} />
                  </Button>
                </Dropdown>
              </div>
            </Layout.Header>
            <Layout.Content style={{ padding: '24px', background: '#0d1117' }}>
              <PageContent />
            </Layout.Content>
            <GlobalSearch />
          </Layout>
        </Layout>
      );
    };

    const AppWrapper = () => {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [themeMode, setThemeMode] = useLocalStorageState('sre-theme-mode', 'dark');

      const handleLogin = () => setIsAuthenticated(true);

      const currentTheme = {
        algorithm: themeMode === 'dark' ? theme.darkAlgorithm : theme.defaultAlgorithm,
        components: {
          Layout: {
            siderBg: themeMode === 'dark' ? '#161719' : '#ffffff',
            headerBg: themeMode === 'dark' ? '#161719' : '#ffffff',
          },
          Menu: {
            darkItemBg: '#161719',
          },
          Card: {
            colorBgContainer: themeMode === 'dark' ? '#202226' : '#ffffff'
          },
          Modal: {
            contentBg: themeMode === 'dark' ? '#202226' : '#ffffff',
            headerBg: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          Drawer: {
            colorBgElevated: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          Popover: {
            colorBgElevated: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          Dropdown: {
            colorBgElevated: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          Select: {
            colorBgElevated: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          DatePicker: {
            colorBgContainer: themeMode === 'dark' ? '#161719' : '#ffffff',
            colorBgElevated: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          Tree: {
            colorBgContainer: themeMode === 'dark' ? '#202226' : '#ffffff',
          }
        }
      };

      return (
        <ErrorBoundary>
          <ConfigProvider theme={currentTheme}>
            <antd.App>
              {isAuthenticated ? <MainApp themeMode={themeMode} setThemeMode={setThemeMode} /> : <LoginPage onLogin={handleLogin} />}
            </antd.App>
          </ConfigProvider>
        </ErrorBoundary>
      )
    }

    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<AppWrapper />);
  </script>
</body>

</html>