<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SRE å¹³å°äº’å‹•åŸå‹</title>
  <!-- React, Babel, Day.js -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
  <script src="https://unpkg.com/dayjs@1.11.10/dayjs.min.js"></script>
  <script src="https://unpkg.com/dayjs@1.11.10/plugin/relativeTime.js"></script>
  <script src="https://unpkg.com/dayjs@1.11.10/plugin/isBetween.js"></script>
  <!-- Ant Design -->
  <script src="https://unpkg.com/antd@5.19.1/dist/antd.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/antd@5.19.1/dist/reset.css" />
  <!-- Ant Design Icons -->
  <script src="https://unpkg.com/@ant-design/icons@5.3.7/dist/index.umd.min.js"></script>
  <!-- ECharts -->
  <script src="https://unpkg.com/echarts@5.5.0/dist/echarts.min.js"></script>

  <style>
    /* ğŸ¨ çµ±ä¸€è¨­è¨ˆç³»çµ± - Design System */
    :root {
      /* === æ ¸å¿ƒå“ç‰Œè‰²ç³»çµ± === */
      --brand-primary: #1890ff;
      --brand-primary-hover: #40a9ff;
      --brand-primary-active: #096dd9;
      --brand-primary-bg: rgba(24, 144, 255, 0.1);

      --brand-success: #52c41a;
      --brand-success-hover: #73d13d;
      --brand-success-bg: rgba(82, 196, 26, 0.1);

      --brand-warning: #faad14;
      --brand-warning-hover: #ffc53d;
      --brand-warning-bg: rgba(250, 173, 20, 0.1);

      --brand-danger: #ff4d4f;
      --brand-danger-hover: #ff7875;
      --brand-danger-bg: rgba(255, 77, 79, 0.1);

      --brand-info: #722ed1;
      --brand-info-hover: #9254de;
      --brand-info-bg: rgba(114, 46, 209, 0.1);

      /* === æ–‡å­—å±¤ç´šç³»çµ± === */
      --text-primary: rgba(255, 255, 255, 0.95);
      --text-secondary: rgba(255, 255, 255, 0.85);
      --text-tertiary: rgba(255, 255, 255, 0.65);
      --text-quaternary: rgba(255, 255, 255, 0.45);
      --text-disabled: rgba(255, 255, 255, 0.25);

      /* === èƒŒæ™¯å±¤ç´šç³»çµ± === */
      --bg-page: #0A0B0E;
      --bg-container: #141519;
      --bg-elevated: #1A1D23;
      --bg-overlay: #23262F;
      --bg-hover: rgba(255, 255, 255, 0.08);
      --bg-active: rgba(255, 255, 255, 0.12);
      --bg-selected: rgba(24, 144, 255, 0.15);

      /* === é‚Šæ¡†ç³»çµ± === */
      --border-base: rgba(255, 255, 255, 0.12);
      --border-light: rgba(255, 255, 255, 0.08);
      --border-focus: var(--brand-primary);
      --border-hover: rgba(255, 255, 255, 0.2);

      /* === é–“è·ç³»çµ± (8px åŸºç¤ç¶²æ ¼) === */
      --spacing-xs: 4px;
      /* 0.5 å–®ä½ */
      --spacing-sm: 8px;
      /* 1 å–®ä½ */
      --spacing-md: 12px;
      /* 1.5 å–®ä½ */
      --spacing-lg: 16px;
      /* 2 å–®ä½ */
      --spacing-xl: 24px;
      /* 3 å–®ä½ */
      --spacing-2xl: 32px;
      /* 4 å–®ä½ */
      --spacing-3xl: 48px;
      /* 6 å–®ä½ */

      /* === åœ“è§’ç³»çµ± === */
      --radius-xs: 4px;
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;

      /* === é™°å½±ç³»çµ± === */
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.25);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.35);
      --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.45);

      /* === æŒ‰éˆ•ç³»çµ± === */
      --btn-height-sm: 28px;
      --btn-height-md: 32px;
      --btn-height-lg: 36px;
      --btn-padding-sm: 0 8px;
      --btn-padding-md: 0 12px;
      --btn-padding-lg: 0 16px;

      /* === ç»ç’ƒæ•ˆæœç³»çµ± === */
      --glass-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
      --glass-border: 1px solid rgba(255, 255, 255, 0.12);
      --glass-backdrop: blur(20px) saturate(180%);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    /* é é¢æ¨™é¡Œå„ªåŒ– */
    .page-title {
      font-size: 32px;
      font-weight: 600;
      margin-bottom: var(--spacing-sm);
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }

    .page-subtitle {
      font-size: 14px;
      color: var(--text-tertiary);
      margin-bottom: var(--spacing-2xl);
    }

    .ant-table-row.row-highlight>td {
      background-color: rgba(255, 77, 79, 0.1) !important;
    }


    /* === ğŸ”§ å„ªåŒ–è¡¨æ ¼å®¹å™¨ç³»çµ± === */

    /* è¡¨æ ¼å®¹å™¨ */
    .table-wrapper {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      margin-top: var(--spacing-xl);
      box-shadow: var(--glass-shadow);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
    }

    /* è¡¨æ ¼å·¥å…·åˆ— */
    .table-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--spacing-lg);
      padding: var(--spacing-lg);
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-light);
      min-height: 64px;
      /* çµ±ä¸€å·¥å…·åˆ—é«˜åº¦ */
    }

    /* è¡¨æ ¼ä¸»é«” */
    .table-wrapper .ant-table {
      background: transparent;
    }

    /* === è¡¨é ­å„ªåŒ– === */
    .table-wrapper .ant-table-thead>tr>th {
      background: var(--bg-elevated);
      color: var(--text-primary);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      padding: var(--spacing-lg) var(--spacing-lg);
      height: 48px;
      /* çµ±ä¸€è¡¨é ­é«˜åº¦ */
      line-height: 1.2;
      border-bottom: 2px solid var(--border-base);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* è¡¨é ­æ’åºåœ–æ¨™ */
    .table-wrapper .ant-table-thead>tr>th .ant-table-column-sorter {
      opacity: 0.6;
      transition: opacity 0.2s ease;
    }

    .table-wrapper .ant-table-thead>tr>th:hover .ant-table-column-sorter {
      opacity: 1;
    }

    /* === è¡¨æ ¼å…§å®¹å„ªåŒ– === */
    .table-wrapper .ant-table-tbody>tr {
      transition: all 0.2s ease;
      height: 52px;
      /* çµ±ä¸€è¡Œé«˜ - æå‡è³‡è¨Šå¯†åº¦ */
    }

    .table-wrapper .ant-table-tbody>tr:hover {
      background: var(--bg-hover);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .table-wrapper .ant-table-tbody>tr>td {
      color: var(--text-secondary);
      padding: var(--spacing-md) var(--spacing-lg);
      line-height: 1.4;
      border-bottom: 1px solid var(--border-light);
      vertical-align: middle;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
      /* é˜²æ­¢å…§å®¹éé•· */
    }

    /* é¸ä¸­è¡Œæ¨£å¼ */
    .table-wrapper .ant-table-row-selected>td {
      background: var(--bg-selected) !important;
      border-left: 3px solid var(--brand-primary);
    }

    .table-wrapper .ant-table-row-selected:hover>td {
      background: var(--bg-selected) !important;
    }

    /* === è¡¨æ ¼åˆ†é å„ªåŒ– === */
    .table-wrapper .ant-pagination {
      margin: var(--spacing-lg) 0 !important;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    /* === è¡¨æ ¼è¼‰å…¥ç‹€æ…‹ === */
    .table-wrapper .ant-spin-container {
      min-height: 200px;
    }

    .table-wrapper .ant-table-placeholder {
      border-bottom: none;
    }

    /* === éŸ¿æ‡‰å¼è¡¨æ ¼ === */
    @media (max-width: 1200px) {
      .table-wrapper .ant-table-tbody>tr>td {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: 13px;
      }

      .table-wrapper .ant-table-thead>tr>th {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: 11px;
      }
    }

    /* === è¡¨æ ¼ç‹€æ…‹æ¨™ç±¤å„ªåŒ– === */
    .table-status-tag {
      padding: 2px 8px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 1px solid transparent;
    }

    .table-status-tag--success {
      background: var(--brand-success-bg);
      color: var(--brand-success);
      border-color: rgba(82, 196, 26, 0.3);
    }

    .table-status-tag--warning {
      background: var(--brand-warning-bg);
      color: var(--brand-warning);
      border-color: rgba(250, 173, 20, 0.3);
    }

    .table-status-tag--danger {
      background: var(--brand-danger-bg);
      color: var(--brand-danger);
      border-color: rgba(255, 77, 79, 0.3);
    }

    /* === ğŸ·ï¸ æ¨™ç±¤ç®¡ç†å°ˆç”¨æ¨£å¼ === */

    /* æ¨™ç±¤åˆ†é¡å°èˆª */
    .tag-category-nav {
      display: flex;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-xl);
      flex-wrap: wrap;
    }


    /* çµ±ä¸€åˆ†é¡æ¨™ç±¤ä¸‹æ‹‰é¸é …æ¨£å¼ */
    .ant-select-dropdown .ant-select-item-option {
      padding: 8px 12px !important;
    }

    .ant-select-dropdown .ant-select-item-option:hover {
      background: rgba(255, 255, 255, 0.05) !important;
    }

    .ant-select-dropdown .ant-select-item-option-selected {
      background: rgba(24, 144, 255, 0.1) !important;
    }

    .tag-category-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      padding: var(--spacing-sm) var(--spacing-lg);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
      background: transparent;
      color: var(--text-tertiary);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 13px;
      font-weight: 500;
    }

    .tag-category-item:hover {
      border-color: var(--border-hover);
      background: var(--bg-hover);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    .tag-category-item.active {
      border-color: var(--brand-primary);
      background: var(--brand-primary-bg);
      color: var(--brand-primary);
    }

    .tag-category-count {
      font-size: 12px;
      padding: 2px 6px;
      border-radius: var(--radius-sm);
      background: rgba(255, 255, 255, 0.15);
      margin-left: var(--spacing-xs);
    }

    /* æ¨™ç±¤çµ±è¨ˆå¡ç‰‡ */
    .tag-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }

    .tag-stat-card {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
      transition: all 0.3s ease;
    }

    .tag-stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .tag-stat-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
      line-height: 1;
    }

    .tag-stat-label {
      font-size: 13px;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    .tag-stat-icon {
      font-size: 20px;
      color: var(--brand-primary);
      opacity: 0.7;
      margin-bottom: var(--spacing-sm);
    }

    /* æ¨™ç±¤è¡¨æ ¼å„ªåŒ– */
    .tag-table-wrapper {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
    }

    /* æ¨™ç±¤å€¼é¡¯ç¤º */
    .tag-values-display {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
      max-width: 300px;
    }

    .tag-value-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      font-weight: 500;
      border: 1px solid transparent;
      max-width: 100px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tag-value-count {
      background: var(--bg-elevated);
      color: var(--text-tertiary);
      border-color: var(--border-light);
      font-size: 10px;
      padding: 1px 4px;
      border-radius: var(--radius-xs);
      margin-left: 4px;
    }

    /* æ¨™ç±¤æ“ä½œæŒ‰éˆ•çµ„ */
    .tag-actions {
      display: flex;
      gap: var(--spacing-xs);
      align-items: center;
    }

    .tag-action-btn {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-sm);
      border: none;
      background: transparent;
      color: var(--text-tertiary);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .tag-action-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    .tag-action-btn.primary:hover {
      background: var(--brand-primary-bg);
      color: var(--brand-primary);
    }

    .tag-action-btn.danger:hover {
      background: var(--brand-danger-bg);
      color: var(--brand-danger);
    }

    /* å¿…éœ€æ¨™ç±¤è¡Œæ¨£å¼ */
    .required-tag-row {
      border-left: 3px solid var(--brand-warning) !important;
    }

    .required-tag-row .tag-required-badge {
      background: var(--brand-warning-bg);
      color: var(--brand-warning);
      font-size: 10px;
      padding: 1px 4px;
      border-radius: var(--radius-xs);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* æ¨™ç±¤æ¨¡æ…‹æ¡†å„ªåŒ– */
    .tag-modal .ant-modal-content {
      background: var(--bg-elevated);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
    }

    .tag-modal .ant-modal-header {
      background: transparent;
      border-bottom: 1px solid var(--border-light);
      padding: var(--spacing-xl) var(--spacing-xl) var(--spacing-lg);
    }

    .tag-modal .ant-modal-body {
      padding: var(--spacing-xl);
    }

    .tag-modal .ant-form-item-label>label {
      color: var(--text-primary);
      font-weight: 600;
      font-size: 13px;
    }

    /* é¡è‰²é¸æ“‡å™¨å„ªåŒ– */
    .color-picker-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: var(--spacing-sm);
    }

    .color-option {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-sm);
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }

    .color-option:hover {
      transform: scale(1.1);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .color-option.selected {
      border-color: rgba(255, 255, 255, 0.8);
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
    }

    .color-option.selected::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 14px;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    /* Sidebar é¸å–æ•ˆæœ - å·¦å´è—è‰²é‚Šæ¡†ï¼ˆä¸»è‰²ï¼‰ */
    .ant-menu-dark .ant-menu-item-selected {
      background-color: rgba(24, 144, 255, 0.15) !important;
      color: rgba(255, 255, 255, 0.9) !important;
      border-radius: 0 !important;
      position: relative;
    }

    .ant-menu-dark .ant-menu-item-selected::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: #1890ff !important;
      border-radius: 0 !important;
    }

    .ant-menu-dark .ant-menu-item-selected::after {
      display: none !important;
    }

    /* å­é¸å–®å±•é–‹æ™‚ï¼Œçˆ¶é¸å–®ä¸é¡¯ç¤ºé¸å–æŒ‡ç¤ºå™¨ï¼Œåªæœ‰è¼•å¾®èƒŒæ™¯è‰² */
    .ant-menu-dark .ant-menu-submenu-open .ant-menu-submenu-title {
      background-color: rgba(255, 255, 255, 0.05) !important;
      color: rgba(255, 255, 255, 0.8) !important;
      border-radius: 0 !important;
    }

    /* ç§»é™¤çˆ¶é¸å–®çš„é¸å–æŒ‡ç¤ºå™¨ */
    .ant-menu-dark .ant-menu-submenu-selected .ant-menu-submenu-title::before {
      display: none !important;
    }

    .ant-menu-dark .ant-menu-item:hover {
      background-color: rgba(255, 255, 255, 0.05) !important;
      color: rgba(255, 255, 255, 0.9) !important;
    }

    .ant-menu-dark .ant-menu-submenu-title:hover {
      background-color: rgba(255, 255, 255, 0.05) !important;
      color: rgba(255, 255, 255, 0.9) !important;
    }

    /* è¡¨æ ¼æ»¾å‹•æ¢æ¨£å¼ */
    .table-wrapper .ant-table-container::-webkit-scrollbar {
      height: 8px;
    }

    .table-wrapper .ant-table-container::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }

    .table-wrapper .ant-table-container::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 4px;
    }

    .table-wrapper .ant-table-container::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    .code-editor-like {
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
    }

    .log-viewer {
      background: #1e1e1e;
      color: #d4d4d4;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
      padding: 16px;
      border-radius: 4px;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    .admin-card {
      cursor: pointer;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(200, 200, 200, 0.05) 100%) !important;
      border: 1px solid rgba(255, 255, 255, 0.15) !important;
      border-radius: 12px !important;
      backdrop-filter: blur(20px) saturate(180%) brightness(1.1) !important;
      -webkit-backdrop-filter: blur(20px) saturate(180%) brightness(1.1) !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.1) !important;
      position: relative;
      overflow: hidden;
    }

    .admin-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 12px;
      z-index: -1;
    }

    .admin-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2), inset 0 -1px 0 rgba(0, 0, 0, 0.15) !important;
      border-color: rgba(255, 255, 255, 0.25) !important;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(200, 200, 200, 0.06) 100%) !important;
    }

    /* åœ–è¡¨å®¹å™¨æ¨£å¼ */
    .chart-container {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      height: 100%;
    }

    /* åœ–è¡¨å€åŸŸçš„ Card æ¨£å¼ */
    .dashboard-chart-card .ant-card-body {
      height: 100%;
      padding: 16px;
    }

    .dashboard-chart-card {
      height: 100%;
    }

    /* ç»ç’ƒæ•ˆæœæ¨£å¼ */
    .glass-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(200, 200, 200, 0.04) 100%) !important;
      border: 1px solid rgba(255, 255, 255, 0.12) !important;
      border-radius: 12px !important;
      backdrop-filter: blur(20px) saturate(180%) !important;
      -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
    }

    .glass-card-subtle {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%) !important;
      border: 1px solid rgba(255, 255, 255, 0.08) !important;
      border-radius: 12px !important;
      backdrop-filter: blur(20px) saturate(180%) !important;
      -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
    }

    .glass-card-colored {
      border-radius: 12px !important;
      backdrop-filter: blur(20px) saturate(180%) !important;
      -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
    }

    /* === ğŸ¯ çµ±ä¸€æ“ä½œæŒ‰éˆ•ç³»çµ± === */

    /* æŒ‰éˆ•å®¹å™¨ */
    .action-buttons {
      display: flex;
      gap: var(--spacing-xs);
      align-items: center;
    }

    /* æ¨™æº–æŒ‰éˆ•åŸºç¤æ¨£å¼ */
    .btn-standard {
      height: var(--btn-height-md);
      padding: var(--btn-padding-md);
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 500;
      border: 1px solid transparent;
      background: transparent;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    /* ä¸»è¦æŒ‰éˆ• */
    .btn-primary {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--brand-primary-hover);
      border-color: var(--brand-primary-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    /* æˆåŠŸæŒ‰éˆ• */
    .btn-success {
      background: var(--brand-success);
      border-color: var(--brand-success);
      color: white;
    }

    .btn-success:hover {
      background: var(--brand-success-hover);
      border-color: var(--brand-success-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    /* å±éšªæŒ‰éˆ• */
    .btn-danger {
      background: var(--brand-danger);
      border-color: var(--brand-danger);
      color: white;
    }

    .btn-danger:hover {
      background: var(--brand-danger-hover);
      border-color: var(--brand-danger-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    /* æ¬¡è¦æŒ‰éˆ• (outlined) */
    .btn-secondary {
      border-color: var(--border-base);
      color: var(--text-secondary);
    }

    .btn-secondary:hover {
      border-color: var(--border-hover);
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    /* åœ–æ¨™æŒ‰éˆ• */
    .btn-icon {
      width: var(--btn-height-md);
      height: var(--btn-height-md);
      padding: 0;
      border-radius: var(--radius-sm);
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-tertiary);
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-icon:hover {
      background: var(--bg-hover);
      border-color: var(--border-light);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    .btn-icon.btn-icon--primary:hover {
      background: var(--brand-primary-bg);
      color: var(--brand-primary);
      border-color: rgba(24, 144, 255, 0.3);
    }

    .btn-icon.btn-icon--danger:hover {
      background: var(--brand-danger-bg);
      color: var(--brand-danger);
      border-color: rgba(255, 77, 79, 0.3);
    }

    /* å°å°ºå¯¸æŒ‰éˆ• */
    .btn-sm {
      height: var(--btn-height-sm);
      padding: var(--btn-padding-sm);
      font-size: 12px;
    }

    .btn-icon.btn-sm {
      width: var(--btn-height-sm);
      height: var(--btn-height-sm);
    }

    /* å¤§å°ºå¯¸æŒ‰éˆ• */
    .btn-lg {
      height: var(--btn-height-lg);
      padding: var(--btn-padding-lg);
      font-size: 14px;
    }

    .btn-icon.btn-lg {
      width: var(--btn-height-lg);
      height: var(--btn-height-lg);
    }

    /* æŒ‰éˆ•çµ„ */
    .btn-group {
      display: inline-flex;
      align-items: center;
    }

    .btn-group .btn-standard:not(:first-child) {
      margin-left: -1px;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }

    .btn-group .btn-standard:not(:last-child) {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    /* çµ±ä¸€æœå°‹æ¡†æ¨£å¼ */
    .search-input {
      width: 300px !important;
    }

    /* çµ±ä¸€é¸æ“‡å™¨æ¨£å¼ */
    .select-full {
      width: 100% !important;
    }

    .select-sm {
      width: 60px !important;
    }

    .select-md {
      width: 80px !important;
    }

    .select-lg {
      width: 120px !important;
    }

    .select-xl {
      width: 150px !important;
    }

    .select-xxl {
      width: 180px !important;
    }

    /* ğŸ¯ å„ªåŒ–ç‹€æ…‹æ¨™ç±¤è¨­è¨ˆ */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: var(--radius-xl);
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      transition: all 0.2s ease;
    }

    .status-badge::before {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: 0.6;
        transform: scale(0.8);
      }

      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* ç‹€æ…‹æ¨™ç±¤é¢œè‰² */
    .status-healthy,
    .status-badge-healthy {
      background: rgba(95, 207, 128, 0.12);
      color: var(--brand-success);
      border: 1px solid rgba(95, 207, 128, 0.24);
    }

    .status-warning,
    .status-badge-warning {
      background: rgba(255, 184, 77, 0.12);
      color: var(--brand-warning);
      border: 1px solid rgba(255, 184, 77, 0.24);
    }

    .status-critical,
    .status-badge-critical {
      background: rgba(255, 107, 107, 0.12);
      color: var(--brand-danger);
      border: 1px solid rgba(255, 107, 107, 0.24);
    }

    .status-new {
      background: rgba(74, 144, 255, 0.12);
      color: var(--brand-primary);
      border: 1px solid rgba(74, 144, 255, 0.24);
    }

    .status-acknowledged {
      background: rgba(255, 184, 77, 0.12);
      color: var(--brand-warning);
      border: 1px solid rgba(255, 184, 77, 0.24);
    }

    .status-resolved {
      background: rgba(95, 207, 128, 0.12);
      color: var(--brand-success);
      border: 1px solid rgba(95, 207, 128, 0.24);
    }

    /* çµ±ä¸€é–“è·æ¨£å¼ */

    /* çµ±ä¸€å…ƒä»¶æ¨£å¼ */
    .transparent-bg {
      background: transparent !important;
    }

    .row-error {
      background-color: rgba(255, 77, 79, 0.08) !important;
    }

    /* éœéŸ³è¦å‰‡è¨­å®šæ·±è‰²èƒŒæ™¯ */
    .silence-modal .ant-modal-content {
      background: var(--bg-elevated) !important;
      border: 1px solid var(--border-base) !important;
      border-radius: 12px !important;
    }

    .silence-modal .ant-modal-body {
      background: transparent !important;
    }

    .silence-modal .ant-table {
      background: rgba(255, 255, 255, 0.02) !important;
    }

    .silence-modal .ant-table-tbody>tr>td {
      background: transparent !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    }

    /* é«˜äº®è¡Œæ¨£å¼ */
    .highlighted-row {
      background: rgba(24, 144, 255, 0.1) !important;
      border-left: 3px solid #1890ff !important;
      animation: highlight-fade 3s ease-out;
    }

    @keyframes highlight-fade {
      0% {
        background: rgba(24, 144, 255, 0.3) !important;
        border-left-color: #40a9ff !important;
      }

      100% {
        background: rgba(24, 144, 255, 0.1) !important;
        border-left-color: #1890ff !important;
      }
    }

    /* Top N è³‡æºä½¿ç”¨åˆ—è¡¨è¡¨æ ¼æ¨£å¼ */
    .topn-table .ant-table-tbody>tr>td {
      padding: 2px 4px !important;
      line-height: 1.2 !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    }

    .topn-table .ant-table-thead>tr>th {
      padding: 4px 4px !important;
      line-height: 1.2 !important;
      background: rgba(255, 255, 255, 0.05) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    }

    .topn-table .ant-table-tbody>tr:hover>td {
      background: rgba(255, 255, 255, 0.03) !important;
    }

    .topn-table .ant-table {
      background: transparent !important;
    }

    .topn-table .ant-table-container {
      background: transparent !important;
    }

    .topn-table .ant-table-content {
      background: transparent !important;
    }

    /* åˆ†é æ¨£å¼ */
    .topn-table .ant-pagination {
      margin: 12px 8px !important;
    }

    .topn-table .ant-pagination-item,
    .topn-table .ant-pagination-prev,
    .topn-table .ant-pagination-next,
    .topn-table .ant-pagination-jump-prev,
    .topn-table .ant-pagination-jump-next {
      background-color: transparent !important;
      border-color: transparent !important;
      border-radius: 4px;
    }

    .topn-table .ant-pagination-item a {
      color: rgba(255, 255, 255, 0.85) !important;
    }

    .topn-table .ant-pagination-prev .ant-pagination-item-link,
    .topn-table .ant-pagination-next .ant-pagination-item-link {
      color: rgba(255, 255, 255, 0.85) !important;
    }

    .topn-table .ant-pagination-item-active {
      border-color: #1677ff !important;
    }

    .topn-table .ant-pagination-item-active a {
      color: #1677ff !important;
    }

    /* Radio æŒ‰éˆ•æ¨£å¼ */
    .topn-radio-group .ant-radio-group {
      border-radius: 6px;
      background-color: rgba(38, 38, 38, 0.6);
    }

    .topn-radio-group .ant-radio-button-wrapper {
      background-color: transparent !important;
      border-color: transparent !important;
      color: rgba(255, 255, 255, 0.85) !important;
      padding: 0 16px;
      height: 32px;
      line-height: 32px;
      border-right: 1px solid rgba(66, 66, 66, 0.6) !important;
    }

    .topn-radio-group .ant-radio-button-wrapper:last-child {
      border-right: none !important;
    }

    .topn-radio-group .ant-radio-button-wrapper:not(:first-child)::before {
      display: none;
    }

    .topn-radio-group .ant-radio-button-wrapper-checked:not(.ant-radio-button-wrapper-disabled) {
      background-color: transparent !important;
      border-color: #1677ff !important;
      color: #1677ff !important;
      border-width: 1px !important;
      border-style: solid !important;
      border-radius: 6px;
    }

    .topn-radio-group .ant-radio-button-wrapper-checked:not(.ant-radio-button-wrapper-disabled):hover {
      background-color: transparent !important;
      color: #1677ff !important;
    }

    .no-margin {
      margin: 0 !important;
    }

    /* Header controls æ¨£å¼ */
    .header-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .header-controls h2 {
      margin: 0;
      font-size: 20px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.9);
    }

    /* åˆ†é æ¨£å¼ */
    .custom-pagination .ant-pagination-item,
    .custom-pagination .ant-pagination-prev,
    .custom-pagination .ant-pagination-next,
    .custom-pagination .ant-pagination-jump-prev,
    .custom-pagination .ant-pagination-jump-next {
      background-color: transparent !important;
      border-color: transparent !important;
      border-radius: 4px;
    }

    .custom-pagination .ant-pagination-item a {
      color: rgba(255, 255, 255, 0.85) !important;
    }

    .custom-pagination .ant-pagination-prev .ant-pagination-item-link,
    .custom-pagination .ant-pagination-next .ant-pagination-item-link {
      color: rgba(255, 255, 255, 0.85) !important;
    }

    .custom-pagination .ant-pagination-item-active {
      border-color: #1677ff !important;
    }

    .custom-pagination .ant-pagination-item-active a {
      color: #1677ff !important;
    }

    .ant-table-pagination.ant-pagination {
      margin: 16px 8px !important;
    }



    /* å°èˆªé …ç›®æ¨£å¼ */
    .nav-item {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(200, 200, 200, 0.05) 100%);
      border-radius: 12px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      cursor: pointer;
      transition: all 0.3s ease;
      height: 100%;
      backdrop-filter: blur(20px) saturate(180%) brightness(1.1);
      -webkit-backdrop-filter: blur(20px) saturate(180%) brightness(1.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 12px;
      z-index: -1;
    }

    .nav-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
      border-color: rgba(255, 255, 255, 0.25);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(200, 200, 200, 0.06) 100%);
    }

    .nav-item-content {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      height: 100%;
    }

    .nav-item-icon {
      font-size: 24px;
      color: rgba(255, 255, 255, 0.8);
      margin-top: 4px;
    }

    .nav-item-text {
      flex: 1;
    }

    .nav-item-title {
      margin: 0 0 8px 0 !important;
      color: rgba(255, 255, 255, 0.9) !important;
    }

    .nav-item-description {
      margin: 0 !important;
      color: rgba(255, 255, 255, 0.6) !important;
      font-size: 14px;
      line-height: 1.4;
    }

    /* Disabled nav item styles */
    .nav-item.disabled {
      cursor: not-allowed;
      opacity: 0.5;
      filter: grayscale(50%);
    }

    .nav-item.disabled:hover {
      transform: none;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.1);
      border-color: rgba(255, 255, 255, 0.15);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(200, 200, 200, 0.05) 100%);
    }

    .nav-item.disabled .nav-item-icon {
      opacity: 0.6;
    }

    .nav-item.disabled .nav-item-title,
    .nav-item.disabled .nav-item-description {
      opacity: 0.7;
    }

    /* æ¨¡æ…‹æ¡†å€æ®µæ¨£å¼ */
    .modal-section {
      padding: 16px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .modal-section+.modal-section {
      margin-top: 16px;
    }

    /* æ¢ä»¶ç¾¤çµ„å®¹å™¨æ¨£å¼ */
    .condition-group-container {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 6px;
      padding: 12px;
    }

    .condition-group-container+.condition-group-container {
      margin-top: 12px;
    }

    .condition-group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .condition-group-title {
      font-size: 14px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.85);
    }

    .condition-group-remove {
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      transition: color 0.2s;
    }

    .condition-group-remove:hover {
      color: rgba(255, 255, 255, 0.9);
    }

    /* è…³æœ¬åƒæ•¸å®¹å™¨æ¨£å¼ */
    .script-params-container {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 6px;
      margin-top: 12px;
    }

    .script-params-header {
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .script-params-content {
      padding: 12px 16px;
    }

    /* çµ±è¨ˆå¡ç‰‡æ¨£å¼ */

    /* ğŸ”§ çµ±ä¸€æ¨£å¼é¡ - æ›¿æ›é‡è¤‡å…§åµŒæ¨£å¼ */

    /* âš¡ çµ±ä¸€é¡è‰²æ¨£å¼ - å·²ç§»è‡³åº•éƒ¨ä½¿ç”¨ CSS è®Šæ•¸ç‰ˆæœ¬ */

    /* çµ±ä¸€é–“è·æ¨£å¼ */
    .margin-bottom-sm {
      margin-bottom: 8px;
    }

    .margin-bottom-md {
      margin-bottom: 16px;
    }

    .margin-bottom-lg {
      margin-bottom: 24px;
    }

    /* çµ±ä¸€å­—é«”æ¨£å¼ */
    .font-medium {
      font-weight: 500;
    }

    .font-semibold {
      font-weight: 600;
    }

    .font-bold {
      font-weight: 700;
    }

    /* çµ±ä¸€æ¨™é¡Œæ¨£å¼ */
    .section-title {
      margin-bottom: 16px;
      color: rgba(255, 255, 255, 0.9);
      font-size: 16px;
      font-weight: 600;
    }

    .chart-title {
      margin-bottom: 8px;
      color: rgba(255, 255, 255, 0.85);
      margin-top: 0;
      font-size: 14px;
      font-weight: 600;
    }

    /* çµ±ä¸€é«˜åº¦æ¨£å¼ */
    .card-height-small {
      height: 88px;
    }

    .card-height-large {
      height: 240px;
    }

    /* çµ±ä¸€å…§è·æ¨£å¼ */
    .padding-md {
      padding: 16px;
    }

    .padding-lg {
      padding: 20px;
    }

    /* å¡ç‰‡æ¨™é¡Œæ¨£å¼ */
    .card-title {
      color: var(--text-tertiary);
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    /* å¡ç‰‡æ•¸å€¼æ¨£å¼ */
    .card-value {
      font-size: 32px;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 4px;
    }

    .card-value-large {
      font-size: 40px;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 4px;
    }

    /* å¡ç‰‡æè¿°æ¨£å¼ */
    .card-description {
      color: var(--text-secondary);
      font-size: 12px;
    }

    /* å¡ç‰‡åœ–æ¨™æ¨£å¼ */
    .card-icon {
      font-size: 32px;
      opacity: 0.8;
    }

    .card-icon-large {
      font-size: 36px;
      opacity: 0.8;
    }

    .card-icon-xl {
      font-size: 40px;
      opacity: 0.8;
    }

    /* å¡ç‰‡å…§å®¹ä½ˆå±€ */
    .card-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 100%;
      padding: 20px 16px;
    }

    .card-content-vertical {
      display: flex;
      flex-direction: column;
      justify-content: center;
      height: 100%;
    }

    /* åœ–è¡¨å€åŸŸæ¨£å¼ */
    .chart-section {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }

    .chart-header {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .chart-content {
      padding: 16px 20px;
    }

    /* åˆ†æå€åŸŸæ¨£å¼ */
    .analysis-section {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 16px;
    }

    .analysis-header {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .analysis-content {
      padding: 16px 20px;
    }

    /* ç©ºåˆ†ææç¤ºæ¨£å¼ */
    .empty-analysis {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 32px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* ç™»å…¥é é¢æ¨£å¼ */
    .login-page {
      background: linear-gradient(135deg, #0a0b0d 0%, #161719 50%, #0a0b0d 100%) !important;
      background-attachment: fixed !important;
    }

    .login-page .ant-input,
    .login-page .ant-input-password {
      background: var(--bg-container) !important;
      border: 1px solid var(--border-light) !important;
      border-radius: var(--radius-lg) !important;
      color: var(--text-primary) !important;
      transition: all 0.3s ease !important;
    }

    .login-page .ant-input::placeholder,
    .login-page .ant-input-password .ant-input::placeholder {
      color: var(--text-tertiary) !important;
    }

    .login-page .ant-input:hover,
    .login-page .ant-input-password:hover {
      border-color: var(--border-hover) !important;
    }

    .login-page .ant-input:focus,
    .login-page .ant-input-focused,
    .login-page .ant-input-password:focus-within {
      border-color: var(--brand-primary) !important;
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1) !important;
    }

    .login-page .ant-form-item-label>label {
      color: var(--text-primary) !important;
      font-weight: 600 !important;
    }

    .login-page .ant-checkbox-wrapper {
      color: var(--text-secondary) !important;
    }

    .login-page .login-submit-btn {
      height: 44px;
      font-size: 16px;
      font-weight: 600;
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, var(--brand-primary) 0%, var(--brand-primary-hover) 100%);
      border: none;
      box-shadow: 0 6px 24px rgba(24, 144, 255, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: white !important;
    }

    .login-page .login-submit-btn:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 8px 32px rgba(24, 144, 255, 0.4) !important;
      background: linear-gradient(135deg, var(--brand-primary-hover) 0%, var(--brand-primary) 100%);
    }

    .login-page .login-submit-btn:active {
      transform: translateY(0) !important;
      box-shadow: 0 4px 16px rgba(24, 144, 255, 0.3) !important;
    }

    /* ä½¿ç”¨è€…åœ˜éšŠå®¹å™¨æ¨£å¼ */
    .user-team-container {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 16px;
    }

    /* è§’è‰²åˆ—è¡¨å®¹å™¨æ¨£å¼ */
    .role-list-container {
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
      height: fit-content;
      box-shadow: var(--shadow-sm);
    }

    .role-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-elevated);
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .role-list-content {
      padding: var(--spacing-md);
      max-height: 500px;
      overflow-y: auto;
    }

    /* è§’è‰²åˆ—è¡¨é …ç›®æ¨£å¼ */
    .role-list-item:hover {
      background: var(--bg-hover) !important;
      border: 1px solid var(--border-base) !important;
    }

    .role-list-item.ant-list-item {
      border: none !important;
    }

    /* è§’è‰²æ¬Šé™å®¹å™¨æ¨£å¼ */
    .role-permissions-container {
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
      height: fit-content;
      box-shadow: var(--shadow-sm);
    }

    .role-permissions-header {
      padding: var(--spacing-lg) var(--spacing-xl);
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-elevated);
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .role-permissions-content {
      padding: var(--spacing-lg) var(--spacing-xl);
    }

    /* æ¬Šé™æ¨¹æ¨£å¼å„ªåŒ– */
    .role-permissions-container .ant-tree .ant-tree-treenode {
      padding: 4px 0;
    }

    .role-permissions-container .ant-tree .ant-tree-node-content-wrapper {
      color: var(--text-primary) !important;
      padding: 2px 4px;
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }

    .role-permissions-container .ant-tree .ant-tree-node-content-wrapper:hover {
      background: var(--bg-hover) !important;
    }

    .role-permissions-container .ant-tree .ant-tree-checkbox {
      margin-right: 8px;
    }

    /* ä¿®å¾©å½ˆçª—é—œé–‰æŒ‰éˆ•èˆ‡æ»¾å‹•æ¢é‡ç–Šå•é¡Œ */
    .ant-modal .ant-modal-close {
      top: 16px !important;
      right: 24px !important;
      z-index: 1050 !important;
      width: 32px !important;
      height: 32px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      background: rgba(0, 0, 0, 0.6) !important;
      border-radius: 50% !important;
      transition: all 0.3s ease !important;
    }

    .ant-modal .ant-modal-close:hover {
      background: rgba(255, 255, 255, 0.1) !important;
      transform: scale(1.1) !important;
    }

    .ant-modal .ant-modal-close-x {
      width: 16px !important;
      height: 16px !important;
      font-size: 16px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      color: var(--text-primary) !important;
    }

    /* å½ˆçª—å…§å®¹å€åŸŸèª¿æ•´ï¼Œé¿å…èˆ‡é—œé–‰æŒ‰éˆ•é‡ç–Š */
    .ant-modal-content {
      padding-top: 24px !important;
      position: relative !important;
    }

    .ant-modal-body {
      padding: 24px !important;
      max-height: 70vh !important;
      overflow-y: auto !important;
      /* ç‚ºæ»¾å‹•æ¢ç•™å‡ºç©ºé–“ */
      padding-right: 32px !important;
      margin-right: -8px !important;
    }

    /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ */
    .ant-modal-body::-webkit-scrollbar {
      width: 8px;
    }

    .ant-modal-body::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }

    .ant-modal-body::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
    }

    .ant-modal-body::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Transfer çµ„ä»¶æ¨£å¼å„ªåŒ– */
    .ant-transfer-list {
      background: rgba(0, 0, 0, 0.2) !important;
      border: 1px solid rgba(255, 255, 255, 0.1) !important;
    }

    .ant-transfer-list-header {
      background: rgba(0, 0, 0, 0.3) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    }

    .ant-transfer-list-header-title {
      color: rgba(255, 255, 255, 0.9) !important;
    }

    .ant-transfer-list-body {
      background: rgba(0, 0, 0, 0.1) !important;
    }

    .ant-transfer-list-content-item {
      color: rgba(255, 255, 255, 0.9) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    }

    .ant-transfer-list-content-item:hover {
      background: rgba(255, 255, 255, 0.05) !important;
    }

    .ant-transfer-list-search {
      background: rgba(255, 255, 255, 0.05) !important;
      border: 1px solid rgba(255, 255, 255, 0.1) !important;
    }

    .ant-transfer-list-search input {
      background: transparent !important;
      color: rgba(255, 255, 255, 0.9) !important;
    }

    .ant-transfer-list-search input::placeholder {
      color: rgba(255, 255, 255, 0.4) !important;
    }

    /* Header å’Œ Sidebar ç´°ç°ç·šåˆ†éš” */
    .ant-layout-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
      height: 48px !important;
      line-height: 48px !important;
    }

    .ant-layout-sider {
      border-right: 1px solid rgba(255, 255, 255, 0.08) !important;
    }

    .ant-layout-sider-collapsed {
      border-right: 1px solid rgba(255, 255, 255, 0.08) !important;
    }

    /* ğŸ¯ å¹³å°ç´š UI/UX æ¨™æº–åŒ–è¨­è¨ˆè¦ç¯„ */

    /* === Modal å½ˆçª—æ¨™æº–åŒ–è¨­è¨ˆ === */
    .platform-modal .ant-modal {
      --modal-border-radius: var(--radius-xl);
      --modal-backdrop: rgba(0, 0, 0, 0.75);
      --modal-shadow: 0 16px 48px rgba(0, 0, 0, 0.5), 0 4px 16px rgba(0, 0, 0, 0.3);
    }

    .platform-modal .ant-modal-mask {
      background: var(--modal-backdrop);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .platform-modal .ant-modal-content {
      background: var(--bg-elevated);
      border: var(--glass-border);
      border-radius: var(--modal-border-radius);
      box-shadow: var(--modal-shadow);
      overflow: hidden;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }

    .platform-modal .ant-modal-header {
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-light);
      padding: var(--spacing-xl);
    }

    .platform-modal .ant-modal-title {
      color: var(--text-primary);
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }

    .platform-modal .ant-modal-body {
      padding: var(--spacing-xl);
      max-height: 70vh;
      overflow-y: auto;
    }

    .platform-modal .ant-modal-footer {
      background: var(--bg-elevated);
      border-top: 1px solid var(--border-light);
      padding: var(--spacing-lg) var(--spacing-xl);
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-md);
    }

    /* === è¨­å®šé é¢ä½ˆå±€æ¨¡å¼æ¨™æº–åŒ– === */
    .settings-layout {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-xl);
    }

    .settings-section {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
    }

    .settings-section-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
    }

    .settings-section-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
      line-height: 1.2;
    }

    .settings-section-description {
      font-size: 14px;
      color: var(--text-tertiary);
      margin-top: var(--spacing-xs);
      line-height: 1.4;
    }

    .settings-section-actions {
      display: flex;
      gap: var(--spacing-sm);
    }

    .settings-form-group {
      margin-bottom: var(--spacing-2xl);
    }

    .settings-form-group:last-child {
      margin-bottom: 0;
    }

    .settings-form-row {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: var(--spacing-xl);
      align-items: flex-start;
      margin-bottom: var(--spacing-lg);
    }

    .settings-form-label {
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: var(--spacing-xs);
    }

    .settings-form-description {
      font-size: 13px;
      color: var(--text-tertiary);
      line-height: 1.4;
    }

    .settings-form-control {
      width: 100%;
    }

    /* === å…¨åŸŸæ“ä½œæŒ‰éˆ•æ¨™æº–åŒ– === */
    .platform-btn {
      --btn-height: 36px;
      --btn-padding: 0 var(--spacing-lg);
      --btn-font-size: 14px;
      --btn-font-weight: 500;
      --btn-border-radius: var(--radius-sm);
      --btn-transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);

      height: var(--btn-height);
      padding: var(--btn-padding);
      font-size: var(--btn-font-size);
      font-weight: var(--btn-font-weight);
      border-radius: var(--btn-border-radius);
      transition: var(--btn-transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
      white-space: nowrap;
      cursor: pointer;
      border: 1px solid transparent;
      background: transparent;
    }

    /* ä¸»è¦æŒ‰éˆ• */
    .platform-btn--primary {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
      color: white;
    }

    .platform-btn--primary:hover {
      background: var(--brand-primary-hover);
      border-color: var(--brand-primary-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(24, 144, 255, 0.3);
    }

    /* æ¬¡è¦æŒ‰éˆ• */
    .platform-btn--secondary {
      border-color: var(--border-base);
      color: var(--text-secondary);
      background: var(--bg-elevated);
    }

    .platform-btn--secondary:hover {
      border-color: var(--border-hover);
      background: var(--bg-hover);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    /* å±éšªæŒ‰éˆ• */
    .platform-btn--danger {
      background: var(--brand-danger);
      border-color: var(--brand-danger);
      color: white;
    }

    .platform-btn--danger:hover {
      background: var(--brand-danger-hover);
      border-color: var(--brand-danger-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(255, 77, 79, 0.3);
    }

    /* å°å°ºå¯¸æŒ‰éˆ• */
    .platform-btn--small {
      --btn-height: 28px;
      --btn-padding: 0 var(--spacing-md);
      --btn-font-size: 12px;
    }

    /* å¤§å°ºå¯¸æŒ‰éˆ• */
    .platform-btn--large {
      --btn-height: 44px;
      --btn-padding: 0 var(--spacing-2xl);
      --btn-font-size: 16px;
    }

    /* åƒ…åœ–ç¤ºæŒ‰éˆ• */
    .platform-btn--icon-only {
      --btn-padding: 0;
      width: var(--btn-height);
      min-width: var(--btn-height);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* å¹½éˆæŒ‰éˆ•è®Šé«” */
    .platform-btn--ghost {
      --btn-bg: transparent;
      --btn-color: var(--text-tertiary);
      --btn-border-color: var(--border-light);
      --btn-bg-hover: var(--bg-hover);
      --btn-color-hover: var(--text-secondary);
      --btn-border-color-hover: var(--border-default);
    }

    .platform-btn--ghost:hover {
      background: var(--btn-bg-hover);
      color: var(--btn-color-hover);
      border-color: var(--btn-border-color-hover);
    }

    /* æ–‡å­—æŒ‰éˆ•è®Šé«” */
    .platform-btn--text {
      --btn-bg: transparent;
      --btn-color: var(--text-tertiary);
      --btn-border-color: transparent;
      --btn-bg-hover: var(--bg-hover);
      --btn-color-hover: var(--text-secondary);
      --btn-border-color-hover: transparent;
      padding: var(--spacing-xs) var(--spacing-sm);
    }

    .platform-btn--text:hover {
      background: var(--btn-bg-hover);
      color: var(--btn-color-hover);
    }

    /* === æ“ä½œæŒ‰éˆ•çµ„æ¨£å¼ === */
    .table-row-actions {
      display: flex;
      gap: var(--spacing-xs);
      align-items: center;
      justify-content: center;
      min-width: 80px;
    }

    .table-row-actions .platform-btn {
      opacity: 0.7;
      transition: all 0.2s ease;
    }

    .table-row-actions .platform-btn:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .table-action-delete:hover {
      --btn-color-hover: var(--brand-danger);
      --btn-bg-hover: rgba(255, 77, 79, 0.1);
    }

    /* === å·¥å…·åˆ—æ¨£å¼ === */
    .toolbar-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      gap: var(--spacing-lg);
      padding: var(--spacing-md) 0;
    }

    .toolbar-group {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    .toolbar-group--secondary .platform-btn {
      opacity: 0.8;
    }

    .toolbar-group--secondary .platform-btn:hover {
      opacity: 1;
    }

    .filter-active {
      --btn-color: var(--brand-primary);
      --btn-bg: rgba(24, 144, 255, 0.1);
      --btn-border-color: var(--brand-primary);
    }

    /* === æ‰¹æ¬¡æ“ä½œå·¥å…·åˆ—æ¨£å¼ === */
    .batch-action-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-md) var(--spacing-lg);
      margin: var(--spacing-md) 0;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
      animation: slideInDown 0.3s ease;
    }

    .batch-selection-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      color: var(--text-secondary);
      font-size: 13px;
    }

    .batch-count {
      font-weight: 600;
      color: var(--brand-primary);
      margin: 0 var(--spacing-xs);
    }

    .batch-actions {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    /* === Modal æ“ä½œæ¨£å¼ === */
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-lg) 0 0;
      margin-top: var(--spacing-lg);
      border-top: 1px solid var(--border-light);
    }

    /* === å‹•ç•«æ•ˆæœ === */
    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* æŒ‰éˆ•é»æ“Šåé¥‹å‹•ç•« */
    .platform-btn:active {
      transform: scale(0.98);
    }

    .platform-btn--icon-only:active {
      transform: scale(0.95);
    }

    /* === è¡¨æ ¼æ¨™æº–åŒ–è¨­è¨ˆ === */
    .platform-table-container {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
    }

    .platform-table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-lg) var(--spacing-xl);
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-light);
      min-height: 64px;
    }

    .platform-table-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .platform-table-actions {
      display: flex;
      gap: var(--spacing-md);
      align-items: center;
    }

    .platform-table .ant-table {
      background: transparent;
    }

    .platform-table .ant-table-thead>tr>th {
      background: rgba(255, 255, 255, 0.05) !important;
      color: var(--text-primary);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
      white-space: nowrap;
    }

    .platform-table .ant-table-tbody>tr {
      height: 48px;
      transition: all 0.2s ease;
    }

    .platform-table .ant-table-tbody>tr:hover {
      background: var(--bg-hover);
    }

    .platform-table .ant-table-tbody>tr>td {
      padding: var(--spacing-sm) var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
      color: var(--text-secondary);
      vertical-align: middle;
      font-size: 13px;
      line-height: 1.4;
    }

    /* === å¢å¼·å‹è¡¨æ ¼å„ªåŒ– === */
    .platform-enhanced-table {
      background: transparent;
    }

    .platform-enhanced-table .ant-table-thead>tr>th {
      background: rgba(255, 255, 255, 0.05) !important;
      color: var(--text-primary);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 12px 16px;
      height: auto;
      border-bottom: 2px solid var(--border-default);
      white-space: nowrap;
      position: relative;
    }

    .platform-enhanced-table .ant-table-thead>tr>th::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--brand-primary);
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .platform-enhanced-table .ant-table-thead>tr>th:hover::after {
      opacity: 0.3;
    }

    /* è¡¨æ ¼è¡Œå„ªåŒ– - ä¸‰ç¨®å¯†åº¦ */
    .platform-enhanced-table.density-compact .ant-table-tbody>tr {
      height: 36px;
    }

    .platform-enhanced-table.density-compact .ant-table-tbody>tr>td {
      padding: 6px 12px;
      font-size: 12px;
      line-height: 1.3;
    }

    .platform-enhanced-table.density-standard .ant-table-tbody>tr {
      height: 48px;
    }

    .platform-enhanced-table.density-standard .ant-table-tbody>tr>td {
      padding: 12px 16px;
      font-size: 13px;
      line-height: 1.4;
    }

    .platform-enhanced-table.density-comfortable .ant-table-tbody>tr {
      height: 56px;
    }

    .platform-enhanced-table.density-comfortable .ant-table-tbody>tr>td {
      padding: 16px 20px;
      font-size: 14px;
      line-height: 1.5;
    }

    /* è¡¨æ ¼è¡Œäº’å‹•æ•ˆæœ */
    .platform-enhanced-table .ant-table-tbody>tr {
      transition: all 0.2s ease;
      border-left: 3px solid transparent;
    }

    .platform-enhanced-table .ant-table-tbody>tr:hover {
      background: var(--bg-hover);
      border-left-color: var(--brand-primary);
      transform: translateX(2px);
    }

    .platform-enhanced-table .ant-table-tbody>tr.ant-table-row-selected {
      background: rgba(24, 144, 255, 0.1);
      border-left-color: var(--brand-primary);
    }

    .platform-enhanced-table .ant-table-tbody>tr.ant-table-row-selected:hover {
      background: rgba(24, 144, 255, 0.15);
    }

    /* æ¬„ä½é¡å‹ç‰¹å®šæ¨£å¼ */
    .table-cell-status {
      text-align: center;
    }

    .table-cell-number {
      text-align: right;
      font-variant-numeric: tabular-nums;
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
    }

    .table-cell-date {
      font-variant-numeric: tabular-nums;
      color: var(--text-tertiary);
      font-size: 12px;
    }

    .table-cell-action {
      text-align: center;
      padding: 8px !important;
    }

    /* éŸ¿æ‡‰å¼æ¬„ä½é¡¯ç¤º */
    @media (max-width: 1200px) {
      .table-column-optional {
        display: none;
      }
    }

    @media (max-width: 768px) {
      .table-column-secondary {
        display: none;
      }

      .platform-enhanced-table .ant-table-tbody>tr>td {
        padding: 8px 12px;
        font-size: 12px;
      }

      .table-cell-action {
        padding: 4px !important;
      }
    }

    /* åˆ†é æ¨£å¼å„ªåŒ– */
    .platform-pagination.ant-pagination {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-lg) 0;
      background: var(--bg-elevated);
      border-top: 1px solid var(--border-light);
    }

    .platform-pagination .ant-pagination-total-text {
      color: var(--text-tertiary);
      font-size: 13px;
      margin-right: auto;
    }

    .platform-pagination .ant-pagination-item,
    .platform-pagination .ant-pagination-prev,
    .platform-pagination .ant-pagination-next {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      color: var(--text-secondary);
    }

    .platform-pagination .ant-pagination-item:hover,
    .platform-pagination .ant-pagination-prev:hover,
    .platform-pagination .ant-pagination-next:hover {
      background: var(--bg-hover);
      border-color: var(--brand-primary);
      color: var(--brand-primary);
    }

    .platform-pagination .ant-pagination-item-active {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
      color: white;
    }

    .platform-pagination .ant-pagination-item-active:hover {
      background: var(--brand-primary);
      color: white;
    }

    /* ç©ºç‹€æ…‹å„ªåŒ– */
    .platform-enhanced-table .ant-empty {
      padding: var(--spacing-2xl);
    }

    .platform-enhanced-table .ant-empty-description {
      color: var(--text-tertiary);
      font-size: 14px;
    }

    /* è¼‰å…¥ç‹€æ…‹å„ªåŒ– */
    .platform-enhanced-table .ant-spin-container {
      position: relative;
      min-height: 200px;
    }

    /* è¡¨æ ¼å·¥å…·åˆ—æ•´åˆ */
    .table-density-control {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .density-option {
      padding: 4px 8px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      background: var(--bg-elevated);
      color: var(--text-tertiary);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 11px;
      text-transform: uppercase;
    }

    .density-option:hover {
      border-color: var(--brand-primary);
      color: var(--brand-primary);
    }

    .density-option.active {
      background: var(--brand-primary);
      border-color: var(--brand-primary);
      color: white;
    }

    /* === ğŸ·ï¸ é é¢æ¨™é¡Œçµ„ä»¶æ¨£å¼ === */
    .page-header {
      margin-bottom: var(--spacing-xl);
      padding: var(--spacing-lg) 0;
    }

    .page-breadcrumb {
      margin-bottom: var(--spacing-md);
    }

    .page-header-content {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--spacing-lg);
    }

    .page-header-main {
      flex: 1;
      min-width: 0;
    }

    .page-title-section {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
    }

    .page-title-icon {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 48px;
      height: 48px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      color: var(--brand-primary);
      font-size: 20px;
    }

    .page-title-text {
      flex: 1;
      min-width: 0;
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0 0 var(--spacing-xs) 0;
      line-height: 1.2;
    }

    .page-subtitle {
      font-size: 16px;
      color: var(--text-tertiary);
      margin: 0;
      line-height: 1.4;
      max-width: 600px;
    }

    .page-header-actions {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      flex-shrink: 0;
    }

    /* éŸ¿æ‡‰å¼è™•ç† */
    @media (max-width: 768px) {
      .page-header-content {
        flex-direction: column;
        align-items: stretch;
        gap: var(--spacing-md);
      }

      .page-title {
        font-size: 24px;
      }

      .page-subtitle {
        font-size: 14px;
      }

      .page-title-section {
        align-items: center;
      }

      .page-title-icon {
        width: 40px;
        height: 40px;
        font-size: 18px;
      }
    }

    /* === ğŸ“Š æƒ…å¢ƒåŒ– KPI å¡ç‰‡æ¨£å¼ === */
    .contextual-kpi-card {
      background: var(--glass-bg);
      border: var(--glass-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      transition: all 0.3s ease;
      backdrop-filter: var(--glass-backdrop);
      -webkit-backdrop-filter: var(--glass-backdrop);
      box-shadow: var(--glass-shadow);
      position: relative;
      overflow: hidden;
      height: 120px;
      /* çµ±ä¸€é«˜åº¦ */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      /* æ¢å¾©é–“è·å°é½Šï¼Œç¢ºä¿å…§å®¹åœ¨åº•éƒ¨å°é½Š */
    }

    .contextual-kpi-card.clickable {
      cursor: pointer;
    }

    .contextual-kpi-card.clickable:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
      border-color: var(--brand-primary);
    }

    .contextual-kpi-card.clickable:active {
      transform: translateY(0);
    }

    /* KPI ç‹€æ…‹æ¨£å¼ */
    .contextual-kpi-card.critical::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--error-color);
    }

    .contextual-kpi-card.warning::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--warning-color);
    }

    .contextual-kpi-card.success::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--success-color);
    }

    .kpi-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* æ”¹ç‚ºå±…ä¸­å°é½Š */
      margin-bottom: var(--spacing-md);
    }

    .kpi-title-section {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      flex: 1;
      min-width: 0;
    }

    .kpi-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: rgba(24, 144, 255, 0.1);
      border-radius: var(--radius-md);
      color: var(--brand-primary);
      font-size: 14px;
      flex-shrink: 0;
    }

    .kpi-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .kpi-trend {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: 12px;
      font-weight: 600;
    }

    .trend-value {
      font-variant-numeric: tabular-nums;
    }

    .kpi-content {
      flex: 1;
    }

    .kpi-value {
      font-size: 32px;
      font-weight: 700;
      line-height: 1;
      margin-bottom: var(--spacing-xs);
      font-variant-numeric: tabular-nums;
      display: flex;
      align-items: baseline;
      gap: var(--spacing-xs);
    }

    .kpi-unit {
      font-size: 16px;
      font-weight: 400;
      color: var(--text-tertiary);
    }

    .kpi-description {
      font-size: 12px;
      color: var(--text-tertiary);
      line-height: 1.4;
    }

    /* å¯ç¯©é¸ KPI ç‰¹æ®Šæ¨£å¼ */
    .filterable-kpi.active {
      border-color: var(--brand-primary);
      background: rgba(24, 144, 255, 0.05);
      box-shadow: 0 0 0 1px var(--brand-primary);
    }

    .filterable-kpi.active .kpi-title {
      color: var(--brand-primary);
      font-weight: 600;
    }

    /* === ğŸ¯ KPI å¡ç‰‡ç¶²æ ¼çµ±ä¸€é…ç½® === */
    .kpi-grid {
      margin-bottom: var(--spacing-lg);
    }

    .kpi-grid .ant-row {
      margin-left: -8px;
      margin-right: -8px;
    }

    .kpi-grid .ant-col {
      padding-left: 8px;
      padding-right: 8px;
      margin-bottom: 12px;
    }

    /* === ğŸ“ é é¢ä½ˆå±€å„ªåŒ– - ç¢ºä¿å…§å®¹åœ¨è¦–çª—ç¯„åœå…§ === */
    .page-header {
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-sm) 0;
    }

    .chart-card {
      margin-bottom: var(--spacing-lg);
    }

    /* === ğŸ›ï¸ çµ±ä¸€å…§å®¹å€åŸŸé–“è· === */
    .ant-tabs {
      margin-top: var(--spacing-md);
    }

    .ant-tabs .ant-tabs-content-holder {
      padding-top: var(--spacing-lg);
    }

    /* Ant Design è¡¨æ ¼ä¸Šæ–¹é–“è·çµ±ä¸€ */
    .ant-table-wrapper {
      margin-top: var(--spacing-lg);
    }

    /* === ğŸ¯ æ·±åº¦é–“è·å„ªåŒ– - åŸºæ–¼æˆªåœ–åˆ†æ === */
    /* çµ±ä¸€å¡ç‰‡å®¹å™¨é–“è· */
    .ant-card {
      margin-bottom: var(--spacing-md);
    }

    /* çµ±ä¸€è¡¨å–®å€åŸŸé–“è· */
    .ant-form {
      margin-bottom: var(--spacing-lg);
    }

    .search-section,
    .filter-section {
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-md);
      background: var(--bg-secondary);
      border-radius: var(--border-radius);
    }

    /* çµ±ä¸€åˆ†é å™¨é–“è· */
    .ant-pagination {
      margin-top: var(--spacing-lg);
      text-align: center;
      padding: var(--spacing-md) 0;
    }

    /* çµ±ä¸€æè¿°å’Œåˆ—è¡¨é–“è· */
    .ant-descriptions {
      margin-bottom: var(--spacing-lg);
    }

    .ant-list-item {
      padding: var(--spacing-md) 0;
      border-bottom: 1px solid var(--border-light);
    }

    /* çµ±ä¸€å·¥å…·åˆ—é–“è· */
    .table-toolbar,
    .content-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
      padding: var(--spacing-sm) 0;
    }

    .filter-bar {
      display: flex;
      gap: var(--spacing-md);
      align-items: center;
      flex-wrap: wrap;
    }

    /* çµ±ä¸€æŒ‰éˆ•çµ„é–“è· */
    .ant-btn-group {
      margin-right: var(--spacing-md);
    }

    .ant-btn+.ant-btn {
      margin-left: var(--spacing-sm);
    }

    /* çµ±ä¸€è¡¨å–®é …é–“è· */
    .ant-form-item {
      margin-bottom: var(--spacing-lg);
    }

    .ant-form-item:last-child {
      margin-bottom: 0;
    }

    /* === ğŸ”§ æ¨¡æ…‹æ¡†å’Œå½ˆå‡ºçµ„ä»¶é–“è·çµ±ä¸€ === */
    .ant-modal-body {
      padding: var(--spacing-xl);
    }

    .ant-modal-header {
      padding: var(--spacing-lg) var(--spacing-xl);
      border-bottom: 1px solid var(--border-light);
    }

    .ant-modal-footer {
      padding: var(--spacing-md) var(--spacing-xl);
      border-top: 1px solid var(--border-light);
    }

    .ant-drawer-body {
      padding: var(--spacing-lg);
    }

    .ant-drawer-header {
      padding: var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
    }

    /* çµ±ä¸€å½ˆå‡ºæ¡†å’Œæç¤ºæ¡†é–“è· */
    .ant-popover-inner-content {
      padding: var(--spacing-md);
    }

    .ant-tooltip-inner {
      padding: var(--spacing-sm) var(--spacing-md);
    }

    /* === ğŸ“Š è¡¨æ ¼å’Œæ•¸æ“šå±•ç¤ºå„ªåŒ– === */
    .ant-table-thead>tr>th {
      padding: var(--spacing-md) var(--spacing-lg);
      background: rgba(255, 255, 255, 0.05) !important;
      font-weight: 600;
    }

    .ant-table-tbody>tr>td {
      padding: var(--spacing-md) var(--spacing-lg);
      border-bottom: 1px solid var(--border-light);
    }

    /* çµ±ä¸€æ¨™ç±¤é–“è· */
    .ant-tag {
      margin: 2px 4px 2px 0;
      padding: 2px 8px;
      border-radius: var(--border-radius);
    }

    /* çµ±ä¸€æ­¥é©Ÿæ¢é–“è· */
    .ant-steps {
      margin-bottom: var(--spacing-lg);
    }

    .ant-steps-item {
      padding-left: 0;
      margin-right: var(--spacing-xl);
    }

    /* === ğŸ›ï¸ ç‰¹å®šé é¢å€åŸŸé–“è·å„ªåŒ– === */
    /* è¡¨æ ¼æ“ä½œå€åŸŸ */
    .table-actions {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    /* æœå°‹å’Œç¯©é¸å™¨å€åŸŸ */
    .search-filters {
      display: flex;
      gap: var(--spacing-md);
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-md);
      background: var(--bg-secondary);
      border-radius: var(--border-radius);
    }

    /* é é¢é ‚éƒ¨å·¥å…·åˆ— */
    .page-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-md) 0;
      border-bottom: 1px solid var(--border-light);
    }

    /* çµ±è¨ˆå¡ç‰‡ä¹‹é–“çš„é–“è· */
    .stats-card {
      margin-bottom: var(--spacing-md);
    }

    /* è³‡æºåˆ—è¡¨é …ç›®é–“è· */
    .resource-item {
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-light);
    }

    /* é€šçŸ¥å’Œè­¦å ±é …ç›®é–“è· */
    .notification-item,
    .alert-item {
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
      border-left: 4px solid var(--border-light);
    }

    /* äººå“¡ç®¡ç†å’Œè¨­å®šé é¢ç‰¹æ®Šé–“è· */
    .user-profile-section {
      margin-bottom: var(--spacing-xl);
      padding: var(--spacing-lg);
      background: var(--bg-elevated);
      border-radius: var(--border-radius);
    }

    .settings-section {
      margin-bottom: var(--spacing-xl);
      padding: var(--spacing-lg);
      border: 1px solid var(--border-light);
      border-radius: var(--border-radius);
    }

    /* === ğŸ¨ è¦–è¦ºå±¤æ¬¡æœ€å¾Œèª¿æ•´ === */
    /* çµ±ä¸€æ–‡å­—å°æ¯”å’Œå±¤æ¬¡ */
    .ant-table-thead>tr>th {
      background: rgba(255, 255, 255, 0.05) !important;
      color: var(--text-primary);
      font-weight: 600;
      font-size: 14px;
    }

    /* å¼·åˆ¶çµ±ä¸€æ‰€æœ‰è¡¨é ­èƒŒæ™¯è‰²å’Œç§»é™¤å›ºå®šé«˜åº¦ */
    .ant-table .ant-table-thead>tr>th,
    .ant-table-thead th,
    th.ant-table-cell,
    .ant-table-thead>tr>th.ant-table-cell,
    .ant-table-thead>tr>th.ant-table-column-has-sorters,
    .ant-table-thead>tr>th.ant-table-column-has-sorters:hover,
    .ant-table-thead>tr>th.ant-table-column-sort {
      background: rgba(255, 255, 255, 0.05) !important;
      background-color: rgba(255, 255, 255, 0.05) !important;
      height: auto !important;
      min-height: auto !important;
    }



    .ant-table-tbody>tr>td {
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* çµ±ä¸€æŒ‰éˆ•æ–‡å­—å¤§å° */
    .ant-btn {
      font-size: 14px;
      font-weight: 500;
      line-height: 1.5;
    }

    /* çµ±ä¸€å¡ç‰‡æ¨™é¡Œæ¨£å¼ */
    .ant-card-head-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* çµ±ä¸€è¡¨å–®æ¨™ç±¤æ¨£å¼ */
    .ant-form-item-label>label {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    /* çµ±ä¸€æ¨™ç±¤å’Œå¾½ç« æ–‡å­— */
    .ant-tag {
      font-size: 12px;
      font-weight: 500;
    }

    /* çµ±ä¸€å°èˆªæ–‡å­— */
    .ant-menu-item {
      font-size: 14px;
      font-weight: 500;
    }

    /* çµ±ä¸€é é¢æ¨™é¡Œå±¤æ¬¡ */
    .page-title {
      font-size: 24px;
      font-weight: 600;
      line-height: 1.2;
      color: var(--text-primary);
    }

    .page-subtitle {
      font-size: 16px;
      font-weight: 400;
      line-height: 1.4;
      color: var(--text-tertiary);
    }

    /* çµ±ä¸€æ•¸æ“šé¡¯ç¤ºå­—é«” */
    .kpi-value {
      font-family: 'SF Mono', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
      font-weight: 600;
    }

    .metric-value {
      font-family: 'SF Mono', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
      font-weight: 500;
    }

    /* éŸ¿æ‡‰å¼ä½ˆå±€å„ªåŒ– */
    @media (max-width: 1200px) {
      .kpi-grid {
        margin-bottom: var(--spacing-md);
      }

      .chart-card {
        margin-bottom: var(--spacing-md);
      }

      .page-header {
        margin-bottom: var(--spacing-md);
      }
    }

    /* å°è¢å¹•å„ªåŒ– */
    @media (max-width: 768px) {
      .page-header {
        margin-bottom: var(--spacing-sm);
        padding: var(--spacing-xs) 0;
      }

      .kpi-grid {
        margin-bottom: var(--spacing-sm);
      }
    }

    /* éŸ¿æ‡‰å¼ KPI å¡ç‰‡ */
    @media (max-width: 768px) {
      .contextual-kpi-card {
        padding: var(--spacing-md);
        height: 100px;
        /* å°è¢å¹•ä½¿ç”¨è¼ƒå°å›ºå®šé«˜åº¦ */
      }

      .kpi-value {
        font-size: 24px;
      }

      .kpi-title {
        font-size: 13px;
      }

      .kpi-icon {
        width: 20px;
        height: 20px;
        font-size: 12px;
      }
    }

    /* === éŸ¿æ‡‰å¼è¨­è¨ˆå„ªåŒ– === */
    @media (max-width: 1200px) {
      .settings-layout {
        padding: var(--spacing-lg);
      }

      .settings-form-row {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }

      .platform-table-header {
        flex-direction: column;
        gap: var(--spacing-md);
        align-items: stretch;
      }

      .platform-table-actions {
        justify-content: flex-end;
      }
    }




    /* ğŸ¨ é€šç”¨æ¨£å¼é¡åˆ¥ç³»çµ± */
    /* æ–‡å­—é¡è‰² */
    .text-primary {
      color: var(--c-gray-900) !important;
    }

    .text-secondary {
      color: var(--c-gray-700) !important;
    }

    .text-tertiary {
      color: var(--c-gray-500) !important;
    }

    .text-muted {
      color: var(--c-gray-400) !important;
    }

    /* èƒŒæ™¯é¡è‰² */
    .bg-primary {
      background: var(--bg-primary) !important;
    }

    .bg-secondary {
      background: var(--bg-secondary) !important;
    }

    .bg-tertiary {
      background: var(--bg-tertiary) !important;
    }

    .bg-hover {
      background: var(--bg-hover) !important;
    }

    .bg-active {
      background: var(--bg-active) !important;
    }

    /* é‚Šæ¡†é¡è‰² */
    .border-primary {
      border-color: var(--c-gray-200) !important;
    }

    .border-secondary {
      border-color: var(--c-gray-300) !important;
    }

    /* é™°å½± */
    .shadow-sm {
      box-shadow: var(--shadow-sm) !important;
    }

    .shadow-md {
      box-shadow: var(--shadow-md) !important;
    }

    .shadow-lg {
      box-shadow: var(--shadow-lg) !important;
    }

    .shadow-xl {
      box-shadow: var(--shadow-xl) !important;
    }

    /* é–“è· */
    .p-xs {
      padding: var(--space-xs) !important;
    }

    .p-sm {
      padding: var(--space-sm) !important;
    }

    .p-md {
      padding: var(--space-md) !important;
    }

    .p-lg {
      padding: var(--space-lg) !important;
    }

    .p-xl {
      padding: var(--space-xl) !important;
    }

    .m-xs {
      margin: var(--space-xs) !important;
    }

    .m-sm {
      margin: var(--space-sm) !important;
    }

    .m-md {
      margin: var(--space-md) !important;
    }

    .m-lg {
      margin: var(--space-lg) !important;
    }

    .m-xl {
      margin: var(--space-xl) !important;
    }

    /* åœ“è§’ */
    .rounded-xs {
      border-radius: var(--radius-xs) !important;
    }

    .rounded-sm {
      border-radius: var(--radius-sm) !important;
    }

    .rounded-md {
      border-radius: var(--radius-md) !important;
    }

    .rounded-lg {
      border-radius: var(--radius-lg) !important;
    }

    .rounded-xl {
      border-radius: var(--radius-xl) !important;
    }

    /* å­—é«” */
    .font-xs {
      font-size: var(--font-size-xs) !important;
    }

    .font-sm {
      font-size: var(--font-size-sm) !important;
    }

    .font-md {
      font-size: var(--font-size-md) !important;
    }

    .font-lg {
      font-size: var(--font-size-lg) !important;
    }

    .font-xl {
      font-size: var(--font-size-xl) !important;
    }

    .font-normal {
      font-weight: var(--font-weight-normal) !important;
    }

    .font-medium {
      font-weight: var(--font-weight-medium) !important;
    }

    .font-semibold {
      font-weight: var(--font-weight-semibold) !important;
    }

    .font-bold {
      font-weight: var(--font-weight-bold) !important;
    }

    /* è™•ç†æ­·å²æ™‚é–“ç·šæ¨£å¼ */
    .incident-timeline {
      padding: 8px 0;
      margin: 0;
      list-style: none;
      position: relative;
    }

    /* æ™‚é–“è»¸é€£æ¥ç·š */
    .incident-timeline::before {
      content: '';
      position: absolute;
      left: 7px;
      top: 20px;
      bottom: 20px;
      width: 2px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
      border-radius: 1px;
    }

    .timeline-item {
      position: relative;
      padding: 8px 0 8px 24px;
      color: rgba(255, 255, 255, 0.85);
      font-size: 13px;
      line-height: 1.4;
    }

    .timeline-item:last-child {
      padding-bottom: 0;
    }

    .timeline-dot {
      position: absolute;
      left: 0;
      top: 12px;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #1890ff;
      border: 2px solid rgba(26, 29, 35, 1);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.2);
      z-index: 1;
    }

    .timeline-dot-completed {
      background: #52c41a;
      box-shadow: 0 0 0 1px rgba(82, 196, 26, 0.3), 0 0 8px rgba(82, 196, 26, 0.2);
    }

    .timeline-dot-current {
      background: #faad14;
      animation: timeline-pulse 2s infinite;
      box-shadow: 0 0 0 1px rgba(250, 173, 20, 0.4), 0 0 8px rgba(250, 173, 20, 0.3);
    }

    .timeline-dot-default {
      background: rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    .timeline-content {
      margin-left: 4px;
    }

    .timeline-title {
      font-weight: 500;
      margin-bottom: 2px;
      color: rgba(255, 255, 255, 0.9);
    }

    .timeline-description {
      color: rgba(255, 255, 255, 0.6);
      font-size: 12px;
    }

    @keyframes timeline-pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(250, 173, 20, 0.4);
      }

      70% {
        box-shadow: 0 0 0 4px rgba(250, 173, 20, 0);
      }

      100% {
        box-shadow: 0 0 0 0 rgba(250, 173, 20, 0);
      }
    }

    .timeline-time {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 4px;
    }

    /* ğŸš€ æ”¹é€²ç‰ˆè¡Œå…§é€²åº¦æ¢è¨­è¨ˆ - æ•¸å€¼èˆ‡é€²åº¦æ¢æ•´åˆé¡¯ç¤º */
    .inline-progress-cell {
      position: relative;
      height: 32px;
      padding: 0 !important;
      overflow: hidden;
      border-radius: var(--radius-md);
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      transition: all 0.3s ease;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .inline-progress-cell:hover {
      border-color: var(--brand-primary);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transform: translateY(-1px);
    }

    /* å°ºå¯¸è®Šé«” */
    .inline-progress-small {
      height: 24px;
      border-radius: var(--radius-sm);
    }

    .inline-progress-medium {
      height: 32px;
    }

    .inline-progress-large {
      height: 40px;
      border-radius: var(--radius-lg);
    }

    .inline-progress-background {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: inherit;
      opacity: 1;
    }

    .inline-progress-background.animated {
      animation: progressFill 1.2s ease-out;
    }

    @keyframes progressFill {
      from {
        width: 0%;
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* å…§å®¹å±¤ */
    .inline-progress-content {
      position: relative;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
      width: 100%;
      height: 100%;
      padding: 0 var(--spacing-sm);
    }

    .inline-progress-label {
      font-size: 10px;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-right: var(--spacing-xs);
    }

    .inline-progress-text {
      font-size: 13px;
      font-weight: 600;
      font-variant-numeric: tabular-nums;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      white-space: nowrap;
    }

    .inline-progress-small .inline-progress-text {
      font-size: 11px;
    }

    .inline-progress-large .inline-progress-text {
      font-size: 15px;
    }

    /* ç‹€æ…‹æŒ‡ç¤ºå™¨ */
    .inline-progress-indicator {
      position: absolute;
      top: 3px;
      right: 3px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      opacity: 0.8;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .inline-progress-small .inline-progress-indicator {
      width: 4px;
      height: 4px;
      top: 2px;
      right: 2px;
    }

    .inline-progress-large .inline-progress-indicator {
      width: 8px;
      height: 8px;
      top: 4px;
      right: 4px;
    }

    /* ç‹€æ…‹æ¨£å¼ */
    .inline-progress-cell.healthy {
      border-color: rgba(82, 196, 26, 0.2);
    }

    .inline-progress-cell.healthy:hover {
      border-color: #52c41a;
    }

    .inline-progress-cell.warning {
      border-color: rgba(250, 173, 20, 0.2);
    }

    .inline-progress-cell.warning:hover {
      border-color: #faad14;
    }

    .inline-progress-cell.critical {
      border-color: rgba(255, 77, 79, 0.2);
    }

    .inline-progress-cell.critical:hover {
      border-color: #ff4d4f;
    }

    .inline-progress-cell.success {
      border-color: rgba(82, 196, 26, 0.2);
    }

    .inline-progress-cell.success:hover {
      border-color: #52c41a;
    }

    .inline-progress-cell.normal {
      border-color: rgba(24, 144, 255, 0.2);
    }

    .inline-progress-cell.normal:hover {
      border-color: #1890ff;
    }

    /* éŸ¿æ‡‰å¼èª¿æ•´ */
    @media (max-width: 768px) {
      .inline-progress-cell {
        height: 28px;
      }

      .inline-progress-text {
        font-size: 12px;
      }

      .inline-progress-label {
        display: none;
      }

      .inline-progress-indicator {
        display: none;
      }
    }

    /* ğŸ¯ æ‰¹æ¬¡æ“ä½œæµ®å‹•å·¥å…·åˆ— */
    .batch-actions-floating {
      position: fixed;
      bottom: 32px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-elevated, rgba(26, 29, 35, 0.95));
      border: 1px solid var(--border-base, rgba(255, 255, 255, 0.12));
      border-radius: 12px;
      padding: 12px 24px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.48);
      display: flex;
      align-items: center;
      gap: 16px;
      z-index: 1000;
      animation: slideUp 0.3s ease;
      backdrop-filter: blur(20px);
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    .batch-info {
      display: flex;
      align-items: center;
      gap: 8px;
      padding-right: 16px;
      border-right: 1px solid var(--border-light, rgba(255, 255, 255, 0.08));
    }

    .batch-count {
      color: var(--brand-primary, #4A90FF);
      font-weight: 600;
    }

    /* Multi-step Modal Styles */
    .multi-step-modal .ant-modal-content {
      background: linear-gradient(135deg, rgba(32, 34, 38, 0.98) 0%, rgba(24, 26, 29, 0.98) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      overflow: hidden;
    }

    .multi-step-modal .ant-modal-header {
      display: none;
    }

    .multi-step-modal .ant-modal-body {
      padding: 32px;
    }

    .multi-step-modal .ant-modal-footer {
      display: none;
    }

    .multi-step-modal .step-content {
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .multi-step-modal .step-indicator:hover {
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(24, 144, 255, 0.6);
    }

    /* Silence Modal Styles */
    .silence-modal .ant-modal-content {
      background: linear-gradient(135deg, rgba(32, 34, 38, 0.98) 0%, rgba(24, 26, 29, 0.98) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      overflow: hidden;
    }

    .silence-modal .ant-modal-header {
      display: none;
    }

    .silence-modal .ant-modal-body {
      padding: 32px;
    }

    .silence-modal .ant-modal-footer {
      display: none;
    }

    .silence-modal .step-content {
      animation: fadeIn 0.3s ease-in;
    }

    .silence-modal .step-indicator:hover {
      transform: scale(1.05);
      box-shadow: 0 0 25px rgba(24, 144, 255, 0.5);
    }

    /* ğŸ¯ çµ±ä¸€æ­¥é©Ÿå¼å°å¼•æ¨£å¼ */
    .steps-container {
      margin-bottom: 32px;
      padding: 24px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .steps-container .steps {
      display: flex;
      gap: 16px;
      position: relative;
      justify-content: space-between;
    }

    .step-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      position: relative;
      z-index: 1;
      transition: all 0.2s ease;
    }

    .step-indicator {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid rgba(255, 255, 255, 0.4);
      background: rgba(32, 34, 38, 0.8);
      backdrop-filter: blur(20px);
      position: relative;
      z-index: 2;
    }

    .step-indicator.active {
      background: linear-gradient(135deg, #1890ff 0%, #40a9ff 100%);
      border: 3px solid #1890ff;
      box-shadow: 0 0 25px rgba(24, 144, 255, 0.6), 0 0 50px rgba(24, 144, 255, 0.3);
      transform: scale(1.15);
      color: #ffffff;
    }

    .step-indicator.completed {
      background: linear-gradient(135deg, #52c41a 0%, #95de64 100%);
      border: 3px solid #52c41a;
      box-shadow: 0 0 20px rgba(82, 196, 26, 0.5);
      color: #ffffff;
    }

    .step-indicator.completed::after {
      content: 'âœ“';
      position: absolute;
      font-size: 14px;
      font-weight: bold;
    }

    .step-label {
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      color: rgba(255, 255, 255, 0.8);
      transition: all 0.2s ease;
      line-height: 1.2;
      margin-top: 4px;
    }

    .step-item:hover .step-label,
    .step-item.active .step-label {
      color: #ffffff;
      transform: translateY(-2px);
    }

    .step-item:hover .step-indicator {
      transform: scale(1.05);
      border-color: rgba(255, 255, 255, 0.6);
    }

    .step-connector {
      position: absolute;
      top: 24px;
      left: 60px;
      right: calc(-100% + 60px);
      height: 3px;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
      z-index: 1;
      border-radius: 2px;
    }

    .step-connector.completed {
      background: linear-gradient(90deg, #52c41a, #1890ff);
    }

    .step-progress {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: linear-gradient(90deg, #52c41a 0%, #1890ff 100%);
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 2px;
    }

    .modal-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      padding-bottom: 20px;
      margin-bottom: 20px;
    }

    .step-content {
      animation: fadeInUp 0.3s ease-in;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ğŸ¯ çµ±ä¸€å½ˆçª—åº•éƒ¨æŒ‰éˆ•æ¨£å¼ - 8é»ç¶²æ ¼ç³»çµ± */
    .modal-footer,
    .modal-footer-unified {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      padding: 24px 0 0 0;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      margin-top: 24px;
    }

    .modal-footer>div {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .modal-footer .ant-btn,
    .modal-footer-unified .ant-btn,
    .modal-footer-btn {
      height: 36px;
      padding: 0 20px;
      border-radius: 6px;
      font-weight: 500;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .modal-footer .ant-btn-default,
    .modal-footer-unified .ant-btn-default {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.85);
    }

    .modal-footer .ant-btn-default:hover,
    .modal-footer-unified .ant-btn-default:hover {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(255, 255, 255, 0.3);
      color: #fff;
    }

    .modal-footer .ant-btn-primary,
    .modal-footer-unified .ant-btn-primary {
      background: linear-gradient(135deg, #1890ff 0%, #40a9ff 100%);
      border: none;
      box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3);
    }

    .modal-footer .ant-btn-primary:hover,
    .modal-footer-unified .ant-btn-primary:hover {
      background: linear-gradient(135deg, #40a9ff 0%, #1890ff 100%);
      box-shadow: 0 4px 12px rgba(24, 144, 255, 0.4);
      transform: translateY(-1px);
    }

    /* ğŸ¯ Compact Modal Styles - 8é»ç¶²æ ¼ç³»çµ±å„ªåŒ– */
    .ant-modal .ant-modal-body {
      padding: 24px;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .ant-modal .ant-modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-light);
    }

    /* 8é»ç¶²æ ¼ç³»çµ±è¡¨å–®é–“è· */
    .ant-modal .ant-form-item {
      margin-bottom: 16px;
      padding: 8px 0;
      /* èª¿æ•´è¡¨å–®é …ç›®ä¸Šä¸‹ padding å¾ 12px æ”¹ç‚º 8px */
    }

    .ant-modal .ant-form-item:last-child {
      margin-bottom: 0;
    }

    /* 8é»ç¶²æ ¼ç³»çµ±æè¿°åˆ—è¡¨ */
    .ant-modal .ant-descriptions-item {
      padding: 8px 16px;
    }

    /* 8é»ç¶²æ ¼ç³»çµ±å¡ç‰‡å…§å®¹ */
    .ant-modal .ant-card {
      margin-bottom: 16px;
    }

    .ant-modal .ant-card-body {
      padding: 16px;
    }

    /* 8é»ç¶²æ ¼ç³»çµ±åˆ—è¡¨é …ç›® */
    .ant-modal .ant-list-item {
      padding: 8px 16px;
    }

    /* ç·Šæ¹Šçš„æ­¥é©ŸæŒ‡ç¤ºå™¨ */
    .ant-modal .ant-steps {
      margin-bottom: 16px;
    }

    /* 8é»ç¶²æ ¼ç³»çµ±å€å¡Šé–“è· */
    .ant-modal .section-block {
      margin-bottom: 16px;
      padding: 16px;
    }

    /* æ»¾å‹•æ¢ç¾åŒ– */
    .ant-modal .ant-modal-body::-webkit-scrollbar {
      width: 6px;
    }

    .ant-modal .ant-modal-body::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }

    .ant-modal .ant-modal-body::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* ğŸ¨ çµ±ä¸€çš„çµ±è¨ˆå¡ç‰‡æ¨£å¼ - Unified Statistic Card Styles */
    .stat-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: var(--radius-lg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.16);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(74, 144, 255, 0.1) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-card .ant-card-body {
      padding: 20px 24px;
    }

    /* è‡ªå®šç¾©å¡ç‰‡æ¨™é¡Œé«˜åº¦ */
    .ant-card-head {
      height: 40px;
      min-height: 40px;
    }

    .ant-card-head .ant-card-head-wrapper {
      align-items: center;
    }

    .ant-card-head-title {
      font-size: 14px;
      font-weight: 500;
    }

    .stat-card .ant-statistic-title {
      color: var(--text-tertiary);
      font-size: 13px;
      font-weight: 500;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .stat-card .ant-statistic-content {
      color: var(--text-primary);
    }

    .stat-card .ant-statistic-content-value {
      font-size: 32px;
      font-weight: 600;
      line-height: 1.2;
    }

    .stat-card .ant-statistic-content-suffix {
      font-size: 16px;
      font-weight: 400;
      margin-left: 4px;
      opacity: 0.7;
    }

    /* ç‰¹æ®Šå¡ç‰‡æ¨£å¼ - åœ–è¡¨èƒŒæ™¯å¡ç‰‡ */
    .chart-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.03) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-lg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.08);
      transition: all 0.3s ease;
    }

    .chart-card:hover {
      border-color: rgba(255, 255, 255, 0.15);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.12);
    }

    /* ğŸ¯ Unified Button Styles */
    /* Primary Actions - ä¸»è¦æ“ä½œæŒ‰éˆ• */
    .btn-primary-action {
      height: 32px;
      padding: 0 16px;
      font-weight: 500;
      border-radius: var(--radius-base);
    }

    /* Toolbar Buttons - å·¥å…·åˆ—æŒ‰éˆ• */
    .ant-btn.toolbar-btn,
    button.ant-btn.toolbar-btn {
      height: 32px !important;
      border-radius: 6px !important;
      background: transparent !important;
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      color: rgba(255, 255, 255, 0.85) !important;
      padding: 0 12px !important;
    }

    .ant-btn.toolbar-btn:hover,
    button.ant-btn.toolbar-btn:hover,
    .ant-btn.toolbar-btn:focus,
    button.ant-btn.toolbar-btn:focus {
      background: rgba(255, 255, 255, 0.05) !important;
      border-color: rgba(255, 255, 255, 0.3) !important;
      color: rgba(255, 255, 255, 0.95) !important;
    }

    .ant-btn.toolbar-btn--icon-only,
    button.ant-btn.toolbar-btn--icon-only {
      width: 32px !important;
      padding: 0 !important;
      border-radius: 6px !important;
    }

    /* é€šçŸ¥éˆ´ Badge å°ºå¯¸ */
    .ant-badge .ant-badge-count {
      height: 18px !important;
      line-height: 18px !important;
      border-radius: 9px !important;
      font-size: 12px !important;
      font-weight: 500 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      padding: 0 4px !important;
      min-width: 18px !important;
    }

    /* å–®æ•¸å­— Badge - å®Œç¾åœ“å½¢ */
    .ant-badge .ant-badge-count:not(.ant-badge-multiple-words) {
      width: 18px !important;
      border-radius: 50% !important;
      padding: 0 !important;
    }

    .ant-badge .ant-badge-count-sm {
      height: 18px !important;
      line-height: 18px !important;
      padding: 0 4px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      min-width: 18px !important;
    }

    /* AI åˆ†ææŒ‰éˆ• - æ¼¸å±¤ç´«è‰² */
    .ant-btn.btn-ai-analysis,
    button.ant-btn.btn-ai-analysis {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      border: none !important;
      color: white !important;
      font-weight: 500 !important;
      border-radius: 6px !important;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3) !important;
      transition: all 0.3s ease !important;
      height: 32px !important;
      padding: 0 16px !important;
    }

    .ant-btn.btn-ai-analysis:hover,
    button.ant-btn.btn-ai-analysis:hover,
    .ant-btn.btn-ai-analysis:focus,
    button.ant-btn.btn-ai-analysis:focus {
      background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%) !important;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
      transform: translateY(-1px) !important;
      color: white !important;
      border: none !important;
    }

    .ant-btn.btn-ai-analysis:active,
    button.ant-btn.btn-ai-analysis:active {
      transform: translateY(0) !important;
      box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3) !important;
      background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%) !important;
      color: white !important;
      border: none !important;
    }

    /* Table Action Buttons - è¡¨æ ¼æ“ä½œæŒ‰éˆ• */
    .table-action-btn {
      height: 24px;
      padding: 0 8px;
      font-size: 13px;
    }

    .table-action-icon-btn {
      width: 28px;
      height: 28px;
      padding: 0;
      border-radius: var(--radius-sm);
    }

    /* Modal Footer Buttons - å½ˆçª—åº•éƒ¨æŒ‰éˆ• */
    .modal-footer-btn {
      height: 32px;
      min-width: 80px;
      font-weight: 500;
    }

    /* Batch Action Buttons - æ‰¹æ¬¡æ“ä½œæŒ‰éˆ• */
    .batch-action-button {
      height: 32px;
      padding: 0 16px;
      border-radius: 6px;
      font-weight: 500;
    }

    .batch-action-button.ant-btn-primary {
      background: #1890ff;
      border-color: #1890ff;
    }

    .batch-action-button--success {
      background: #52c41a !important;
      border-color: #52c41a !important;
      color: white !important;
    }

    .batch-action-button--success:hover,
    .batch-action-button--success:focus {
      background: #73d13d !important;
      border-color: #73d13d !important;
      color: white !important;
    }

    /* Danger Buttons - å±éšªæ“ä½œæŒ‰éˆ• */
    .danger-button {
      color: var(--brand-danger);
      border-color: var(--brand-danger);
    }

    .batch-action-button.ant-btn-dangerous,
    .batch-action-button.danger-button,
    .ant-btn.batch-action-button.danger-button {
      background: #ff4d4f !important;
      border-color: #ff4d4f !important;
      color: white !important;
    }

    .batch-action-button.ant-btn-dangerous:hover,
    .batch-action-button.danger-button:hover,
    .ant-btn.batch-action-button.danger-button:hover,
    .batch-action-button.ant-btn-dangerous:focus,
    .batch-action-button.danger-button:focus,
    .ant-btn.batch-action-button.danger-button:focus {
      background: #ff7875 !important;
      border-color: #ff7875 !important;
      color: white !important;
    }

    .danger-button:hover {
      background: rgba(255, 77, 79, 0.1);
      border-color: var(--brand-danger);
      color: var(--brand-danger);
    }

    /* Icon Button Tooltips - åœ–æ¨™æŒ‰éˆ•æç¤º */
    .icon-btn-wrapper {
      display: inline-block;
    }

    /* ğŸ¯ Compact Navigation Items - ç·Šæ¹Šå°èˆªé …ç›® */
    .compact-nav-item {
      padding: 12px !important;
      min-height: auto !important;
    }

    .compact-nav-item .nav-item-content {
      padding: 0 !important;
    }

    .compact-nav-item .nav-item-icon {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .compact-nav-item .nav-item-title {
      margin-bottom: 2px !important;
      font-size: 14px !important;
      line-height: 1.2 !important;
    }

    .compact-nav-item .nav-item-description {
      margin-bottom: 0 !important;
      font-size: 12px !important;
      line-height: 1.3 !important;
    }

    /* ğŸ¯ Admin Navigation Items - ç®¡ç†ä¸­å¿ƒå°èˆªé …ç›® */
    .admin-nav-item {
      min-height: 120px;
    }

    .admin-nav-item .nav-item-content {
      padding: 0 !important;
      height: 100%;
    }

    .admin-nav-item .nav-item-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .admin-nav-item:hover .nav-item-icon {
      background: rgba(24, 144, 255, 0.15) !important;
    }

    /* ğŸ¯ Notification Styles - é€šçŸ¥æ¨£å¼ */
    .notification-popover .ant-popover-inner {
      padding: 0;
      border-radius: var(--radius-lg);
      overflow: hidden;
      max-height: 600px;
    }

    .notification-popover .ant-popover-content {
      max-height: 600px;
    }

    .notification-dropdown .notification-item:hover {
      background: linear-gradient(135deg, rgba(24, 144, 255, 0.08) 0%, rgba(24, 144, 255, 0.04) 100%) !important;
    }

    .notification-dropdown ::-webkit-scrollbar {
      width: 6px;
    }

    .notification-dropdown ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 3px;
    }

    .notification-dropdown ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    /* ğŸ¯ Notification Badge Styles - é€šçŸ¥å¾½ç« æ¨£å¼ */
    .ant-badge-count,
    .ant-badge .ant-badge-count,
    .ant-badge-multiple-words {
      color: white !important;
      background: #ff4d4f !important;
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      font-weight: 600 !important;
      font-size: 12px !important;
    }

    /* å–®æ•¸å­— Badge - å®Œç¾åœ“å½¢ (å…¨åŸŸ) */
    .ant-badge-count:not(.ant-badge-multiple-words) {
      width: 18px !important;
      border-radius: 50% !important;
      padding: 0 !important;
    }

    /* ğŸ¯ Button Alignment Uniformity - æŒ‰éˆ•å°é½Šçµ±ä¸€ */

    /* å·¥å…·æ¬„å®¹å™¨å°é½Š */
    .toolbar,
    .page-toolbar,
    .ant-space {
      display: flex !important;
      align-items: center !important;
      gap: 8px !important;
    }

    /* æ‰€æœ‰æŒ‰éˆ•å‚ç›´å±…ä¸­å°é½Š */
    .ant-btn {
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      vertical-align: middle !important;
      margin: 0 !important;
    }

    /* æœç´¢æ¡†èˆ‡æŒ‰éˆ•å°é½Š */
    .ant-input,
    .ant-input-search,
    .search-input,
    .ant-input-search-button {
      vertical-align: middle !important;
      display: inline-flex !important;
      align-items: center !important;
    }

    /* Space çµ„ä»¶å…§çš„é …ç›®å°é½Š */
    .ant-space-item {
      display: flex !important;
      align-items: center !important;
    }

    /* è¡¨æ ¼æ“ä½œæŒ‰éˆ•å°é½Š */
    .ant-table-tbody .ant-btn {
      vertical-align: middle !important;
      margin: 2px 4px !important;
    }

    /* é é¢æ¨™é¡Œå€åŸŸå°é½Š */
    .page-header,
    .table-header {
      display: flex !important;
      align-items: center !important;
      justify-content: space-between !important;
      margin-bottom: 16px !important;
    }

    /* ğŸ¯ Unified Button Styles - çµ±ä¸€æŒ‰éˆ•æ¨£å¼ */

    /* çµ±ä¸€åˆªé™¤æŒ‰éˆ•æ¨£å¼ */
    .ant-btn[danger],
    .ant-btn.ant-btn-dangerous,
    .btn--danger {
      background: var(--brand-danger) !important;
      border-color: var(--brand-danger) !important;
      color: white !important;
    }

    .ant-btn[danger]:hover,
    .ant-btn.ant-btn-dangerous:hover,
    .btn--danger:hover {
      background: #ff4d4f !important;
      border-color: #ff4d4f !important;
      color: white !important;
    }

    /* æ‰¹æ¬¡åˆªé™¤æŒ‰éˆ• - outlined æ¨£å¼ */
    .danger-button {
      background: transparent !important;
      border: 1px solid var(--brand-danger) !important;
      color: var(--brand-danger) !important;
    }

    .danger-button:hover {
      background: rgba(255, 77, 79, 0.1) !important;
      border-color: var(--brand-danger) !important;
      color: var(--brand-danger) !important;
    }

    /* éˆæ¥æ¨£å¼çš„åˆªé™¤æŒ‰éˆ• */
    .ant-btn-link.ant-btn-dangerous,
    .ant-btn-link[danger],
    button.ant-btn.ant-btn-link.ant-btn-dangerous,
    .ant-btn.ant-btn-link.ant-btn-dangerous {
      color: var(--brand-danger) !important;
      background: transparent !important;
      border: none !important;
    }

    .ant-btn-link.ant-btn-dangerous:hover,
    .ant-btn-link[danger]:hover,
    button.ant-btn.ant-btn-link.ant-btn-dangerous:hover,
    .ant-btn.ant-btn-link.ant-btn-dangerous:hover {
      color: #ff4d4f !important;
      background: rgba(255, 107, 107, 0.1) !important;
    }

    /* æ›´å¼·çš„é¸æ“‡å™¨è¦†è“‹ Ant Design é»˜èªæ¨£å¼ */
    .ant-table-tbody .ant-btn.ant-btn-link.ant-btn-dangerous {
      color: var(--brand-danger) !important;
    }

    .ant-table-tbody .ant-btn.ant-btn-link.ant-btn-dangerous:hover {
      color: #ff4d4f !important;
      background: rgba(255, 107, 107, 0.1) !important;
    }

    /* å¼·åˆ¶è¦†è“‹æ‰€æœ‰å¯èƒ½çš„ danger æŒ‰éˆ•æ¨£å¼ */
    [data-testid] .ant-btn[danger],
    .ant-btn[danger],
    .ant-btn.ant-btn-dangerous,
    button[danger],
    button.ant-btn-dangerous {
      color: var(--brand-danger) !important;
      background: transparent !important;
      border: 1px solid transparent !important;
    }

    [data-testid] .ant-btn[danger]:hover,
    .ant-btn[danger]:hover,
    .ant-btn.ant-btn-dangerous:hover,
    button[danger]:hover,
    button.ant-btn-dangerous:hover {
      color: #ff4d4f !important;
      background: rgba(255, 107, 107, 0.1) !important;
      border: 1px solid transparent !important;
    }

    /* çµ±ä¸€ç·¨è¼¯æŒ‰éˆ•æ¨£å¼ */
    .ant-btn-primary,
    .btn--primary {
      background: var(--brand-primary) !important;
      border-color: var(--brand-primary) !important;
    }

    .ant-btn-primary:hover,
    .btn--primary:hover {
      background: #40a9ff !important;
      border-color: #40a9ff !important;
    }

    /* è¡¨æ ¼æ“ä½œæŒ‰éˆ•çµ±ä¸€é–“è·å’Œå°ºå¯¸ */
    .ant-table-tbody .ant-btn {
      margin: 2px !important;
      min-width: 60px !important;
      height: 30px !important;
      font-size: 12px !important;
    }

    /* åœ–æ¨™æŒ‰éˆ•çµ±ä¸€ */
    .table-action-icon-btn {
      width: 30px !important;
      height: 30px !important;
      padding: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
    }

    /* === ğŸ¯ è¡¨æ ¼æ“ä½œæŒ‰éˆ•çµ±ä¸€æ¨£å¼ === */

    /* è¡¨æ ¼æŒ‰éˆ•åŸºç¤æ¨£å¼ - ä½¿ç”¨æ–°çš„è¨­è¨ˆç³»çµ± */
    .ant-table-tbody .ant-btn:not(.ant-switch),
    .ant-table-tbody button:not(.ant-switch) {
      height: var(--btn-height-sm) !important;
      padding: var(--btn-padding-sm) !important;
      font-size: 12px !important;
      font-weight: 500 !important;
      border-radius: var(--radius-sm) !important;
      min-width: 60px !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      gap: 4px !important;
      transition: all 0.2s ease !important;
      box-shadow: none !important;
    }

    /* é è¨­æŒ‰éˆ• - æ¬¡è¦æ¨£å¼ */
    .ant-table-tbody .ant-btn:not(.ant-switch):not(.ant-btn-primary):not(.ant-btn-dangerous):not([danger]),
    .ant-table-tbody button:not(.ant-switch):not(.ant-btn-primary):not(.ant-btn-dangerous):not([danger]) {
      border: 1px solid var(--border-base) !important;
      background: transparent !important;
      color: var(--text-secondary) !important;
    }

    .ant-table-tbody .ant-btn:not(.ant-switch):not(.ant-btn-primary):not(.ant-btn-dangerous):not([danger]):hover,
    .ant-table-tbody button:not(.ant-switch):not(.ant-btn-primary):not(.ant-btn-dangerous):not([danger]):hover {
      border-color: var(--border-hover) !important;
      background: var(--bg-hover) !important;
      color: var(--text-primary) !important;
      transform: translateY(-1px) !important;
    }

    /* ä¸»è¦æ“ä½œæŒ‰éˆ• - ä½¿ç”¨å“ç‰Œè‰² */
    .ant-table-tbody .ant-btn-primary:not(.ant-switch),
    .ant-table-tbody button.ant-btn-primary:not(.ant-switch) {
      border: 1px solid var(--brand-primary) !important;
      background: var(--brand-primary-bg) !important;
      color: var(--brand-primary) !important;
    }

    .ant-table-tbody .ant-btn-primary:hover:not(.ant-switch),
    .ant-table-tbody button.ant-btn-primary:hover:not(.ant-switch) {
      border-color: var(--brand-primary-hover) !important;
      background: rgba(24, 144, 255, 0.2) !important;
      color: var(--brand-primary-hover) !important;
      transform: translateY(-1px) !important;
    }

    /* å±éšªæ“ä½œæŒ‰éˆ• - ä½¿ç”¨å±éšªè‰² */
    .ant-table-tbody .ant-btn-dangerous:not(.ant-switch),
    .ant-table-tbody .ant-btn[danger]:not(.ant-switch),
    .ant-table-tbody button[danger]:not(.ant-switch),
    .ant-table-tbody button.ant-btn-dangerous:not(.ant-switch) {
      border: 1px solid var(--brand-danger) !important;
      background: var(--brand-danger-bg) !important;
      color: var(--brand-danger) !important;
    }

    .ant-table-tbody .ant-btn-dangerous:hover:not(.ant-switch),
    .ant-table-tbody .ant-btn[danger]:hover:not(.ant-switch),
    .ant-table-tbody button[danger]:hover:not(.ant-switch),
    .ant-table-tbody button.ant-btn-dangerous:hover:not(.ant-switch) {
      border-color: var(--brand-danger-hover) !important;
      background: rgba(255, 77, 79, 0.2) !important;
      color: var(--brand-danger-hover) !important;
      transform: translateY(-1px) !important;
    }

    /* æ–‡å­—æŒ‰éˆ•æ¨£å¼ */
    .ant-table-tbody .ant-btn-link:not(.ant-switch) {
      background: transparent !important;
      border: none !important;
      color: var(--text-tertiary) !important;
      min-width: auto !important;
      padding: 4px 8px !important;
    }

    .ant-table-tbody .ant-btn-link:hover:not(.ant-switch) {
      color: var(--brand-primary) !important;
      background: var(--brand-primary-bg) !important;
    }

    .ant-table-tbody .ant-btn-link.ant-btn-dangerous:hover:not(.ant-switch) {
      color: var(--brand-danger) !important;
      background: var(--brand-danger-bg) !important;
    }

    /* é¡¯ç¤ºæ‰€æœ‰åœ–æ¨™ - æ¢å¾©æ­£å¸¸åœ–æ¨™é¡¯ç¤º */
    .ant-table-tbody .ant-btn .anticon,
    .ant-table-tbody button .anticon {
      display: inline-block !important;
      font-size: 14px !important;
    }

    /* ğŸ¯ Switch çµ„ä»¶ä¿®å¾© - é‡ç½®æ‰€æœ‰æ¨£å¼ */
    .ant-switch {
      position: relative !important;
      display: inline-block !important;
      box-sizing: border-box !important;
      width: 44px !important;
      height: 22px !important;
      line-height: 20px !important;
      background: rgba(255, 255, 255, 0.25) !important;
      border: 1px solid transparent !important;
      border-radius: 100px !important;
      cursor: pointer !important;
      transition: all 0.3s ease !important;
      user-select: none !important;
    }

    .ant-switch-checked {
      background: #1890ff !important;
    }

    .ant-switch:focus,
    .ant-switch:hover {
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2) !important;
    }

    .ant-switch-checked:focus,
    .ant-switch-checked:hover {
      background: #40a9ff !important;
    }

    .ant-switch-disabled {
      background: rgba(255, 255, 255, 0.08) !important;
      cursor: not-allowed !important;
      opacity: 0.4 !important;
    }

    .ant-switch-disabled:hover {
      box-shadow: none !important;
    }

    /* Switch å…§éƒ¨æ»‘å¡Š */
    .ant-switch-handle {
      position: absolute !important;
      top: 1px !important;
      left: 1px !important;
      width: 18px !important;
      height: 18px !important;
      background: #fff !important;
      border-radius: 50% !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
      transition: all 0.3s ease !important;
      z-index: 1 !important;
    }

    .ant-switch-checked .ant-switch-handle {
      left: calc(100% - 19px) !important;
    }

    /* ç§»é™¤ä»»ä½•å¯èƒ½å¹²æ“¾çš„å…§éƒ¨å…ƒç´  */
    .ant-switch-inner {
      display: none !important;
    }

    .ant-switch::after {
      display: none !important;
    }

    /* ğŸ¯ å›ºå®šæ¬„ä½èƒŒæ™¯ä¿®å¾© - å¼·åˆ¶è¦†è“‹æ‰€æœ‰ç‹€æ…‹ */
    .table-wrapper .ant-table-cell-fix-right,
    .table-wrapper .ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-cell-fix-right-last {
      background: transparent !important;
      background-color: transparent !important;
      backdrop-filter: none !important;
      box-shadow: none !important;
    }

    .table-wrapper .ant-table-cell-fix-right-first::after,
    .table-wrapper .ant-table-cell-fix-right-last::after {
      background: none !important;
      box-shadow: none !important;
      border: none !important;
    }

    /* è¡¨é ­å›ºå®šæ¬„ä½ */
    .table-wrapper .ant-table-thead>tr>th.ant-table-cell-fix-right,
    .table-wrapper .ant-table-thead>tr>th.ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-thead>tr>th.ant-table-cell-fix-right-last {
      background: rgba(255, 255, 255, 0.05) !important;
      background-color: rgba(255, 255, 255, 0.05) !important;
    }

    /* è¡¨æ ¼å…§å®¹å›ºå®šæ¬„ä½ */
    .table-wrapper .ant-table-tbody>tr>td.ant-table-cell-fix-right,
    .table-wrapper .ant-table-tbody>tr>td.ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-tbody>tr>td.ant-table-cell-fix-right-last {
      background: transparent !important;
      background-color: transparent !important;
    }

    /* æ‡¸åœç‹€æ…‹å›ºå®šæ¬„ä½ - èˆ‡å…¶ä»–æ¬„ä½å®Œå…¨ä¸€è‡´ */
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right,
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right-last {
      background: var(--bg-hover) !important;
      background-color: var(--bg-hover) !important;
    }

    /* ç¢ºä¿æ•´è¡Œæ‡¸åœæ™‚æ‰€æœ‰æ¬„ä½èƒŒæ™¯ä¸€è‡´ */
    .table-wrapper .ant-table-tbody>tr:hover>td {
      background: var(--bg-hover) !important;
    }

    /* å›ºå®šæ¬„ä½åœ¨æ•´è¡Œæ‡¸åœæ™‚ä¿æŒå®Œå…¨ä¸€è‡´çš„æ•ˆæœ */
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right,
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-tbody>tr:hover>td.ant-table-cell-fix-right-last {
      background: var(--bg-hover) !important;
      background-color: var(--bg-hover) !important;
    }

    /* é¸ä¸­ç‹€æ…‹å›ºå®šæ¬„ä½ */
    .table-wrapper .ant-table-row-selected>td.ant-table-cell-fix-right,
    .table-wrapper .ant-table-row-selected>td.ant-table-cell-fix-right-first,
    .table-wrapper .ant-table-row-selected>td.ant-table-cell-fix-right-last {
      background: var(--bg-selected) !important;
      background-color: var(--bg-selected) !important;
    }

    /* å¼·åˆ¶ç§»é™¤æ‰€æœ‰å›ºå®šæ¬„ä½çš„é™°å½±å’Œé‚Šæ¡†æ•ˆæœ */
    .table-wrapper .ant-table-cell-fix-right::before,
    .table-wrapper .ant-table-cell-fix-right::after,
    .table-wrapper .ant-table-cell-fix-right-first::before,
    .table-wrapper .ant-table-cell-fix-right-first::after,
    .table-wrapper .ant-table-cell-fix-right-last::before,
    .table-wrapper .ant-table-cell-fix-right-last::after {
      display: none !important;
      content: none !important;
      background: none !important;
      box-shadow: none !important;
      border: none !important;
    }


    /* ğŸ¯ å°å°ºå¯¸æŒ‰éˆ• outlined æ¨£å¼ - çµ±ä¸€å°ºå¯¸ */
    .ant-table-tbody .ant-btn-sm,
    .ant-table-tbody .ant-btn.ant-btn-sm {
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      background: transparent !important;
      box-shadow: none !important;
      padding: 4px 12px !important;
      height: 32px !important;
      font-size: 13px !important;
      border-radius: 6px !important;
      min-width: 60px !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
    }

    .ant-table-tbody .ant-btn-primary.ant-btn-sm {
      color: var(--brand-primary) !important;
      border-color: var(--brand-primary) !important;
    }

    .ant-table-tbody .ant-btn-primary.ant-btn-sm:hover {
      color: #40a9ff !important;
      border-color: #40a9ff !important;
      background: rgba(24, 144, 255, 0.1) !important;
    }

    .ant-table-tbody .ant-btn-dangerous.ant-btn-sm,
    .ant-table-tbody .ant-btn-sm[danger] {
      color: var(--brand-danger) !important;
      border-color: var(--brand-danger) !important;
    }

    .ant-table-tbody .ant-btn-dangerous.ant-btn-sm:hover,
    .ant-table-tbody .ant-btn-sm[danger]:hover {
      color: #ff4d4f !important;
      border-color: #ff4d4f !important;
      background: rgba(255, 107, 107, 0.1) !important;
    }

    /* ğŸ¯ Personnel Menu Styles - äººå“¡é¸å–®æ¨£å¼ */
    .user-menu-trigger:hover {
      background: rgba(255, 255, 255, 0.08) !important;
    }

    .user-dropdown-menu .ant-dropdown-menu {
      background: var(--bg-elevated);
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-2xl);
    }

    .user-dropdown-menu .ant-dropdown-menu-item {
      border-radius: var(--radius-sm);
      margin: 2px 0;
      transition: all 0.2s ease;
    }

    .user-dropdown-menu .ant-dropdown-menu-item:hover {
      background: linear-gradient(135deg, rgba(24, 144, 255, 0.1) 0%, rgba(24, 144, 255, 0.05) 100%);
    }

    .user-dropdown-menu .ant-dropdown-menu-item-divider {
      background: var(--border-light);
      margin: 4px 0;
    }

    /* ğŸ¯ Login Page Styles - ç™»å…¥é é¢æ¨£å¼ */
    @keyframes float {

      0%,
      100% {
        transform: translate(0, 0) scale(1);
      }

      33% {
        transform: translate(-30px, -30px) scale(0.96);
      }

      66% {
        transform: translate(30px, -20px) scale(1.04);
      }
    }

    .login-card .ant-input-affix-wrapper {
      background: rgba(255, 255, 255, 0.05) !important;
      border: 1px solid rgba(255, 255, 255, 0.1) !important;
      border-radius: 8px !important;
      transition: all 0.3s ease;
    }

    .login-card .ant-input-affix-wrapper:hover {
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      background: rgba(255, 255, 255, 0.08) !important;
      border-radius: 8px !important;
    }

    .login-card .ant-input-affix-wrapper-focused,
    .login-card .ant-input-affix-wrapper:focus-within {
      border: 1px solid var(--brand-primary) !important;
      background: rgba(24, 144, 255, 0.05) !important;
      border-radius: 8px !important;
      box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2) !important;
    }

    .login-card .ant-input {
      background: transparent !important;
      border: none !important;
      color: var(--text-primary) !important;
    }

    .login-card .ant-input::placeholder {
      color: var(--text-tertiary) !important;
    }

    /* é¡å¤–ç¢ºä¿æ²’æœ‰é›™æ¡†ç·š */
    .login-card .ant-input-affix-wrapper,
    .login-card .ant-input-affix-wrapper:hover,
    .login-card .ant-input-affix-wrapper:focus,
    .login-card .ant-input-affix-wrapper-focused {
      outline: none !important;
      box-sizing: border-box !important;
    }

    .login-submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(22, 104, 220, 0.4) !important;
    }

    .login-submit-btn:active {
      transform: translateY(0);
    }

    .centered-statistic .ant-statistic-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo, useCallback } = React;
    const { Layout, Menu, ConfigProvider, theme, Typography, Input, Avatar, Button, Row, Col, Card, Statistic, Table, Tag, Modal, Form, Select, Breadcrumb, message, Tabs, DatePicker, List, Divider, Dropdown, Badge, Drawer, Tree, Collapse, InputNumber, Transfer, Spin, Empty, Switch, Space, Radio, Progress, Popover, Tooltip, Descriptions, Timeline, Checkbox, Steps, TimePicker, Alert, AutoComplete } = antd;
    const { UserOutlined, SearchOutlined, LogoutOutlined, DashboardOutlined, HddOutlined, TeamOutlined, ProfileOutlined, CodeOutlined, BarChartOutlined, HistoryOutlined, HomeOutlined, PlusOutlined, SettingOutlined, SafetyCertificateOutlined, BellOutlined, DownOutlined, ExclamationCircleOutlined, InfoCircleOutlined, EditOutlined, DeleteOutlined, ApartmentOutlined, BuildOutlined, ControlOutlined, AuditOutlined, MenuUnfoldOutlined, MenuFoldOutlined, PauseCircleOutlined, ScheduleOutlined, CarryOutOutlined, ThunderboltOutlined, MinusCircleOutlined, FireOutlined, ClockCircleOutlined, CheckCircleOutlined, CopyOutlined, PlayCircleOutlined, RobotOutlined, DeploymentUnitOutlined, EyeOutlined, FilterOutlined, ReloadOutlined, DownloadOutlined, DollarOutlined, LineChartOutlined, AlertOutlined, PieChartOutlined, FileDoneOutlined, FileTextOutlined, DatabaseOutlined, FieldTimeOutlined, RiseOutlined, FileProtectOutlined, BranchesOutlined, BookOutlined, AppstoreOutlined, ArrowUpOutlined, ArrowDownOutlined, AlignCenterOutlined, CompressOutlined, ExpandOutlined, MinusOutlined, UnorderedListOutlined, WarningOutlined, GlobalOutlined, SaveOutlined, QuestionCircleOutlined, BulbOutlined, LockOutlined, TagsOutlined, TagOutlined, LinkOutlined, MailOutlined, BarsOutlined, CloseOutlined, CheckOutlined, SafetyOutlined, MonitorOutlined } = icons;
    const { Title, Text, Paragraph } = Typography;
    const { TextArea } = Input;
    const { RangePicker } = DatePicker;
    dayjs.extend(dayjs_plugin_relativeTime);
    dayjs.extend(dayjs_plugin_isBetween);

    // === ğŸš€ æ€§èƒ½å„ªåŒ–å’Œé€šç”¨çµ„ä»¶ ===

    // éŒ¯èª¤é‚Šç•Œçµ„ä»¶
    class ErrorBoundary extends React.Component {
      constructor(props) {
        super(props);
        this.state = { hasError: false, error: null };
      }

      static getDerivedStateFromError(error) {
        return { hasError: true, error };
      }

      componentDidCatch(error, errorInfo) {
        console.error('Error caught by boundary:', error, errorInfo);
      }

      render() {
        if (this.state.hasError) {
          return (
            <div style={{
              padding: '20px',
              textAlign: 'center',
              background: 'rgba(255, 77, 79, 0.1)',
              border: '1px solid rgba(255, 77, 79, 0.3)',
              borderRadius: '8px',
              margin: '20px'
            }}>
              <Title level={4} style={{ color: '#ff4d4f', marginBottom: '16px' }}>
                ğŸš¨ ç™¼ç”ŸéŒ¯èª¤
              </Title>
              <Text type="secondary" style={{ display: 'block', marginBottom: '16px' }}>
                æ‡‰ç”¨ç¨‹å¼é‡åˆ°äº†ä¸€äº›å•é¡Œï¼Œè«‹åˆ·æ–°é é¢é‡è©¦ã€‚
              </Text>
              <Button onClick={() => window.location.reload()}>
                åˆ·æ–°é é¢
              </Button>
            </div>
          );
        }

        return this.props.children;
      }
    }

    // è‡ªå®šç¾© Hook: è¡¨æ ¼æ•¸æ“šç®¡ç†
    const useTableData = (initialData = [], options = {}) => {
      const [data, setData] = useState(initialData);
      const [loading, setLoading] = useState(false);
      const [selectedKeys, setSelectedKeys] = useState([]);

      const updateData = useCallback((newData) => {
        setData(newData);
      }, []);

      const addItem = useCallback((item) => {
        setData(prev => [...prev, { ...item, key: item.key || `key_${Date.now()}` }]);
      }, []);

      const removeItems = useCallback((keys) => {
        setData(prev => prev.filter(item => !keys.includes(item.key)));
      }, []);

      const clearSelection = useCallback(() => {
        setSelectedKeys([]);
      }, []);

      return {
        data,
        loading,
        selectedKeys,
        setLoading,
        updateData,
        addItem,
        removeItems,
        setSelectedKeys,
        clearSelection
      };
    };

    // è‡ªå®šç¾© Hook: æœå°‹å’Œç¯©é¸
    const useSearchFilter = (data, searchFields = []) => {
      const [searchText, setSearchText] = useState('');
      const [filters, setFilters] = useState({});
      const [isFilterOpen, setIsFilterOpen] = useState(false);

      const filteredData = useMemo(() => {
        let result = data;

        // æ–‡å­—æœå°‹
        if (searchText && searchFields.length > 0) {
          result = result.filter(item =>
            searchFields.some(field => {
              const value = item[field];
              return value && value.toString().toLowerCase().includes(searchText.toLowerCase());
            })
          );
        }

        // æ¢ä»¶ç¯©é¸
        Object.entries(filters).forEach(([key, value]) => {
          if (value && value.length > 0) {
            result = result.filter(item => {
              const itemValue = item[key];
              return Array.isArray(value) ? value.includes(itemValue) : itemValue === value;
            });
          }
        });

        return result;
      }, [data, searchText, filters, searchFields]);

      const applyFilter = useCallback((newFilters) => {
        setFilters(newFilters);
        setIsFilterOpen(false);
      }, []);

      const clearFilters = useCallback(() => {
        setFilters({});
        setSearchText('');
      }, []);

      return {
        searchText,
        setSearchText,
        filters,
        isFilterOpen,
        setIsFilterOpen,
        filteredData,
        applyFilter,
        clearFilters
      };
    };

    // ğŸ¯ å¹³å°ç´šæ¨™æº–åŒ–çµ„ä»¶ç³»çµ± - çµ±ä¸€ UI/UX é«”é©—

    // === æ¨™æº–åŒ– Modal çµ„ä»¶ ===
    const PlatformModal = React.memo(({
      title,
      visible,
      onClose,
      children,
      footer,
      width = 600,
      ...props
    }) => (
      <Modal
        title={title}
        open={visible}
        onCancel={onClose}
        footer={footer}
        width={width}
        className="platform-modal"
        maskClosable={false}
        destroyOnClose
        {...props}
      >
        {children}
      </Modal>
    ));

    // === æ¨™æº–åŒ–è¨­å®šé é¢å¸ƒå±€çµ„ä»¶ ===
    const SettingsLayout = React.memo(({ children }) => (
      <div className="settings-layout">
        {children}
      </div>
    ));

    const SettingsSection = React.memo(({
      title,
      description,
      actions,
      children,
      ...props
    }) => (
      <div className="settings-section" {...props}>
        <div className="settings-section-header">
          <div>
            <h3 className="settings-section-title">{title}</h3>
            {description && (
              <p className="settings-section-description">{description}</p>
            )}
          </div>
          {actions && (
            <div className="settings-section-actions">
              {actions}
            </div>
          )}
        </div>
        {children}
      </div>
    ));

    const SettingsFormRow = React.memo(({
      label,
      description,
      children,
      required = false
    }) => (
      <div className="settings-form-row">
        <div>
          <div className="settings-form-label">
            {label}
            {required && <span style={{ color: 'var(--brand-danger)' }}> *</span>}
          </div>
          {description && (
            <div className="settings-form-description">{description}</div>
          )}
        </div>
        <div className="settings-form-control">
          {children}
        </div>
      </div>
    ));

    // === æ¨™æº–åŒ–æŒ‰éˆ•çµ„ä»¶ ===
    const PlatformButton = React.memo(({
      variant = 'secondary', // primary, secondary, text, danger, ghost
      size = 'medium', // small, medium, large
      icon,
      loading = false,
      disabled = false,
      children,
      className = '',
      htmlType = 'button',
      tooltip,
      ...props
    }) => {
      const classNames = [
        'platform-btn',
        `platform-btn--${variant}`,
        size !== 'medium' ? `platform-btn--${size}` : '',
        icon && !children ? 'platform-btn--icon-only' : '',
        loading ? 'platform-btn--loading' : '',
        disabled ? 'platform-btn--disabled' : '',
        className
      ].filter(Boolean).join(' ');

      const ButtonContent = (
        <button
          className={classNames}
          disabled={disabled || loading}
          type={htmlType}
          {...props}
        >
          {loading ? <Spin size="small" /> : icon}
          {children}
        </button>
      );

      return tooltip ? (
        <Tooltip title={tooltip}>
          {ButtonContent}
        </Tooltip>
      ) : ButtonContent;
    });

    // === æ“ä½œæŒ‰éˆ•çµ„ - è¡¨æ ¼è¡Œå‹•ä½œ ===
    const TableRowActions = React.memo(({ record, onEdit, onDelete, onView, customActions = [] }) => (
      <Space size="small" className="table-row-actions">
        {onView && (
          <PlatformButton
            variant="text"
            size="small"
            icon={<EyeOutlined />}
            tooltip="æŸ¥çœ‹è©³æƒ…"
            onClick={() => onView(record)}
          />
        )}
        {onEdit && (
          <PlatformButton
            variant="text"
            size="small"
            icon={<EditOutlined />}
            tooltip="ç·¨è¼¯"
            onClick={() => onEdit(record)}
          />
        )}
        {onDelete && (
          <PlatformButton
            variant="text"
            size="small"
            icon={<DeleteOutlined />}
            tooltip="åˆªé™¤"
            className="table-action-delete"
            onClick={() => onDelete(record)}
          />
        )}
        {customActions.map((action, index) => (
          <PlatformButton
            key={index}
            variant="text"
            size="small"
            icon={action.icon}
            tooltip={action.tooltip}
            onClick={() => action.onClick(record)}
            {...action.props}
          />
        ))}
      </Space>
    ));

    // === å·¥å…·åˆ—æŒ‰éˆ•çµ„ ===
    const ToolbarActions = React.memo(({
      onRefresh,
      onExport,
      onAdd,
      onFilter,
      filterActive = false,
      showBatchActions = false,
      customActions = []
    }) => (
      <Space size="middle" className="toolbar-actions">
        <Space size="small" className="toolbar-group toolbar-group--secondary">
          {onRefresh && (
            <PlatformButton
              variant="ghost"
              size="small"
              icon={<ReloadOutlined />}
              tooltip="é‡æ–°è¼‰å…¥"
              onClick={onRefresh}
            />
          )}
          {onFilter && (
            <PlatformButton
              variant="ghost"
              size="small"
              icon={<FilterOutlined />}
              tooltip="ç¯©é¸æ¢ä»¶"
              className={filterActive ? 'filter-active' : ''}
              onClick={onFilter}
            />
          )}
          {onExport && (
            <PlatformButton
              variant="ghost"
              size="small"
              icon={<DownloadOutlined />}
              tooltip="åŒ¯å‡ºè³‡æ–™"
              onClick={onExport}
            />
          )}
        </Space>

        {customActions.length > 0 && (
          <Space size="small" className="toolbar-group toolbar-group--custom">
            {customActions.map((action, index) => (
              <PlatformButton
                key={index}
                variant={action.variant || 'ghost'}
                size="small"
                icon={action.icon}
                tooltip={action.tooltip}
                onClick={action.onClick}
                {...action.props}
              >
                {action.text}
              </PlatformButton>
            ))}
          </Space>
        )}

        {onAdd && (
          <Space size="small" className="toolbar-group toolbar-group--primary">
            <PlatformButton
              variant="primary"
              size="medium"
              icon={<PlusOutlined />}
              onClick={onAdd}
            >
              æ–°å¢
            </PlatformButton>
          </Space>
        )}
      </Space>
    ));

    // === æ‰¹æ¬¡æ“ä½œå·¥å…·åˆ— ===
    const BatchActionToolbar = React.memo(({
      selectedCount,
      onClear,
      actions = [],
      className = ''
    }) => {
      if (selectedCount === 0) return null;

      return (
        <div className={`batch-action-toolbar ${className}`}>
          <div className="batch-selection-info">
            <PlatformButton
              variant="text"
              size="small"
              icon={<CloseOutlined />}
              tooltip="æ¸…é™¤é¸æ“‡"
              onClick={onClear}
            />
            <span className="batch-count">å·²é¸æ“‡ {selectedCount} é …</span>
          </div>
          <Space size="small" className="batch-actions">
            {actions.map((action, index) => (
              <PlatformButton
                key={index}
                variant={action.variant || 'secondary'}
                size="small"
                icon={action.icon}
                tooltip={action.tooltip}
                loading={action.loading}
                disabled={action.disabled}
                onClick={() => action.onClick(selectedCount)}
                {...action.props}
              >
                {action.text}
              </PlatformButton>
            ))}
          </Space>
        </div>
      );
    });

    // === Modal åº•éƒ¨æ“ä½œæŒ‰éˆ•çµ„ ===
    const ModalActions = React.memo(({
      onCancel,
      onConfirm,
      confirmText = "ç¢ºå®š",
      cancelText = "å–æ¶ˆ",
      confirmLoading = false,
      confirmDisabled = false,
      showCancel = true,
      customActions = []
    }) => (
      <Space size="middle" className="modal-actions">
        {customActions.map((action, index) => (
          <PlatformButton
            key={index}
            variant={action.variant || 'secondary'}
            size="medium"
            icon={action.icon}
            loading={action.loading}
            disabled={action.disabled}
            onClick={action.onClick}
            {...action.props}
          >
            {action.text}
          </PlatformButton>
        ))}
        {showCancel && (
          <PlatformButton
            variant="secondary"
            size="medium"
            onClick={onCancel}
          >
            {cancelText}
          </PlatformButton>
        )}
        <PlatformButton
          variant="primary"
          size="medium"
          loading={confirmLoading}
          disabled={confirmDisabled}
          onClick={onConfirm}
          htmlType="submit"
        >
          {confirmText}
        </PlatformButton>
      </Space>
    ));

    // === ğŸš€ å¢å¼·å‹è³‡æ–™è¡¨ - å®Œæ•´åŠŸèƒ½æ•´åˆ ===
    const EnhancedTable = React.memo(({
      title,
      columns,
      dataSource,
      loading = false,
      // æœå°‹åŠŸèƒ½
      searchable = true,
      searchPlaceholder = "æœå°‹...",
      searchValue = "",
      onSearchChange,
      // ç¯©é¸åŠŸèƒ½
      filterable = true,
      filters = [],
      onFilterChange,
      // æ’åºåŠŸèƒ½
      sortable = true,
      defaultSortField,
      defaultSortOrder = 'ascend',
      // åˆ†é åŠŸèƒ½
      paginated = true,
      pageSize = 20,
      total,
      currentPage = 1,
      onPageChange,
      showSizeChanger = true,
      pageSizeOptions = ['10', '20', '50', '100'],
      // æ‰¹æ¬¡æ“ä½œ
      batchActions = [],
      selectedRowKeys = [],
      onSelectionChange,
      // å·¥å…·åˆ—å‹•ä½œ
      toolbarActions = {},
      // æ¬„ä½é¡¯ç¤ºæ§åˆ¶
      columnSettings = false,
      visibleColumns,
      onColumnVisibilityChange,
      // åŒ¯å‡ºåŠŸèƒ½
      exportable = true,
      onExport,
      // æ¨£å¼é…ç½®
      size = 'small',
      bordered = false,
      showHeader = true,
      sticky = false,
      className = '',
      ...tableProps
    }) => {
      const [internalSortField, setInternalSortField] = useState(defaultSortField);
      const [internalSortOrder, setInternalSortOrder] = useState(defaultSortOrder);

      // æ’åºè™•ç†
      const handleTableChange = useCallback((pagination, filters, sorter) => {
        if (sortable && sorter) {
          setInternalSortField(sorter.field);
          setInternalSortOrder(sorter.order);
        }
        if (onPageChange && pagination) {
          onPageChange(pagination.current, pagination.pageSize);
        }
      }, [sortable, onPageChange]);

      // æ‰¹æ¬¡æ“ä½œ
      const hasSelectedRows = selectedRowKeys.length > 0;
      const rowSelection = onSelectionChange ? {
        selectedRowKeys,
        onChange: onSelectionChange,
        columnWidth: 48,
      } : undefined;

      // è™•ç†æ¬„ä½é¡¯ç¤º
      const finalColumns = useMemo(() => {
        let processedColumns = columns;

        // å¦‚æœæœ‰æ¬„ä½é¡¯ç¤ºæ§åˆ¶ï¼Œéæ¿¾ä¸å¯è¦‹æ¬„ä½
        if (columnSettings && visibleColumns) {
          processedColumns = columns.filter(col =>
            visibleColumns[col.key] !== false && visibleColumns[col.dataIndex] !== false
          );
        }

        // ç‚ºå¯æ’åºæ¬„ä½æ·»åŠ æ’åºåŠŸèƒ½
        if (sortable) {
          processedColumns = processedColumns.map(col => ({
            ...col,
            sorter: col.sorter || (col.sortable !== false ? true : undefined)
          }));
        }

        return processedColumns;
      }, [columns, columnSettings, visibleColumns, sortable]);

      // åˆ†é é…ç½®
      const paginationConfig = paginated ? {
        current: currentPage,
        pageSize: pageSize,
        total: total || dataSource.length,
        showSizeChanger,
        pageSizeOptions,
        showQuickJumper: true,
        showTotal: (total, range) => `é¡¯ç¤º ${range[0]}-${range[1]} å…± ${total} é …`,
        onChange: onPageChange,
        className: 'platform-pagination'
      } : false;

      return (
        <PlatformTableContainer
          title={title}
          actions={
            <ToolbarActions
              onRefresh={toolbarActions.onRefresh}
              onExport={exportable ? (onExport || toolbarActions.onExport) : undefined}
              onAdd={toolbarActions.onAdd}
              onFilter={toolbarActions.onFilter}
              filterActive={toolbarActions.filterActive}
              customActions={[
                ...(toolbarActions.customActions || []),
                ...(columnSettings ? [{
                  icon: <EyeOutlined />,
                  tooltip: 'æ¬„ä½è¨­å®š',
                  onClick: toolbarActions.onColumnSettings,
                  text: 'æ¬„ä½'
                }] : [])
              ]}
            />
          }
          className={className}
        >
          {/* æœå°‹å’Œç¯©é¸æ§åˆ¶åˆ— */}
          {(searchable || filterable) && (
            <EnhancedTableControls
              searchValue={searchValue}
              onSearchChange={onSearchChange}
              searchPlaceholder={searchPlaceholder}
              filters={filters}
              onFilterChange={onFilterChange}
              showRefresh={false}
              showExport={false}
            />
          )}

          {/* æ‰¹æ¬¡æ“ä½œå·¥å…·åˆ— */}
          <BatchActionToolbar
            selectedCount={selectedRowKeys.length}
            onClear={() => onSelectionChange && onSelectionChange([])}
            actions={batchActions}
          />

          {/* è³‡æ–™è¡¨ */}
          <Table
            {...tableProps}
            columns={finalColumns}
            dataSource={dataSource}
            loading={loading}
            rowSelection={rowSelection}
            pagination={paginationConfig}
            size={size}
            bordered={bordered}
            showHeader={showHeader}
            sticky={sticky}
            onChange={handleTableChange}
            className="platform-enhanced-table"
            scroll={{ x: 'max-content' }}
          />
        </PlatformTableContainer>
      );
    });

    // === ğŸ¯ åˆ—è¡¨é é¢æ ¸å¿ƒåŠŸèƒ½ Hook ===
    const useListPageFeatures = ({
      initialData = [],
      searchFields = ['name'],
      pageSize = 20,
      sortField = 'name',
      sortOrder = 'ascend'
    }) => {
      // åŸºç¤ç‹€æ…‹
      const [data, setData] = useState(initialData);
      const [loading, setLoading] = useState(false);
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);

      // æœå°‹ç‹€æ…‹
      const [searchValue, setSearchValue] = useState('');
      const [filters, setFilters] = useState({});

      // åˆ†é ç‹€æ…‹
      const [currentPage, setCurrentPage] = useState(1);
      const [currentPageSize, setCurrentPageSize] = useState(pageSize);

      // æ’åºç‹€æ…‹
      const [sortField_, setSortField] = useState(sortField);
      const [sortOrder_, setSortOrder] = useState(sortOrder);

      // æ¬„ä½é¡¯ç¤ºç‹€æ…‹
      const [visibleColumns, setVisibleColumns] = useState({});

      // æœå°‹åŠŸèƒ½
      const filteredData = useMemo(() => {
        let result = data;

        // æ–‡å­—æœå°‹
        if (searchValue) {
          result = result.filter(item =>
            searchFields.some(field => {
              const value = item[field];
              return value && value.toString().toLowerCase().includes(searchValue.toLowerCase());
            })
          );
        }

        // é€²éšç¯©é¸
        Object.entries(filters).forEach(([key, filterValue]) => {
          if (filterValue && filterValue.length > 0) {
            result = result.filter(item => {
              if (Array.isArray(filterValue)) {
                return filterValue.includes(item[key]);
              }
              return item[key] === filterValue;
            });
          }
        });

        return result;
      }, [data, searchValue, filters, searchFields]);

      // åˆ†é å’Œæ’åºå¾Œçš„è³‡æ–™
      const processedData = useMemo(() => {
        let result = [...filteredData];

        // æ’åº
        if (sortField_ && sortOrder_) {
          result.sort((a, b) => {
            const aVal = a[sortField_];
            const bVal = b[sortField_];

            if (typeof aVal === 'string') {
              return sortOrder_ === 'ascend'
                ? aVal.localeCompare(bVal)
                : bVal.localeCompare(aVal);
            }

            if (typeof aVal === 'number') {
              return sortOrder_ === 'ascend' ? aVal - bVal : bVal - aVal;
            }

            return 0;
          });
        }

        // åˆ†é 
        const startIndex = (currentPage - 1) * currentPageSize;
        return result.slice(startIndex, startIndex + currentPageSize);
      }, [filteredData, sortField_, sortOrder_, currentPage, currentPageSize]);

      // æ‰¹æ¬¡æ“ä½œ
      const batchDelete = useCallback((confirmCallback) => {
        if (selectedRowKeys.length === 0) return;

        Modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} é …è³‡æ–™å—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼Œè«‹è¬¹æ…æ“ä½œã€‚',
          okText: 'ç¢ºå®šåˆªé™¤',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk: () => {
            setData(prev => prev.filter(item => !selectedRowKeys.includes(item.key)));
            setSelectedRowKeys([]);
            confirmCallback && confirmCallback();
          }
        });
      }, [selectedRowKeys]);

      return {
        // è³‡æ–™ç‹€æ…‹
        data: processedData,
        allData: data,
        setData,
        loading,
        setLoading,
        total: filteredData.length,

        // æœå°‹å’Œç¯©é¸
        searchValue,
        setSearchValue,
        filters,
        setFilters,

        // åˆ†é 
        currentPage,
        setCurrentPage,
        currentPageSize,
        setCurrentPageSize,

        // æ’åº
        sortField: sortField_,
        setSortField,
        sortOrder: sortOrder_,
        setSortOrder,

        // é¸æ“‡
        selectedRowKeys,
        setSelectedRowKeys,

        // æ¬„ä½é¡¯ç¤º
        visibleColumns,
        setVisibleColumns,

        // æ‰¹æ¬¡æ“ä½œ
        batchDelete,

        // çµ±è¨ˆè³‡è¨Š
        stats: {
          total: data.length,
          filtered: filteredData.length,
          selected: selectedRowKeys.length,
          currentPageStart: (currentPage - 1) * currentPageSize + 1,
          currentPageEnd: Math.min(currentPage * currentPageSize, filteredData.length)
        }
      };
    };

    // === ğŸ“Š è¡¨æ ¼å¯†åº¦æ§åˆ¶çµ„ä»¶ ===
    const TableDensityControl = React.memo(({ density = 'standard', onChange }) => {
      const densityOptions = [
        { value: 'compact', label: 'ç·Šæ¹Š', icon: <CompressOutlined /> },
        { value: 'standard', label: 'æ¨™æº–', icon: <AlignCenterOutlined /> },
        { value: 'comfortable', label: 'èˆ’é©', icon: <ExpandOutlined /> }
      ];

      return (
        <div className="table-density-control">
          <Tooltip title="èª¿æ•´è¡¨æ ¼è¡Œé«˜å¯†åº¦">
            <Dropdown
              menu={{
                items: densityOptions.map(option => ({
                  key: option.value,
                  label: (
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      {option.icon}
                      <span>{option.label}</span>
                      {density === option.value && <CheckOutlined style={{ color: 'var(--brand-primary)' }} />}
                    </div>
                  ),
                  onClick: () => onChange(option.value)
                }))
              }}
              trigger={['click']}
            >
              <PlatformButton
                variant="ghost"
                size="small"
                icon={<SettingOutlined />}
                tooltip="å¯†åº¦è¨­å®š"
              >
                å¯†åº¦
              </PlatformButton>
            </Dropdown>
          </Tooltip>
        </div>
      );
    });

    // === ğŸ›ï¸ æ¬„ä½é¡¯ç¤ºæ§åˆ¶çµ„ä»¶ ===
    const ColumnVisibilityControl = React.memo(({
      columns,
      visibleColumns,
      onChange,
      title = "æ¬„ä½é¡¯ç¤ºè¨­å®š"
    }) => {
      const [open, setOpen] = useState(false);

      const handleVisibilityChange = (columnKey, visible) => {
        onChange({
          ...visibleColumns,
          [columnKey]: visible
        });
      };

      const resetToDefault = () => {
        const defaultVisible = {};
        columns.forEach(col => {
          defaultVisible[col.key || col.dataIndex] = col.defaultVisible !== false;
        });
        onChange(defaultVisible);
      };

      const hideAllOptional = () => {
        const newVisible = {};
        columns.forEach(col => {
          const key = col.key || col.dataIndex;
          newVisible[key] = col.required === true || col.priority === 'high';
        });
        onChange(newVisible);
      };

      const showAll = () => {
        const newVisible = {};
        columns.forEach(col => {
          newVisible[col.key || col.dataIndex] = true;
        });
        onChange(newVisible);
      };

      const visibleCount = Object.values(visibleColumns).filter(Boolean).length;

      return (
        <Popover
          title={
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <span>{title}</span>
              <Text type="secondary" style={{ fontSize: '12px' }}>
                {visibleCount} / {columns.length} é¡¯ç¤º
              </Text>
            </div>
          }
          content={
            <div style={{ width: 280, maxHeight: 400, overflowY: 'auto' }}>
              {/* å¿«é€Ÿæ“ä½œ */}
              <div style={{
                display: 'flex',
                gap: '8px',
                marginBottom: '12px',
                paddingBottom: '12px',
                borderBottom: '1px solid var(--border-light)'
              }}>
                <Button size="small" onClick={showAll}>å…¨éƒ¨é¡¯ç¤º</Button>
                <Button size="small" onClick={hideAllOptional}>åƒ…æ ¸å¿ƒæ¬„ä½</Button>
                <Button size="small" onClick={resetToDefault}>é‡è¨­</Button>
              </div>

              {/* æ¬„ä½æ¸…å–® */}
              <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                {columns.map(column => {
                  const key = column.key || column.dataIndex;
                  const isVisible = visibleColumns[key] !== false;
                  const isRequired = column.required === true;

                  return (
                    <div
                      key={key}
                      style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        padding: '4px 8px',
                        borderRadius: 'var(--radius-sm)',
                        background: isVisible ? 'rgba(24, 144, 255, 0.1)' : 'transparent'
                      }}
                    >
                      <Checkbox
                        checked={isVisible}
                        disabled={isRequired}
                        onChange={(e) => handleVisibilityChange(key, e.target.checked)}
                      />
                      <span style={{
                        flex: 1,
                        fontSize: '13px',
                        color: isVisible ? 'var(--text-primary)' : 'var(--text-tertiary)'
                      }}>
                        {column.title}
                      </span>
                      {isRequired && (
                        <Tag size="small" color="blue">å¿…éœ€</Tag>
                      )}
                      {column.priority === 'low' && (
                        <Tag size="small" color="orange">å¯é¸</Tag>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          }
          trigger="click"
          open={open}
          onOpenChange={setOpen}
          placement="bottomRight"
        >
          <PlatformButton
            variant="ghost"
            size="small"
            icon={<EyeOutlined />}
            tooltip="æ¬„ä½è¨­å®š"
          >
            æ¬„ä½ ({visibleCount})
          </PlatformButton>
        </Popover>
      );
    });

    // === ğŸ“± éŸ¿æ‡‰å¼æ¬„ä½ç®¡ç† Hook ===
    const useResponsiveColumns = (columns, breakpoints = {}) => {
      const [screenSize, setScreenSize] = useState('large');

      useEffect(() => {
        const updateScreenSize = () => {
          const width = window.innerWidth;
          if (width < 768) {
            setScreenSize('mobile');
          } else if (width < 1200) {
            setScreenSize('tablet');
          } else {
            setScreenSize('large');
          }
        };

        updateScreenSize();
        window.addEventListener('resize', updateScreenSize);
        return () => window.removeEventListener('resize', updateScreenSize);
      }, []);

      const responsiveColumns = useMemo(() => {
        return columns.map(column => {
          const responsiveProps = {};

          // æ ¹æ“šè¢å¹•å°ºå¯¸è¨­å®š className
          if (column.priority === 'low' && screenSize !== 'large') {
            responsiveProps.className = `${column.className || ''} table-column-optional`.trim();
          } else if (column.priority === 'medium' && screenSize === 'mobile') {
            responsiveProps.className = `${column.className || ''} table-column-secondary`.trim();
          }

          // èª¿æ•´æ¬„ä½å¯¬åº¦
          if (screenSize === 'mobile') {
            if (column.width && typeof column.width === 'string') {
              const numericWidth = parseInt(column.width);
              if (numericWidth > 20) {
                responsiveProps.width = Math.max(15, numericWidth - 5) + '%';
              }
            }
          }

          return {
            ...column,
            ...responsiveProps
          };
        });
      }, [columns, screenSize]);

      return {
        columns: responsiveColumns,
        screenSize,
        isMobile: screenSize === 'mobile',
        isTablet: screenSize === 'tablet',
        isLarge: screenSize === 'large'
      };
    };

    // === ğŸ·ï¸ æ¨™æº–åŒ–é é¢æ¨™é¡Œçµ„ä»¶ ===
    const PageHeader = React.memo(({
      title,
      subtitle,
      actions,
      breadcrumb,
      icon,
      className = '',
      level = 1
    }) => {
      const HeadingTag = `h${level}`;

      return (
        <div className={`page-header ${className}`}>
          {breadcrumb && (
            <div className="page-breadcrumb">
              {breadcrumb}
            </div>
          )}

          <div className="page-header-content">
            <div className="page-header-main">
              <div className="page-title-section">
                {icon && (
                  <div className="page-title-icon">
                    {icon}
                  </div>
                )}
                <div className="page-title-text">
                  <HeadingTag className="page-title">
                    {title}
                  </HeadingTag>
                  {subtitle && (
                    <p className="page-subtitle">
                      {subtitle}
                    </p>
                  )}
                </div>
              </div>
            </div>

            {actions && (
              <div className="page-header-actions">
                {actions}
              </div>
            )}
          </div>
        </div>
      );
    });

    // === ğŸ“Š æƒ…å¢ƒåŒ– KPI å¡ç‰‡çµ„ä»¶ ===
    const ContextualKPICard = React.memo(({
      title,
      value,
      unit = '',
      trend,
      trendDirection = 'up', // up, down, stable
      status = 'normal', // normal, warning, critical, success
      icon,
      onClick,
      className = '',
      description,
      loading = false
    }) => {
      const statusColors = {
        normal: 'var(--text-primary)',
        success: 'var(--success-color)',
        warning: 'var(--warning-color)',
        critical: 'var(--error-color)'
      };

      const trendIcons = {
        up: <ArrowUpOutlined />,
        down: <ArrowDownOutlined />,
        stable: <MinusOutlined />
      };

      const trendColors = {
        up: status === 'critical' ? 'var(--error-color)' : 'var(--success-color)',
        down: status === 'critical' ? 'var(--success-color)' : 'var(--error-color)',
        stable: 'var(--text-tertiary)'
      };

      return (
        <div
          className={`contextual-kpi-card ${status} ${onClick ? 'clickable' : ''} ${className}`}
          onClick={onClick}
        >
          <div className="kpi-header">
            <div className="kpi-title-section">
              {icon && (
                <div className="kpi-icon">
                  {icon}
                </div>
              )}
              <div className="kpi-title">
                {title}
              </div>
            </div>

            {trend && (
              <div className="kpi-trend" style={{ color: trendColors[trendDirection] }}>
                {trendIcons[trendDirection]}
                <span className="trend-value">{trend}</span>
              </div>
            )}
          </div>

          <div className="kpi-content">
            {loading ? (
              <Skeleton.Input active size="large" />
            ) : (
              <>
                <div className="kpi-value" style={{ color: statusColors[status] }}>
                  {typeof value === 'number' ? value.toLocaleString() : value}
                  {unit && <span className="kpi-unit">{unit}</span>}
                </div>

                {description && (
                  <div className="kpi-description">
                    {description}
                  </div>
                )}
              </>
            )}
          </div>
        </div>
      );
    });

    // === ğŸ›ï¸ å¿«é€Ÿç¯©é¸ KPI çµ„ä»¶ ===
    const FilterableKPICard = React.memo(({
      title,
      value,
      unit = '',
      filterKey,
      filterValue,
      isActive = false,
      onFilterClick,
      status = 'normal',
      icon,
      className = ''
    }) => {
      const handleClick = () => {
        if (onFilterClick) {
          onFilterClick(filterKey, filterValue, !isActive);
        }
      };

      return (
        <ContextualKPICard
          title={title}
          value={value}
          unit={unit}
          status={status}
          icon={icon}
          onClick={handleClick}
          className={`filterable-kpi ${isActive ? 'active' : ''} ${className}`}
        />
      );
    });

    // === æ¨™æº–åŒ–è¡¨æ ¼å®¹å™¨çµ„ä»¶ ===
    const PlatformTableContainer = React.memo(({
      title,
      actions,
      children,
      className = ''
    }) => (
      <div className={`platform-table-container ${className}`}>
        {(title || actions) && (
          <div className="platform-table-header">
            {title && <h3 className="platform-table-title">{title}</h3>}
            {actions && (
              <div className="platform-table-actions">
                {actions}
              </div>
            )}
          </div>
        )}
        <div className="platform-table">
          {children}
        </div>
      </div>
    ));

    // === å¢å¼·ç‰ˆè¡¨æ ¼æœå°‹å’Œç¯©é¸çµ„ä»¶ ===
    const EnhancedTableControls = React.memo(({
      searchValue,
      onSearchChange,
      searchPlaceholder = "æœå°‹...",
      filters = [],
      onFilterChange,
      showRefresh = true,
      onRefresh,
      showExport = false,
      onExport,
      extraActions
    }) => {
      return (
        <div style={{
          display: 'flex',
          gap: 'var(--spacing-md)',
          alignItems: 'center',
          flexWrap: 'wrap'
        }}>
          {/* æœå°‹æ¡† */}
          <Input.Search
            placeholder={searchPlaceholder}
            value={searchValue}
            onChange={(e) => onSearchChange?.(e.target.value)}
            style={{ width: 300 }}
            allowClear
          />

          {/* ç¯©é¸å™¨ */}
          {filters.map((filter, index) => (
            <Select
              key={index}
              placeholder={filter.placeholder}
              value={filter.value}
              onChange={(value) => onFilterChange?.(filter.key, value)}
              style={{ width: filter.width || 150 }}
              allowClear
              mode={filter.multiple ? 'multiple' : undefined}
            >
              {filter.options?.map(option => (
                <Select.Option key={option.value} value={option.value}>
                  {option.label}
                </Select.Option>
              ))}
            </Select>
          ))}

          {/* æ“ä½œæŒ‰éˆ•çµ„ */}
          <div style={{ marginLeft: 'auto', display: 'flex', gap: 'var(--spacing-sm)' }}>
            {showRefresh && (
              <Tooltip title="é‡æ–°æ•´ç†">
                <PlatformButton
                  type="secondary"
                  icon={<ReloadOutlined />}
                  onClick={onRefresh}
                />
              </Tooltip>
            )}
            {showExport && (
              <Tooltip title="åŒ¯å‡ºè³‡æ–™">
                <PlatformButton
                  type="secondary"
                  icon={<DownloadOutlined />}
                  onClick={onExport}
                />
              </Tooltip>
            )}
            {extraActions}
          </div>
        </div>
      );
    });


    // ğŸš€ æ”¹é€²ç‰ˆè¡Œå…§é€²åº¦æ¢çµ„ä»¶ - æ•´åˆæ•¸å€¼èˆ‡é€²åº¦æ¢èƒŒæ™¯
    const InlineProgressCell = React.memo(({
      value,
      max = 100,
      status = 'healthy',
      unit = '%',
      showPercentage = false,
      formatValue = null,
      label = null,
      size = 'medium', // small, medium, large
      animated = false,
      threshold = null, // { warning: 80, critical: 90 }
      showTooltip = true
    }) => {
      // è¨ˆç®—ç™¾åˆ†æ¯”
      const percentage = Math.min((value / max) * 100, 100);

      // è‡ªå‹•åˆ¤æ–·ç‹€æ…‹ï¼ˆå¦‚æœæœ‰é–¾å€¼è¨­å®šï¼‰
      let finalStatus = status;
      if (threshold && status === 'healthy') {
        if (percentage >= (threshold.critical || 90)) {
          finalStatus = 'critical';
        } else if (percentage >= (threshold.warning || 80)) {
          finalStatus = 'warning';
        }
      }

      // æ ¼å¼åŒ–é¡¯ç¤ºå€¼
      const displayValue = formatValue ? formatValue(value) : value;
      const displayText = showPercentage ? `${percentage.toFixed(1)}%` : `${displayValue}${unit}`;

      const statusColors = {
        healthy: '#52c41a',
        success: '#52c41a',
        warning: '#faad14',
        critical: '#ff4d4f',
        normal: '#1890ff'
      };

      const backgroundColors = {
        healthy: 'rgba(82, 196, 26, 0.15)',
        success: 'rgba(82, 196, 26, 0.15)',
        warning: 'rgba(250, 173, 20, 0.15)',
        critical: 'rgba(255, 77, 79, 0.15)',
        normal: 'rgba(24, 144, 255, 0.15)'
      };

      const progressCell = (
        <div className={`inline-progress-cell inline-progress-${size} ${finalStatus} ${animated ? 'animated' : ''}`}>
          {/* èƒŒæ™¯é€²åº¦æ¢ */}
          <div
            className="inline-progress-background"
            style={{
              width: `${percentage}%`,
              backgroundColor: backgroundColors[finalStatus]
            }}
          />

          {/* å‰æ™¯æ–‡å­—å…§å®¹ */}
          <div className="inline-progress-content">
            {label && (
              <span className="inline-progress-label">{label}</span>
            )}
            <span
              className="inline-progress-text"
              style={{ color: statusColors[finalStatus] }}
            >
              {displayText}
            </span>
          </div>

          {/* ç‹€æ…‹æŒ‡ç¤ºå™¨ */}
          <div
            className="inline-progress-indicator"
            style={{ backgroundColor: statusColors[finalStatus] }}
          />
        </div>
      );

      // å¯é¸çš„ Tooltip
      if (showTooltip) {
        return (
          <Tooltip
            title={
              <div>
                <div>æ•¸å€¼: {displayValue}{unit}</div>
                <div>é€²åº¦: {percentage.toFixed(1)}%</div>
                <div>ç‹€æ…‹: {finalStatus}</div>
              </div>
            }
          >
            {progressCell}
          </Tooltip>
        );
      }

      return progressCell;
    });

    // ğŸ”§ é€²åº¦æ¢è¡¨æ ¼æ¬„ä½è¼”åŠ©å‡½æ•¸
    const createProgressColumn = ({
      title,
      dataIndex,
      maxValue = 100,
      unit = '%',
      threshold = { warning: 80, critical: 90 },
      formatValue = null,
      showPercentage = false,
      width = '140px'
    }) => ({
      title,
      dataIndex,
      width,
      align: 'center',
      render: (value, record) => (
        <InlineProgressCell
          value={value || 0}
          max={maxValue}
          unit={unit}
          threshold={threshold}
          formatValue={formatValue}
          showPercentage={showPercentage}
          size="medium"
          animated={true}
          showTooltip={true}
        />
      ),
      sorter: (a, b) => (a[dataIndex] || 0) - (b[dataIndex] || 0)
    });

    // é€šç”¨è¡¨æ ¼çµ„ä»¶ - ä½¿ç”¨ React.memo å„ªåŒ–æ€§èƒ½
    const OptimizedTable = React.memo(({
      dataSource,
      columns,
      loading,
      rowKey = 'key',
      pagination,
      onRowSelectionChange,
      scroll,
      size = 'small',
      className = 'transparent-bg'
    }) => {
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);

      const rowSelection = useMemo(() => onRowSelectionChange ? {
        selectedRowKeys,
        onChange: (keys) => {
          setSelectedRowKeys(keys);
          onRowSelectionChange(keys);
        },
        columnWidth: 32
      } : undefined, [selectedRowKeys, onRowSelectionChange]);

      const defaultPagination = useMemo(() => ({
        position: ['bottomRight'],
        showSizeChanger: true,
        showQuickJumper: true,
        size: 'small',
        ...pagination
      }), [pagination]);

      return (
        <Table
          rowSelection={rowSelection}
          columns={columns}
          dataSource={dataSource}
          rowKey={rowKey}
          loading={loading}
          pagination={defaultPagination}
          scroll={scroll || { x: 'max-content' }}
          size={size}
          className={className}
        />
      );
    });

    // --- Custom Hook for localStorage ---
    const useLocalStorageState = (key, defaultValue) => {
      const [state, setState] = useState(() => {
        try {
          const storedValue = window.localStorage.getItem(key);
          // Reviver function to parse ISO date strings back to dayjs objects
          const reviver = (k, v) => {
            if (typeof v === 'string' && /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/.test(v)) {
              return dayjs(v);
            }
            if (k === 'timeRange' && Array.isArray(v)) {
              return [dayjs(v[0]), dayjs(v[1])];
            }
            if (k === 'lastRun' && typeof v === 'string') {
              return dayjs(v);
            }
            return v;
          };
          return storedValue ? JSON.parse(storedValue, reviver) : defaultValue;
        } catch (error) {
          // localStorage è®€å–å¤±æ•—ï¼Œä½¿ç”¨é è¨­å€¼
          return defaultValue;
        }
      });

      useEffect(() => {
        try {
          window.localStorage.setItem(key, JSON.stringify(state));
        } catch (error) {
          // localStorage å¯«å…¥å¤±æ•—ï¼Œéœé»˜è™•ç†
        }
      }, [key, state]);

      return [state, setState];
    };

    // --- é€šç”¨åˆªé™¤ç¢ºèªå‡½æ•¸ ---
    const useDeleteConfirm = () => {
      return (itemName, onDelete, customMessage = null) => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤${customMessage || `æ­¤${itemName}`}å—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            onDelete();
            message.success(`${itemName}åˆªé™¤æˆåŠŸ`);
          }
        });
      };

      const handleBatchAddToGroup = () => {
        if (selectedRowKeys.length === 0) {
          message.warning('è«‹å…ˆé¸æ“‡è¦æ“ä½œçš„è³‡æº');
          return;
        }
        setIsAddToGroupModalOpen(true);
      };

      const handleConfirmAddToGroup = () => {
        if (!selectedGroupId) {
          message.error('è«‹é¸æ“‡ä¸€å€‹è³‡æºç¾¤çµ„');
          return;
        }

        const updatedResources = resources.map(res => {
          if (selectedRowKeys.includes(res.key)) {
            const currentGroups = res.groups || [];
            const newGroups = [...new Set([...currentGroups, selectedGroupId])];
            return { ...res, groups: newGroups };
          }
          return res;
        });

        setResources(updatedResources);
        message.success(`${selectedRowKeys.length} å€‹è³‡æºå·²æˆåŠŸåŠ å…¥ç¾¤çµ„`);
        setIsAddToGroupModalOpen(false);
        setSelectedRowKeys([]);
        setSelectedGroupId(null);
      };

      const handleOpenScanModal = () => {
        setIsScanModalOpen(true);
      };
    };

    // --- ECharts Component ---
    const EchartsForReact = ({ option, isDark }) => {
      const chartRef = useRef(null);
      useEffect(() => {
        let chart;
        if (chartRef.current !== null) {
          chart = echarts.init(chartRef.current, isDark ? 'dark' : 'light', { renderer: 'svg' });
          chart.setOption({ backgroundColor: 'transparent', ...option });
        }
        const resizeChart = () => { if (chart && !chart.isDisposed()) chart.resize(); };
        window.addEventListener('resize', resizeChart);
        return () => { if (chart) chart.dispose(); window.removeEventListener('resize', resizeChart); };
      }, [option, isDark]);
      return <div ref={chartRef} style={{ width: '100%', height: '100%' }} />;
    };

    // --- Page Components ---
    const LoginPage = ({ onLogin }) => {
      const [form] = Form.useForm();
      const onFinish = (values) => {
        if (values.username === 'admin' && values.password === 'admin') {
          onLogin();
        } else {
          message.error('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤');
        }
      };
      return (
        <div className="login-page" style={{
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          height: '100vh',
          background: 'linear-gradient(135deg, #0a0b0d 0%, #161719 50%, #0a0b0d 100%)',
          backgroundAttachment: 'fixed',
          position: 'relative',
          overflow: 'hidden'
        }}>
          {/* èƒŒæ™¯è£é£¾ */}
          <div style={{
            position: 'absolute',
            top: '-50%',
            left: '-25%',
            width: '150%',
            height: '200%',
            background: 'radial-gradient(circle at 50% 50%, rgba(138, 43, 226, 0.1) 0%, transparent 50%)',
            animation: 'float 20s ease-in-out infinite',
            pointerEvents: 'none'
          }} />
          <div style={{
            position: 'absolute',
            bottom: '-50%',
            right: '-25%',
            width: '150%',
            height: '200%',
            background: 'radial-gradient(circle at 50% 50%, rgba(24, 144, 255, 0.1) 0%, transparent 50%)',
            animation: 'float 25s ease-in-out infinite reverse',
            pointerEvents: 'none'
          }} />

          <Card
            className="login-card"
            style={{
              width: 320,
              background: 'var(--bg-elevated)',
              border: '1px solid var(--border-light)',
              borderRadius: 'var(--radius-xl)',
              boxShadow: '0 24px 80px rgba(0, 0, 0, 0.6), 0 8px 32px rgba(0, 0, 0, 0.4)',
              backdropFilter: 'blur(24px) saturate(200%)',
              WebkitBackdropFilter: 'blur(24px) saturate(200%)'
            }}
            bodyStyle={{
              padding: '24px',
              background: 'transparent'
            }}
          >
            <div style={{ textAlign: 'center', marginBottom: 24 }}>
              <div style={{
                marginBottom: 16,
                position: 'relative',
                display: 'inline-block'
              }}>
                <div style={{
                  width: '56px',
                  height: '56px',
                  borderRadius: '16px',
                  background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  margin: '0 auto',
                  boxShadow: '0 8px 32px rgba(102, 126, 234, 0.3)'
                }}>
                  <DeploymentUnitOutlined style={{
                    fontSize: '28px',
                    color: 'white'
                  }} />
                </div>
              </div>
              <Title level={2} style={{ color: 'var(--text-primary)', margin: '0 0 4px 0', fontWeight: '700', fontSize: '28px', letterSpacing: '-0.5px' }}>
                SRE Platform
              </Title>
              <Text style={{
                color: 'var(--text-secondary)',
                fontSize: '14px',
                display: 'block',
                fontWeight: '500'
              }}>
                æ™ºæ…§åŒ–ç³»çµ±å¯é æ€§ç®¡ç†å¹³å°
              </Text>
            </div>
            <Form
              form={form}
              name="login"
              onFinish={onFinish}
              layout="vertical"
              initialValues={{ username: 'admin', password: 'admin' }}
              style={{ marginTop: '0' }}
            >
              <Form.Item
                label={
                  <span style={{
                    color: 'var(--text-primary)',
                    fontSize: '13px',
                    fontWeight: '600'
                  }}>
                    å¸³è™Ÿ
                  </span>
                }
                name="username"
                rules={[{ required: true, message: 'è«‹è¼¸å…¥å¸³è™Ÿ' }]}
                style={{ marginBottom: '16px' }}
              >
                <Input
                  size="large"
                  prefix={<UserOutlined style={{ color: 'var(--text-tertiary)' }} />}
                  style={{
                    background: 'var(--bg-container)',
                    border: '1px solid var(--border-light)',
                    borderRadius: 'var(--radius-lg)',
                    height: '40px',
                    fontSize: '15px',
                    color: 'var(--text-primary)'
                  }}
                  placeholder="è«‹è¼¸å…¥å¸³è™Ÿ"
                  autoComplete="username"
                />
              </Form.Item>
              <Form.Item
                label={
                  <span style={{
                    color: 'var(--text-primary)',
                    fontSize: '13px',
                    fontWeight: '600'
                  }}>
                    å¯†ç¢¼
                  </span>
                }
                name="password"
                rules={[{ required: true, message: 'è«‹è¼¸å…¥å¯†ç¢¼' }]}
                style={{ marginBottom: '16px' }}
              >
                <Input.Password
                  size="large"
                  prefix={<LockOutlined style={{ color: 'var(--text-tertiary)' }} />}
                  style={{
                    background: 'var(--bg-container)',
                    border: '1px solid var(--border-light)',
                    borderRadius: 'var(--radius-lg)',
                    height: '40px',
                    fontSize: '15px',
                    color: 'var(--text-primary)'
                  }}
                  placeholder="è«‹è¼¸å…¥å¯†ç¢¼"
                  autoComplete="current-password"
                />
              </Form.Item>
              <Form.Item style={{ marginBottom: '16px' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Checkbox style={{ color: 'var(--text-secondary)', fontSize: '13px' }}>
                    è¨˜ä½æˆ‘
                  </Checkbox>
                  <Button type="link" style={{
                    color: 'var(--brand-primary)',
                    fontSize: '13px',
                    padding: 0,
                    height: 'auto'
                  }}>
                    å¿˜è¨˜å¯†ç¢¼ï¼Ÿ
                  </Button>
                </div>
              </Form.Item>
              <Form.Item style={{ marginTop: 16, marginBottom: 8 }}>
                <Button
                  htmlType="submit"
                  block
                  size="large"
                  className="login-submit-btn"
                >
                  ç™»å…¥
                </Button>
              </Form.Item>
              <div style={{
                textAlign: 'center',
                marginTop: '8px'
              }}>
                <Text style={{
                  color: 'var(--text-tertiary)',
                  fontSize: '12px'
                }}>
                  æ¸¬è©¦å¸³è™Ÿï¼šadmin / admin
                </Text>
              </div>
            </Form>
          </Card>
        </div>
      );
    };



    const AiRiskForecast = ({ onNavigate }) => {
      const riskData = [
        { id: 'risk-1', resourceName: 'web-prod-01', metricName: 'CPU Usage', metricType: 'usage', timeToExhaust: 7, unit: 'å¤©' },
        { id: 'risk-2', resourceName: 'db-prod-01', metricName: 'Memory Usage', metricType: 'usage', timeToExhaust: 14, unit: 'å¤©' },
        { id: 'risk-3', resourceName: 'api-gateway-01', metricName: 'Latency', metricType: 'latency', timeToExhaust: 20, unit: 'å¤©' },
        { id: 'risk-4', resourceName: 'log-server-01', metricName: 'Disk Space', metricType: 'storage', timeToExhaust: 30, unit: 'å¤©' },
      ];

      const getIcon = (metricType) => {
        switch (metricType) {
          case 'storage':
            return <HddOutlined style={{ color: 'var(--brand-info)' }} />;
          case 'usage':
            return <DashboardOutlined style={{ color: 'var(--brand-success)' }} />;
          case 'latency':
            return <FieldTimeOutlined style={{ color: 'var(--brand-warning)' }} />;
          default:
            return <QuestionCircleOutlined />;
        }
      };

      return (
        <Card title="AI é¢¨éšªé æ¸¬" style={{ flex: 1, display: 'flex', flexDirection: 'column' }} bodyStyle={{ flex: 1, overflow: 'hidden', padding: '0 8px 8px' }}>
          <List
            itemLayout="horizontal"
            dataSource={riskData}
            renderItem={item => (
              <List.Item
                actions={[<Button type="link" onClick={() => onNavigate('resource-list', { searchText: item.resourceName, highlightedResource: item.resourceName })}>æŸ¥çœ‹</Button>]}
                style={{ padding: '8px 12px', lineHeight: 1.6 }}
              >
                <List.Item.Meta
                  avatar={<Avatar size="large" icon={getIcon(item.metricType)} style={{ backgroundColor: 'rgba(255, 255, 255, 0.05)' }} />}
                  title={<a onClick={() => onNavigate('resource-list', { searchText: item.resourceName, highlightedResource: item.resourceName })}>{item.resourceName}</a>}
                  description={
                    <span>
                      {item.metricName} é è¨ˆåœ¨ <strong style={{ color: item.timeToExhaust < 15 ? 'var(--brand-danger)' : 'var(--brand-warning)' }}>{item.timeToExhaust} {item.unit}</strong> å¾Œé”åˆ°é–¾å€¼
                    </span>
                  }
                />
              </List.Item>
            )}
          />
        </Card>
      );
    };

    // --- Page Components (Enhanced and Placeholders) ---
    const TopNResourceList = ({ themeMode }) => {
      const [metric, setMetric] = useState('CPU');

      // ç”Ÿæˆè¶¨å‹¢æ•¸æ“š - å¢å¼·ç‰ˆéš¨æ©Ÿæ³¢å‹•
      const generateTrend = () => {
        const baseValue = 55; // åŸºæº–å€¼
        const trendDirection = Math.random() > 0.5 ? 1 : -1; // ä¸Šå‡æˆ–ä¸‹é™è¶¨å‹¢
        const volatility = 25; // æ³¢å‹•æ€§

        let currentValue = baseValue;
        const trend = [];

        for (let i = 0; i < 12; i++) {
          // æ–°å¢è¶¨å‹¢æ–¹å‘çš„å½±éŸ¿
          const trendInfluence = trendDirection * (i / 12) * 15;

          // æ–°å¢éš¨æ©Ÿæ³¢å‹•
          const randomChange = (Math.random() - 0.5) * volatility;

          // æ–°å¢ä¸€äº›é€±æœŸæ€§è®ŠåŒ–ï¼ˆæ¨¡æ“¬ä¸€å¤©ä¸­çš„æ³¢å‹•ï¼‰
          const periodicChange = Math.sin(i * Math.PI / 6) * 8;

          currentValue = Math.max(8, Math.min(98,
            baseValue + trendInfluence + randomChange + periodicChange
          ));

          // æ–°å¢å¹³æ»‘éæ¸¡
          if (i > 0) {
            const prevValue = trend[i - 1];
            currentValue = prevValue * 0.6 + currentValue * 0.4;
          }

          trend.push(Math.round(currentValue));
        }

        return trend;
      };

      const data = {
        CPU: Array.from({ length: 10 }, (_, i) => ({
          key: i,
          host: `web-prod-${i + 1}`,
          value: 95 - i * 2,
          trend: generateTrend()
        })),
        Mem: Array.from({ length: 10 }, (_, i) => ({
          key: i,
          host: `db-prod-${i + 1}`,
          value: 92 - i * 1.8,
          trend: generateTrend()
        })),
        Disk: Array.from({ length: 10 }, (_, i) => ({
          key: i,
          host: `log-server-${i + 1}`,
          value: 88 - i * 2.5,
          trend: generateTrend()
        })),
        Net: Array.from({ length: 10 }, (_, i) => ({
          key: i,
          host: `api-gateway-${i + 1}`,
          value: 800 - i * 25,
          trend: generateTrend()
        })),
      };

      // å»ºç«‹è¿·ä½ è¶¨å‹¢åœ–é¸é … - å¢å¼·ç‰ˆ
      const createSparklineOption = (trendData, color, currentValue = 0) => {
        // æ ¹æ“šæ•¸å€¼æ±ºå®šç‹€æ…‹
        const status = currentValue > 90 ? 'critical' :
          currentValue > 75 ? 'warning' : 'normal';

        return {
          backgroundColor: 'transparent',
          grid: { top: 3, bottom: 3, left: 2, right: 2 },

          // æ–°å¢è¼•å¾®çš„èƒŒæ™¯è‰²èª¿æŒ‡ç¤ºç‹€æ…‹
          graphic: status !== 'normal' ? {
            type: 'rect',
            left: 0,
            top: 0,
            right: 0,
            bottom: 0,
            style: {
              fill: status === 'critical' ? 'rgba(255, 77, 79, 0.08)' :
                'rgba(250, 173, 20, 0.08)',
              borderRadius: 2
            }
          } : undefined,

          xAxis: {
            type: 'category',
            show: false,
            data: trendData.map((_, i) => i)
          },
          yAxis: {
            type: 'value',
            show: false,
            min: 'dataMin',
            max: 'dataMax'
          },
          series: [{
            data: trendData,
            type: 'line',
            smooth: true,
            showSymbol: false,
            lineStyle: {
              width: 1.5,
              color: color,
              shadowColor: color,
              shadowBlur: 1
            },
            // æ–°å¢è¼•å¾®çš„å€åŸŸå¡«å……
            areaStyle: {
              color: {
                type: 'linear',
                x: 0, y: 0, x2: 0, y2: 1,
                colorStops: [{
                  offset: 0, color: `${color}15`
                }, {
                  offset: 1, color: `${color}05`
                }]
              }
            },
            // æ–°å¢å‹•ç•«æ•ˆæœ
            animationDuration: 800,
            animationEasing: 'cubicOut'
          }]
        };
      };

      const columns = [
        {
          title: 'ä¸»æ©Ÿ',
          dataIndex: 'host',
          key: 'host',
          width: '20%',
          render: (text) => (
            <div className="text-secondary" style={{ fontSize: '12px', cursor: 'pointer' }} onClick={() => {
              // åˆ‡æ›åˆ°åˆ—è¡¨æ¨¡å¼ä¸¦ç¯©é¸è©²ä¸»æ©Ÿ
              setViewMode('list');
              setSearchText(text);
              setHighlightedResource(text);
            }}>
              {text}
            </div>
          )
        },
        {
          title: 'è³‡æºè¶¨å‹¢ (24H)',
          dataIndex: 'trend',
          key: 'trend',
          width: '25%',
          render: (trend, record) => (
            <div style={{ height: '30px' }}>
              <EchartsForReact
                option={{
                  backgroundColor: 'transparent',
                  grid: { top: 4, bottom: 4, left: 2, right: 2 },
                  xAxis: { type: 'category', show: false, data: (trend || []).map((_, i) => i) },
                  yAxis: { type: 'value', show: false, min: 'dataMin', max: 'dataMax' },
                  series: [{
                    data: trend || [],
                    type: 'line',
                    smooth: false,
                    showSymbol: false,
                    lineStyle: { width: 2, color: '#6395f9' },
                    areaStyle: {
                      color: {
                        type: 'linear', x: 0, y: 0, x2: 0, y2: 1,
                        colorStops: [{ offset: 0, color: '#6395f94D' }, { offset: 1, color: '#6395f91A' }]
                      }
                    }
                  }]
                }}
                isDark={themeMode === 'dark'}
              />
            </div>
          )
        },
        {
          title: 'ä½¿ç”¨ç‡',
          dataIndex: 'value',
          key: 'value',
          width: '30%',
          render: (value, record) => {
            // æ±ºå®šå–®ä½å’Œæœ€å¤§å€¼
            const metric = record.metric;
            const unit = metric === 'Net' ? ' Mbps' : '%';
            const maxValue = metric === 'Net' ? 1000 : 100;
            const displayValue = metric === 'Net' ? value : value;

            return (
              <InlineProgressCell
                value={displayValue}
                max={maxValue}
                unit={unit}
                threshold={{ warning: 75, critical: 90 }}
                size="medium"
                animated={true}
                showTooltip={true}
                formatValue={(val) => metric === 'Net' ? val.toFixed(0) : val.toFixed(1)}
              />
            );
          }
        }
      ];

      const titleContent = (
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' }}>
          <span style={{ fontSize: '16px', fontWeight: '600' }}>Top N è³‡æºä½¿ç”¨åˆ—è¡¨</span>
          <Radio.Group
            value={metric}
            onChange={(e) => setMetric(e.target.value)}
            size="small"
          >
            <Radio.Button value="CPU">CPU</Radio.Button>
            <Radio.Button value="Mem">è¨˜æ†¶é«”</Radio.Button>
            <Radio.Button value="Disk">ç£ç¢Ÿ</Radio.Button>
            <Radio.Button value="Net">ç¶²è·¯</Radio.Button>
          </Radio.Group>
        </div>
      );

      return (
        <Card
          title={titleContent}
          style={{
            height: '100%',
            display: 'flex',
            flexDirection: 'column',
            background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%)',
            border: '1px solid rgba(255, 255, 255, 0.12)',
            borderRadius: 'var(--radius-lg)',
            backdropFilter: 'blur(20px) saturate(180%)',
            WebkitBackdropFilter: 'blur(20px) saturate(180%)',
            boxShadow: '0 4px 24px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)',
            transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
            position: 'relative',
            overflow: 'hidden'
          }}
          bodyStyle={{ flex: 1, overflow: 'hidden', padding: '12px 12px 12px' }}
        >
          <div style={{ height: '100%', overflow: 'auto' }}>
            <Table
              dataSource={data[metric]}
              columns={columns}
              pagination={false}
              size="small"
              rowKey="key"
              className="topn-table"
              scroll={{ y: 'calc(100% - 25px)' }}
            />
          </div>
        </Card>
      );
    };

    const AIInsightSummary = ({ onNavigate }) => {
      const [isRefreshing, setIsRefreshing] = useState(false);
      const [insightContent, setInsightContent] = useState('æ•´é«”ç³»çµ±ç©©å®šï¼Œä½†è§€å¯Ÿåˆ° Production Web Servers çš„ CPU ä½¿ç”¨ç‡åœ¨é«˜å³°æ™‚æ®µæœ‰ 15% çš„å¢é•·ï¼Œæ¥è¿‘è­¦æˆ’ç·šã€‚è³‡æ–™åº« å»¶é²å¹³ç©©ï¼Œç„¡æ˜é¡¯ç•°å¸¸ã€‚å»ºè­°é—œæ³¨ web-prod-03 ä¸»æ©Ÿçš„æ—¥èªŒï¼Œè©²ä¸»æ©Ÿå‡ºç¾äº†æ•¸æ¬¡éŸ¿æ‡‰ç·©æ…¢çš„æƒ…æ³ã€‚');

      // åˆ·æ–°AIåˆ†æçš„å‡½æ•¸
      const handleRefresh = async () => {
        setIsRefreshing(true);
        try {
          // æ¨¡æ“¬AIé‡æ–°åˆ†æéç¨‹
          await new Promise(resolve => setTimeout(resolve, 2000));

          // æ¨¡æ“¬ä¸åŒçš„AIåˆ†æçµæœ
          const analysisVariants = [
            'æ•´é«”ç³»çµ±ç©©å®šï¼Œä½†è§€å¯Ÿåˆ° Production Web Servers çš„ CPU ä½¿ç”¨ç‡åœ¨é«˜å³°æ™‚æ®µæœ‰ 15% çš„å¢é•·ï¼Œæ¥è¿‘è­¦æˆ’ç·šã€‚è³‡æ–™åº«å»¶é²å¹³ç©©ï¼Œç„¡æ˜é¡¯ç•°å¸¸ã€‚å»ºè­°é—œæ³¨ web-prod-03 ä¸»æ©Ÿçš„æ—¥èªŒï¼Œè©²ä¸»æ©Ÿå‡ºç¾äº†æ•¸æ¬¡éŸ¿æ‡‰ç·©æ…¢çš„æƒ…æ³ã€‚',
            'ç³»çµ±é‹è¡Œè‰¯å¥½ï¼Œæ‰€æœ‰æ ¸å¿ƒæœå‹™è¡¨ç¾æ­£å¸¸ã€‚æª¢æ¸¬åˆ° è³‡æ–™åº« é€£æ¥æ± ä½¿ç”¨ç‡ç•¥æœ‰ä¸Šå‡ï¼Œä½†ä»åœ¨å®‰å…¨ç¯„åœå…§ã€‚å»ºè­°åœ¨ä¸‹æ¬¡ç¶­è­·çª—å£æœŸé–“å„ªåŒ– Production Web Servers çš„è² è¼‰åˆ†é…ç­–ç•¥ã€‚',
            'ç™¼ç¾æ½›åœ¨çš„æ€§èƒ½ç“¶é ¸ï¼šweb-prod-03 ä¸»æ©Ÿçš„ç£ç›¤I/Oä½¿ç”¨ç‡æŒçºŒåé«˜ï¼Œå¯èƒ½å½±éŸ¿æ•´é«”éŸ¿æ‡‰æ™‚é–“ã€‚è³‡æ–™åº«æŸ¥è©¢æ€§èƒ½è‰¯å¥½ï¼Œä½†å»ºè­°å¢åŠ å° Production Web Servers é›†ç¾¤çš„ç›£æ§é »ç‡ã€‚',
            'ç³»çµ±æ•´é«”å¥åº·ï¼Œä½†æ³¨æ„åˆ°ç¶²çµ¡å»¶é²ç•¥æœ‰æ³¢å‹•ã€‚Production Web Servers è² è¼‰å‡è¡¡é‹è¡Œç©©å®šï¼Œè³‡æ–™åº«æ€§èƒ½å„ªç•°ã€‚å»ºè­°åœ¨ç¹å¿™æ™‚æ®µå¢åŠ  web-prod-03 çš„è³‡æºé…ç½®ä»¥æå‡æ•´é«”æœå‹™è³ªé‡ã€‚'
          ];

          const randomAnalysis = analysisVariants[Math.floor(Math.random() * analysisVariants.length)];
          setInsightContent(randomAnalysis);

          message.success('AI åˆ†æå·²æ›´æ–°');
        } catch (error) {
          message.error('é‡æ–°ç”Ÿæˆåˆ†æå¤±æ•—');
        } finally {
          setIsRefreshing(false);
        }
      };

      // æ¸²æŸ“å¯¦é«”é€£çµçš„å‡½æ•¸
      const renderEntityLinkedText = (text) => {
        const entityPatterns = [
          { pattern: /Production Web Servers/g, type: 'resource-group', param: 'Production Web Servers' },
          { pattern: /web-prod-03/g, type: 'resource', param: 'web-prod-03' },
          { pattern: /è³‡æ–™åº«/g, type: 'service', param: 'è³‡æ–™åº«' }
        ];

        let result = text;
        entityPatterns.forEach(({ pattern, type, param }) => {
          result = result.replace(pattern, (match) => {
            let href = '#';
            let color = '#1890ff';

            switch (type) {
              case 'resource-group':
                href = `/resource-list?group=${encodeURIComponent(param)}`;
                color = '#52c41a';
                break;
              case 'resource':
                href = `/resource-detail/${param}`;
                color = '#faad14';
                break;
              case 'service':
                href = `/service-dashboard/${param}`;
                color = '#1677FF';
                break;
            }

            return `<a href="${href}" style="color: ${color}; text-decoration: underline; cursor: pointer; font-weight: 600;" onclick="event.preventDefault(); return false;">${match}</a>`;
          });
        });

        return <span dangerouslySetInnerHTML={{ __html: result }} />;
      };

      return (
        <div style={{
          background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%)',
          border: '1px solid rgba(114, 46, 209, 0.6)',
          borderRadius: 'var(--radius-lg)',
          padding: 'var(--spacing-lg)',
          backdropFilter: 'blur(10px)',
          boxShadow: '0 4px 12px rgba(0,0,0,0.1)',
          margin: '0 0 16px 0'
        }}>
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 'var(--spacing-md)' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
              <RobotOutlined style={{ fontSize: '24px', color: '#722ed1' }} />
              <Title level={4} style={{ margin: 0, color: 'var(--text-primary)' }}>AI æ¯æ—¥ç°¡å ±</Title>
            </div>
            <Tooltip title="é‡æ–°ç”Ÿæˆåˆ†æ">
              <Avatar
                size={28}
                shape="square"
                icon={<ReloadOutlined spin={isRefreshing} />}
                onClick={handleRefresh}
                style={{
                  background: 'linear-gradient(135deg, #722ed1 0%, #9c4dcc 100%)',
                  fontSize: '14px',
                  cursor: isRefreshing ? 'not-allowed' : 'pointer',
                  opacity: isRefreshing ? 0.6 : 1,
                  transition: 'all 0.2s ease'
                }}
              />
            </Tooltip>
          </div>
          <Paragraph style={{ margin: 0, lineHeight: 1.7, color: 'var(--text-secondary)', fontSize: '14px' }}>
            {renderEntityLinkedText(insightContent)}
          </Paragraph>
        </div>
      );
    };

    // âš¡ æ€§èƒ½å„ªåŒ–ï¼šä½¿ç”¨ React.memo å’Œ useMemo å„ªåŒ– HomePage
    const HomePage = ({ themeMode, onNavigate }) => {
      // This component is now much cleaner.
      // All the logic for TopNResourceList has been moved to that component.

      // å †ç–Šé•·æ¢åœ–é¸é … - è³‡æºç¾¤çµ„ç‹€æ…‹ç¸½è¦½
      const stackedBarOption = {
        tooltip: {
          trigger: 'axis',
          backgroundColor: 'rgba(0,0,0,0.8)',
          borderColor: 'rgba(255,255,255,0.2)',
          textStyle: { color: '#fff', fontSize: 11 }
        },
        // æ–°å¢é»æ“Šäº‹ä»¶è™•ç†
        onClick: function (params) {
          if (onNavigate && params.name) {
            // è·³è½‰åˆ°è³‡æºåˆ—è¡¨é é¢ï¼Œä¸¦å¸¶ä¸Šç¾¤çµ„ç¯©é¸åƒæ•¸
            onNavigate('resource-list', { groupFilter: params.name });
          }
        },
        legend: {
          data: ['å¥åº·', 'è­¦å‘Š', 'åš´é‡'],
          top: 0,
          textStyle: { color: 'rgba(255,255,255,0.85)', fontSize: 12 },
          itemGap: 8,
          itemWidth: 12,
          itemHeight: 8
        },
        grid: {
          left: '2%',
          right: '2%',
          bottom: '15%',
          top: '18%',
          containLabel: true
        },
        xAxis: {
          type: 'category',
          data: ['ç”Ÿç”¢Webé›†ç¾¤', 'ç”Ÿç”¢è³‡æ–™åº«', 'æ¸¬è©¦ç’°å¢ƒ', 'é–‹ç™¼ç’°å¢ƒ', 'ç½å‚™ç³»çµ±', 'ç›£æ§å¹³å°', 'APIç¶²é—œ', 'å¿«å–æœå‹™'],
          axisLabel: {
            color: 'rgba(255,255,255,0.65)',
            fontSize: 12,
            interval: 0,
            rotate: 0
          },
          axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }
        },
        yAxis: {
          type: 'value',
          axisLabel: { color: 'rgba(255,255,255,0.65)', fontSize: 10 },
          axisLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
          splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } }
        },
        series: [
          {
            name: 'å¥åº·',
            type: 'bar',
            stack: 'ç¸½é‡',
            data: [85, 18, 28, 22, 75, 32, 45, 38],
            color: '#52c41a',
            barWidth: '60%'
          },
          {
            name: 'è­¦å‘Š',
            type: 'bar',
            stack: 'ç¸½é‡',
            data: [18, 12, 25, 8, 28, 22, 16, 14],
            color: '#faad14'
          },
          {
            name: 'åš´é‡',
            type: 'bar',
            stack: 'ç¸½é‡',
            data: [22, 8, 12, 6, 15, 10, 8, 12],
            color: '#ff4d4f'
          }
        ]
      };

      // æœå‹™å¥åº·åº¦ç†±åŠ›åœ–é¸é … - å››å¤§é»ƒé‡‘ä¿¡è™Ÿç›£æ§
      const serviceHealthHeatmapOption = {
        tooltip: {
          position: 'top',
          backgroundColor: 'rgba(0,0,0,0.8)',
          borderColor: 'rgba(255,255,255,0.2)',
          textStyle: { color: '#fff', fontSize: 11 },
          formatter: function (params) {
            const services = ['äººå“¡èªè­‰', 'è¨‚å–®ç³»çµ±', 'æ”¯ä»˜é–˜é“', 'é€šçŸ¥æœå‹™', 'è³‡æ–™åˆ†æ', 'æª”æ¡ˆå„²å­˜'];
            const signals = ['å»¶é² (Latency)', 'æµé‡ (Traffic)', 'éŒ¯èª¤ (Errors)', 'é£½å’Œåº¦ (Saturation)'];
            const service = services[params.data[1]];
            const signal = signals[params.data[0]];
            const statusText = params.data[2] === 0 ? 'å¥åº·' : params.data[2] === 1 ? 'è­¦å‘Š' : 'åš´é‡';
            return `${service}<br/>${signal}: ${statusText}`;
          }
        },
        // æ–°å¢é»æ“Šäº‹ä»¶è™•ç†
        onClick: function (params) {
          if (onNavigate && params.data) {
            const services = ['äººå“¡èªè­‰', 'è¨‚å–®ç³»çµ±', 'æ”¯ä»˜é–˜é“', 'é€šçŸ¥æœå‹™', 'è³‡æ–™åˆ†æ', 'æª”æ¡ˆå„²å­˜'];
            const signals = ['å»¶é²', 'æµé‡', 'éŒ¯èª¤', 'é£½å’Œåº¦'];
            const service = services[params.data[1]];
            const signal = signals[params.data[0]];
            // è·³è½‰åˆ°è³‡æºåˆ—è¡¨é é¢ï¼Œä¸¦å¸¶ä¸Šæœå‹™ç¯©é¸åƒæ•¸
            onNavigate('resource-list', { serviceFilter: service, signalFilter: signal });
          }
        },
        animation: false,
        grid: {
          height: '65%',
          top: '10%',
          left: '15%',
          right: '5%'
        },
        xAxis: {
          type: 'category',
          data: ['å»¶é²', 'æµé‡', 'éŒ¯èª¤', 'é£½å’Œåº¦'],
          splitArea: {
            show: true
          },
          axisLabel: {
            color: 'rgba(255,255,255,0.85)',
            fontSize: 11
          }
        },
        yAxis: {
          type: 'category',
          data: ['äººå“¡èªè­‰', 'è¨‚å–®ç³»çµ±', 'æ”¯ä»˜é–˜é“', 'é€šçŸ¥æœå‹™', 'è³‡æ–™åˆ†æ', 'æª”æ¡ˆå„²å­˜'],
          splitArea: {
            show: true
          },
          axisLabel: {
            color: 'rgba(255,255,255,0.85)',
            fontSize: 11
          }
        },
        visualMap: {
          min: 0,
          max: 2,
          type: 'piecewise',
          pieces: [
            { min: 0, max: 0, color: '#52c41a', label: 'å¥åº·' },
            { min: 1, max: 1, color: '#faad14', label: 'è­¦å‘Š' },
            { min: 2, max: 2, color: '#ff4d4f', label: 'åš´é‡' }
          ],
          orient: 'horizontal',
          left: 'center',
          bottom: '8%',
          itemWidth: 16,
          itemHeight: 10,
          textGap: 6,
          itemGap: 50,
          textStyle: {
            color: 'rgba(255,255,255,0.9)',
            fontSize: 11,
            fontWeight: 500
          }
        },
        series: [{
          name: 'æœå‹™å¥åº·åº¦',
          type: 'heatmap',
          data: [
            [0, 0, 0], [1, 0, 0], [2, 0, 1], [3, 0, 0],  // äººå“¡èªè­‰
            [0, 1, 0], [1, 1, 0], [2, 1, 0], [3, 1, 1],  // è¨‚å–®ç³»çµ±
            [0, 2, 1], [1, 2, 0], [2, 2, 2], [3, 2, 0],  // æ”¯ä»˜é–˜é“
            [0, 3, 0], [1, 3, 0], [2, 3, 0], [3, 3, 0],  // é€šçŸ¥æœå‹™
            [0, 4, 0], [1, 4, 1], [2, 4, 0], [3, 4, 0],  // è³‡æ–™åˆ†æ
            [0, 5, 0], [1, 5, 0], [2, 5, 0], [3, 5, 1]   // æª”æ¡ˆå„²å­˜
          ],
          label: {
            show: false
          },
          emphasis: {
            itemStyle: {
              shadowBlur: 10,
              shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
          }
        }]
      };

      return (
        <div style={{ display: 'flex', flexDirection: 'column', height: 'calc(100vh - 48px - 48px)', paddingBottom: 'var(--spacing-xl)' }}>

          {/* å€å¡Š A: äº‹ä»¶æˆ°æƒ… (Incident Status) */}
          <div style={{ marginBottom: '16px' }}>
            <Row gutter={[16, 12]}>
              {/* ä¸»å¡ç‰‡ - å¾…è™•ç†äº‹ä»¶ */}
              <Col xs={24} sm={12} md={8} lg={8}>
                <div
                  className="stat-card padding-md"
                  style={{ height: '120px', cursor: 'pointer' }}
                  onClick={() => {
                    if (onNavigate) onNavigate('incident-list', { statusFilter: 'new' });
                  }}
                >
                  <div className="card-content">
                    <div>
                      <div className="card-title" style={{ fontSize: '14px' }}>å¾…è™•ç†äº‹ä»¶</div>
                      <div className="card-value" style={{ color: '#ff4d4f', fontSize: '40px' }}>5</div>
                      <div className="card-description">
                        å…¶ä¸­ <span style={{ color: '#ff4d4f', fontWeight: '600' }}>2</span> åš´é‡
                      </div>
                    </div>
                    <FireOutlined className="card-icon" style={{ color: '#ff4d4f', fontSize: '36px' }} />
                  </div>
                </div>
              </Col>

              {/* å‰¯å¡ç‰‡ 1 - è™•ç†ä¸­ */}
              <Col xs={24} sm={12} md={8} lg={8}>
                <div
                  className="stat-card padding-md"
                  style={{ height: '120px', cursor: 'pointer' }}
                  onClick={() => {
                    if (onNavigate) onNavigate('incident-list', { statusFilter: 'acknowledged' });
                  }}
                >
                  <div className="card-content">
                    <div>
                      <div className="card-title" style={{ fontSize: '14px' }}>è™•ç†ä¸­</div>
                      <div className="card-value" style={{ color: '#faad14', fontSize: '40px' }}>3</div>
                      <div className="card-description" style={{ color: '#faad14' }}>
                        â†˜ 15% è¼ƒæ˜¨æ—¥
                      </div>
                    </div>
                    <ClockCircleOutlined className="card-icon" style={{ color: '#faad14', fontSize: '36px' }} />
                  </div>
                </div>
              </Col>

              {/* å‰¯å¡ç‰‡ 2 - ä»Šæ—¥å·²è§£æ±º */}
              <Col xs={24} sm={12} md={8} lg={8}>
                <div
                  className="stat-card padding-md"
                  style={{ height: '120px', cursor: 'pointer' }}
                  onClick={() => {
                    if (onNavigate) onNavigate('incident-list', { statusFilter: 'resolved' });
                  }}
                >
                  <div className="card-content">
                    <div>
                      <div className="card-title" style={{ fontSize: '14px' }}>ä»Šæ—¥å·²è§£æ±º</div>
                      <div className="card-value" style={{ color: '#52c41a', fontSize: '40px' }}>12</div>
                      <div className="card-description" style={{ color: '#52c41a' }}>
                        â†— 8% è¼ƒæ˜¨æ—¥
                      </div>
                    </div>
                    <CheckCircleOutlined className="card-icon" style={{ color: '#52c41a', fontSize: '36px' }} />
                  </div>
                </div>
              </Col>
            </Row>
          </div>

          {/* AI ä½œæˆ°åƒè¬€æ¯æ—¥ç°¡å ± */}
          <AIInsightSummary onNavigate={onNavigate} />

          {/* å€å¡Š B: è³‡æºå¥åº·åº¦èˆ‡é—œéµæ¥­å‹™ç›£æ§ (Resource Health & Key Business Monitoring) */}
          <div style={{ flexGrow: 1, display: 'flex', flexDirection: 'column', minHeight: '400px', marginBottom: 'var(--spacing-lg)' }}>
            <Row gutter={[16, 12]} style={{ flexGrow: 1, height: '100%' }}>
              {/* å·¦å´ï¼šæœå‹™å¥åº·åº¦ç†±åŠ›åœ– - ä½” 1/3 */}
              <Col xs={24} sm={24} md={8} lg={8} style={{ display: 'flex', marginBottom: '16px' }}>
                <div
                  className="chart-card"
                  style={{
                    width: '100%',
                    padding: '16px',
                    cursor: 'pointer',
                    display: 'flex',
                    flexDirection: 'column',
                    minHeight: '350px',
                    height: '100%'
                  }}
                  onClick={() => {
                    if (onNavigate) onNavigate('resource-list');
                  }}
                >
                  <Title level={5} className="chart-title" style={{ marginBottom: '16px' }}>æœå‹™å¥åº·åº¦ç¸½è¦½</Title>
                  <div style={{ flexGrow: 1, minHeight: '280px', height: 'calc(100% - 40px)' }}>
                    <EchartsForReact option={serviceHealthHeatmapOption} isDark={themeMode === 'dark'} />
                  </div>
                </div>
              </Col>

              {/* å³å´ï¼šè³‡æºç¾¤çµ„ç‹€æ…‹ç¸½è¦½ - ä½” 2/3 */}
              <Col xs={24} sm={24} md={16} lg={16} style={{ display: 'flex', marginBottom: '16px' }}>
                <div
                  className="chart-card"
                  style={{
                    width: '100%',
                    padding: '16px',
                    cursor: 'pointer',
                    display: 'flex',
                    flexDirection: 'column',
                    minHeight: '350px',
                    height: '100%'
                  }}
                  onClick={() => {
                    if (onNavigate) onNavigate('resource-list');
                  }}
                >
                  <Title level={5} className="chart-title" style={{ marginBottom: '16px' }}>è³‡æºç¾¤çµ„ç‹€æ…‹ç¸½è¦½</Title>
                  <div style={{ flexGrow: 1, minHeight: '280px', height: 'calc(100% - 40px)' }}>
                    <EchartsForReact option={stackedBarOption} isDark={themeMode === 'dark'} />
                  </div>
                </div>
              </Col>
            </Row>
          </div>

        </div>
      );
    };

    const ResourceOverviewPage = ({ themeMode, onNavigate }) => {
      // Data and state logic migrated from the original component
      const generateTrend = () => {
        const baseValue = 55;
        const trendDirection = Math.random() > 0.5 ? 1 : -1;
        const volatility = 25;
        let currentValue = baseValue;
        const trend = [];
        for (let i = 0; i < 12; i++) {
          const trendInfluence = trendDirection * (i / 12) * 15;
          const randomChange = (Math.random() - 0.5) * volatility;
          const periodicChange = Math.sin(i * Math.PI / 6) * 8;
          currentValue = Math.max(8, Math.min(98, baseValue + trendInfluence + randomChange + periodicChange));
          if (i > 0) {
            const prevValue = trend[i - 1];
            currentValue = prevValue * 0.6 + currentValue * 0.4;
          }
          trend.push(Math.round(currentValue));
        }
        return trend;
      };

      const initialData = [
        { key: 'host_1', name: 'db-prod-01', type: 'database', status: 'healthy', ip_address: '10.0.0.10', groups: ['g_1'], tags: ['production', 'database', 'high-priority'], trend: generateTrend(), alarms: [] },
        { key: 'host_2', name: 'web-prod-02', type: 'server', status: 'warning', ip_address: '10.0.0.21', groups: ['g_2'], tags: ['production', 'web-server'], trend: generateTrend(), alarms: [{ severity: 'warning', summary: 'Disk space is over 85%' }] },
        { key: 'host_3', name: 'api-gateway-prod', type: 'gateway', status: 'critical', ip_address: '10.0.0.35', groups: [], tags: ['production', 'high-priority'], trend: generateTrend(), alarms: [{ severity: 'critical', summary: 'API latency > 2s' }, { severity: 'warning', summary: '5xx error rate > 5%' }] },
        { key: 'host_4', name: 'cache-redis-prod', type: 'cache', status: 'healthy', ip_address: '10.0.0.40', groups: ['g_1', 'g_2'], tags: ['production', 'database'], trend: generateTrend(), alarms: [] },
        {
          key: 'host_5',
          name: 'k8s-master-node-01',
          type: 'server',
          status: 'healthy',
          ip_address: '10.0.1.5',
          groups: ['g_2', 'g_3'],
          tags: [
            'production', 'kubernetes', 'control-plane', 'high-availability', 'cluster-critical',
            'team-alpha', 'owner:JohnDoe', 'cost-center:12345', 'data-center:us-east-1a',
            'os:ubuntu-22.04', 'instance-type:m5.xlarge', 'backup-policy:daily'
          ],
          trend: generateTrend(),
          alarms: []
        }
      ];

      const [resources, setResources] = useLocalStorageState('sre-resources-v3', initialData);

      // Click handler for attention list, navigates to list page with filter
      const handleAttentionClick = (resourceName) => {
        onNavigate('resource-list', { searchText: resourceName, highlightedResource: resourceName });
      };

      const attentionResources = resources
        .filter(r => r.status === 'warning' || r.status === 'critical')
        .sort((a, b) => {
          if (a.status === 'critical' && b.status !== 'critical') return -1;
          if (a.status !== 'critical' && b.status === 'critical') return 1;
          return 0;
        });

      return (
        <React.Fragment>
          <div style={{ marginBottom: 'var(--spacing-lg)' }}>
            <Title level={2} className="page-title" style={{ marginBottom: '4px' }}>è³‡æºç¸½è¦½</Title>
            <Paragraph className="page-subtitle" type="secondary" style={{ margin: 0 }}>
              æ‚¨æ‰€æœ‰åŸºç¤è¨­æ–½çš„ä½œæˆ°æŒ‡æ®ä¸­å¿ƒã€‚å³æ™‚æŒæ¡è³‡æºå¥åº·åº¦ã€å®šä½æ€§èƒ½ç“¶é ¸ï¼Œä¸¦é æ¸¬æœªä¾†å®¹é‡é¢¨éšªã€‚
            </Paragraph>
          </div>
          {/* é ‚éƒ¨æ©«å¹…ï¼šå®è§€ KPI ç‹€æ…‹æ¬„ */}
          <Row gutter={[16, 16]} style={{ marginBottom: 'var(--spacing-lg)' }}>
            {/* ç¸½è³‡æºæ•¸ */}
            <Col xs={24} sm={12} md={6} lg={6}>
              <div
                className="stat-card"
                style={{ height: '120px', cursor: 'pointer' }}
                onClick={() => onNavigate('resource-list')}
              >
                <div className="card-content">
                  <div>
                    <div className="card-title" style={{ fontSize: '14px' }}>ç¸½è³‡æºæ•¸</div>
                    <div className="card-value" style={{ color: 'var(--brand-primary)', fontSize: '32px', fontWeight: '600' }}>
                      374 <span style={{ fontSize: '16px', color: 'var(--text-tertiary)', fontWeight: '400' }}>å€‹</span>
                    </div>
                    <div className="card-description" style={{ fontSize: '12px', color: 'var(--text-tertiary)', marginTop: '4px' }}>
                      ä¸»æ©Ÿ: 350, æœå‹™: 24
                    </div>
                  </div>
                  <HddOutlined className="card-icon" style={{ color: 'var(--brand-primary)', fontSize: '24px' }} />
                </div>
              </div>
            </Col>

            {/* å¥åº·ç‹€æ…‹ */}
            <Col xs={24} sm={12} md={6} lg={6}>
              <div
                className="stat-card"
                style={{ height: '120px', cursor: 'pointer' }}
                onClick={() => onNavigate('resource-list', { statusFilter: 'healthy' })}
              >
                <div className="card-content">
                  <div>
                    <div className="card-title" style={{ fontSize: '14px' }}>å¥åº·ç‹€æ…‹</div>
                    <div className="card-value" style={{ color: 'var(--brand-success)', fontSize: '32px', fontWeight: '600' }}>
                      138 <span style={{ fontSize: '16px', color: 'var(--text-tertiary)', fontWeight: '400' }}>å¥åº·</span>
                    </div>
                    <div className="card-description" style={{ display: 'flex', gap: '12px', fontSize: '12px' }}>
                      <span style={{ color: 'var(--brand-warning)', cursor: 'pointer', textDecoration: 'underline' }}
                        onClick={(e) => { e.stopPropagation(); onNavigate('resource-list', { statusFilter: 'warning' }) }}>
                        143 è­¦å‘Š
                      </span>
                      <span style={{ color: 'var(--brand-danger)', cursor: 'pointer', textDecoration: 'underline' }}
                        onClick={(e) => { e.stopPropagation(); onNavigate('resource-list', { statusFilter: 'critical' }) }}>
                        93 åš´é‡
                      </span>
                    </div>
                  </div>
                  <CheckCircleOutlined className="card-icon" style={{ color: 'var(--brand-success)', fontSize: '24px' }} />
                </div>
              </div>
            </Col>

            {/* ä½œæ¥­ç³»çµ±åˆ†ä½ˆ */}
            <Col xs={24} sm={12} md={6} lg={6}>
              <div
                className="stat-card"
                style={{ height: '120px', cursor: 'pointer' }}
                onClick={() => onNavigate('resource-list')}
              >
                <div className="card-content">
                  <div>
                    <div className="card-title" style={{ fontSize: '14px' }}>ä½œæ¥­ç³»çµ±åˆ†ä½ˆ</div>
                    <div className="card-value" style={{ color: 'var(--text-primary)', fontSize: '32px', fontWeight: '600' }}>
                      350 <span style={{ fontSize: '16px', color: 'var(--text-tertiary)', fontWeight: '400' }}>Linux</span>
                    </div>
                    <div className="card-description">
                      Windows: 24
                    </div>
                  </div>
                  <BuildOutlined className="card-icon" style={{ color: 'var(--brand-info)', fontSize: '24px' }} />
                </div>
              </div>
            </Col>

            {/* éœ€è¦é—œæ³¨ */}
            <Col xs={24} sm={12} md={6} lg={6}>
              <div
                className="stat-card"
                style={{ height: '120px', cursor: 'pointer' }}
                onClick={() => onNavigate('resource-list', { attention: true })}
              >
                <div className="card-content">
                  <div>
                    <div className="card-title" style={{ fontSize: '14px' }}>éœ€è¦é—œæ³¨</div>
                    <div className="card-value" style={{ color: 'var(--brand-warning)', fontSize: '32px', fontWeight: '600' }}>
                      {attentionResources.length} <span style={{ fontSize: '16px', color: 'var(--text-tertiary)', fontWeight: '400' }}>é …</span>
                    </div>
                    <div className="card-description">
                      éœ€ç«‹å³è™•ç†
                    </div>
                  </div>
                  <AlertOutlined className="card-icon" style={{ color: 'var(--brand-warning)', fontSize: '24px' }} />
                </div>
              </div>
            </Col>
          </Row>

          {/* Main Content Area: å·¦å´æ€§èƒ½ç“¶é ¸åˆ†æ + å³å´è¡Œå‹•èˆ‡é¢¨éšªä¸­å¿ƒ */}
          <Row gutter={[16, 16]} style={{ height: 'calc(100vh - 48px - 48px - 140px - 32px)' }}>
            {/* å·¦å´å€å¡Šï¼šæ€§èƒ½ç“¶é ¸åˆ†æ (Top N è³‡æºä½¿ç”¨åˆ—è¡¨) */}
            <Col span={14} style={{ display: 'flex', flexDirection: 'column' }}>
              <div style={{ height: '490px' }}>
                <TopNResourceList themeMode={themeMode} />
              </div>
            </Col>

            {/* å³å´å€å¡Šï¼šè¡Œå‹•èˆ‡é¢¨éšªä¸­å¿ƒ */}
            <Col span={10} style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
              {/* ä¸Šæ–¹ï¼šAI é¢¨éšªé æ¸¬ */}
              <Card
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <RobotOutlined style={{ color: '#722ed1' }} />
                    <span style={{ fontSize: '16px', fontWeight: '600' }}>AI é¢¨éšªé æ¸¬</span>
                    <Badge count={3} style={{ backgroundColor: '#722ed1' }} />
                  </div>
                }
                style={{
                  height: '238px',
                  display: 'flex',
                  flexDirection: 'column',
                  background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%)',
                  border: '1px solid rgba(255, 255, 255, 0.12)',
                  borderRadius: 'var(--radius-lg)',
                  backdropFilter: 'blur(20px) saturate(180%)',
                  WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                  boxShadow: '0 4px 24px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)',
                  transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                  position: 'relative',
                  overflow: 'hidden'
                }}
                bodyStyle={{ flex: 1, padding: '12px', overflow: 'hidden' }}
              >
                <div style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
                  {/* é¢¨éšªè³‡æºåˆ—è¡¨ */}
                  <div style={{ flex: 1, overflow: 'auto' }}>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '6px' }}>
                      {/* é«˜é¢¨éšª - web-prod-01 */}
                      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '3px 6px', background: 'rgba(255, 77, 79, 0.08)', borderRadius: '4px' }}>
                        <div>
                          <Text strong style={{ color: 'var(--text-primary)' }}>web-prod-01</Text>
                          <br />
                          <Text style={{ fontSize: '11px', color: 'var(--text-tertiary)' }}>CPU ä½¿ç”¨ç‡æŒçºŒä¸Šå‡ï¼Œé è¨ˆ 2 å°æ™‚å…§é” 90%</Text>
                        </div>
                        <Tag color="red" size="small">é«˜é¢¨éšª</Tag>
                      </div>

                      {/* é«˜é¢¨éšª - api-gateway-01 */}
                      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '3px 6px', background: 'rgba(255, 77, 79, 0.08)', borderRadius: '4px' }}>
                        <div>
                          <Text strong style={{ color: 'var(--text-primary)' }}>api-gateway-01</Text>
                          <br />
                          <Text style={{ fontSize: '11px', color: 'var(--text-tertiary)' }}>éŸ¿æ‡‰æ™‚é–“ç•°å¸¸æ³¢å‹•ï¼ŒéŒ¯èª¤ç‡ä¸Šå‡è¶¨å‹¢</Text>
                        </div>
                        <Tag color="red" size="small">é«˜é¢¨éšª</Tag>
                      </div>

                      {/* ä¸­é¢¨éšª - db-prod-02 */}
                      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '3px 6px', background: 'rgba(250, 173, 20, 0.08)', borderRadius: '4px' }}>
                        <div>
                          <Text strong style={{ color: 'var(--text-primary)' }}>db-prod-02</Text>
                          <br />
                          <Text style={{ fontSize: '11px', color: 'var(--text-tertiary)' }}>ç£ç¢Ÿç©ºé–“å‰©é¤˜ä¸è¶³ 15%ï¼Œå»ºè­°æ¸…ç†</Text>
                        </div>
                        <Tag color="orange" size="small">ä¸­é¢¨éšª</Tag>
                      </div>
                    </div>
                  </div>
                </div>
              </Card>

              {/* ä¸‹æ–¹ï¼šéœ€é—œæ³¨çš„è³‡æºåˆ—è¡¨ */}
              <Card
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <AlertOutlined style={{ color: '#faad14' }} />
                    <span style={{ fontSize: '16px', fontWeight: '600' }}>éœ€é—œæ³¨çš„è³‡æºåˆ—è¡¨</span>
                    <Badge count={attentionResources.length} style={{ backgroundColor: '#faad14' }} />
                  </div>
                }
                style={{
                  height: '238px',
                  display: 'flex',
                  flexDirection: 'column',
                  background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%)',
                  border: '1px solid rgba(255, 255, 255, 0.12)',
                  borderRadius: 'var(--radius-lg)',
                  backdropFilter: 'blur(20px) saturate(180%)',
                  WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                  boxShadow: '0 4px 24px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)',
                  transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                  position: 'relative',
                  overflow: 'hidden'
                }}
                bodyStyle={{ flex: 1, padding: '12px', overflow: 'hidden' }}
              >
                <div style={{ height: '100%', overflow: 'auto' }}>
                  <Table
                    columns={[
                      {
                        title: 'ç‹€æ…‹',
                        dataIndex: 'status',
                        key: 'status',
                        width: '30%',
                        render: (status) => (
                          <span className={`status-badge status-${status}`}>
                            {status.toUpperCase()}
                          </span>
                        )
                      },
                      {
                        title: 'è³‡æºåç¨±',
                        dataIndex: 'name',
                        key: 'name',
                        width: '45%',
                        render: (text, record) => <a onClick={() => handleAttentionClick(text)}>{text}</a>
                      },
                      {
                        title: 'å‘Šè­¦',
                        dataIndex: 'alarms',
                        key: 'alarms',
                        width: '25%',
                        render: (alarms, record) => {
                          if (!alarms || alarms.length === 0) {
                            return <Text type="secondary">-</Text>;
                          }
                          const highestSeverity = alarms.some(a => a.severity === 'critical') ? 'critical' : 'warning';
                          const color = highestSeverity === 'critical' ? 'red' : 'orange';
                          return (
                            <Tag color={color} onClick={() => onNavigate && onNavigate('incident-list', { resourceFilter: record.name })} style={{ cursor: 'pointer' }}>
                              {alarms.length} å‰‡
                            </Tag>
                          );
                        }
                      }
                    ]}
                    dataSource={attentionResources}
                    pagination={false}
                    size="small"
                    style={{ backgroundColor: 'transparent' }}
                    className="topn-table"
                    scroll={{ y: 'calc(100% - 25px)' }}
                  />
                </div>
              </Card>
            </Col>
          </Row>

        </React.Fragment >
      );
    };

    // æ¥­å‹™å„€è¡¨æ¿é é¢
    const BusinessDashboardPage = ({ themeMode, onNavigate }) => {
      // æ¥­å‹™æ ¸å¿ƒæŒ‡æ¨™
      const businessMetrics = {
        dailyRevenue: 485720,
        dailyTransactions: 24751,
        activeUsers: 8934,
        avgTransactionValue: 196.3,
        conversionRate: 3.2,
        customerSatisfaction: 4.7,
        systemUptime: 99.8,
        avgResponseTime: 145,
        errorRate: 0.02,
        peakConcurrentUsers: 1247
      };

      return (
        <React.Fragment>
          <PageHeader
            title="æ¥­å‹™é‹ç‡Ÿå„€è¡¨æ¿"
            subtitle="å³æ™‚ç›£æ§æ¥­å‹™æ ¸å¿ƒæŒ‡æ¨™ï¼ŒæŒæ¡ç‡Ÿé‹ç‹€æ…‹èˆ‡æœå‹™å“è³ª"
            icon={<DollarOutlined />}
            actions={[
              <Button key="export" icon={<DownloadOutlined />}>
                åŒ¯å‡ºå ±å‘Š
              </Button>,
              <Button key="refresh" icon={<ReloadOutlined />}>
                é‡æ–°æ•´ç†
              </Button>
            ]}
          />

          {/* æ¥­å‹™æ ¸å¿ƒæŒ‡æ¨™ */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="ä»Šæ—¥ç‡Ÿæ”¶"
                  value={`Â¥${(businessMetrics.dailyRevenue / 1000).toFixed(0)}K`}
                  trend="+15.2%"
                  status="success"
                  description="è¼ƒæ˜¨æ—¥åŒæœŸ"
                  icon={<DollarOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="äº¤æ˜“ç¸½é‡"
                  value={businessMetrics.dailyTransactions.toLocaleString()}
                  unit="ç­†"
                  trend="+12.3%"
                  status="success"
                  description="ä»Šæ—¥æˆåŠŸäº¤æ˜“"
                  icon={<FileDoneOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="æ´»èºäººå“¡"
                  value={businessMetrics.activeUsers.toLocaleString()}
                  unit="äºº"
                  trend="+8.7%"
                  status="success"
                  description="éå» 24 å°æ™‚"
                  icon={<TeamOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="è½‰æ›ç‡"
                  value={businessMetrics.conversionRate}
                  unit="%"
                  trend="+0.3%"
                  status="info"
                  description="è¨ªå®¢è‡³ä»˜è²»äººå“¡"
                  icon={<RiseOutlined />}
                />
              </Col>
            </Row>
          </div>

          {/* æœå‹™å“è³ªæŒ‡æ¨™ */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="ç³»çµ±å¯ç”¨æ€§"
                  value={businessMetrics.systemUptime}
                  unit="%"
                  status="success"
                  description="éå» 30 å¤©å¹³å‡"
                  icon={<SafetyCertificateOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="å¹³å‡å›æ‡‰æ™‚é–“"
                  value={businessMetrics.avgResponseTime}
                  unit="ms"
                  status="success"
                  description="API å›æ‡‰æ™‚é–“"
                  icon={<ClockCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="éŒ¯èª¤ç‡"
                  value={businessMetrics.errorRate}
                  unit="%"
                  status="success"
                  description="éå» 24 å°æ™‚"
                  icon={<ExclamationCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="å®¢æˆ¶æ»¿æ„åº¦"
                  value={businessMetrics.customerSatisfaction}
                  unit="/5.0"
                  status="success"
                  description="æœ¬æœˆå¹³å‡è©•åˆ†"
                  icon={<CheckCircleOutlined />}
                />
              </Col>
            </Row>
          </div>

          {/* æ¥­å‹™è¶¨å‹¢èˆ‡æ´å¯Ÿ */}
          <Row gutter={[24, 24]} style={{ marginBottom: 'var(--spacing-xl)' }}>
            {/* æ”¶å…¥è¶¨å‹¢åœ– */}
            <Col xs={24} lg={16}>
              <Card
                className="dashboard-card"
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <LineChartOutlined style={{ color: '#1890ff' }} />
                    <span>æ”¶å…¥è¶¨å‹¢</span>
                  </div>
                }
                extra={
                  <Select defaultValue="7d" size="small">
                    <Select.Option value="24h">24 å°æ™‚</Select.Option>
                    <Select.Option value="7d">7 å¤©</Select.Option>
                    <Select.Option value="30d">30 å¤©</Select.Option>
                  </Select>
                }
                bodyStyle={{ padding: '20px' }}
              >
                <div style={{ height: '300px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                  <div style={{ textAlign: 'center', color: 'rgba(255, 255, 255, 0.6)' }}>
                    <LineChartOutlined style={{ fontSize: '48px', marginBottom: '16px' }} />
                    <div>æ”¶å…¥è¶¨å‹¢åœ–è¡¨å€åŸŸ</div>
                    <div style={{ fontSize: '14px', marginTop: '8px' }}>
                      éå» 7 å¤©å¹³å‡æ—¥æ”¶å…¥: Â¥{(businessMetrics.dailyRevenue * 0.85 / 1000).toFixed(0)}K
                    </div>
                  </div>
                </div>
              </Card>
            </Col>

            {/* æ¥­å‹™æ´å¯Ÿèˆ‡å¿«é€Ÿè¡Œå‹• */}
            <Col xs={24} lg={8}>
              <Card
                className="dashboard-card"
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <BulbOutlined style={{ color: '#faad14' }} />
                    <span>æ¥­å‹™æ´å¯Ÿ</span>
                  </div>
                }
                bodyStyle={{ padding: '16px' }}
              >
                <div style={{ marginBottom: '20px' }}>
                  <Alert
                    message="äº¤æ˜“é‡å‰µæ–°é«˜"
                    description="ä»Šæ—¥äº¤æ˜“é‡è¼ƒæ˜¨æ—¥å¢é•· 12.3%ï¼Œå»ºè­°é—œæ³¨ç³»çµ±è² è¼‰"
                    type="success"
                    showIcon
                    style={{ marginBottom: '12px' }}
                  />
                  <Alert
                    message="äººå“¡æ´»èºåº¦ä¸Šå‡"
                    description="æ´»èºäººå“¡æ•¸è¼ƒä¸Šé€±åŒæœŸå¢é•· 8.7%"
                    type="info"
                    showIcon
                  />
                </div>

                <Space direction="vertical" style={{ width: '100%' }} size="small">
                  <Button block icon={<BarChartOutlined />} onClick={() => onNavigate('analytics')}>
                    æŸ¥çœ‹è©³ç´°åˆ†æ
                  </Button>
                  <Button block icon={<AlertOutlined />} onClick={() => onNavigate('incident-list')}>
                    ç³»çµ±å¥åº·æª¢æŸ¥
                  </Button>
                  <Button block icon={<SettingOutlined />} onClick={() => onNavigate('automation-center')}>
                    å„ªåŒ–è‡ªå‹•åŒ–æµç¨‹
                  </Button>
                </Space>
              </Card>
            </Col>
          </Row>
        </React.Fragment>
      );
    };



    // âš¡ æ€§èƒ½å„ªåŒ–ï¼šä½¿ç”¨ React.memo åŒ…è£çµ„ä»¶ä¸¦æ·»åŠ  useCallback
    const ResourceListPage = React.memo(({ pageParams, themeMode, onNavigate }) => {
      const [viewMode, setViewMode] = useState('list'); // é è¨­æ”¹ç‚º list
      const [isScanModalOpen, setIsScanModalOpen] = useState(false);

      // æƒæç¶²è·¯Modalçš„è™•ç†å‡½æ•¸ - ä½¿ç”¨ useCallback å„ªåŒ–
      const handleOpenScanModal = useCallback(() => {
        setIsScanModalOpen(true);
      }, []);

      // æ¸¬è©¦è³‡æºè¦å‰‡çš„è™•ç†å‡½æ•¸ - ä½¿ç”¨ useCallback å„ªåŒ–
      const handleTestRule = useCallback((record) => {
        message.loading({ content: `æ­£åœ¨æ¸¬è©¦è³‡æº "${record.name}"...`, key: 'test_resource' });
        // Simulate API call
        setTimeout(() => {
          const success = Math.random() > 0.3; // 70% success rate
          if (success) {
            message.success({ content: 'æ¸¬è©¦æˆåŠŸï¼šè³‡æºé€£æ¥æ­£å¸¸ã€‚', key: 'test_resource' });
          } else {
            message.error({ content: 'æ¸¬è©¦å¤±æ•—ï¼šç„¡æ³•é€£æ¥è³‡æºï¼Œè«‹æª¢æŸ¥ç¶²è·¯è¨­å®šã€‚', key: 'test_resource' });
          }
        }, 1500);
      }, []);

      // ç¯©é¸ç‹€æ…‹
      const [filterStatus, setFilterStatus] = useState([]);
      const [filterType, setFilterType] = useState([]);
      const [filterResourceName, setFilterResourceName] = useState('');
      const [isFilterOpen, setIsFilterOpen] = useState(false);

      // ç¯©é¸æ‡‰ç”¨å‡½æ•¸ - ä½¿ç”¨ useCallback å„ªåŒ–
      const applyFilters = useCallback(() => {
        setIsFilterOpen(false);
        // ç¯©é¸é‚è¼¯æœƒåœ¨æ¸²æŸ“æ™‚æ‡‰ç”¨
      }, []);

      // é‡ç½®ç¯©é¸ - ä½¿ç”¨ useCallback å„ªåŒ–
      const resetFilters = useCallback(() => {
        setFilterStatus([]);
        setFilterType([]);
        setFilterResourceName('');
        setIsFilterOpen(false);
      }, []);

      // ç¯©é¸çµ„ä»¶
      const ResourceFilterPopover = () => (
        <div style={{ width: 300, padding: '16px' }}>
          <div style={{ marginBottom: '16px' }}>
            <div style={{ marginBottom: '8px', fontWeight: 500 }}>ç‹€æ…‹</div>
            <Select
              mode="multiple"
              placeholder="é¸æ“‡ç‹€æ…‹"
              value={filterStatus}
              onChange={setFilterStatus}
              style={{ width: '100%' }}
              options={[
                { value: 'healthy', label: 'Healthy' },
                { value: 'warning', label: 'Warning' },
                { value: 'critical', label: 'Critical' }
              ]}
            />
          </div>
          <div style={{ marginBottom: '16px' }}>
            <div style={{ marginBottom: '8px', fontWeight: 500 }}>é¡å‹</div>
            <Select
              mode="multiple"
              placeholder="é¸æ“‡é¡å‹"
              value={filterType}
              onChange={setFilterType}
              style={{ width: '100%' }}
              options={[
                { value: 'database', label: 'Database' },
                { value: 'server', label: 'Server' },
                { value: 'gateway', label: 'Gateway' },
                { value: 'cache', label: 'Cache' }
              ]}
            />
          </div>
          <div style={{ marginBottom: '16px' }}>
            <div style={{ marginBottom: '8px', fontWeight: 500 }}>è³‡æºåç¨±</div>
            <Input
              placeholder="è¼¸å…¥è³‡æºåç¨±"
              value={filterResourceName}
              onChange={e => setFilterResourceName(e.target.value)}
            />
          </div>
          <div style={{ display: 'flex', justifyContent: 'space-between', gap: '8px' }}>
            <Button onClick={resetFilters} style={{ flex: 1 }}>é‡ç½®</Button>
            <Button type="primary" onClick={applyFilters} style={{ flex: 1 }}>æ‡‰ç”¨</Button>
          </div>
        </div>
      );

      // AttentionRequiredList å·²ç§»è‡³ ResourceOverviewPage
      // const AttentionRequiredList = ...

      const mockGroups = [
        { id: 'g_1', name: 'Production Database' },
        { id: 'g_2', name: 'Production Web Servers' },
        { id: 'g_3', name: 'Staging Environment' },
      ];

      // è³‡æºç¾¤çµ„æ•¸æ“šï¼ˆèˆ‡ ResourceGroupsPage ä¿æŒä¸€è‡´ï¼‰
      const groups = [
        { key: 'g_1', name: 'Production Database', description: 'æ‰€æœ‰ç”Ÿç”¢ç’°å¢ƒçš„è³‡æ–™åº«', responsibleTeam: 'team_1', members: ['host_1'] },
        { key: 'g_2', name: 'Production Web Servers', description: 'æ‰€æœ‰ç”Ÿç”¢ç’°å¢ƒçš„ Web ä¼ºæœå™¨', responsibleTeam: 'team_2', members: ['host_2'] },
        { key: 'g_3', name: 'Staging Environment', description: 'æ¸¬è©¦ç’°å¢ƒæ‰€æœ‰è³‡æº', responsibleTeam: 'team_3', members: ['host_3', 'host_4'] },
      ];

      // åœ˜éšŠæ•¸æ“š
      const teams = [
        { key: 'team_1', name: 'è³‡æ–™åº«åœ˜éšŠ' },
        { key: 'team_2', name: 'Web é–‹ç™¼åœ˜éšŠ' },
        { key: 'team_3', name: 'æ¸¬è©¦åœ˜éšŠ' },
      ];
      // ç”Ÿæˆè¶¨å‹¢æ•¸æ“š
      const generateTrend = () => {
        const baseValue = 55;
        const trendDirection = Math.random() > 0.5 ? 1 : -1;
        const volatility = 25;
        let currentValue = baseValue;
        const trend = [];
        for (let i = 0; i < 12; i++) {
          const trendInfluence = trendDirection * (i / 12) * 15;
          const randomChange = (Math.random() - 0.5) * volatility;
          const periodicChange = Math.sin(i * Math.PI / 6) * 8;
          currentValue = Math.max(8, Math.min(98, baseValue + trendInfluence + randomChange + periodicChange));
          if (i > 0) {
            const prevValue = trend[i - 1];
            currentValue = prevValue * 0.6 + currentValue * 0.4;
          }
          trend.push(Math.round(currentValue));
        }
        return trend;
      };

      const initialData = [
        // è¨»ï¼šæ­¤ç‚ºæ¨¡æ“¬æ•¸æ“šï¼Œæ–°å¢ location, cpu_usage, memory_usage ç­‰æ¬„ä½ä»¥ç¬¦åˆæ›´æ–°å¾Œçš„ schema
        { key: 'host_1', name: 'db-prod-01', type: 'database', status: 'healthy', ip_address: '10.0.0.10', location: 'us-east-1', groups: ['g_1'], tags: ['production', 'database', 'high-priority'], cpu_usage: 45.5, memory_usage: 60.2, trend: generateTrend(), alarms: [] },
        { key: 'host_2', name: 'web-prod-02', type: 'server', status: 'warning', ip_address: '10.0.0.21', location: 'us-west-2', groups: ['g_2'], tags: ['production', 'web-server'], cpu_usage: 88.1, memory_usage: 75.0, trend: generateTrend(), alarms: [{ severity: 'warning', summary: 'Disk space is over 85%' }] },
        { key: 'host_3', name: 'api-gateway-prod', type: 'gateway', status: 'critical', ip_address: '10.0.0.35', location: 'eu-central-1', groups: [], tags: ['production', 'high-priority'], cpu_usage: 92.3, memory_usage: 50.8, trend: generateTrend(), alarms: [{ severity: 'critical', summary: 'API latency > 2s' }, { severity: 'warning', summary: '5xx error rate > 5%' }] },
        { key: 'host_4', name: 'cache-redis-prod', type: 'cache', status: 'healthy', ip_address: '10.0.0.40', location: 'ap-northeast-1', groups: ['g_1', 'g_2'], tags: ['production', 'database'], cpu_usage: 25.0, memory_usage: 35.5, trend: generateTrend(), alarms: [] },
      ];

      const [resources, setResources] = useLocalStorageState('sre-resources-v3', initialData);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingResource, setEditingResource] = useState(null);
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [highlightedResource, setHighlightedResource] = useState('');
      const [isAddToGroupModalOpen, setIsAddToGroupModalOpen] = useState(false);
      const [selectedGroupId, setSelectedGroupId] = useState(null);
      const [scanIpRange, setScanIpRange] = useState('');
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // Column settings state
      const defaultVisibleColumns = {
        status: true,
        name: true,
        ip_address: true,
        location: true,
        team: true,
        type: true,
        tags: true,
        alarms: true,
        cpu_usage: true,
        memory_usage: true,
        usage: false,
        trend: true,
        action: true
      };
      const [visibleColumns, setVisibleColumns] = useLocalStorageState('sre-resource-columns', defaultVisibleColumns);
      const [isColumnSettingsOpen, setIsColumnSettingsOpen] = useState(false);

      // ç•¶æœå°‹æ–‡å­—æ”¹è®Šæ™‚æ¸…é™¤é«˜äº®ç‹€æ…‹
      useEffect(() => {
        if (searchText && highlightedResource) {
          // å¦‚æœæœå°‹æ–‡å­—ä¸åŒ…å«é«˜äº®è³‡æºåï¼Œå‰‡æ¸…é™¤é«˜äº®
          const lowerSearch = searchText.toLowerCase();
          const lowerHighlight = highlightedResource.toLowerCase();
          if (!lowerHighlight.includes(lowerSearch) && !lowerSearch.includes(lowerHighlight)) {
            setHighlightedResource('');
          }
        }
      }, [searchText, highlightedResource]);

      const showModal = (resource = null) => {
        setEditingResource(resource);
        form.setFieldsValue(resource || { name: '', ip_address: '', type: 'server', groups: [], tags: [] });
        setIsModalOpen(true);
      };
      const handleCancel = () => { setIsModalOpen(false); setEditingResource(null); form.resetFields(); };
      const onFinish = (values) => {
        const status = editingResource ? editingResource.status : 'healthy';
        if (editingResource) {
          setResources(resources.map(res => res.key === editingResource.key ? { ...res, ...values, status } : res));
          message.success('è³‡æºæ›´æ–°æˆåŠŸ');
        } else {
          const newResource = { ...values, key: `r_${Date.now()}`, status: 'unknown', trend: generateTrend() };
          setResources([newResource, ...resources]);
          message.success('è³‡æºæ–°å¢æˆåŠŸ');
        }
        handleCancel();
      };
      const handleDelete = (key) => {
        confirmDelete('è³‡æº', () => {
          setResources(resources.filter(res => res.key !== key));
        });
      };

      const onSelectChange = (newSelectedRowKeys) => {
        setSelectedRowKeys(newSelectedRowKeys);
      };

      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      const handleBatchDelete = () => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} å€‹è³‡æºå—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setResources(resources.filter(res => !selectedRowKeys.includes(res.key)));
            setSelectedRowKeys([]);
            message.success('æ‰¹æ¬¡åˆªé™¤æˆåŠŸ');
          }
        });
      };

      // ç¢ºèªæ‰¹æ¬¡åŠ å…¥ç¾¤çµ„çš„è™•ç†å‡½æ•¸
      const handleConfirmAddToGroup = () => {
        if (!selectedGroupId) {
          message.error('è«‹é¸æ“‡ä¸€å€‹è³‡æºç¾¤çµ„');
          return;
        }

        const updatedResources = resources.map(res => {
          if (selectedRowKeys.includes(res.key)) {
            const currentGroups = res.groups || [];
            const newGroups = [...new Set([...currentGroups, selectedGroupId])];
            return { ...res, groups: newGroups };
          }
          return res;
        });

        setResources(updatedResources);
        message.success(`${selectedRowKeys.length} å€‹è³‡æºå·²æˆåŠŸåŠ å…¥ç¾¤çµ„`);
        setIsAddToGroupModalOpen(false);
        setSelectedRowKeys([]);
        setSelectedGroupId(null);
      };

      const createSparklineOption = (trendData) => ({
        backgroundColor: 'transparent',
        grid: { top: 4, bottom: 4, left: 2, right: 2 },
        xAxis: { type: 'category', show: false, data: (trendData || []).map((_, i) => i) },
        yAxis: { type: 'value', show: false, min: 'dataMin', max: 'dataMax' },
        series: [{
          data: trendData || [],
          type: 'line',
          smooth: true,
          showSymbol: false,
          lineStyle: { width: 2, color: '#6395f9' },
          areaStyle: {
            color: {
              type: 'linear', x: 0, y: 0, x2: 0, y2: 1,
              colorStops: [{ offset: 0, color: '#6395f94D' }, { offset: 1, color: '#6395f91A' }]
            }
          }
        }]
      });

      // Define all possible columns
      const allColumns = {
        status: {
          title: 'è³‡æºç‹€æ…‹',
          dataIndex: 'status',
          width: '8%',
          sorter: (a, b) => (a.status || '').localeCompare(b.status || ''),
          render: (status) => {
            const statusLabels = {
              healthy: 'æ­£å¸¸',
              warning: 'è­¦å‘Š',
              critical: 'åš´é‡',
              unknown: 'æœªçŸ¥'
            };
            return (
              <span className={`status-badge status-${status}`}>
                {statusLabels[status] || 'æœªçŸ¥'}
              </span>
            );
          }
        },
        name: {
          title: 'è³‡æºåç¨±',
          dataIndex: 'name',
          width: '18%',
          sorter: (a, b) => a.name.localeCompare(b.name),
          render: (name, record) => {
            // æ¨¡æ“¬é‹è¡Œæ™‚é–“æ•¸æ“š
            const uptimeMap = {
              'db-prod-01': '45å¤©', 'web-prod-02': '22å¤©', 'api-gateway-prod': '8å¤©', 'cache-redis-prod': '12å¤©',
              'host_1': '15å¤©', 'host_2': '32å¤©', 'host_3': '7å¤©', 'host_4': '28å¤©'
            };
            const uptime = uptimeMap[name] || `${Math.floor(Math.random() * 50 + 1)}å¤©`;

            return (
              <div>
                <div style={{
                  fontWeight: 500,
                  marginBottom: '2px',
                  color: 'var(--text-primary)'
                }}>
                  {name || '-'}
                </div>
                <div style={{
                  fontSize: '11px',
                  color: 'rgba(255, 255, 255, 0.5)'
                }}>
                  é‹è¡Œ {uptime}
                </div>
              </div>
            );
          }
        },
        ip_address: {
          title: 'IPä½å€',
          dataIndex: 'ip_address',
          width: '14%',
          sorter: (a, b) => a.ip_address.localeCompare(b.ip_address)
        },
        location: {
          title: 'ä½ç½®',
          dataIndex: 'location',
          width: '12%',
          sorter: (a, b) => (a.location || '').localeCompare(b.location || ''),
          render: (location, record) => {
            // æ¨¡æ“¬ä½ç½®æ•¸æ“š
            const locationMap = {
              'db-prod-01': 'us-east-1', 'web-prod-02': 'us-west-1', 'api-gateway-prod': 'us-west-2', 'cache-redis-prod': 'us-west-1',
              'host_1': 'us-west-1', 'host_2': 'us-west-2', 'host_3': 'us-east-1', 'host_4': 'us-central-1'
            };
            const resourceLocation = locationMap[record.name] || 'us-west-1';

            return (
              <span style={{
                fontSize: '12px',
                fontWeight: '500',
                color: 'var(--text-secondary)'
              }}>
                {resourceLocation}
              </span>
            );
          }
        },
        team: {
          title: 'æ‰€å±¬åœ˜éšŠ',
          key: 'team',
          width: '12%',
          render: (_, record) => {
            const group = groups.find(g => g.members && g.members.includes(record.key));
            if (group && group.responsibleTeam) {
              const team = teams.find(t => t.key === group.responsibleTeam);
              return team ? team.name : '-';
            }
            return '-';
          }
        },
        type: {
          title: 'è³‡æºé¡å‹',
          dataIndex: 'type',
          width: '10%',
          sorter: (a, b) => (a.type || '').localeCompare(b.type || ''),
          render: (type) => {
            const typeConfig = {
              server: { label: 'ä¼ºæœå™¨', color: 'blue' },
              database: { label: 'è³‡æ–™åº«', color: 'green' },
              gateway: { label: 'é–˜é“', color: 'purple' },
              cache: { label: 'å¿«å–', color: 'orange' },
              container: { label: 'å®¹å™¨', color: 'purple' },
              service: { label: 'æœå‹™', color: 'orange' }
            };

            const config = typeConfig[type] || { label: type || '-', color: 'default' };

            return (
              <Tag
                color={config.color}
                style={{ fontSize: '10px', fontWeight: '500' }}
              >
                {config.label}
              </Tag>
            );
          }
        },
        tags: {
          title: 'æ¨™ç±¤',
          dataIndex: 'tags',
          key: 'tags',
          width: '17%',
          render: (tags) => (
            <Space size={[4, 4]} wrap>
              {tags && (
                Array.isArray(tags) && tags.length > 0 ? tags.map(tag => {
                  const tagColorMap = {
                    'production': 'red',
                    'staging': 'orange',
                    'database': 'blue',
                    'web-server': 'green',
                    'high-priority': 'red',
                    'team-alpha': 'purple'
                  };
                  return <Tag key={tag} color={tagColorMap[tag] || 'default'} size="small">{tag}</Tag>;
                }) : !Array.isArray(tags) && Object.keys(tags).length > 0 ? Object.entries(tags).map(([key, value]) => {
                  const tagColorMap = {
                    'production': 'red',
                    'staging': 'orange',
                    'database': 'blue',
                    'web-server': 'green',
                    'high-priority': 'red',
                    'team-alpha': 'purple'
                  };
                  return <Tag key={key} color={tagColorMap[key] || 'default'} size="small">{key}:{value}</Tag>;
                }) : <span style={{ color: 'var(--text-secondary)' }}>ç„¡æ¨™ç±¤</span>
              )}
            </Space>
          )
        },
        alarms: {
          title: 'é—œè¯äº‹ä»¶',
          dataIndex: 'alarms',
          width: '10%',
          render: (alarms, record) => {
            if (!alarms || alarms.length === 0) {
              return <Text type="secondary">-</Text>;
            }

            const highestSeverity = alarms.some(a => a.severity === 'critical') ? 'critical' : 'warning';
            const color = highestSeverity === 'critical' ? 'red' : 'orange';
            const icon = highestSeverity === 'critical' ? 'ğŸš¨' : 'âš ï¸';

            const content = (
              <List
                size="small"
                dataSource={alarms}
                renderItem={item => <List.Item>{item.summary}</List.Item>}
              />
            );

            return (
              <Popover content={content} title="æ´»èºäº‹ä»¶" trigger="hover">
                <Tag
                  color={color}
                  onClick={() => onNavigate && onNavigate('incident-list', { resourceFilter: record.name })}
                  style={{ cursor: 'pointer' }}
                >
                  {icon} {alarms.length}
                </Tag>
              </Popover>
            );
          }
        },
        cpu_usage: {
          title: 'CPU ä½¿ç”¨ç‡',
          dataIndex: 'cpu_usage',
          width: '12%',
          render: (cpu_usage, record) => {
            // æ¨¡æ“¬ CPU ä½¿ç”¨ç‡æ•¸æ“š
            const cpuUsageMap = {
              'db-prod-01': 85, 'web-prod-02': 73, 'api-gateway-prod': 91, 'cache-redis-prod': 45,
              'host_1': 65, 'host_2': 78, 'host_3': 92, 'host_4': 34
            };
            const resourceCpuUsage = cpuUsageMap[record.name] || Math.floor(Math.random() * 100);

            return (
              <InlineProgressCell
                value={resourceCpuUsage}
                max={100}
                unit="%"
                status={resourceCpuUsage >= 90 ? 'critical' : resourceCpuUsage >= 80 ? 'warning' : 'normal'}
                size="small"
                animated={true}
                showTooltip={true}
                formatValue={(val) => `${val}%`}
              />
            );
          }
        },
        memory_usage: {
          title: 'è¨˜æ†¶é«”ä½¿ç”¨ç‡',
          dataIndex: 'memory_usage',
          width: '12%',
          render: (memory_usage, record) => {
            // æ¨¡æ“¬è¨˜æ†¶é«”ä½¿ç”¨ç‡æ•¸æ“š
            const memoryUsageMap = {
              'db-prod-01': 78, 'web-prod-02': 82, 'api-gateway-prod': 67, 'cache-redis-prod': 52,
              'host_1': 71, 'host_2': 89, 'host_3': 94, 'host_4': 43
            };
            const resourceMemoryUsage = memoryUsageMap[record.name] || Math.floor(Math.random() * 100);

            return (
              <InlineProgressCell
                value={resourceMemoryUsage}
                max={100}
                unit="%"
                status={resourceMemoryUsage >= 90 ? 'critical' : resourceMemoryUsage >= 80 ? 'warning' : 'normal'}
                size="small"
                animated={true}
                showTooltip={true}
                formatValue={(val) => `${val}%`}
              />
            );
          }
        },
        usage: {
          title: 'ä½¿ç”¨ç‡',
          dataIndex: 'usage',
          width: '12%',
          render: (usage, record) => {
            // å¾ ResourceOverviewTab çš„æ•¸æ“šæ¨¡æ“¬ä½¿ç”¨ç‡
            const usageMap = {
              'web-prod-1': 95, 'web-prod-2': 93, 'web-prod-3': 91, 'web-prod-4': 89, 'web-prod-5': 87,
              'db-prod-1': 85, 'api-gateway-1': 83, 'cache-redis-1': 81
            };
            const resourceUsage = usageMap[record.name] || 65; // é»˜èªå€¼

            return (
              <InlineProgressCell
                value={resourceUsage}
                max={100}
                unit="%"
                status={resourceUsage >= 90 ? 'critical' : resourceUsage >= 80 ? 'warning' : 'normal'}
                size="small"
                animated={true}
                showTooltip={true}
                formatValue={(val) => `${val}%`}
              />
            );
          }
        },
        trend: {
          title: 'è¶¨å‹¢',
          dataIndex: 'trend',
          width: '8%',
          render: (trend, record) => {
            // å¾ ResourceOverviewTab çš„æ•¸æ“šæ¨¡æ“¬è¶¨å‹¢
            const trendMap = {
              'web-prod-1': 'up', 'web-prod-2': 'up', 'web-prod-3': 'stable', 'web-prod-4': 'down', 'web-prod-5': 'down',
              'db-prod-1': 'stable', 'api-gateway-1': 'up', 'cache-redis-1': 'down'
            };
            const resourceTrend = trendMap[record.name] || 'stable';

            return (
              <div style={{ textAlign: 'center' }}>
                {resourceTrend === 'up' ? (
                  <ArrowUpOutlined style={{ color: '#ff4d4f' }} />
                ) : resourceTrend === 'down' ? (
                  <ArrowDownOutlined style={{ color: '#52c41a' }} />
                ) : (
                  <MinusOutlined style={{ color: '#faad14' }} />
                )}
              </div>
            );
          }
        },
        action: {
          title: 'æ“ä½œ',
          key: 'action',
          width: '10%',
          align: 'center',
          render: (_, record) => (
            <div style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              gap: '4px'
            }}>
              {/* æŸ¥çœ‹è©³æƒ… */}
              <Button
                type="text"
                size="small"
                style={{
                  width: '28px',
                  height: '28px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  color: 'rgba(255, 255, 255, 0.65)',
                  border: 'none'
                }}
                icon={<EyeOutlined />}
                onClick={() => onNavigate && onNavigate('resource-details', { resourceId: record.key })}
                onMouseEnter={(e) => {
                  e.target.style.color = 'rgba(255, 255, 255, 0.9)';
                  e.target.style.backgroundColor = 'rgba(255, 255, 255, 0.08)';
                }}
                onMouseLeave={(e) => {
                  e.target.style.color = 'rgba(255, 255, 255, 0.65)';
                  e.target.style.backgroundColor = 'transparent';
                }}
              />

              {/* ç·¨è¼¯é…ç½® */}
              <Button
                type="text"
                size="small"
                style={{
                  width: '28px',
                  height: '28px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  color: 'rgba(255, 255, 255, 0.65)',
                  border: 'none'
                }}
                icon={<EditOutlined />}
                onClick={() => showModal(record)}
                onMouseEnter={(e) => {
                  e.target.style.color = 'rgba(255, 255, 255, 0.9)';
                  e.target.style.backgroundColor = 'rgba(255, 255, 255, 0.08)';
                }}
                onMouseLeave={(e) => {
                  e.target.style.color = 'rgba(255, 255, 255, 0.65)';
                  e.target.style.backgroundColor = 'transparent';
                }}
              />

              {/* é‡æ–°è¼‰å…¥ */}
              <Button
                type="text"
                size="small"
                style={{
                  width: '28px',
                  height: '28px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  color: 'rgba(255, 255, 255, 0.65)',
                  border: 'none'
                }}
                icon={<ReloadOutlined />}
                onClick={() => {
                  message.success('é‡æ–°è¼‰å…¥è³‡æºç‹€æ…‹');
                  // é€™è£¡å¯ä»¥åŠ å…¥å¯¦éš›çš„é‡æ–°è¼‰å…¥é‚è¼¯
                }}
                onMouseEnter={(e) => {
                  e.target.style.color = 'rgba(255, 255, 255, 0.9)';
                  e.target.style.backgroundColor = 'rgba(255, 255, 255, 0.08)';
                }}
                onMouseLeave={(e) => {
                  e.target.style.color = 'rgba(255, 255, 255, 0.65)';
                  e.target.style.backgroundColor = 'transparent';
                }}
              />
            </div>
          )
        }
      };

      // Generate dynamic columns based on visible settings
      const columns = Object.keys(allColumns)
        .filter(key => visibleColumns[key])
        .map(key => allColumns[key]);
      // æ‡‰ç”¨é ç¯©é¸å’Œæœå°‹ç¯©é¸
      let filteredResources = resources;

      // é ç¯©é¸é‚è¼¯ (å¾ç¸½è¦½é é¢ä¸‹é‘½éä¾†)
      if (pageParams && pageParams.statusFilter) {
        filteredResources = filteredResources.filter(res => res.status === pageParams.statusFilter);
      }
      if (pageParams && pageParams.attention) {
        filteredResources = filteredResources.filter(res => res.status === 'warning' || res.status === 'critical');
      }

      // æœå°‹ç¯©é¸é‚è¼¯ï¼ˆåŒ…å«æ¨™ç±¤æœå°‹ï¼‰
      if (searchText) {
        filteredResources = filteredResources.filter(res =>
          res.name.toLowerCase().includes(searchText.toLowerCase()) ||
          res.ip_address.toLowerCase().includes(searchText.toLowerCase()) ||
          (res.tags && (
            Array.isArray(res.tags) ?
              res.tags.some(tag => tag.toLowerCase().includes(searchText.toLowerCase())) :
              Object.keys(res.tags).some(key => key.toLowerCase().includes(searchText.toLowerCase()) || res.tags[key].toLowerCase().includes(searchText.toLowerCase()))
          ))
        );
      }

      // é€²éšç¯©é¸é‚è¼¯
      if (filterStatus.length > 0) {
        filteredResources = filteredResources.filter(res => filterStatus.includes(res.status));
      }
      if (filterType.length > 0) {
        filteredResources = filteredResources.filter(res => filterType.includes(res.type));
      }
      if (filterResourceName) {
        filteredResources = filteredResources.filter(res =>
          res.name.toLowerCase().includes(filterResourceName.toLowerCase())
        );
      }

      // çµ±è¨ˆè³‡æ–™
      const stats = {
        total: resources.length,
        healthy: resources.filter(r => r.status === 'healthy').length,
        warning: resources.filter(r => r.status === 'warning').length,
        critical: resources.filter(r => r.status === 'critical').length,
        unknown: resources.filter(r => r.status === 'unknown').length
      };

      const ResourceOverviewKPIs = ({ themeMode }) => {
        const kpiData = {
          total: 374,
          health: { healthy: 138, warning: 143, critical: 93 },
          os: { linux: 350, windows: 24 }
        };

        const healthChartOption = {
          tooltip: { trigger: 'item' },
          series: [
            {
              name: 'Health Status',
              type: 'pie',
              radius: ['60%', '80%'],
              avoidLabelOverlap: false,
              label: { show: false },
              emphasis: {
                label: { show: false }
              },
              labelLine: { show: false },
              data: [
                { value: kpiData.health.healthy, name: 'Healthy', itemStyle: { color: '#52c41a' } },
                { value: kpiData.health.warning, name: 'Warning', itemStyle: { color: '#faad14' } },
                { value: kpiData.health.critical, name: 'Critical', itemStyle: { color: '#ff4d4f' } }
              ]
            }
          ]
        };

        const StatBox = ({ children, style }) => (
          <div style={{
            background: 'rgba(255,255,255,0.03)',
            border: '1px solid rgba(255,255,255,0.08)',
            borderRadius: '8px',
            padding: '16px',
            height: '100%',
            ...style
          }}>
            {children}
          </div>
        );

        return (
          // è¨»è§£ï¼šå¡ç‰‡å…ƒä»¶ï¼Œç”¨æ–¼é¡¯ç¤ºè³‡æºç¸½è¦½
          <Card title="è³‡æºç¸½è¦½" style={{ flex: 1, display: 'flex', flexDirection: 'column' }} bodyStyle={{ flex: 1, display: 'flex', alignItems: 'stretch' }}>
            <Row gutter={[16, 16]} style={{ width: '100%' }}>
              <Col span={12}>
                <StatBox>
                  <Statistic title="ç¸½è³‡æºæ•¸" value={kpiData.total} prefix={<HddOutlined />} />
                </StatBox>
              </Col>
              <Col span={12}>
                <StatBox>
                  <Statistic title="ä½œæ¥­ç³»çµ±åˆ†ä½ˆ" value={kpiData.os.linux} suffix="Linux" />
                  <div style={{ fontSize: '12px', color: 'var(--text-tertiary)', marginTop: '4px' }}>
                    Windows: {kpiData.os.windows}
                  </div>
                </StatBox>
              </Col>
              <Col span={24}>
                <StatBox style={{ display: 'flex', alignItems: 'center' }}>
                  <div style={{ flex: 1 }}>
                    <Statistic title="å¥åº·ç‹€æ…‹" value={kpiData.health.healthy} suffix="å¥åº·" />
                    <div style={{ fontSize: '12px', color: 'var(--text-tertiary)', marginTop: '4px' }}>
                      <span style={{ color: '#faad14' }}>{kpiData.health.warning} è­¦å‘Š</span>, <span style={{ color: '#ff4d4f' }}>{kpiData.health.critical} åš´é‡</span>
                    </div>
                  </div>
                  <div style={{ width: '50px', height: '50px', flexShrink: 0 }}>
                    <EchartsForReact option={healthChartOption} isDark={themeMode === 'dark'} />
                  </div>
                </StatBox>
              </Col>
            </Row>
          </Card>
        );
      };

      // DashboardView é‡æ–°è¨­è¨ˆ - æ‰å¹³åŒ–è³‡è¨Šå¡ç‰‡
      const ListView = () => (
        <div className="table-wrapper" style={{ marginTop: 0 }}>
          {resources.length > 0 ? (
            <Table
              rowSelection={rowSelection}
              columns={columns}
              dataSource={filteredResources}
              rowKey="key"
              className="transparent-bg"
              rowClassName={(record) => record.name === highlightedResource ? 'highlighted-row' : ''}
              size="small"
            />
          ) : (
            <Empty description="å°šç„¡ä»»ä½•è³‡æº">
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>ç«‹å³æ–°å¢è³‡æº</Button>
            </Empty>
          )}
        </div>
      );

      return (
        <React.Fragment>

          {/* ä¸»å…§å®¹å€æ¢ä»¶æ¸²æŸ“ */}
          {viewMode === 'dashboard' ? <DashboardView /> : (
            <React.Fragment>
              {/* å·¥å…·åˆ— - åƒè€ƒè³‡æºç¾¤çµ„ä½ˆå±€ */}
              <Space style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: 'var(--spacing-lg)',
                width: '100%'
              }}>
                <Space>
                  <Input.Search
                    placeholder="æœå°‹è³‡æºåç¨±ã€IP æˆ–æ¨™ç±¤..."
                    value={searchText}
                    onChange={e => setSearchText(e.target.value)}
                    style={{ width: 300 }}
                    allowClear
                  />
                  <Popover
                    content={<ResourceFilterPopover />}
                    title="ç¯©é¸æ¢ä»¶"
                    trigger="click"
                    open={isFilterOpen}
                    onOpenChange={setIsFilterOpen}
                    placement="bottomLeft"
                    overlayStyle={{
                      backgroundColor: 'rgba(0, 0, 0, 0.8)',
                      backdropFilter: 'blur(8px)',
                      border: '1px solid rgba(255, 255, 255, 0.1)',
                      borderRadius: '8px',
                      boxShadow: '0 8px 32px rgba(0, 0, 0, 0.6)'
                    }}
                    overlayInnerStyle={{
                      padding: 0,
                      backgroundColor: 'transparent'
                    }}
                  >
                    <Button className="toolbar-btn" icon={<FilterOutlined />}>
                      ç¯©é¸
                      <Badge count={filterStatus.length + filterType.length + (filterResourceName ? 1 : 0)} style={{ marginLeft: 8 }} />
                    </Button>
                  </Popover>
                </Space>
                <Space>
                  <Button className="toolbar-btn" icon={<DownloadOutlined />} onClick={() => message.info('åŒ¯å‡ºè³‡æºåˆ—è¡¨...')}>åŒ¯å‡º</Button>
                  <Button className="toolbar-btn" icon={<ReloadOutlined />} onClick={() => message.info('é‡æ–°æ•´ç†è³‡æºåˆ—è¡¨...')}>é‡æ–°æ•´ç†</Button>
                  <Popover
                    content={
                      <div style={{ width: '200px' }}>
                        <div style={{ marginBottom: '12px', fontWeight: 600, color: 'rgba(255, 255, 255, 0.9)' }}>
                          æ¬„ä½é¡¯ç¤ºè¨­å®š
                        </div>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                          {Object.keys(allColumns).map(key => (
                            <div key={key} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                              <Checkbox
                                checked={visibleColumns[key]}
                                onChange={(e) => setVisibleColumns(prev => ({ ...prev, [key]: e.target.checked }))}
                                style={{ marginRight: '8px' }}
                              />
                              <span style={{ color: 'rgba(255, 255, 255, 0.8)', fontSize: '13px' }}>
                                {allColumns[key].title}
                              </span>
                            </div>
                          ))}
                        </div>
                      </div>
                    }
                    title={null}
                    trigger="click"
                    open={isColumnSettingsOpen}
                    onOpenChange={setIsColumnSettingsOpen}
                    placement="bottomRight"
                    overlayStyle={{
                      backgroundColor: 'rgba(0, 0, 0, 0.8)',
                      backdropFilter: 'blur(8px)',
                      border: '1px solid rgba(255, 255, 255, 0.1)'
                    }}
                  >
                    <Button className="toolbar-btn" icon={<EyeOutlined />}>
                      æ¬„ä½è¨­å®š
                    </Button>
                  </Popover>
                  <Button className="toolbar-btn" icon={<SearchOutlined />} onClick={handleOpenScanModal}>æƒæç¶²è·¯</Button>
                  <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>æ–°å¢è³‡æº</Button>
                </Space>
              </Space>

              {/* è¡¨æ ¼å€åŸŸ - ä½¿ç”¨ table-wrapper åŒ…è£¹ */}
              <div className="table-wrapper">
                {resources.length > 0 ? (
                  <Table
                    rowSelection={rowSelection}
                    columns={columns}
                    dataSource={filteredResources}
                    rowKey="key"
                    className="transparent-bg"
                    rowClassName={(record) => record.name === highlightedResource ? 'highlighted-row' : ''}
                    size="small"
                  />
                ) : (
                  <Empty description="å°šç„¡ä»»ä½•è³‡æº">
                    <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>ç«‹å³æ–°å¢è³‡æº</Button>
                  </Empty>
                )}
              </div>
            </React.Fragment>
          )}

          {/* æ‰¹æ¬¡æ“ä½œå·¥å…·åˆ— - åƒè€ƒè³‡æºç¾¤çµ„ä½ˆå±€ */}
          {selectedRowKeys.length > 0 && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button
                  className="batch-action-button secondary-button"
                  onClick={() => handleBatchAddToGroup()}
                >
                  <TeamOutlined /> åŠ å…¥ç¾¤çµ„
                </Button>
                <Button
                  className="batch-action-button danger-button"
                  onClick={() => handleBatchDelete()}
                >
                  <DeleteOutlined /> æ‰¹æ¬¡åˆªé™¤
                </Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          {/* Modal */}
          <Modal title={editingResource ? 'ç·¨è¼¯è³‡æº' : 'æ–°å¢è³‡æº'} open={isModalOpen} onCancel={handleCancel} footer={null}>
            <Form form={form} layout="vertical" onFinish={onFinish} style={{ marginTop: 24 }}>
              <Form.Item name="name" label="è³‡æºåç¨±" rules={[{ required: true }]}><Input /></Form.Item>
              <Form.Item name="ip_address" label="IP ä½å€" rules={[{ required: true }]}><Input /></Form.Item>
              <Form.Item name="type" label="é¡å‹" rules={[{ required: true }]}> <Select> <Select.Option value="server">Server</Select.Option> <Select.Option value="database">Database</Select.Option> <Select.Option value="gateway">Gateway</Select.Option> <Select.Option value="cache">Cache</Select.Option> <Select.Option value="container">Container</Select.Option> </Select> </Form.Item>
              <Form.Item name="groups" label="æ‰€å±¬ç¾¤çµ„">
                <div style={{ maxHeight: '150px', overflowY: 'auto', border: '1px solid #444', padding: '8px', borderRadius: '4px' }}>
                  <Checkbox.Group options={mockGroups.map(g => ({ label: g.name, value: g.id }))} />
                </div>
              </Form.Item>
              <Form.Item name="tags" label="æ¨™ç±¤">
                <SmartTagInput
                  placeholder="è¼¸å…¥æ¨™ç±¤..."
                  style={{ width: '100%' }}
                />
              </Form.Item>
              <div className="modal-footer">
                <div></div>
                <div>
                  <Button onClick={handleCancel}>å–æ¶ˆ</Button>
                  <Button type="primary" htmlType="submit">ç¢ºå®š</Button>
                </div>
              </div>
            </Form>
          </Modal>
          <Modal
            title="æ‰¹æ¬¡åŠ å…¥ç¾¤çµ„"
            open={isAddToGroupModalOpen}
            onCancel={() => setIsAddToGroupModalOpen(false)}
            onOk={handleConfirmAddToGroup}
            okText="ç¢ºèªåŠ å…¥"
            cancelText="å–æ¶ˆ"
          >
            <p>è«‹é¸æ“‡è¦å°‡ {selectedRowKeys.length} å€‹è³‡æºåŠ å…¥çš„ç›®æ¨™ç¾¤çµ„ï¼š</p>
            <Select
              placeholder="é¸æ“‡è³‡æºç¾¤çµ„"
              style={{ width: '100%' }}
              onChange={(value) => setSelectedGroupId(value)}
              allowClear
            >
              {mockGroups.map(group => (
                <Select.Option key={group.id} value={group.id}>{group.name}</Select.Option>
              ))}
            </Select>
          </Modal>
          <Modal
            title="æƒæç¶²æ®µä»¥æ¢ç´¢æ–°è³‡æº"
            open={isScanModalOpen}
            onCancel={() => setIsScanModalOpen(false)}
            onOk={() => {
              message.loading({ content: `æ­£åœ¨æƒæç¶²æ®µ ${scanIpRange}...`, key: 'scan' });
              setTimeout(() => {
                message.success({ content: 'æƒæä»»å‹™å·²å•Ÿå‹•ï¼Œå®Œæˆå¾Œå°‡æœƒé€šçŸ¥æ‚¨ã€‚', key: 'scan', duration: 5 });
              }, 2000);
              setIsScanModalOpen(false);
              setScanIpRange('');
            }}
            okText="é–‹å§‹æƒæ"
            cancelText="å–æ¶ˆ"
          >
            <p>è«‹è¼¸å…¥è¦æƒæçš„ IP ç¶²æ®µï¼ˆä¾‹å¦‚ï¼š192.168.1.0/24ï¼‰ã€‚ç³»çµ±å°‡æœƒç•°æ­¥æƒæä¸¦åœ¨ç™¼ç¾æ–°è³‡æºæ™‚é€šçŸ¥æ‚¨ã€‚</p>
            <Input
              placeholder="192.168.1.0/24"
              value={scanIpRange}
              onChange={e => setScanIpRange(e.target.value)}
            />
          </Modal>
        </React.Fragment>
      );
    }, (prevProps, nextProps) => {
      // âš¡ æ€§èƒ½å„ªåŒ–ï¼šè‡ªå®šç¾©æ¯”è¼ƒå‡½æ•¸ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
      return (
        prevProps.pageParams?.statusFilter === nextProps.pageParams?.statusFilter &&
        prevProps.pageParams?.groupFilter === nextProps.pageParams?.groupFilter &&
        prevProps.themeMode === nextProps.themeMode &&
        prevProps.onNavigate === nextProps.onNavigate
      );
    });

    const ResourceGroupsPage = () => {
      // === ğŸš€ çœŸå¯¦åŒ–çš„ä¼æ¥­ç´šè³‡æºæ•¸æ“š ===
      const allResourcesData = [
        // ç”Ÿç”¢è³‡æ–™åº«é›†ç¾¤
        {
          key: 'host_1',
          name: 'mysql-prod-master-01',
          type: 'database',
          status: 'healthy',
          ip_address: '10.100.10.11',
          tags: ['production', 'database', 'mysql', 'master', 'high-priority'],
          team: 'Database Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'db.r5.xlarge',
          cpu_usage: 68,
          memory_usage: 72,
          disk_usage: 58,
          created_at: dayjs().subtract(180, 'day'),
          last_check: dayjs().subtract(2, 'minute')
        },
        {
          key: 'host_2',
          name: 'mysql-prod-slave-01',
          type: 'database',
          status: 'healthy',
          ip_address: '10.100.10.12',
          tags: ['production', 'database', 'mysql', 'slave', 'high-priority'],
          team: 'Database Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'db.r5.xlarge',
          cpu_usage: 45,
          memory_usage: 52,
          disk_usage: 58,
          created_at: dayjs().subtract(180, 'day'),
          last_check: dayjs().subtract(3, 'minute')
        },
        // ç”Ÿç”¢Webæœå‹™å™¨é›†ç¾¤
        {
          key: 'host_3',
          name: 'web-prod-frontend-01',
          type: 'server',
          status: 'warning',
          ip_address: '10.100.20.11',
          tags: ['production', 'web', 'frontend', 'nginx', 'high-priority'],
          team: 'Frontend Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'c5.2xlarge',
          cpu_usage: 82,
          memory_usage: 78,
          disk_usage: 34,
          created_at: dayjs().subtract(90, 'day'),
          last_check: dayjs().subtract(1, 'minute')
        },
        {
          key: 'host_4',
          name: 'web-prod-backend-01',
          type: 'server',
          status: 'healthy',
          ip_address: '10.100.20.21',
          tags: ['production', 'web', 'backend', 'nodejs', 'high-priority'],
          team: 'Backend Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'c5.2xlarge',
          cpu_usage: 65,
          memory_usage: 71,
          disk_usage: 42,
          created_at: dayjs().subtract(75, 'day'),
          last_check: dayjs().subtract(1, 'minute')
        },
        // API é–˜é“å’Œè² è¼‰å¹³è¡¡
        {
          key: 'host_5',
          name: 'api-gateway-prod-01',
          type: 'gateway',
          status: 'critical',
          ip_address: '10.100.30.11',
          tags: ['production', 'api', 'gateway', 'kong', 'critical'],
          team: 'Platform Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'c5.xlarge',
          cpu_usage: 91,
          memory_usage: 86,
          disk_usage: 67,
          created_at: dayjs().subtract(120, 'day'),
          last_check: dayjs().subtract(30, 'second')
        },
        {
          key: 'host_6',
          name: 'load-balancer-prod-01',
          type: 'load_balancer',
          status: 'healthy',
          ip_address: '10.100.30.21',
          tags: ['production', 'load-balancer', 'nginx', 'high-priority'],
          team: 'Network Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'c5.large',
          cpu_usage: 23,
          memory_usage: 31,
          disk_usage: 15,
          created_at: dayjs().subtract(200, 'day'),
          last_check: dayjs().subtract(45, 'second')
        },
        // å¿«å–æœå‹™
        {
          key: 'host_7',
          name: 'redis-prod-cluster-01',
          type: 'cache',
          status: 'healthy',
          ip_address: '10.100.40.11',
          tags: ['production', 'cache', 'redis', 'cluster', 'high-priority'],
          team: 'Backend Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'cache.r6g.large',
          cpu_usage: 55,
          memory_usage: 78,
          disk_usage: 25,
          created_at: dayjs().subtract(150, 'day'),
          last_check: dayjs().subtract(1, 'minute')
        },
        // ç›£æ§ç³»çµ±
        {
          key: 'host_8',
          name: 'prometheus-prod-01',
          type: 'monitoring',
          status: 'healthy',
          ip_address: '10.100.50.11',
          tags: ['production', 'monitoring', 'prometheus', 'observability'],
          team: 'SRE Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'm5.xlarge',
          cpu_usage: 72,
          memory_usage: 84,
          disk_usage: 76,
          created_at: dayjs().subtract(240, 'day'),
          last_check: dayjs().subtract(1, 'minute')
        },
        {
          key: 'host_9',
          name: 'grafana-prod-01',
          type: 'monitoring',
          status: 'healthy',
          ip_address: '10.100.50.21',
          tags: ['production', 'monitoring', 'grafana', 'visualization'],
          team: 'SRE Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'm5.large',
          cpu_usage: 38,
          memory_usage: 45,
          disk_usage: 32,
          created_at: dayjs().subtract(220, 'day'),
          last_check: dayjs().subtract(2, 'minute')
        },
        // æ¸¬è©¦ç’°å¢ƒ
        {
          key: 'host_10',
          name: 'web-staging-frontend-01',
          type: 'server',
          status: 'healthy',
          ip_address: '10.200.20.11',
          tags: ['staging', 'web', 'frontend', 'nginx', 'testing'],
          team: 'QA Team',
          environment: 'staging',
          region: 'us-east-1',
          instance_type: 't3.medium',
          cpu_usage: 25,
          memory_usage: 42,
          disk_usage: 28,
          created_at: dayjs().subtract(60, 'day'),
          last_check: dayjs().subtract(5, 'minute')
        },
        {
          key: 'host_11',
          name: 'mysql-staging-01',
          type: 'database',
          status: 'healthy',
          ip_address: '10.200.10.11',
          tags: ['staging', 'database', 'mysql', 'testing'],
          team: 'QA Team',
          environment: 'staging',
          region: 'us-east-1',
          instance_type: 'db.t3.medium',
          cpu_usage: 18,
          memory_usage: 35,
          disk_usage: 22,
          created_at: dayjs().subtract(60, 'day'),
          last_check: dayjs().subtract(4, 'minute')
        },
        // é–‹ç™¼å’ŒCI/CDå·¥å…·
        {
          key: 'host_12',
          name: 'jenkins-cicd-01',
          type: 'ci_cd',
          status: 'healthy',
          ip_address: '10.300.10.11',
          tags: ['development', 'ci-cd', 'jenkins', 'automation'],
          team: 'DevOps Team',
          environment: 'development',
          region: 'us-east-1',
          instance_type: 'm5.large',
          cpu_usage: 42,
          memory_usage: 58,
          disk_usage: 67,
          created_at: dayjs().subtract(300, 'day'),
          last_check: dayjs().subtract(3, 'minute')
        },
        {
          key: 'host_13',
          name: 'gitlab-dev-01',
          type: 'development',
          status: 'healthy',
          ip_address: '10.300.10.21',
          tags: ['development', 'git', 'gitlab', 'source-control'],
          team: 'Development Team',
          environment: 'development',
          region: 'us-east-1',
          instance_type: 'm5.large',
          cpu_usage: 35,
          memory_usage: 48,
          disk_usage: 85,
          created_at: dayjs().subtract(350, 'day'),
          last_check: dayjs().subtract(6, 'minute')
        },
        // ç¶²è·¯åŸºç¤è¨­æ–½
        {
          key: 'host_14',
          name: 'core-switch-dc1-01',
          type: 'network',
          status: 'healthy',
          ip_address: '192.168.1.10',
          tags: ['infrastructure', 'network', 'switch', 'core'],
          team: 'Network Team',
          environment: 'infrastructure',
          region: 'us-east-1',
          instance_type: 'physical',
          cpu_usage: 8,
          memory_usage: 12,
          disk_usage: 5,
          created_at: dayjs().subtract(800, 'day'),
          last_check: dayjs().subtract(10, 'minute')
        },
        // å®‰å…¨ç›¸é—œ
        {
          key: 'host_15',
          name: 'waf-prod-01',
          type: 'security',
          status: 'healthy',
          ip_address: '10.100.60.11',
          tags: ['production', 'security', 'waf', 'protection'],
          team: 'Security Team',
          environment: 'production',
          region: 'us-east-1',
          instance_type: 'c5.large',
          cpu_usage: 28,
          memory_usage: 35,
          disk_usage: 22,
          created_at: dayjs().subtract(180, 'day'),
          last_check: dayjs().subtract(2, 'minute')
        }
      ];

      const initialGroups = [
        { key: 'g_1', name: 'Production Database', description: 'æ‰€æœ‰ç”Ÿç”¢ç’°å¢ƒçš„è³‡æ–™åº«', members: ['host_1'], responsibleTeam: 'team_6' },
        { key: 'g_2', name: 'Production Web Servers', description: 'æ‰€æœ‰ç”Ÿç”¢ç’°å¢ƒçš„ Web ä¼ºæœå™¨', members: ['host_2'], responsibleTeam: 'team_5' },
        { key: 'g_3', name: 'Staging Environment', description: 'æ¸¬è©¦ç’°å¢ƒæ‰€æœ‰è³‡æº', members: ['host_5', 'host_6'], responsibleTeam: 'team_1' },
        { key: 'g_4', name: 'Network Infrastructure', description: 'ç¶²è·¯åŸºç¤è¨­æ–½è³‡æº', members: ['host_3', 'host_7'], responsibleTeam: 'team_7' },
        { key: 'g_5', name: 'Monitoring Systems', description: 'ç›£æ§ç³»çµ±èˆ‡äº‹ä»¶è³‡æº', members: ['host_4', 'host_8', 'host_9'], responsibleTeam: 'team_9' },
        { key: 'g_6', name: 'Security Resources', description: 'å®‰å…¨ç›¸é—œçš„è³‡æºèˆ‡å·¥å…·', members: [], responsibleTeam: 'team_8' },
        { key: 'g_7', name: 'Development Tools', description: 'é–‹ç™¼ç’°å¢ƒèˆ‡å·¥å…·è³‡æº', members: ['host_10', 'host_11'], responsibleTeam: 'team_10' },
      ];

      const initialTeams = [
        { key: 'team_1', name: 'Developers', description: 'è² è²¬é–‹ç™¼èˆ‡ç¶­è­·çš„æ ¸å¿ƒåœ˜éšŠ', members: ['user_2', 'user_4'], subscribers: ['user_1', 'slack_devops'], created_at: dayjs().subtract(60, 'day'), owner: 'user_2' },
        { key: 'team_2', name: 'Viewers', description: 'åƒ…æœ‰æª¢è¦–æ¬Šé™çš„è§€å¯Ÿå“¡', members: ['user_3'], subscribers: ['user_2'], created_at: dayjs().subtract(45, 'day'), owner: 'user_1' },
        { key: 'team_3', name: 'Administrators', description: 'å¹³å°æœ€é«˜æ¬Šé™ç®¡ç†è€…', members: ['user_1', 'user_4'], subscribers: ['user_1', 'slack_network', 'email_security', 'oncall_security'], created_at: dayjs().subtract(90, 'day'), owner: 'user_1' },
        { key: 'team_4', name: 'QA Team', description: 'å“è³ªä¿è­‰èˆ‡æ¸¬è©¦åœ˜éšŠ', members: [], subscribers: ['user_3', 'email_ops'], created_at: dayjs().subtract(20, 'day'), owner: 'user_1' },
        { key: 'team_5', name: 'DevOps Team', description: 'è² è²¬CI/CDå’ŒåŸºç¤è¨­æ–½è‡ªå‹•åŒ–çš„åœ˜éšŠ', members: ['user_2', 'user_4'], subscribers: ['user_1', 'slack_devops'], created_at: dayjs().subtract(30, 'day'), owner: 'user_2' },
        { key: 'team_6', name: 'Database Team', description: 'è² è²¬è³‡æ–™åº«ç®¡ç†èˆ‡å„ªåŒ–çš„åœ˜éšŠ', members: ['user_1'], subscribers: ['user_1', 'slack_database'], created_at: dayjs().subtract(40, 'day'), owner: 'user_1' },
        { key: 'team_7', name: 'Network Team', description: 'è² è²¬ç¶²è·¯åŸºç¤è¨­æ–½èˆ‡å®‰å…¨çš„åœ˜éšŠ', members: ['user_3'], subscribers: ['user_3', 'slack_network'], created_at: dayjs().subtract(50, 'day'), owner: 'user_3' },
        { key: 'team_8', name: 'Security Team', description: 'è² è²¬è³‡è¨Šå®‰å…¨èˆ‡åˆè¦çš„åœ˜éšŠ', members: ['user_4'], subscribers: ['user_4', 'email_security', 'oncall_security'], created_at: dayjs().subtract(35, 'day'), owner: 'user_4' },
        { key: 'team_9', name: 'Operations Team', description: 'è² è²¬ç³»çµ±é‹ç‡Ÿèˆ‡ç›£æ§çš„åœ˜éšŠ', members: ['user_1', 'user_2', 'user_3'], subscribers: ['user_1', 'slack_operations'], created_at: dayjs().subtract(25, 'day'), owner: 'user_1' },
        { key: 'team_10', name: 'Platform Team', description: 'è² è²¬å¹³å°æ¶æ§‹èˆ‡æŠ€è¡“åŸºç¤è¨­æ–½çš„åœ˜éšŠ', members: ['user_2', 'user_4'], subscribers: ['user_1', 'slack_platform'], created_at: dayjs().subtract(15, 'day'), owner: 'user_2' },
      ];

      const [groups, setGroups] = useLocalStorageState('sre-groups', initialGroups);
      const [teams] = useLocalStorageState('sre-teams', initialTeams);
      const [allResources] = useState(allResourcesData.map(r => ({ ...r, title: r.name })));
      const [isGroupModalOpen, setIsGroupModalOpen] = useState(false);
      const [editingGroup, setEditingGroup] = useState(null);
      const [targetKeys, setTargetKeys] = useState([]);
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [groupForm] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // Column settings state
      const defaultVisibleColumns = {
        name: true,
        description: true,
        responsibleTeam: true,
        members: true,
        status: true,
        action: true
      };
      const [visibleColumns, setVisibleColumns] = useLocalStorageState('sre-resource-group-columns', defaultVisibleColumns);
      const [isColumnSettingsOpen, setIsColumnSettingsOpen] = useState(false);

      const getStatusSummary = (memberKeys) => {
        const summary = { healthy: 0, warning: 0, critical: 0 };
        memberKeys.forEach(key => {
          const resource = allResources.find(r => r.key === key);
          if (resource) {
            summary[resource.status]++;
          }
        });
        return summary;
      };

      const showGroupModal = (group = null) => {
        setEditingGroup(group);
        groupForm.setFieldsValue(group || { name: '', description: '', responsibleTeam: '' });
        setTargetKeys(group ? (group.members || []) : []);
        setIsGroupModalOpen(true);
      };
      const handleGroupCancel = () => {
        setIsGroupModalOpen(false);
        setEditingGroup(null);
        setTargetKeys([]);
        groupForm.resetFields();
      };
      const handleGroupFinish = (values) => {
        if (editingGroup) {
          setGroups(groups.map(g => g.key === editingGroup.key ? { ...g, ...values, members: targetKeys } : g));
          message.success('ç¾¤çµ„æ›´æ–°æˆåŠŸ');
        } else {
          const newGroup = { ...values, key: `g_${Date.now()}`, members: targetKeys };
          setGroups([newGroup, ...groups]);
          message.success('ç¾¤çµ„æ–°å¢æˆåŠŸ');
        }
        handleGroupCancel();
      };
      const handleGroupDelete = (key) => {
        confirmDelete('ç¾¤çµ„', () => {
          setGroups(groups.filter(g => g.key !== key));
        });
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} å€‹ç¾¤çµ„å—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setGroups(groups.filter(g => !selectedRowKeys.includes(g.key)));
            setSelectedRowKeys([]);
            message.success('æ‰¹æ¬¡åˆªé™¤æˆåŠŸ');
          }
        });
      };

      const handleViewHistory = (record) => {
        message.info(`æŸ¥çœ‹ç¾¤çµ„ã€Œ${record.name}ã€çš„æ“ä½œæ­·å²`);
        // é€™è£¡å¯ä»¥è·³è½‰åˆ°ç›¸é—œçš„æ­·å²è¨˜éŒ„é é¢
      };


      const getTeamName = (teamKey) => {
        if (!teamKey) return '-';
        const team = teams.find(t => t.key === teamKey);
        return team ? team.name : teamKey;
      };

      // Define all possible columns
      const allColumns = {
        name: {
          title: 'ç¾¤çµ„åç¨±',
          dataIndex: 'name',
          width: '20%',
          sorter: (a, b) => a.name.localeCompare(b.name)
        },
        description: {
          title: 'æè¿°',
          dataIndex: 'description',
          width: '20%'
        },
        responsibleTeam: {
          title: 'è² è²¬åœ˜éšŠ',
          dataIndex: 'responsibleTeam',
          width: '15%',
          render: responsibleTeam => getTeamName(responsibleTeam)
        },
        members: {
          title: 'æˆå“¡æ•¸é‡',
          dataIndex: 'members',
          width: '10%',
          render: members => members.length
        },
        status: {
          title: 'ç‹€æ…‹',
          dataIndex: 'members',
          width: '25%',
          render: members => {
            const summary = getStatusSummary(members);
            return (
              <span>
                <Tag color="green">Healthy: {summary.healthy}</Tag>
                <Tag color="orange">Warning: {summary.warning}</Tag>
                <Tag color="red">Critical: {summary.critical}</Tag>
              </span>
            );
          }
        },
        action: {
          title: 'æ“ä½œ',
          key: 'action',
          width: '15%',
          render: (_, record) => (
            <Space size="small">
              <Tooltip title="ç·¨è¼¯" placement="top">
                <Button type="text" icon={<EditOutlined />} onClick={() => showGroupModal(record)} />
              </Tooltip>
              <Tooltip title="åˆªé™¤" placement="top">
                <Button type="text" icon={<DeleteOutlined />} danger onClick={() => handleGroupDelete(record.key)} />
              </Tooltip>
            </Space>
          )
        }
      };

      // Generate dynamic columns based on visible settings
      const columns = Object.keys(allColumns)
        .filter(key => visibleColumns[key])
        .map(key => allColumns[key]);

      const filteredGroups = groups.filter(g => g.name.toLowerCase().includes(searchText.toLowerCase()));

      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      return (
        <React.Fragment>

          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="æœå°‹ç¾¤çµ„åç¨±æˆ–æè¿°..."
                onChange={e => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                ç¯©é¸
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              <Popover
                content={
                  <div style={{ width: '200px' }}>
                    <div style={{ marginBottom: '12px', fontWeight: 600, color: 'rgba(255, 255, 255, 0.9)' }}>
                      æ¬„ä½é¡¯ç¤ºè¨­å®š
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                      {Object.keys(allColumns).map(key => (
                        <div key={key} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                          <Checkbox
                            checked={visibleColumns[key]}
                            onChange={(e) => setVisibleColumns(prev => ({ ...prev, [key]: e.target.checked }))}
                            style={{ marginRight: '8px' }}
                          />
                          <span style={{ color: 'rgba(255, 255, 255, 0.8)', fontSize: '13px' }}>
                            {allColumns[key].title}
                          </span>
                        </div>
                      ))}
                    </div>
                  </div>
                }
                title={null}
                trigger="click"
                open={isColumnSettingsOpen}
                onOpenChange={setIsColumnSettingsOpen}
                placement="bottomRight"
                overlayStyle={{
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  backdropFilter: 'blur(8px)',
                  border: '1px solid rgba(255, 255, 255, 0.1)'
                }}
              >
                <Button className="toolbar-btn" icon={<EyeOutlined />}>
                  æ¬„ä½è¨­å®š
                </Button>
              </Popover>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showGroupModal()}>
                æ–°å¢ç¾¤çµ„
              </Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            {
              filteredGroups.length > 0 ?
                <Table rowSelection={rowSelection} columns={columns} dataSource={filteredGroups} rowKey="key" className="transparent-bg" size="small" /> :
                <Empty description="å°šç„¡ä»»ä½•è³‡æºç¾¤çµ„">
                  <Button type="primary" icon={<PlusOutlined />} onClick={() => showGroupModal()}>ç«‹å³æ–°å¢ç¾¤çµ„</Button>
                </Empty>
            }
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>æ‰¹æ¬¡åˆªé™¤</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          <Modal title={editingGroup ? 'ç·¨è¼¯ç¾¤çµ„' : 'æ–°å¢ç¾¤çµ„'} open={isGroupModalOpen} onCancel={handleGroupCancel} footer={null} width={900}>
            <Form form={groupForm} layout="vertical" onFinish={handleGroupFinish} style={{ marginTop: 24 }}>
              <Form.Item name="name" label="ç¾¤çµ„åç¨±" rules={[{ required: true, message: 'è«‹è¼¸å…¥ç¾¤çµ„åç¨±' }]}>
                <Input />
              </Form.Item>
              <Form.Item name="description" label="æè¿°">
                <TextArea rows={3} />
              </Form.Item>
              <Form.Item name="responsibleTeam" label="è² è²¬åœ˜éšŠ">
                <Select placeholder="è«‹é¸æ“‡è² è²¬åœ˜éšŠ" allowClear>
                  {teams.map(team => (
                    <Select.Option key={team.key} value={team.key}>
                      {team.name}
                    </Select.Option>
                  ))}
                </Select>
              </Form.Item>
              <Form.Item label="ç¾¤çµ„è³‡æº">
                <Transfer
                  dataSource={allResources.map(resource => ({
                    key: resource.key,
                    title: `${resource.name} (${resource.type})`,
                    description: resource.ip_address,
                    status: resource.status,
                    name: resource.name,
                    type: resource.type,
                    ip_address: resource.ip_address
                  }))}
                  showSearch
                  filterOption={(inputValue, item) =>
                    item.name.toLowerCase().includes(inputValue.toLowerCase()) ||
                    item.type.toLowerCase().includes(inputValue.toLowerCase()) ||
                    item.ip_address.includes(inputValue)
                  }
                  targetKeys={targetKeys}
                  onChange={(targetKeys) => {
                    setTargetKeys(targetKeys);
                  }}
                  render={item => {
                    const resource = allResources.find(r => r.key === item.key);
                    return (
                      <div style={{ padding: '4px 0', display: 'flex', alignItems: 'center', gap: '8px' }}>
                        <div style={{ fontWeight: '500', color: 'rgba(255, 255, 255, 0.9)', flex: 1 }}>
                          {item.name}
                        </div>
                        <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)', flexShrink: 0 }}>
                          {item.type} â€¢ {item.ip_address}
                        </div>
                        <Tag size="small" color={
                          resource?.status === 'healthy' ? 'green' :
                            resource?.status === 'warning' ? 'orange' : 'red'
                        } style={{ flexShrink: 0 }}>
                          {resource?.status === 'healthy' ? 'å¥åº·' :
                            resource?.status === 'warning' ? 'è­¦å‘Š' : 'åš´é‡'}
                        </Tag>
                      </div>
                    );
                  }}
                  listStyle={{
                    width: 420,
                    height: 300,
                  }}
                  locale={{
                    itemUnit: 'å€‹è³‡æº',
                    itemsUnit: 'å€‹è³‡æº',
                    searchPlaceholder: 'æœå°‹è³‡æºåç¨±ã€é¡å‹æˆ–IP'
                  }}
                  titles={['å¯ç”¨è³‡æº', 'ç¾¤çµ„æˆå“¡']}
                />
              </Form.Item>
              <div className="modal-footer">
                <div></div>
                <div>
                  <Button onClick={handleGroupCancel}>å–æ¶ˆ</Button>
                  <Button type="primary" htmlType="submit">{editingGroup ? 'æ›´æ–°ç¾¤çµ„' : 'å»ºç«‹ç¾¤çµ„'}</Button>
                </div>
              </div>
            </Form>
          </Modal>

        </React.Fragment >
      );
    };

    // è³‡æºç¸½è¦½ Tab - é«˜å±¤æ¬¡çš„å„€è¡¨æ¿è¦–åœ–
    const ResourceOverviewTab = ({ themeMode, onNavigate }) => {
      // è³‡æºçµ±è¨ˆè³‡æ–™ - èˆ‡é¦–é  systemKPIs ä¿æŒä¸€è‡´
      const resourceStats = {
        totalServers: 47,
        databases: 12,
        containers: 156,
        services: 23,
        healthyResources: 326,  // èˆ‡é¦–é ä¸€è‡´
        warningResources: 35,   // èˆ‡é¦–é ä¸€è‡´
        criticalResources: 13,  // èˆ‡é¦–é ä¸€è‡´
        totalResources: 374     // èˆ‡é¦–é ä¸€è‡´
      };

      return (
        <div style={{ marginTop: 'var(--spacing-lg)' }}>
          {/* è³‡æºç¸½è¦½ä¸»è¦å…§å®¹ */}
          <Row gutter={[24, 24]} style={{ alignItems: 'stretch' }}>
            {/* Top N è³‡æºä½¿ç”¨ç‡åˆ—è¡¨ */}
            <Col xs={24} lg={16} style={{ display: 'flex' }}>
              <Card
                className="dashboard-card"
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <UnorderedListOutlined style={{ color: '#1890ff' }} />
                    <span>è³‡æºåˆ—è¡¨ç¸½è¦½</span>
                    <Tag color="blue">{resourceStats.totalResources} å€‹è³‡æº</Tag>
                  </div>
                }
                extra={
                  <div style={{ display: 'flex', gap: '8px' }}>
                    <Button
                      size="small"
                      icon={<SearchOutlined />}
                      onClick={() => onNavigate('resource-list')}
                    >
                      è©³ç´°æœå°‹
                    </Button>
                  </div>
                }
                bodyStyle={{ padding: '12px' }}
                style={{ width: '100%', height: '452px', display: 'flex', flexDirection: 'column' }}
              >
                <div style={{ height: '100%', overflowY: 'auto', flex: 1, paddingRight: '4px', paddingBottom: '8px' }}>
                  {[
                    { name: 'web-prod-1', usage: 95, trend: 'up', status: 'critical' },
                    { name: 'web-prod-2', usage: 93, trend: 'up', status: 'critical' },
                    { name: 'web-prod-3', usage: 91, trend: 'stable', status: 'critical' },
                    { name: 'web-prod-4', usage: 89, trend: 'down', status: 'warning' },
                    { name: 'web-prod-5', usage: 87, trend: 'down', status: 'warning' },
                    { name: 'db-prod-1', usage: 85, trend: 'stable', status: 'warning' },
                    { name: 'api-gateway-1', usage: 83, trend: 'up', status: 'warning' },
                    { name: 'cache-redis-1', usage: 81, trend: 'down', status: 'warning' }
                  ].map((resource, index) => (
                    <div key={resource.name} style={{
                      display: 'flex',
                      alignItems: 'center',
                      padding: '8px 12px',
                      marginBottom: '4px',
                      backgroundColor: 'rgba(255, 255, 255, 0.02)',
                      borderRadius: '6px',
                      border: '1px solid rgba(255, 255, 255, 0.06)',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: resource.name })}
                    >
                      <div style={{ minWidth: '100px', fontWeight: 500, fontSize: '14px' }}>
                        {resource.name}
                      </div>
                      <div style={{ flex: 1, margin: '0 12px' }}>
                        <InlineProgressCell
                          value={resource.usage}
                          max={100}
                          unit="%"
                          status={resource.status}
                          size="small"
                          animated={true}
                          showTooltip={true}
                          formatValue={(val) => `${val}%`}
                        />
                      </div>
                      <div style={{ minWidth: '50px', textAlign: 'right' }}>
                        {resource.trend === 'up' ? (
                          <ArrowUpOutlined style={{ color: '#ff4d4f' }} />
                        ) : resource.trend === 'down' ? (
                          <ArrowDownOutlined style={{ color: '#52c41a' }} />
                        ) : (
                          <MinusOutlined style={{ color: '#faad14' }} />
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </Card>
            </Col>

            {/* å³å´ï¼šAI é¢¨éšªé æ¸¬ + éœ€é—œæ³¨è³‡æº */}
            <Col xs={24} lg={8} style={{ display: 'flex' }}>
              <div style={{ display: 'flex', flexDirection: 'column', gap: '16px', height: '452px', width: '100%' }}>
                {/* AI é¢¨éšªé æ¸¬ */}
                <Card
                  className="dashboard-card"
                  title={
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <RobotOutlined style={{ color: '#722ed1' }} />
                      <span>AI é¢¨éšªé æ¸¬</span>
                      <Badge count={3} style={{ backgroundColor: '#ff4d4f' }} />
                    </div>
                  }
                  bodyStyle={{ padding: '8px', overflow: 'hidden' }}
                  style={{ flex: 1, display: 'flex', flexDirection: 'column' }}
                >
                  <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '4px',
                    height: '100%',
                    overflowY: 'auto',
                    paddingRight: '4px'
                  }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '8px 10px',
                      backgroundColor: 'rgba(255, 77, 79, 0.1)',
                      borderRadius: '4px',
                      border: '1px solid rgba(255, 77, 79, 0.2)',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: 'web-prod-01' })}
                    >
                      <div style={{ flex: 1 }}>
                        <div style={{ fontWeight: 500, marginBottom: '2px', fontSize: '12px' }}>web-prod-01</div>
                        <div style={{ fontSize: '10px', color: 'rgba(255, 255, 255, 0.8)', lineHeight: '1.2' }}>
                          CPU ä½¿ç”¨ç‡æŒçºŒä¸Šå‡ï¼Œé è¨ˆ 2 å°æ™‚å…§é” 90%
                        </div>
                      </div>
                      <div>
                        <Tag color="red" size="small" style={{ fontSize: '10px', padding: '0 4px', lineHeight: '16px' }}>é«˜é¢¨éšª</Tag>
                      </div>
                    </div>

                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '8px 10px',
                      backgroundColor: 'rgba(255, 77, 79, 0.1)',
                      borderRadius: '4px',
                      border: '1px solid rgba(255, 77, 79, 0.2)',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: 'api-gateway-01' })}
                    >
                      <div style={{ flex: 1 }}>
                        <div style={{ fontWeight: 500, marginBottom: '2px', fontSize: '12px' }}>api-gateway-01</div>
                        <div style={{ fontSize: '10px', color: 'rgba(255, 255, 255, 0.8)', lineHeight: '1.2' }}>
                          å¯¦é«”è¨˜æ†¶é«”æ³¢å‹•ï¼ŒéŒ¯èª¤ç‡ä¸Šå‡è¶¨å‹¢
                        </div>
                      </div>
                      <div>
                        <Tag color="red" size="small" style={{ fontSize: '10px', padding: '0 4px', lineHeight: '16px' }}>é«˜é¢¨éšª</Tag>
                      </div>
                    </div>

                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '8px 10px',
                      backgroundColor: 'rgba(250, 173, 20, 0.1)',
                      borderRadius: '4px',
                      border: '1px solid rgba(250, 173, 20, 0.2)',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: 'db-prod-02' })}
                    >
                      <div style={{ flex: 1 }}>
                        <div style={{ fontWeight: 500, marginBottom: '2px', fontSize: '12px' }}>db-prod-02</div>
                        <div style={{ fontSize: '10px', color: 'rgba(255, 255, 255, 0.8)', lineHeight: '1.2' }}>
                          ç£ç¢Ÿç©ºé–“å‰©é¤˜ä¸è¶³ 15%ï¼Œå»ºè­°æ¸…ç†
                        </div>
                      </div>
                      <div>
                        <Tag color="orange" size="small" style={{ fontSize: '10px', padding: '0 4px', lineHeight: '16px' }}>ä¸­é¢¨éšª</Tag>
                      </div>
                    </div>
                  </div>
                </Card>

                {/* éœ€é—œæ³¨çš„è³‡æºåˆ—è¡¨ */}
                <Card
                  className="dashboard-card"
                  title={
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <AlertOutlined style={{ color: '#faad14' }} />
                      <span>éœ€é—œæ³¨çš„è³‡æºåˆ—è¡¨</span>
                      <Badge count={2} style={{ backgroundColor: '#faad14' }} />
                    </div>
                  }
                  bodyStyle={{ padding: '8px', overflow: 'hidden' }}
                  style={{ flex: 1, display: 'flex', flexDirection: 'column' }}
                >
                  <div style={{
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '8px',
                    height: '100%',
                    overflowY: 'auto',
                    paddingRight: '4px'
                  }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '8px 12px',
                      backgroundColor: 'rgba(255, 77, 79, 0.08)',
                      borderRadius: '4px',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: 'api-gateway-prod' })}
                    >
                      <div>
                        <div style={{ fontWeight: 500 }}>api-gateway-prod</div>
                        <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                          CRITICAL
                        </div>
                      </div>
                      <div style={{ textAlign: 'right' }}>
                        <div style={{ color: '#ff4d4f', fontWeight: 500 }}>2 å‰‡</div>
                      </div>
                    </div>

                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '8px 12px',
                      backgroundColor: 'rgba(250, 173, 20, 0.08)',
                      borderRadius: '4px',
                      cursor: 'pointer'
                    }}
                      onClick={() => onNavigate('resource-list', { searchText: 'web-prod-02' })}
                    >
                      <div>
                        <div style={{ fontWeight: 500 }}>web-prod-02</div>
                        <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                          WARNING
                        </div>
                      </div>
                      <div style={{ textAlign: 'right' }}>
                        <div style={{ color: '#faad14', fontWeight: 500 }}>1 å‰‡</div>
                      </div>
                    </div>
                  </div>
                </Card>
              </div>
            </Col>
          </Row>

        </div>
      );
    };

    // è³‡æºæ¸…å–® Tab - è©³ç´°çš„è³‡æºåˆ—è¡¨å’Œç®¡ç†
    const ResourceListTab = ({ pageParams, themeMode, onNavigate }) => {
      return (
        <div>
          <ResourceListPage pageParams={pageParams} themeMode={themeMode} onNavigate={onNavigate} />
        </div>
      );
    };

    // è³‡æºç¾¤çµ„ Tab - æŒ‰æ¥­å‹™æˆ–åŠŸèƒ½åˆ†çµ„çš„è³‡æºç®¡ç†
    const ResourceGroupsTab = ({ onNavigate }) => {
      return (
        <div style={{ marginTop: 'var(--spacing-lg)' }}>
          <ResourceGroupsPage onNavigate={onNavigate} />
        </div>
      );
    };

    // è³‡æºæ‹“æ’² Tab - è³‡æºé–“çš„ä¾è³´é—œä¿‚è¦–è¦ºåŒ–
    const ResourceTopologyTab = ({ onNavigate }) => {
      const [selectedNode, setSelectedNode] = React.useState(null);
      const [layoutType, setLayoutType] = React.useState('force');
      const chartRef = React.useRef(null);
      const chartInstance = React.useRef(null);

      // åŸºæ–¼è³‡æºæ•¸æ“šç”Ÿæˆæ‹“æ’²åœ–æ•¸æ“š
      const generateTopologyData = () => {
        // ç¯€é»æ•¸æ“š - å¾ç¾æœ‰è³‡æºè½‰æ›
        const nodes = [
          { id: 'host_1', name: 'db-prod-01', type: 'database', status: 'healthy', ip_address: '10.0.0.10', category: 0 },
          { id: 'host_2', name: 'web-prod-02', type: 'server', status: 'warning', ip_address: '10.0.0.21', category: 1 },
          { id: 'host_3', name: 'api-gateway-prod', type: 'gateway', status: 'critical', ip_address: '10.0.0.35', category: 2 },
          { id: 'host_4', name: 'cache-redis-prod', type: 'cache', status: 'healthy', ip_address: '10.0.0.40', category: 3 },
          { id: 'host_5', name: 'k8s-master-node-01', type: 'server', status: 'healthy', ip_address: '10.0.1.5', category: 1 },
          // æ–°å¢ä¸€äº›è™›æ“¬ç¯€é»ä¾†å±•ç¤ºæ›´è¤‡é›œçš„æ‹“æ’²
          { id: 'service_auth', name: 'èªè­‰æœå‹™', type: 'service', status: 'healthy', ip_address: 'N/A', category: 4 },
          { id: 'service_order', name: 'è¨‚å–®æœå‹™', type: 'service', status: 'healthy', ip_address: 'N/A', category: 4 },
          { id: 'load_balancer', name: 'è² è¼‰å‡è¡¡å™¨', type: 'gateway', status: 'healthy', ip_address: '10.0.0.1', category: 2 },
          { id: 'monitoring', name: 'ç›£æ§ç³»çµ±', type: 'service', status: 'healthy', ip_address: '10.0.0.100', category: 5 }
        ];

        // é€£ç·šæ•¸æ“š - å®šç¾©è³‡æºé–“çš„ä¾è³´é—œä¿‚
        const links = [
          { source: 'load_balancer', target: 'host_3', label: 'æµé‡è·¯ç”±' },
          { source: 'host_3', target: 'host_2', label: 'APIèª¿ç”¨' },
          { source: 'host_3', target: 'service_auth', label: 'èªè­‰é©—è­‰' },
          { source: 'host_2', target: 'host_1', label: 'è³‡æ–™è®€å¯«' },
          { source: 'host_2', target: 'host_4', label: 'ç·©å­˜è®€å–' },
          { source: 'service_auth', target: 'host_1', label: 'äººå“¡é©—è­‰' },
          { source: 'service_order', target: 'host_1', label: 'è¨‚å–®å„²å­˜' },
          { source: 'service_order', target: 'host_4', label: 'æœƒè©±ç·©å­˜' },
          { source: 'host_5', target: 'host_2', label: 'å®¹å™¨ç®¡ç†' },
          { source: 'monitoring', target: 'host_1', label: 'ç›£æ§æ¡é›†' },
          { source: 'monitoring', target: 'host_2', label: 'ç›£æ§æ¡é›†' },
          { source: 'monitoring', target: 'host_3', label: 'ç›£æ§æ¡é›†' },
          { source: 'monitoring', target: 'host_4', label: 'ç›£æ§æ¡é›†' },
          { source: 'monitoring', target: 'host_5', label: 'ç›£æ§æ¡é›†' }
        ];

        return { nodes, links };
      };

      // ç¯€é»é¡å‹å’Œé¡è‰²æ˜ å°„
      const getNodeStyle = (node) => {
        const statusColors = {
          healthy: '#52c41a',
          warning: '#faad14',
          critical: '#ff4d4f'
        };

        const categoryColors = {
          0: '#1890ff', // database
          1: '#722ed1', // server
          2: '#13c2c2', // gateway
          3: '#eb2f96', // cache
          4: '#52c41a', // service
          5: '#fa8c16'  // monitoring
        };

        const color = statusColors[node.status] || categoryColors[node.category] || '#d9d9d9';

        return {
          color,
          borderColor: color,
          shadowColor: color + '40',
          symbolSize: node.type === 'service' ? 50 : 40
        };
      };

      // åˆå§‹åŒ–EChartsåœ–è¡¨
      React.useEffect(() => {
        if (chartRef.current && !chartInstance.current) {
          chartInstance.current = echarts.init(chartRef.current, 'dark', { renderer: 'svg' });

          const { nodes, links } = generateTopologyData();

          const option = {
            tooltip: {
              trigger: 'item',
              formatter: (params) => {
                if (params.dataType === 'node') {
                  const node = params.data;
                  return `
                    <div style="font-weight: bold; margin-bottom: 8px;">${node.name}</div>
                    <div>é¡å‹: ${node.type}</div>
                    <div>ç‹€æ…‹: <span style="color: ${getNodeStyle(node).color}">â—</span> ${node.status}</div>
                    <div>IP: ${node.ip_address}</div>
                  `;
                } else if (params.dataType === 'edge') {
                  return `${params.data.source} â†’ ${params.data.target}<br/>${params.data.label}`;
                }
              }
            },
            legend: {
              data: ['è³‡æ–™åº«', 'ä¼ºæœå™¨', 'ç¶²é—œ', 'å¿«å–', 'æœå‹™', 'ç›£æ§'],
              textStyle: { color: '#fff' },
              top: 10
            },
            series: [{
              type: 'graph',
              layout: layoutType,
              data: nodes.map(node => ({
                ...node,
                ...getNodeStyle(node),
                label: {
                  show: true,
                  position: 'bottom',
                  color: '#fff',
                  fontSize: 12,
                  formatter: '{b}'
                }
              })),
              links: links.map(link => ({
                ...link,
                lineStyle: {
                  color: '#aaa',
                  width: 2,
                  curveness: 0.2
                },
                emphasis: {
                  lineStyle: {
                    width: 4
                  }
                }
              })),
              emphasis: {
                focus: 'adjacency',
                lineStyle: {
                  width: 4
                }
              },
              roam: true,
              focusNodeAdjacency: true,
              draggable: true,
              categories: [
                { name: 'è³‡æ–™åº«', itemStyle: { color: '#1890ff' } },
                { name: 'ä¼ºæœå™¨', itemStyle: { color: '#722ed1' } },
                { name: 'ç¶²é—œ', itemStyle: { color: '#13c2c2' } },
                { name: 'å¿«å–', itemStyle: { color: '#eb2f96' } },
                { name: 'æœå‹™', itemStyle: { color: '#52c41a' } },
                { name: 'ç›£æ§', itemStyle: { color: '#fa8c16' } }
              ],
              force: {
                repulsion: 1000,
                edgeLength: [150, 300]
              }
            }]
          };

          chartInstance.current.setOption(option);

          // é»æ“Šäº‹ä»¶
          chartInstance.current.on('click', (params) => {
            if (params.dataType === 'node') {
              setSelectedNode(params.data);
              message.info(`å·²é¸æ“‡è³‡æº: ${params.data.name}`);
            }
          });

          // æ‡¸åœäº‹ä»¶
          chartInstance.current.on('mouseover', (params) => {
            if (params.dataType === 'node') {
              chartRef.current.style.cursor = 'pointer';
            }
          });

          chartInstance.current.on('mouseout', () => {
            chartRef.current.style.cursor = 'default';
          });
        }

        return () => {
          if (chartInstance.current) {
            chartInstance.current.dispose();
            chartInstance.current = null;
          }
        };
      }, [layoutType]);

      // ä½ˆå±€åˆ‡æ›è™•ç†
      const handleLayoutChange = (newLayout) => {
        setLayoutType(newLayout);
        if (chartInstance.current) {
          chartInstance.current.setOption({
            series: [{
              layout: newLayout
            }]
          });
        }
      };

      // é‡æ–°æ•´ç†åœ–è¡¨
      const handleRefresh = () => {
        if (chartInstance.current) {
          chartInstance.current.dispose();
          chartInstance.current = null;
          setSelectedNode(null);
          // é‡æ–°è§¸ç™¼useEffect
          setLayoutType(layoutType === 'force' ? 'circular' : 'force');
          setTimeout(() => setLayoutType('force'), 100);
        }
        message.success('æ‹“æ’²åœ–å·²é‡æ–°æ•´ç†');
      };

      return (
        <div style={{ marginTop: 'var(--spacing-lg)' }}>
          <Card
            className="dashboard-card"
            title={
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <BranchesOutlined style={{ color: '#1890ff' }} />
                <span>è³‡æºæ‹“æ’²åœ–</span>
              </div>
            }
            extra={
              <div style={{ display: 'flex', gap: '8px' }}>
                <Select
                  size="small"
                  value={layoutType}
                  onChange={handleLayoutChange}
                  style={{ width: 100 }}
                >
                  <Select.Option value="force">åŠ›å¼•å°</Select.Option>
                  <Select.Option value="circular">ç’°å½¢</Select.Option>
                </Select>
                <Button size="small" icon={<ReloadOutlined />} onClick={handleRefresh}>
                  é‡æ–°æ•´ç†
                </Button>
              </div>
            }
            bodyStyle={{ padding: '20px' }}
          >
            <div style={{ display: 'flex', gap: '16px', height: '600px' }}>
              {/* åœ–è¡¨å€åŸŸ */}
              <div
                ref={chartRef}
                style={{
                  flex: 1,
                  backgroundColor: 'rgba(255, 255, 255, 0.02)',
                  borderRadius: '8px'
                }}
              />

              {/* è©³ç´°è³‡è¨Šé¢æ¿ */}
              {selectedNode && (
                <div style={{
                  width: '300px',
                  backgroundColor: 'rgba(255, 255, 255, 0.05)',
                  borderRadius: '8px',
                  padding: '16px',
                  border: '1px solid rgba(255, 255, 255, 0.1)'
                }}>
                  <Title level={4} style={{ color: '#fff', marginBottom: '16px' }}>
                    è³‡æºè©³æƒ…
                  </Title>
                  <Descriptions
                    column={1}
                    size="small"
                    style={{ color: '#fff' }}
                  >
                    <Descriptions.Item label="åç¨±" style={{ color: '#fff' }}>
                      {selectedNode.name}
                    </Descriptions.Item>
                    <Descriptions.Item label="é¡å‹" style={{ color: '#fff' }}>
                      {selectedNode.type}
                    </Descriptions.Item>
                    <Descriptions.Item label="ç‹€æ…‹" style={{ color: '#fff' }}>
                      <span style={{
                        color: getNodeStyle(selectedNode).color,
                        fontWeight: 'bold'
                      }}>
                        â— {selectedNode.status}
                      </span>
                    </Descriptions.Item>
                    <Descriptions.Item label="IPä½å€" style={{ color: '#fff' }}>
                      {selectedNode.ip_address}
                    </Descriptions.Item>
                  </Descriptions>
                  <div style={{ marginTop: '16px' }}>
                    <Button
                      type="primary"
                      size="small"
                      block
                      onClick={() => onNavigate('resource-list', { searchText: selectedNode.name })}
                    >
                      æŸ¥çœ‹è³‡æºè©³æƒ…
                    </Button>
                  </div>
                </div>
              )}
            </div>

            {/* æ“ä½œèªªæ˜ */}
            <div style={{
              marginTop: '16px',
              padding: '12px',
              backgroundColor: 'rgba(255, 255, 255, 0.05)',
              borderRadius: '6px',
              fontSize: '12px',
              color: 'rgba(255, 255, 255, 0.7)'
            }}>
              <div style={{ marginBottom: '8px', fontWeight: 'bold' }}>æ“ä½œèªªæ˜ï¼š</div>
              <div>â€¢ é»æ“Šç¯€é»æŸ¥çœ‹è©³ç´°è³‡è¨Š â€¢ æ‹–æ‹½ç¯€é»èª¿æ•´ä½ç½® â€¢ æ»¾è¼ªç¸®æ”¾ â€¢ æ‡¸åœæŸ¥çœ‹å·¥å…·æç¤º</div>
            </div>
          </Card>
        </div>
      );
    };

    const ResourcesPage = ({ onNavigate, pageKey, themeMode }) => {
      const tabKey = ['resource-overview', 'resource-groups', 'resource-topology'].includes(pageKey) ? pageKey : 'resource-overview';

      return (
        <React.Fragment>
          <PageHeader
            title="è³‡æºç®¡ç†"
            subtitle="æ¢ç´¢ã€çµ„ç¹”èˆ‡ç®¡ç†æ‚¨çš„æ‰€æœ‰åŸºç¤è¨­æ–½è³‡æº"
            icon={<HddOutlined />}
          />

          {/* ğŸ“Š è³‡æºç®¡ç†å„€è¡¨æ¿ - æ ¸å¿ƒæŒ‡æ¨™ç¸½è¦½ */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="ç¸½è³‡æºæ•¸"
                  value={374}
                  unit="å€‹"
                  status="success"
                  description="æ¶µè“‹æ‰€æœ‰æ¥­å‹™ç³»çµ±"
                  icon={<HddOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="å¥åº·è³‡æº"
                  value={326}
                  unit="å€‹"
                  status="success"
                  description="æ­£å¸¸é‹è¡Œä¸­"
                  icon={<SafetyCertificateOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="å‘Šè­¦è³‡æº"
                  value={35}
                  unit="å€‹"
                  status="warning"
                  description="éœ€è¦é—œæ³¨"
                  icon={<ExclamationCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="è³‡æºç¾¤çµ„"
                  value={12}
                  unit="çµ„"
                  status="info"
                  description="æ¥­å‹™é‚è¼¯åˆ†çµ„"
                  icon={<ApartmentOutlined />}
                />
              </Col>
            </Row>
          </div>

          <Tabs
            activeKey={tabKey}
            onChange={(key) => onNavigate(key)}
            style={{
              '--tab-bar-margin': '0 0 var(--spacing-lg) 0'
            }}
          >
            <Tabs.TabPane
              tab={
                <span>
                  <BarsOutlined />
                  è³‡æºåˆ—è¡¨
                </span>
              }
              key="resource-overview"
            >
              <IntegratedResourceOverviewPage themeMode={themeMode} onNavigate={onNavigate} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <ApartmentOutlined />
                  è³‡æºç¾¤çµ„
                </span>
              }
              key="resource-groups"
            >
              <ResourceGroupsDetailPage onNavigate={onNavigate} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <BranchesOutlined />
                  æ‹“æ’²è¦–åœ–
                </span>
              }
              key="resource-topology"
            >
              <ResourceTopologyDetailPage onNavigate={onNavigate} />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    // === ğŸ“Š åŸºç¤è¨­æ–½æ´å¯Ÿé é¢ ===
    const AlertsInsightsPage = ({ themeMode, onNavigate }) => {
      // è³‡æºçµ±è¨ˆè³‡æ–™ - å¾ ResourceOverviewTab ç§»å‹•éä¾†
      const resourceStats = {
        totalServers: 47,
        databases: 12,
        containers: 156,
        services: 23,
        healthyResources: 326,
        warningResources: 35,
        criticalResources: 13,
        totalResources: 374
      };

      return (
        <React.Fragment>
          {/* è³‡æºæ¦‚è¦½ KPI */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="ä¼ºæœå™¨ç¸½æ•¸"
                  value={resourceStats.totalServers}
                  unit="å°"
                  trend="stable"
                  status="success"
                  description="å¯¦é«”èˆ‡è™›æ“¬ä¼ºæœå™¨"
                  icon={<HddOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <div style={{ height: '140px' }}>
                  <ContextualKPICard
                    title="è³‡æ–™åº«"
                    value={resourceStats.databases}
                    unit="å€‹"
                    trend="stable"
                    status="info"
                    description="å„é¡å‹è³‡æ–™åº«å¯¦ä¾‹"
                    icon={<DatabaseOutlined />}
                  />
                </div>
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <div style={{ height: '140px' }}>
                  <ContextualKPICard
                    title="å®¹å™¨"
                    value={resourceStats.containers}
                    unit="å€‹"
                    trend="up"
                    status="info"
                    description="é‹è¡Œä¸­çš„å®¹å™¨å¯¦ä¾‹"
                    icon={<DeploymentUnitOutlined />}
                  />
                </div>
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <div style={{ height: '140px' }}>
                  <ContextualKPICard
                    title="æœå‹™"
                    value={resourceStats.services}
                    unit="å€‹"
                    trend="stable"
                    status="info"
                    description="è¨»å†Šçš„å¾®æœå‹™"
                    icon={<GlobalOutlined />}
                  />
                </div>
              </Col>
            </Row>
          </div>

          {/* ğŸ“Š è³‡æºåˆ—è¡¨ç¸½è¦½ */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <ResourceOverviewTab themeMode={themeMode} onNavigate={onNavigate} />
          </div>
        </React.Fragment>
      );
    };

    // === ğŸ› ï¸ è³‡æºåˆ—è¡¨å·¥ä½œå€ - å°ˆæ³¨æ–¼è³‡æºç®¡ç†å’Œæ“ä½œ ===
    const IntegratedResourceOverviewPage = ({ themeMode, onNavigate }) => {
      return (
        <React.Fragment>


          {/* ğŸ“Š è³‡æºæ¸…å–®è¡¨æ ¼ */}
          <ResourceListTab pageParams={{}} themeMode={themeMode} onNavigate={onNavigate} />
        </React.Fragment>
      );
    };

    // === ğŸ“ è³‡æºç¾¤çµ„è©³ç´°é é¢ - æ¥­å‹™å°å‘çš„è³‡æºçµ„ç¹”ç®¡ç† ===
    const ResourceGroupsDetailPage = ({ onNavigate }) => {
      return (
        <React.Fragment>
          {/* åŠŸèƒ½èªªæ˜å€å¡Š */}
          <Alert
            message="è³‡æºç¾¤çµ„ç®¡ç†"
            description="æŒ‰æ¥­å‹™é‚è¼¯çµ„ç¹”è³‡æºï¼Œæ–¹ä¾¿åœ˜éšŠå”ä½œå’Œæ¬Šé™ç®¡ç†ã€‚ä¸€å€‹è³‡æºå¯ä»¥å±¬æ–¼å¤šå€‹ç¾¤çµ„ï¼Œç¾¤çµ„å¯ä»¥åˆ†é…çµ¦ç‰¹å®šåœ˜éšŠé€²è¡Œç®¡ç†ã€‚"
            type="info"
            showIcon
            style={{ marginBottom: 'var(--spacing-lg)' }}
            action={
              <Space>
                <Button size="small" onClick={() => onNavigate('resource-overview')}>
                  è¿”å›ç¸½è¦½
                </Button>
                <Button size="small" type="link" onClick={() => onNavigate('platform-settings')}>
                  ç®¡ç†æ¨™ç±¤
                </Button>
              </Space>
            }
          />

          {/* åµŒå…¥åŸæœ‰çš„è³‡æºç¾¤çµ„åŠŸèƒ½ */}
          <ResourceGroupsTab onNavigate={onNavigate} />
        </React.Fragment>
      );
    };

    // === ğŸ”— è³‡æºæ‹“æ’²è©³ç´°é é¢ - ä¾è³´é—œä¿‚å’Œå½±éŸ¿åˆ†æ ===
    const ResourceTopologyDetailPage = ({ onNavigate }) => {
      return (
        <React.Fragment>
          {/* åŠŸèƒ½èªªæ˜å€å¡Š */}
          <Alert
            message="è³‡æºæ‹“æ’²è¦–åœ–"
            description="è¦–è¦ºåŒ–å±•ç¤ºè³‡æºé–“çš„ä¾è³´é—œä¿‚ï¼Œå¹«åŠ©ç†è§£ç³»çµ±æ¶æ§‹å’Œé€²è¡Œå½±éŸ¿åˆ†æã€‚æ”¯æ´æ•…éšœè¿½è¹¤å’Œè®Šæ›´å½±éŸ¿è©•ä¼°ã€‚"
            type="info"
            showIcon
            style={{ marginBottom: 'var(--spacing-lg)' }}
            action={
              <Space>
                <Button size="small" onClick={() => onNavigate('resource-overview')}>
                  è¿”å›ç¸½è¦½
                </Button>
                <Button size="small" onClick={() => onNavigate('resource-groups')}>
                  æŸ¥çœ‹ç¾¤çµ„
                </Button>
              </Space>
            }
          />

          {/* åµŒå…¥åŸæœ‰çš„æ‹“æ’²åŠŸèƒ½ */}
          <ResourceTopologyTab onNavigate={onNavigate} />
        </React.Fragment>
      );
    };

    const IncidentsPage = ({ onNavigate, pageKey }) => {
      const tabKey = ['incident-list', 'alerting-rules', 'silences'].includes(pageKey) ? pageKey : 'incident-list';

      // äº‹ä»¶ç®¡ç†è©³ç´°çµ±è¨ˆ - å°ˆæ³¨äº‹ä»¶è™•ç†æµç¨‹
      const incidentStats = {
        activeIncidents: 5, // ç•¶å‰æ´»èºäº‹ä»¶ï¼ˆæ–°å¢+è™•ç†ä¸­ï¼‰
        criticalIncidents: 2,
        acknowledgedIncidents: 3,
        todayResolved: 12,
        avgResolutionTime: 2.5,
        escalationRate: 8.3, // å‡ç´šç‡ç™¾åˆ†æ¯”
        automatedResolved: 7, // è‡ªå‹•è§£æ±ºçš„äº‹ä»¶æ•¸
        automationRate: 35.2, // è‡ªå‹•åŒ–è™•ç†ç‡ç™¾åˆ†æ¯”
        automatedExecutions: 4 // ä»Šæ—¥è‡ªå‹•åŒ–åŸ·è¡Œæ¬¡æ•¸
      };

      return (
        <React.Fragment>
          <PageHeader
            title="äº‹ä»¶ç®¡ç†"
            subtitle="é›†ä¸­ç®¡ç†äº‹ä»¶ã€å®šç¾©è¦å‰‡ä¸¦è¨­å®šéœéŸ³ï¼Œå»ºç«‹å®Œæ•´çš„äº‹ä»¶ç®¡ç†æµç¨‹"
            icon={<ExclamationCircleOutlined />}
          />

          {/* ğŸ¯ äº‹ä»¶è™•ç†æµç¨‹å„€è¡¨æ¿ - å°ˆæ³¨è™•ç†æ•ˆç‡ */}
          <div className="kpi-grid" style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} md={6} lg={6}>
                <ContextualKPICard
                  title="æ´»èºäº‹ä»¶"
                  value={incidentStats.activeIncidents}
                  unit="ä»¶"
                  status={incidentStats.criticalIncidents > 0 ? 'critical' : incidentStats.activeIncidents > 3 ? 'warning' : 'success'}
                  description={`${incidentStats.criticalIncidents} ä»¶åš´é‡ï¼Œ${incidentStats.acknowledgedIncidents} ä»¶è™•ç†ä¸­`}
                  icon={<FireOutlined />}
                  onClick={() => onNavigate('incident-list', { statusFilter: 'active' })}
                  style={{ cursor: 'pointer' }}
                />
              </Col>
              <Col xs={24} sm={12} md={6} lg={6}>
                <ContextualKPICard
                  title="ä»Šæ—¥å·²è§£æ±º"
                  value={incidentStats.todayResolved}
                  unit="ä»¶"
                  trend="+8%"
                  status="success"
                  description={`${incidentStats.automatedResolved} ä»¶è‡ªå‹•è§£æ±º`}
                  icon={<CheckCircleOutlined />}
                  onClick={() => onNavigate('incident-list', { statusFilter: 'resolved', timeFilter: 'today' })}
                  style={{ cursor: 'pointer' }}
                />
              </Col>
              <Col xs={24} sm={12} md={6} lg={6}>
                <ContextualKPICard
                  title="å¹³å‡è§£æ±ºæ™‚é–“"
                  value={incidentStats.avgResolutionTime}
                  unit="å°æ™‚"
                  trend="-15%"
                  status="success"
                  description="è¼ƒä¸Šé€±å¤§å¹…æ”¹å–„"
                  icon={<ClockCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6} lg={6}>
                <ContextualKPICard
                  title="è‡ªå‹•åŒ–è™•ç†ç‡"
                  value={incidentStats.automationRate}
                  unit="%"
                  status="success"
                  description={`ä»Šæ—¥ ${incidentStats.automatedExecutions} ä»¶è‡ªå‹•è§£æ±º`}
                  icon={<ThunderboltOutlined />}
                  onClick={() => onNavigate('automation', { subTab: 'executions', filter: 'alert-triggered' })}
                  style={{ cursor: 'pointer' }}
                />
              </Col>
            </Row>
          </div>
          <Tabs defaultActiveKey={tabKey} onChange={(key) => onNavigate(key)}>
            <Tabs.TabPane tab="äº‹ä»¶åˆ—è¡¨" key="incident-list">
              <IncidentListPage onNavigate={onNavigate} />
            </Tabs.TabPane>
            <Tabs.TabPane tab="äº‹ä»¶è¦å‰‡" key="alerting-rules">
              <AlertingRulesPage />
            </Tabs.TabPane>
            <Tabs.TabPane tab="éœéŸ³è¦å‰‡" key="silences">
              <SilencesPage />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    const AnalyzingPage = ({ onNavigate, pageKey, themeMode }) => {
      const tabKey = [
        'capacity-planning',
        'performance-insights',
        'incident-trends',
        'cost-analysis',
        'mttr-analysis',
        'sla-reports'
      ].includes(pageKey) ? pageKey : 'capacity-planning';

      // åˆ†æçµ±è¨ˆè³‡æ–™
      const analysisStats = {
        totalDataPoints: 15420,
        analysisReports: 28,
        avgProcessingTime: 3.2,
        accuracyRate: 96.8,
        resourceUtilization: 78.5,
        costSavings: 24300
      };

      return (
        <React.Fragment>
          <PageHeader
            title="åˆ†æä¸­å¿ƒ"
            subtitle="æ·±å…¥äº†è§£ç³»çµ±è¶¨å‹¢ã€æ•ˆèƒ½ç“¶é ¸å’Œé‹ç‡Ÿæ•¸æ“šï¼Œåšå‡ºæ•¸æ“šé©…å‹•çš„æ±ºç­–"
            icon={<BarChartOutlined />}
          />

          {/* åˆ†æ KPI å„€è¡¨æ¿ */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="æ•¸æ“šé»ç¸½æ•¸"
                  value={analysisStats.totalDataPoints.toLocaleString()}
                  unit="å€‹"
                  trend="+8.2%"
                  status="success"
                  description="éå» 24 å°æ™‚æ”¶é›†"
                  icon={<LineChartOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="åˆ†æå ±å‘Š"
                  value={analysisStats.analysisReports}
                  unit="ä»½"
                  trend="+12.5%"
                  status="info"
                  description="æœ¬æœˆç”Ÿæˆå ±å‘Š"
                  icon={<FileTextOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="è™•ç†æ™‚é–“"
                  value={analysisStats.avgProcessingTime}
                  unit="ç§’"
                  trend="-15.3%"
                  status="success"
                  description="å¹³å‡åˆ†æè™•ç†æ™‚é–“"
                  icon={<ClockCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="æº–ç¢ºç‡"
                  value={analysisStats.accuracyRate}
                  unit="%"
                  trend="+2.1%"
                  status="success"
                  description="AI é æ¸¬æº–ç¢ºç‡"
                  icon={<RobotOutlined />}
                />
              </Col>
            </Row>
          </div>

          <Tabs
            defaultActiveKey={tabKey}
            onChange={(key) => onNavigate(key)}
            style={{
              '--tab-bar-margin': '0 0 var(--spacing-lg) 0'
            }}
          >
            <Tabs.TabPane
              tab={
                <span>
                  <PieChartOutlined />
                  å®¹é‡è¦åŠƒ
                </span>
              }
              key="capacity-planning"
            >
              <CapacityPlanningPage themeMode={themeMode} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <ThunderboltOutlined />
                  æ€§èƒ½æ´å¯Ÿ
                </span>
              }
              key="performance-insights"
            >
              <PlaceholderPage title="æ€§èƒ½æ´å¯Ÿ" subtitle="æ·±å…¥åˆ†æç³»çµ±æ€§èƒ½ç“¶é ¸ï¼Œæä¾›æ™ºèƒ½å„ªåŒ–å»ºè­°ã€‚" icon={<ThunderboltOutlined />} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <LineChartOutlined />
                  äº‹ä»¶è¶¨å‹¢
                </span>
              }
              key="incident-trends"
            >
              <PlaceholderPage title="äº‹ä»¶è¶¨å‹¢åˆ†æ" subtitle="åˆ†æäº‹ä»¶ç™¼ç”Ÿæ¨¡å¼ï¼Œè­˜åˆ¥é‡è¤‡å•é¡Œå’Œæ ¹æœ¬åŸå› ã€‚" icon={<LineChartOutlined />} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <DollarOutlined />
                  æˆæœ¬åˆ†æ
                </span>
              }
              key="cost-analysis"
            >
              <PlaceholderPage title="æˆæœ¬åˆ†æ" subtitle="è¿½è¹¤è³‡æºä½¿ç”¨æˆæœ¬ï¼Œè­˜åˆ¥æˆæœ¬ç¯€ç´„æ©Ÿæœƒã€‚" icon={<DollarOutlined />} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <FieldTimeOutlined />
                  MTTR åˆ†æ
                </span>
              }
              key="mttr-analysis"
            >
              <PlaceholderPage title="MTTR åˆ†æ" subtitle="è¿½è¹¤å¹³å‡ä¿®å¾©æ™‚é–“ï¼Œæ‰¾å‡ºæ•ˆç‡æ”¹å–„æ©Ÿæœƒã€‚" icon={<FieldTimeOutlined />} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <FileDoneOutlined />
                  SLA å ±å‘Š
                </span>
              }
              key="sla-reports"
            >
              <PlaceholderPage title="SLA å ±å‘Š" subtitle="è¿½è¹¤æœå‹™ç´šåˆ¥å”è­°çš„é”æˆæƒ…æ³å’Œè¶¨å‹¢åˆ†æã€‚" icon={<FileDoneOutlined />} />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    const AutomationCenterPage = ({ onNavigate, pageKey, scripts, setScripts, addExecution, executions, setExecutions, schedules, setSchedules, pageParams }) => {
      // æ ¹æ“š pageParams ç¢ºå®šé è¨­ Tab
      const defaultTab = pageParams && pageParams.subTab === 'executions' ? 'executions' : 'scripts';
      const tabKey = ['scripts', 'schedules', 'executions'].includes(pageKey) ? pageKey : defaultTab;

      // è¨ˆç®—è‡ªå‹•åŒ– KPI
      const totalScripts = scripts.length;
      const activeScripts = scripts.filter(s => s.status === 'active').length;
      const successfulExecutions = executions.filter(e => e.status === 'success').length;
      const totalExecutions = executions.length;
      const successRate = totalExecutions > 0 ? ((successfulExecutions / totalExecutions) * 100) : 100;
      const recentExecutions = executions.filter(e =>
        dayjs().diff(dayjs(e.start_time), 'hours') <= 24
      ).length;

      return (
        <React.Fragment>
          <PageHeader
            title="è‡ªå‹•åŒ–ä¸­å¿ƒ"
            subtitle="ç®¡ç†è‡ªå‹•åŒ–è…³æœ¬ã€æ’ç¨‹ä»»å‹™èˆ‡åŸ·è¡Œæ­·å²ï¼Œæå‡é‹ç¶­æ•ˆç‡"
            icon={<CodeOutlined />}
          />

          {/* è‡ªå‹•åŒ– KPI å„€è¡¨æ¿ */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="è…³æœ¬ç¸½æ•¸"
                  value={totalScripts}
                  unit="å€‹"
                  trend={totalScripts > 20 ? 'up' : 'stable'}
                  status="success"
                  description={`${activeScripts} å€‹å•Ÿç”¨ä¸­`}
                  icon={<CodeOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="åŸ·è¡ŒæˆåŠŸç‡"
                  value={successRate}
                  unit="%"
                  trend={successRate >= 95 ? 'up' : successRate >= 85 ? 'stable' : 'down'}
                  status={successRate >= 95 ? 'success' : successRate >= 85 ? 'warning' : 'critical'}
                  description={`${successfulExecutions}/${totalExecutions} æ¬¡åŸ·è¡Œ`}
                  icon={<CheckCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="24å°æ™‚åŸ·è¡Œ"
                  value={recentExecutions}
                  unit="æ¬¡"
                  trend={recentExecutions > 50 ? 'up' : 'stable'}
                  status="info"
                  description="éå»ä¸€å¤©çš„åŸ·è¡Œæ¬¡æ•¸"
                  icon={<ClockCircleOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={6}>
                <ContextualKPICard
                  title="æ’ç¨‹ä»»å‹™"
                  value={scripts.filter(s => s.schedule).length}
                  unit="å€‹"
                  trend="stable"
                  status="info"
                  description="å·²è¨­å®šæ’ç¨‹çš„è…³æœ¬"
                  icon={<ScheduleOutlined />}
                />
              </Col>
            </Row>
          </div>

          {/* è¤‡åˆæ¦‚è¦è¦–åœ– */}
          <Row gutter={[24, 24]} style={{ marginBottom: 'var(--spacing-xl)' }}>
            {/* æœ€è¿‘åŸ·è¡Œæ—¥èªŒ */}
            <Col xs={24} lg={16}>
              <Card
                className="dashboard-card"
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <HistoryOutlined style={{ color: '#1890ff' }} />
                    <span>æœ€è¿‘åŸ·è¡Œæ—¥èªŒ</span>
                    <Badge count={recentExecutions} style={{ marginLeft: 'auto' }} />
                  </div>
                }
                bodyStyle={{ padding: '12px' }}
                style={{ height: '320px', display: 'flex', flexDirection: 'column' }}
              >
                <div style={{ flex: 1, overflowY: 'auto' }}>
                  {executions.slice(0, 5).map(execution => (
                    <div key={execution.key} style={{
                      display: 'flex',
                      alignItems: 'center',
                      padding: '8px 12px',
                      marginBottom: '8px',
                      backgroundColor: 'rgba(255, 255, 255, 0.02)',
                      borderRadius: '6px',
                      border: '1px solid rgba(255, 255, 255, 0.06)'
                    }}>
                      <div style={{ marginRight: '12px' }}>
                        {execution.status === 'success' ? (
                          <CheckCircleOutlined style={{ color: '#52c41a' }} />
                        ) : execution.status === 'failed' ? (
                          <ExclamationCircleOutlined style={{ color: '#ff4d4f' }} />
                        ) : (
                          <ClockCircleOutlined style={{ color: '#faad14' }} />
                        )}
                      </div>
                      <div style={{ flex: 1 }}>
                        <div style={{ fontWeight: 500, marginBottom: '2px' }}>
                          {scripts.find(s => s.id === execution.script_id)?.name || `è…³æœ¬ ${execution.script_id}`}
                        </div>
                        <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                          {dayjs(execution.start_time).format('MM-DD HH:mm')} â€¢
                          è€—æ™‚ {execution.duration}ms
                        </div>
                      </div>
                      <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.8)' }}>
                        {execution.triggeredBy}
                      </div>
                    </div>
                  ))}
                </div>
              </Card>
            </Col>

            {/* ç†±é–€è…³æœ¬ */}
            <Col xs={24} lg={8}>
              <Card
                className="dashboard-card"
                title={
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <FireOutlined style={{ color: '#ff7a45' }} />
                    <span>ç†±é–€è…³æœ¬</span>
                  </div>
                }
                bodyStyle={{ padding: '12px' }}
                style={{ height: '320px', display: 'flex', flexDirection: 'column' }}
              >
                <div style={{ flex: 1, overflowY: 'auto' }}>
                  {scripts && scripts.length > 0 ? scripts
                    .filter(s => s.status === 'active')
                    .sort((a, b) => (b.executionCount || 0) - (a.executionCount || 0))
                    .slice(0, 3)
                    .map((script, index) => (
                      <div key={`hot-script-${script.key}-${index}`} style={{
                        display: 'flex',
                        alignItems: 'center',
                        padding: '8px',
                        marginBottom: '6px',
                        backgroundColor: 'rgba(255, 255, 255, 0.03)',
                        borderRadius: '6px',
                        border: '1px solid rgba(255, 255, 255, 0.08)',
                        cursor: 'pointer',
                        transition: 'all 0.2s ease'
                      }}
                        onMouseEnter={(e) => {
                          e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.06)';
                          e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.15)';
                        }}
                        onMouseLeave={(e) => {
                          e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.03)';
                          e.currentTarget.style.borderColor = 'rgba(255, 255, 255, 0.08)';
                        }}>
                        <div style={{
                          width: '24px',
                          height: '24px',
                          backgroundColor: index === 0 ? '#ff7a45' : index === 1 ? '#ffa940' : '#fadb14',
                          borderRadius: '50%',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          fontSize: '12px',
                          fontWeight: 'bold',
                          color: '#fff',
                          marginRight: '12px'
                        }}>
                          {index + 1}
                        </div>
                        <div style={{ marginRight: '12px' }}>
                          <Tag color={script.category === 'monitoring' ? 'blue' :
                            script.category === 'deployment' ? 'green' :
                              script.category === 'maintenance' ? 'orange' :
                                script.category === 'performance' ? 'purple' : 'default'}>
                            {script.category === 'monitoring' ? 'ç›£æ§' :
                              script.category === 'deployment' ? 'éƒ¨ç½²' :
                                script.category === 'maintenance' ? 'ç¶­è­·' :
                                  script.category === 'performance' ? 'æ•ˆèƒ½' : 'å…¶ä»–'}
                          </Tag>
                        </div>
                        <div style={{ flex: 1 }}>
                          <div style={{ fontWeight: 500, marginBottom: '4px', color: 'rgba(255, 255, 255, 0.9)' }}>
                            {script.name}
                          </div>
                          <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                            åŸ·è¡Œ {script.executionCount || 0} æ¬¡ â€¢ å»ºç«‹è€…ï¼š{script.creator}
                          </div>
                        </div>
                        <div style={{ textAlign: 'right' }}>
                          <div style={{
                            fontSize: '16px',
                            fontWeight: 'bold',
                            color: '#ff7a45',
                            marginBottom: '2px'
                          }}>
                            {script.executionCount || 0}
                          </div>
                          <div style={{ fontSize: '10px', color: 'rgba(255, 255, 255, 0.5)' }}>
                            æ¬¡åŸ·è¡Œ
                          </div>
                        </div>
                      </div>
                    )) :
                    <div style={{
                      textAlign: 'center',
                      padding: '24px',
                      color: 'rgba(255, 255, 255, 0.6)'
                    }}>
                      æš«ç„¡è…³æœ¬æ•¸æ“š
                    </div>
                  }
                </div>
              </Card>
            </Col>
          </Row>

          <Tabs
            defaultActiveKey={tabKey}
            onChange={(key) => onNavigate(key)}
            style={{
              '--tab-bar-margin': '0 0 var(--spacing-lg) 0'
            }}
          >
            <Tabs.TabPane
              tab={
                <span>
                  <CodeOutlined />
                  è…³æœ¬åº«
                </span>
              }
              key="scripts"
            >
              <ScriptsPage scripts={scripts} setScripts={setScripts} addExecution={addExecution} schedules={schedules} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <ScheduleOutlined />
                  æ’ç¨‹ç®¡ç†
                </span>
              }
              key="schedules"
            >
              <SchedulesPage scripts={scripts} schedules={schedules} setSchedules={setSchedules} onNavigate={onNavigate} />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <HistoryOutlined />
                  åŸ·è¡Œæ—¥èªŒ
                </span>
              }
              key="executions"
            >
              <ExecutionsPage executions={executions} setExecutions={setExecutions} pageParams={pageParams} />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    const AdvancedIncidentFilter = ({ onFilterChange, initialFilters }) => {
      const [filters, setFilters] = useState(initialFilters || {
        timeRange: null,
        severity: [],
        status: [],
        resourceName: ''
      });

      const handleFilter = () => {
        onFilterChange(filters);
      };

      const resetFilters = () => {
        const newFilters = { timeRange: null, severity: [], status: [], resourceName: '' };
        setFilters(newFilters);
        onFilterChange(newFilters);
      }

      return (
        <div style={{
          width: '320px',
          padding: '16px',
          maxHeight: '500px',
          overflowY: 'auto'
        }}>
          <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
            <div>
              <div style={{
                marginBottom: '8px',
                fontWeight: 600,
                color: 'rgba(255, 255, 255, 0.9)',
                fontSize: '13px'
              }}>
                æ™‚é–“ç¯„åœ
              </div>
              <DatePicker.RangePicker
                style={{ width: '100%' }}
                size="small"
                value={filters.timeRange}
                onChange={(dates) => setFilters(f => ({ ...f, timeRange: dates }))}
                placeholder={['é–‹å§‹æ—¥æœŸ', 'çµæŸæ—¥æœŸ']}
              />
            </div>
            <div>
              <div style={{
                marginBottom: '8px',
                fontWeight: 600,
                color: 'rgba(255, 255, 255, 0.9)',
                fontSize: '13px'
              }}>
                åš´é‡æ€§
              </div>
              <Select
                mode="multiple"
                allowClear
                size="small"
                style={{ width: '100%' }}
                placeholder="é¸æ“‡åš´é‡æ€§"
                value={filters.severity}
                onChange={(value) => setFilters(f => ({ ...f, severity: value }))}
                maxTagCount={2}
                maxTagPlaceholder={(omittedValues) => `+${omittedValues.length}`}
              >
                <Select.Option value="critical">
                  <span style={{ color: '#ff4d4f' }}>ğŸ”´ Critical</span>
                </Select.Option>
                <Select.Option value="warning">
                  <span style={{ color: '#faad14' }}>ğŸŸ¡ Warning</span>
                </Select.Option>
              </Select>
            </div>
            <div>
              <div style={{
                marginBottom: '8px',
                fontWeight: 600,
                color: 'rgba(255, 255, 255, 0.9)',
                fontSize: '13px'
              }}>
                ç‹€æ…‹
              </div>
              <Select
                mode="multiple"
                allowClear
                size="small"
                style={{ width: '100%' }}
                placeholder="é¸æ“‡ç‹€æ…‹"
                value={filters.status}
                onChange={(value) => setFilters(f => ({ ...f, status: value }))}
                maxTagCount={2}
                maxTagPlaceholder={(omittedValues) => `+${omittedValues.length}`}
              >
                <Select.Option value="new">ğŸ†• New</Select.Option>
                <Select.Option value="acknowledged">âœ… Acknowledged</Select.Option>
                <Select.Option value="resolved">ğŸ¯ Resolved</Select.Option>
              </Select>
            </div>
            <div>
              <div style={{
                marginBottom: '8px',
                fontWeight: 600,
                color: 'rgba(255, 255, 255, 0.9)',
                fontSize: '13px'
              }}>
                è³‡æºåç¨±
              </div>
              <Input
                placeholder="è¼¸å…¥è³‡æºåç¨±"
                size="small"
                value={filters.resourceName}
                onChange={(e) => setFilters(f => ({ ...f, resourceName: e.target.value }))}
                allowClear
              />
            </div>
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              gap: '8px',
              paddingTop: '12px',
              borderTop: '1px solid rgba(255, 255, 255, 0.1)'
            }}>
              <Button
                onClick={resetFilters}
                style={{
                  flex: 1,
                  background: 'rgba(255, 255, 255, 0.05)',
                  borderColor: 'rgba(255, 255, 255, 0.2)'
                }}
              >
                é‡è¨­
              </Button>
              <Button
                type="primary"
                onClick={handleFilter}
                style={{ flex: 1 }}
              >
                å¥—ç”¨ç¯©é¸
              </Button>
            </div>
          </div>
        </div>
      );
    };


    const IncidentListPage = ({ onNavigate, pageParams }) => {
      const initialData = [
        // è¨»ï¼šæ“´å……æ¬„ä½ä»¥ç¬¦åˆ pages-param.md å’Œ db_schema.sql v2.0
        { key: 'i_1', summary: 'CPU high on db-mysql-prod-02', severity: 'critical', source: 'Prometheus', status: 'acknowledged', created_at: dayjs().subtract(5, 'minutes'), automation_id: null, assignee: 'user_2', resource_name: 'db-mysql-prod-02', service: 'è³‡æ–™åº«æœå‹™', business_impact: 'é«˜', storm_group: null, rule_id: 'rule_1', ruleName: 'é«˜ CPU ä½¿ç”¨ç‡', threshold: 90, labels: { "cluster": "prod-db" }, annotations: { "playbook": "http://runbook/cpu" }, triggerThreshold: 'CPU > 90%' },
        { key: 'i_2', summary: 'Disk space low on srv-web-prod-02', severity: 'warning', source: 'Grafana', status: 'new', created_at: dayjs().subtract(2, 'hour'), automation_id: 'e_1', assignee: null, resource_name: 'srv-web-prod-02', service: 'Webæ‡‰ç”¨', business_impact: 'ä¸­', storm_group: null, rule_id: 'rule_2', ruleName: 'ç£ç¢Ÿç©ºé–“ä¸è¶³', threshold: 15, labels: { "cluster": "prod-web" }, annotations: {}, triggerThreshold: 'Disk < 15%' },
        { key: 'i_3', summary: 'API latency over 500ms', severity: 'warning', source: 'Datadog', status: 'acknowledged', created_at: dayjs().subtract(1, 'day'), assignee: 'user_4', resource_name: 'srv-api-prod-01', service: 'APIé–˜é“', business_impact: 'é«˜', storm_group: null, rule_id: 'rule_3', ruleName: 'API å»¶é²éé«˜', threshold: 500, labels: {}, annotations: { "description": "P95 latency is high" }, triggerThreshold: 'P95 Latency > 500ms' },
        { key: 'i_4', summary: 'Prometheus Server Down', severity: 'critical', source: 'Kubernetes', status: 'resolved', created_at: dayjs().subtract(3, 'day'), assignee: 'user_1', resource_name: 'mon-prometheus-prod-01', service: 'ç›£æ§ç³»çµ±', business_impact: 'ä¸­', storm_group: null, rule_id: 'rule_4', ruleName: 'åŸºç¤è¨­æ–½ç›£æ§', threshold: 1, labels: { "service": "monitoring" }, annotations: {}, triggerThreshold: 'Pod is not ready' },
        { key: 'i_5', summary: 'è¨˜æ†¶é«”ä½¿ç”¨ç‡éé«˜ - staging', severity: 'warning', source: 'Prometheus', status: 'new', created_at: dayjs().subtract(15, 'minutes'), automation_id: null, assignee: null, resource_name: 'srv-web-stg-01', service: 'Webæ‡‰ç”¨', business_impact: 'ä½', storm_group: null, rule_id: 'rule_5', ruleName: 'æ¸¬è©¦ç’°å¢ƒè³‡æºç›£æ§', threshold: 80, labels: { "env": "staging" }, annotations: {}, triggerThreshold: 'Memory > 80%' },
        { key: 'i_6', summary: 'Cache Redis Memory Full', severity: 'critical', source: 'Grafana', status: 'new', created_at: dayjs().subtract(30, 'minutes'), automation_id: null, assignee: null, resource_name: 'cache-redis-prod-01', service: 'å¿«å–æœå‹™', business_impact: 'é«˜', storm_group: null, rule_id: 'rule_6', ruleName: 'å¿«å–æœå‹™ç›£æ§', threshold: 95, labels: { "service": "cache" }, annotations: {}, triggerThreshold: 'Memory > 95%' },
        { key: 'i_7', summary: 'Web Server 503 Errors', severity: 'critical', source: 'Datadog', status: 'new', created_at: dayjs().subtract(2, 'minutes'), automation_id: null, assignee: null, resource_name: 'srv-web-prod-01', service: 'Webæ‡‰ç”¨', business_impact: 'é«˜', storm_group: 'storm_1', rule_id: 'rule_7', ruleName: 'Web æœå‹™å¯ç”¨æ€§', threshold: 5, labels: { "error_type": "5xx" }, annotations: {}, triggerThreshold: '5xx errors > 5%' },
        { key: 'i_8', summary: 'Load Balancer High Traffic', severity: 'warning', source: 'Prometheus', status: 'new', created_at: dayjs().subtract(3, 'minutes'), automation_id: null, assignee: null, resource_name: 'net-lb-prod-01', service: 'è² è¼‰å¹³è¡¡', business_impact: 'ä¸­', storm_group: 'storm_1', rule_id: 'rule_8', ruleName: 'ç¶²è·¯æµé‡ç›£æ§', threshold: 1000, labels: {}, annotations: {}, triggerThreshold: 'Traffic > 1Gbps' },
        { key: 'i_9', summary: 'Database Connection Pool Full', severity: 'critical', source: 'Grafana', status: 'new', created_at: dayjs().subtract(2, 'minutes'), automation_id: null, assignee: null, resource_name: 'db-mysql-prod-01', service: 'è³‡æ–™åº«æœå‹™', business_impact: 'é«˜', storm_group: 'storm_1', rule_id: 'rule_9', ruleName: 'è³‡æ–™åº«é€£ç·šæ± ç›£æ§', threshold: 98, labels: {}, annotations: {}, triggerThreshold: 'Connection Pool > 98%' },
      ];
      const [incidents, setIncidents] = useLocalStorageState('sre-incidents-v4', initialData);
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);
      const [currentIncident, setCurrentIncident] = useState(null);
      const [isSilenceModalOpen, setIsSilenceModalOpen] = useState(false);
      const [silenceIncident, setSilenceIncident] = useState(null);
      const [silenceDuration, setSilenceDuration] = useState(1);
      const { message, modal } = antd.App.useApp();
      const [isAIAnalysisModalOpen, setIsAIAnalysisModalOpen] = useState(false);
      const [analyzedIncidents, setAnalyzedIncidents] = useState([]);
      const [quickFilters, setQuickFilters] = useState({
        new: false
      });
      const [advancedFilters, setAdvancedFilters] = useState({
        timeRange: null,
        severity: [],
        status: [],
        resourceName: ''
      });
      const [isFilterOpen, setIsFilterOpen] = useState(false);

      // æ ¹æ“š pageParams åˆå§‹åŒ–ç¯©é¸
      React.useEffect(() => {
        if (pageParams) {
          if (pageParams.statusFilter === 'active') {
            setAdvancedFilters(prev => ({
              ...prev,
              status: ['new', 'acknowledged']
            }));
            message.info('å·²ç¯©é¸é¡¯ç¤ºæ´»èºäº‹ä»¶');
          } else if (pageParams.statusFilter === 'resolved' && pageParams.timeFilter === 'today') {
            setAdvancedFilters(prev => ({
              ...prev,
              status: ['resolved'],
              timeRange: [dayjs().startOf('day'), dayjs().endOf('day')]
            }));
            message.info('å·²ç¯©é¸é¡¯ç¤ºä»Šæ—¥å·²è§£æ±ºäº‹ä»¶');
          }
        }
      }, [pageParams]);

      // æ¬„ä½è‡ªè¨‚åŠŸèƒ½
      const defaultVisibleColumns = {
        severity: true,
        summary: true,
        resource_name: true,
        business_impact: true,
        ruleName: false, // é è¨­éš±è—
        triggerThreshold: false, // é è¨­éš±è—
        status: true,
        assignee: true,
        created_at: true,
        action: true
      };
      const [visibleColumns, setVisibleColumns] = useLocalStorageState('sre-incident-columns', defaultVisibleColumns);
      const [isColumnSettingsOpen, setIsColumnSettingsOpen] = useState(false);

      const handleStatusChange = (keys, newStatus) => {
        const actionText = newStatus === 'acknowledged' ? 'ç¢ºèª' : 'è§£æ±º';
        setIncidents(incidents.map(inc => (keys.includes(inc.key) ? { ...inc, status: newStatus } : inc)));
        message.success(`äº‹ä»¶ç‹€æ…‹å·²æ›´æ–°`);
        if (isDetailModalOpen) {
          setCurrentIncident(prev => ({ ...prev, status: newStatus }));
        }
      };

      const handleBatchUpdate = (newStatus) => {
        const actionText = newStatus === 'acknowledged' ? 'ç¢ºèª' : 'è§£æ±º';
        modal.confirm({
          title: `ç¢ºå®šè¦æ‰¹æ¬¡ ${actionText} ${selectedRowKeys.length} å€‹äº‹ä»¶å—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          onOk() {
            handleStatusChange(selectedRowKeys, newStatus);
            setSelectedRowKeys([]);
          }
        });
      };

      const handleAIAnalysis = (selectedKeys = null) => {
        const keysToAnalyze = selectedKeys || selectedRowKeys;
        if (keysToAnalyze.length === 0) {
          message.warning('è«‹å…ˆé¸æ“‡è¦åˆ†æçš„äº‹ä»¶');
          return;
        }
        const incidentsToAnalyze = incidents.filter(incident => keysToAnalyze.includes(incident.key));
        setAnalyzedIncidents(incidentsToAnalyze);
        setIsAIAnalysisModalOpen(true);
      };

      // è™•ç†å¿«é€Ÿç¯©é¸
      const handleQuickFilter = (filterType) => {
        setQuickFilters(prev => {
          const newFilters = { ...prev };
          // åˆ‡æ›ç•¶å‰ç¯©é¸å™¨
          newFilters[filterType] = !newFilters[filterType];
          return newFilters;
        });
      };

      const showDetailModal = (record) => {
        setCurrentIncident(record);
        setIsDetailModalOpen(true);
      };

      const showSilenceModal = (record) => {
        setSilenceIncident(record);
        setSilenceDuration(1); // é è¨­1å°æ™‚
        setIsSilenceModalOpen(true);
      };

      const hideSilenceModal = () => {
        setIsSilenceModalOpen(false);
        setSilenceIncident(null);
        setSilenceDuration(1);
      };

      const handleSilence = () => {
        if (!silenceIncident) return;

        // å»ºç«‹éœéŸ³è¦å‰‡çš„åŒ¹é…æ¢ä»¶
        const matchers = [
          { key: 'alert_name', op: '=', value: silenceIncident.summary },
          { key: 'resource_name', op: '=', value: silenceIncident.resource_name },
          { key: 'severity', op: '=', value: silenceIncident.severity }
        ];

        // å»ºç«‹éœéŸ³è¦å‰‡ç‰©ä»¶
        const silenceRule = {
          key: `s_temp_${Date.now()}`,
          name: `è‡¨æ™‚éœéŸ³ - ${silenceIncident.summary}`,
          description: `è‡¨æ™‚éœéŸ³è¦å‰‡ï¼Œç”±äº‹ä»¶åˆ—è¡¨å¿«é€Ÿå»ºç«‹`,
          type: 'once',
          timeRange: [
            dayjs(),
            dayjs().add(silenceDuration, 'hour')
          ],
          matchers: matchers,
          creator: 'admin', // æ‡‰è©²å¾ç•¶å‰äººå“¡ç²å–
          enabled: true,
          createdFromIncident: silenceIncident.key
        };

        // å–å¾—ç¾æœ‰çš„éœéŸ³è¦å‰‡ä¸¦æ–°å¢æ–°è¦å‰‡
        const existingSilences = JSON.parse(localStorage.getItem('sre-silences-v2') || '[]');
        existingSilences.push(silenceRule);
        localStorage.setItem('sre-silences-v2', JSON.stringify(existingSilences));

        // æ›´æ–°ç•¶å‰äº‹ä»¶çš„ç‹€æ…‹ç‚ºéœéŸ³
        setIncidents(incidents.map(inc =>
          inc.key === silenceIncident.key
            ? { ...inc, status: 'silenced', silencedUntil: dayjs().add(silenceDuration, 'hour') }
            : inc
        ));

        message.success(`å·²å»ºç«‹ ${silenceDuration} å°æ™‚çš„éœéŸ³è¦å‰‡`);
        hideSilenceModal();
      };

      // å®šç¾©æ‰€æœ‰å¯èƒ½çš„æ¬„ä½
      const allColumns = {
        severity: {
          title: 'åš´é‡æ€§',
          dataIndex: 'severity',
          width: '8%',
          sorter: (a, b) => a.severity.localeCompare(b.severity),
          render: (severity) => (
            <span className={`status-badge status-${severity}`}>
              {severity ? severity.toUpperCase() : 'UNKNOWN'}
            </span>
          )
        },
        summary: { title: 'æ‘˜è¦', dataIndex: 'summary', width: '18%', sorter: (a, b) => a.summary.localeCompare(b.summary), render: (text, record) => <a onClick={() => showDetailModal(record)} style={{ color: '#1890ff', textDecoration: 'none', cursor: 'pointer' }} onMouseEnter={(e) => e.target.style.textDecoration = 'underline'} onMouseLeave={(e) => e.target.style.textDecoration = 'none'}>{text}</a> },
        resource_name: { title: 'è³‡æºåç¨±', dataIndex: 'resource_name', width: '14%', sorter: (a, b) => (a || '').localeCompare(b || ''), render: name => name || '-' },
        business_impact: {
          title: 'æ¥­å‹™å½±éŸ¿',
          dataIndex: 'business_impact',
          width: '10%',
          sorter: (a, b) => (a.business_impact || '').localeCompare(b.business_impact || ''),
          render: (impact) => {
            const color = impact === 'é«˜' ? 'red' : impact === 'ä¸­' ? 'orange' : 'blue';
            return <Tag color={color}>{impact || '-'}</Tag>;
          }
        },
        ruleName: { title: 'è¦å‰‡åç¨±', dataIndex: 'ruleName', width: '14%', sorter: (a, b) => (a || '').localeCompare(b || ''), render: name => name || '-' },
        triggerThreshold: { title: 'è§¸ç™¼é–¾å€¼', dataIndex: 'triggerThreshold', width: '10%', render: name => name || '-' },
        status: {
          title: 'ç‹€æ…‹',
          dataIndex: 'status',
          width: '8%',
          render: (status, record) => {
            const statusText = {
              new: 'NEW',
              acknowledged: 'ACK',
              resolved: 'RESOLVED',
              silenced: 'SILENCED'
            };

            // é¡¯ç¤ºå‘Šè­¦é¢¨æš´æ¨™ç±¤
            if (record.storm_group) {
              const stormCount = incidents.filter(i => i.storm_group === record.storm_group).length;
              return (
                <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>
                  <Tag color="orange" size="small" style={{ margin: 0, fontSize: '10px' }}>
                    é¢¨æš´ ({stormCount})
                  </Tag>
                  <span className={`status-badge status-${status}`}>
                    {statusText[status] || 'UNKNOWN'}
                  </span>
                </div>
              );
            }

            return (
              <span className={`status-badge status-${status}`}>
                {statusText[status] || 'UNKNOWN'}
              </span>
            );
          }
        },
        assignee: { title: 'è™•ç†äºº', dataIndex: 'assignee', width: '8%', sorter: (a, b) => (a || '').localeCompare(b || ''), render: (assignee) => assignee || '-' },
        created_at: { title: 'è§¸ç™¼æ™‚é–“', dataIndex: 'created_at', width: '10%', sorter: (a, b) => a.created_at.valueOf() - b.created_at.valueOf(), render: time => <span title={time ? time.format('YYYY-MM-DD HH:mm:ss') : ''}>{time ? time.fromNow() : '-'}</span> },
        action: {
          title: 'æ“ä½œ', key: 'action', width: '10%', render: (_, record) => (
            <Space size="small">
              <Tooltip title="ç¢ºèªäº‹ä»¶" placement="top">
                <Button
                  type="text"
                  icon={<CheckCircleOutlined style={{ color: '#52c41a' }} />}
                  disabled={record.status !== 'new'}
                  onClick={() => handleStatusChange([record.key], 'acknowledged')}
                />
              </Tooltip>
              <Tooltip title={record.status === 'silenced' ? 'å·²éœéŸ³' : 'è¨­ç½®éœéŸ³'} placement="top">
                <Button
                  type="text"
                  icon={<PauseCircleOutlined />}
                  disabled={record.status === 'resolved'}
                  onClick={() => showSilenceModal(record)}
                />
              </Tooltip>
            </Space>
          )
        }
      };

      // æ ¹æ“šå¯è¦‹æ¬„ä½è¨­å®šå‹•æ…‹ç”Ÿæˆè¡¨æ ¼æ¬„ä½
      const columns = Object.keys(allColumns)
        .filter(key => visibleColumns[key])
        .map(key => allColumns[key]);

      // æ‡‰ç”¨é ç¯©é¸å’Œæœå°‹ç¯©é¸
      let filteredIncidents = incidents;

      // é ç¯©é¸é‚è¼¯ (å¾ç¸½è¦½é é¢ä¸‹é‘½éä¾†)
      if (pageParams && pageParams.statusFilter) {
        filteredIncidents = filteredIncidents.filter(inc => inc.status === pageParams.statusFilter);
      }

      // å¿«é€Ÿç¯©é¸é‚è¼¯
      if (quickFilters.new) {
        filteredIncidents = filteredIncidents.filter(inc => inc.status === 'new');
      }

      // é€²éšç¯©é¸é‚è¼¯
      if (advancedFilters.timeRange) {
        const [start, end] = advancedFilters.timeRange;
        filteredIncidents = filteredIncidents.filter(inc =>
          inc.created_at.isBetween(start, end)
        );
      }
      if (advancedFilters.severity && advancedFilters.severity.length > 0) {
        filteredIncidents = filteredIncidents.filter(inc => advancedFilters.severity.includes(inc.severity));
      }
      if (advancedFilters.status && advancedFilters.status.length > 0) {
        filteredIncidents = filteredIncidents.filter(inc => advancedFilters.status.includes(inc.status));
      }
      if (advancedFilters.resourceName) {
        filteredIncidents = filteredIncidents.filter(inc => inc.resource_name && inc.resource_name.toLowerCase().includes(advancedFilters.resourceName.toLowerCase()));
      }

      // æœå°‹ç¯©é¸é‚è¼¯
      if (searchText) {
        filteredIncidents = filteredIncidents.filter(inc =>
          inc.summary.toLowerCase().includes(searchText.toLowerCase()) ||
          inc.status.toLowerCase().includes(searchText.toLowerCase()) ||
          (inc.assignee && inc.assignee.toLowerCase().includes(searchText.toLowerCase())) ||
          (inc.resource_name && inc.resource_name.toLowerCase().includes(searchText.toLowerCase())) ||
          (inc.service && inc.service.toLowerCase().includes(searchText.toLowerCase()))
        );
      }
      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      // çµ±è¨ˆè³‡æ–™
      const stats = {
        total: incidents.length,
        new: incidents.filter(i => i.status === 'new').length,
        acknowledged: incidents.filter(i => i.status === 'acknowledged').length,
        resolved: incidents.filter(i => i.status === 'resolved').length,
        critical: incidents.filter(i => i.severity === 'critical').length,
        warning: incidents.filter(i => i.severity === 'warning').length
      };

      return (
        <React.Fragment>




          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="æœå°‹äº‹ä»¶æ‘˜è¦ã€è³‡æºæˆ–è™•ç†äºº..."
                onChange={e => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Popover
                content={<AdvancedIncidentFilter onFilterChange={(newFilters) => {
                  setAdvancedFilters(newFilters);
                  setIsFilterOpen(false);
                }} initialFilters={advancedFilters} />}
                title={null}
                trigger="click"
                open={isFilterOpen}
                onOpenChange={setIsFilterOpen}
                placement="bottomLeft"
                overlayStyle={{
                  backgroundColor: 'rgba(0, 0, 0, 0.9)',
                  backdropFilter: 'blur(8px)',
                  border: '1px solid rgba(255, 255, 255, 0.1)',
                  borderRadius: '8px',
                  boxShadow: '0 8px 32px rgba(0, 0, 0, 0.6)'
                }}
                overlayInnerStyle={{
                  padding: 0,
                  backgroundColor: 'transparent'
                }}
              >
                <Button className="toolbar-btn" icon={<FilterOutlined />}>
                  ç¯©é¸
                  <Badge count={Object.values(advancedFilters).filter(v => v && (!Array.isArray(v) || v.length > 0) && (v.resourceName ? v.resourceName.length > 0 : true)).length} style={{ marginLeft: 8 }} />
                </Button>
              </Popover>
              {/* å¿«é€Ÿç¯©é¸æŒ‰éˆ• */}
              <Button
                className={`toolbar-btn ${quickFilters.new ? 'ant-btn-primary' : ''}`}
                type={quickFilters.new ? 'primary' : 'default'}
                onClick={() => handleQuickFilter('new')}
                style={{ backgroundColor: quickFilters.new ? '#faad14' : undefined }}
              >
                æœªç¢ºèª (NEW)
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              <Popover
                content={
                  <div style={{ width: '200px' }}>
                    <div style={{ marginBottom: '12px', fontWeight: 600, color: 'rgba(255, 255, 255, 0.9)' }}>
                      æ¬„ä½é¡¯ç¤ºè¨­å®š
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                      {Object.keys(allColumns).map(key => (
                        <div key={key} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                          <Checkbox
                            checked={visibleColumns[key]}
                            onChange={(e) => setVisibleColumns(prev => ({ ...prev, [key]: e.target.checked }))}
                            style={{ marginRight: '8px' }}
                          />
                          <span style={{ color: 'rgba(255, 255, 255, 0.8)', fontSize: '13px' }}>
                            {allColumns[key].title}
                          </span>
                        </div>
                      ))}
                    </div>
                  </div>
                }
                title={null}
                trigger="click"
                open={isColumnSettingsOpen}
                onOpenChange={setIsColumnSettingsOpen}
                placement="bottomRight"
                overlayStyle={{
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  backdropFilter: 'blur(8px)',
                  border: '1px solid rgba(255, 255, 255, 0.1)'
                }}
              >
                <Button className="toolbar-btn" icon={<EyeOutlined />}>
                  æ¬„ä½è¨­å®š
                </Button>
              </Popover>
              <Button type="primary" className="btn-ai-analysis" icon={<RobotOutlined />} onClick={() => handleAIAnalysis(selectedRowKeys.length > 0 ? selectedRowKeys : null)}>
                AI åˆ†æ
              </Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            <Table rowSelection={rowSelection} columns={columns} dataSource={filteredIncidents} rowKey="key" className="transparent-bg" size="small" />
          </div>
          <Modal
            title={
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <InfoCircleOutlined style={{ color: '#1890ff' }} />
                <span>äº‹ä»¶è©³æƒ…</span>
              </div>
            }
            open={isDetailModalOpen}
            onCancel={() => setIsDetailModalOpen(false)}
            footer={
              <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '12px' }}>
                <Button className="modal-footer-btn" onClick={() => setIsDetailModalOpen(false)}>é—œé–‰</Button>
                <Button type="primary" className="modal-footer-btn" disabled={currentIncident && currentIncident.status !== 'new'} onClick={() => { handleStatusChange([currentIncident.key], 'acknowledged') }}>ç¢ºèªæ”¶åˆ° (Ack)</Button>
                <Button type="primary" className="btn-ai-analysis modal-footer-btn" icon={<RobotOutlined />} onClick={() => handleAIAnalysis([currentIncident.key])}>AI åˆ†æ</Button>
              </div>
            }
            width={800}
            style={{
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
              borderRadius: '12px'
            }}
          >
            {currentIncident && (
              <Tabs defaultActiveKey="1" style={{ marginTop: 16 }}>
                <Tabs.TabPane tab="åŸºæœ¬è³‡è¨Š" key="1">
                  {/* åŸºæœ¬è³‡è¨Šå€å¡Š */}
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '8px',
                    padding: '12px',
                    marginBottom: '12px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '12px' }}>
                      <div className="severity-indicator severity-critical"></div>
                      <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.85)' }}>åŸºæœ¬è³‡è¨Š</Title>
                    </div>
                    <Descriptions bordered column={1} size="small" className="compact-descriptions">
                      <Descriptions.Item label="æ‘˜è¦">{currentIncident.summary}</Descriptions.Item>
                      <Descriptions.Item label="åš´é‡æ€§"><Tag color={currentIncident.severity === 'critical' ? 'red' : 'orange'}>{currentIncident.severity ? currentIncident.severity.toUpperCase() : 'UNKNOWN'}</Tag></Descriptions.Item>
                      <Descriptions.Item label="ç‹€æ…‹">{currentIncident.status ? currentIncident.status.toUpperCase() : 'UNKNOWN'}</Descriptions.Item>
                      <Descriptions.Item label="ä¾†æº">{currentIncident.source}</Descriptions.Item>
                      <Descriptions.Item label="è§¸ç™¼æ™‚é–“">{currentIncident.created_at ? currentIncident.created_at.format('YYYY-MM-DD HH:mm:ss') : '-'}</Descriptions.Item>
                      <Descriptions.Item label="è³‡æºåç¨±">
                        <span style={{ marginRight: '8px' }}>{currentIncident.resource_name || '-'}</span>
                        <Button size="small" type="link" style={{ padding: 0, height: 'auto' }}>
                          å‰å¾€å„€è¡¨æ¿
                        </Button>
                      </Descriptions.Item>
                      <Descriptions.Item label="è¦å‰‡åç¨±">{currentIncident.ruleName || '-'}</Descriptions.Item>
                      <Descriptions.Item label="è§¸ç™¼é–¾å€¼">{currentIncident.triggerThreshold || '-'}</Descriptions.Item>
                      {currentIncident.storm_group && (
                        <Descriptions.Item label="äº‹ä»¶é¢¨æš´">
                          <Tag color="orange">é¢¨æš´ç¾¤çµ„: {currentIncident.storm_group}</Tag>
                          <Button size="small" type="link" style={{ padding: '0 4px', height: 'auto', marginLeft: '8px' }}>
                            æŸ¥çœ‹ç›¸é—œäº‹ä»¶
                          </Button>
                        </Descriptions.Item>
                      )}
                      <Descriptions.Item label="å¿«é€Ÿæ“ä½œ">
                        <Space>
                          <Button size="small" type="primary" icon={<BarChartOutlined />}>
                            è³‡æºç›£æ§
                          </Button>
                        </Space>
                      </Descriptions.Item>
                    </Descriptions>
                  </div>
                </Tabs.TabPane>
                <Tabs.TabPane tab="è™•ç†æ­·å²" key="2">
                  {/* è™•ç†æ­·å²å€å¡Š */}
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '8px',
                    padding: '8px',
                    marginBottom: '8px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
                      <div className="severity-indicator severity-warning"></div>
                      <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.85)', fontSize: '14px' }}>è™•ç†æ­·å²</Title>
                    </div>
                    <div className="incident-timeline">
                      <div className="timeline-item">
                        <div className="timeline-dot timeline-dot-completed"></div>
                        <div className="timeline-content">
                          <div className="timeline-title">äº‹ä»¶å»ºç«‹</div>
                          <div className="timeline-description">ç”± {currentIncident.source} è§¸ç™¼</div>
                          <div className="timeline-time">{currentIncident.created_at ? currentIncident.created_at.format('MM-DD HH:mm:ss') : 'æœªçŸ¥æ™‚é–“'}</div>
                        </div>
                      </div>
                      {currentIncident.status === 'acknowledged' && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-completed"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">äº‹ä»¶ç¢ºèª</div>
                            <div className="timeline-description">å·²ç”± {currentIncident.assignee || 'ç³»çµ±'} ç¢ºèª</div>
                            <div className="timeline-time">{currentIncident.created_at ? currentIncident.created_at.add(2, 'minute').format('MM-DD HH:mm:ss') : ''}</div>
                          </div>
                        </div>
                      )}
                      {currentIncident.status === 'new' && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-current"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">ç­‰å¾…ç¢ºèª</div>
                            <div className="timeline-description">å°šæœªç¢ºèªï¼Œè«‹æŒ‡æ´¾è² è²¬äºº</div>
                          </div>
                        </div>
                      )}
                      {currentIncident.status === 'acknowledged' && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-current"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">èª¿æŸ¥ä¸­</div>
                            <div className="timeline-description">æ­£åœ¨åˆ†æå’Œè™•ç†å•é¡Œ</div>
                          </div>
                        </div>
                      )}
                      {currentIncident.automation_id && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-completed"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">è‡ªå‹•åŒ–åŸ·è¡Œ</div>
                            <div className="timeline-description">åŸ·è¡Œè…³æœ¬ {currentIncident.automation_id}</div>
                            <div className="timeline-time">{currentIncident.created_at ? currentIncident.created_at.add(1, 'minute').format('MM-DD HH:mm:ss') : ''}</div>
                          </div>
                        </div>
                      )}
                      {currentIncident.status === 'resolved' && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-completed"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">äº‹ä»¶è§£æ±º</div>
                            <div className="timeline-description">å•é¡Œå·²ä¿®å¾©ä¸¦é©—è­‰</div>
                            <div className="timeline-time">{currentIncident.created_at ? currentIncident.created_at.add(15, 'minute').format('MM-DD HH:mm:ss') : ''}</div>
                          </div>
                        </div>
                      )}
                      {currentIncident.status !== 'resolved' && (
                        <div className="timeline-item">
                          <div className="timeline-dot timeline-dot-default"></div>
                          <div className="timeline-content">
                            <div className="timeline-title">äº‹ä»¶è§£æ±º</div>
                            <div className="timeline-description">å¾…è™•ç†</div>
                          </div>
                        </div>
                      )}
                    </div>
                    <div style={{ marginTop: '16px', paddingTop: '12px', borderTop: '1px solid rgba(255, 255, 255, 0.1)' }}>
                      <TextArea
                        rows={2}
                        placeholder="æ–°å¢è™•ç†ç´€éŒ„..."
                        style={{
                          background: 'rgba(255, 255, 255, 0.05)',
                          border: '1px solid rgba(255, 255, 255, 0.2)',
                          color: 'rgba(255, 255, 255, 0.9)',
                          borderRadius: '4px',
                          fontSize: '13px',
                          marginBottom: '12px'
                        }}
                      />
                      <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()} style={{ height: '32px', fontSize: '13px', display: 'block' }}>æ–°å¢ç´€éŒ„</Button>
                    </div>
                  </div>
                </Tabs.TabPane>
                <Tabs.TabPane tab="é—œè¯äº‹ä»¶" key="3">
                  {/* é—œè¯äº‹ä»¶å€å¡Š */}
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '8px',
                    padding: '8px',
                    marginBottom: '8px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
                      <div className="severity-indicator severity-info"></div>
                      <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.85)', fontSize: '14px' }}>é—œè¯äº‹ä»¶</Title>
                    </div>
                    <List
                      size="small"
                      bordered
                      dataSource={[
                        { summary: 'API latency over 500ms', time: '3 åˆ†é˜å‰è§¸ç™¼', status: 'ACK', severity: 'warning' },
                        { summary: 'Database slow query detected', time: '5 åˆ†é˜å‰è§¸ç™¼', status: 'NEW', severity: 'warning' },
                        { summary: 'Load balancer health check failed', time: '2 åˆ†é˜å‰è§¸ç™¼', status: 'NEW', severity: 'critical' }
                      ]}
                      renderItem={(item) => (
                        <List.Item style={{
                          color: 'rgba(255, 255, 255, 0.85)',
                          background: 'rgba(255, 255, 255, 0.02)',
                          padding: '8px 12px'
                        }}>
                          <div style={{ width: '100%' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '4px' }}>
                              <span style={{ fontWeight: '500' }}>{item.summary}</span>
                              <Tag
                                color={item.severity === 'critical' ? 'red' : 'orange'}
                                size="small"
                                style={{ fontSize: '10px' }}
                              >
                                {item.severity.toUpperCase()}
                              </Tag>
                            </div>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                              <span style={{
                                fontSize: '12px',
                                color: 'rgba(255, 255, 255, 0.6)'
                              }}>
                                {item.time}
                              </span>
                              <Tag
                                color={item.status === 'ACK' ? 'orange' : 'blue'}
                                size="small"
                                style={{ fontSize: '10px' }}
                              >
                                ç‹€æ…‹: {item.status}
                              </Tag>
                            </div>
                          </div>
                        </List.Item>
                      )}
                    />
                  </div>
                </Tabs.TabPane>
                <Tabs.TabPane tab="è‡ªå‹•åŒ–" key="4">
                  {/* è‡ªå‹•åŒ–å€å¡Š */}
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '8px',
                    padding: '12px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 4px 16px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '12px' }}>
                      <div className="severity-indicator severity-success"></div>
                      <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.85)' }}>è‡ªå‹•åŒ–</Title>
                    </div>
                    {currentIncident.automation_id ? (
                      <p style={{ color: 'rgba(255, 255, 255, 0.85)' }}>
                        åŸ·è¡Œç´€éŒ„ ID: <a onClick={() => onNavigate('executions')} style={{ color: '#1890ff' }}>{currentIncident.automation_id}</a>
                      </p>
                    ) : (
                      <p style={{ color: 'rgba(255, 255, 255, 0.7)' }}>æ­¤äº‹ä»¶æœªè§¸ç™¼è‡ªå‹•åŒ–è…³æœ¬ã€‚</p>
                    )}
                  </div>
                </Tabs.TabPane>
              </Tabs>
            )}
          </Modal>

          <AIAnalysisModal
            open={isAIAnalysisModalOpen}
            onClose={() => setIsAIAnalysisModalOpen(false)}
            incidents={analyzedIncidents}
            onNavigate={onNavigate}
          />

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button className="batch-action-button" onClick={() => handleBatchUpdate('acknowledged')}>
                  æ‰¹æ¬¡ç¢ºèª
                </Button>
                <Button className="batch-action-button batch-action-button--success" onClick={() => handleBatchUpdate('resolved')}>
                  æ‰¹æ¬¡è§£æ±º
                </Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          {/* éœéŸ³æ¨¡æ…‹æ¡† */}
          <Modal
            title="å»ºç«‹éœéŸ³"
            open={isSilenceModalOpen}
            onCancel={hideSilenceModal}
            onOk={handleSilence}
            okText="å»ºç«‹éœéŸ³"
            cancelText="å–æ¶ˆ"
            width={600}
          >
            <div style={{ padding: '8px 0' }}>
              <div style={{ marginBottom: '24px' }}>
                <Title level={5} style={{ color: 'rgba(255, 255, 255, 0.85)', marginBottom: '8px' }}>
                  äº‹ä»¶è³‡è¨Š
                </Title>
                <div style={{ background: 'rgba(255, 255, 255, 0.02)', padding: '12px', borderRadius: '6px', border: '1px solid rgba(255, 255, 255, 0.08)' }}>
                  <div style={{ marginBottom: '8px' }}>
                    <Text strong style={{ color: 'rgba(255, 255, 255, 0.9)' }}>æ‘˜è¦ï¼š</Text>
                    <Text style={{ color: 'rgba(255, 255, 255, 0.7)' }}>{silenceIncident?.summary}</Text>
                  </div>
                  <div style={{ marginBottom: '8px' }}>
                    <Text strong style={{ color: 'rgba(255, 255, 255, 0.9)' }}>è³‡æºï¼š</Text>
                    <Text style={{ color: 'rgba(255, 255, 255, 0.7)' }}>{silenceIncident?.resource_name}</Text>
                  </div>
                  <div>
                    <Text strong style={{ color: 'rgba(255, 255, 255, 0.9)' }}>åš´é‡æ€§ï¼š</Text>
                    <Tag color={silenceIncident?.severity === 'critical' ? 'red' : 'orange'} style={{ marginLeft: '8px' }}>
                      {silenceIncident?.severity?.toUpperCase()}
                    </Tag>
                  </div>
                </div>
              </div>

              <div style={{ marginBottom: '24px' }}>
                <Title level={5} style={{ color: 'rgba(255, 255, 255, 0.85)', marginBottom: '8px' }}>
                  éœéŸ³è¨­å®š
                </Title>
                <div style={{ background: 'rgba(255, 255, 255, 0.02)', padding: '12px', borderRadius: '6px', border: '1px solid rgba(255, 255, 255, 0.08)' }}>
                  <div style={{ marginBottom: '8px' }}>
                    <Text style={{ color: 'rgba(255, 255, 255, 0.8)' }}>
                      é¸æ“‡éœéŸ³æŒçºŒæ™‚é–“ï¼š
                    </Text>
                  </div>
                  <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
                    {[1, 2, 4, 8, 12, 24].map(duration => (
                      <Button
                        key={duration}
                        type={silenceDuration === duration ? 'primary' : 'default'}
                        size="small"
                        onClick={() => setSilenceDuration(duration)}
                        style={{
                          background: silenceDuration === duration ? undefined : 'rgba(255, 255, 255, 0.05)',
                          borderColor: 'rgba(255, 255, 255, 0.3)',
                          color: silenceDuration === duration ? undefined : 'rgba(255, 255, 255, 0.85)',
                          borderRadius: '6px',
                          transition: 'all 0.2s'
                        }}
                      >
                        {duration} å°æ™‚
                      </Button>
                    ))}
                  </div>
                  <div style={{ marginTop: '12px', padding: '8px', background: 'rgba(24, 144, 255, 0.1)', borderRadius: '4px', border: '1px solid rgba(24, 144, 255, 0.2)' }}>
                    <Text style={{ color: 'rgba(24, 144, 255, 0.9)', fontSize: '12px' }}>
                      ğŸ“ å°‡å»ºç«‹éœéŸ³æŒçºŒ {silenceDuration} å°æ™‚ï¼Œåˆ° {dayjs().add(silenceDuration, 'hour').format('YYYY-MM-DD HH:mm:ss')}
                    </Text>
                  </div>
                </div>
              </div>

              <div style={{ padding: '12px', background: 'rgba(250, 173, 20, 0.1)', borderRadius: '6px', border: '1px solid rgba(250, 173, 20, 0.2)' }}>
                <Text style={{ color: 'rgba(250, 173, 20, 0.9)', fontSize: '12px' }}>
                  ğŸ’¡ éœéŸ³è¦å‰‡å°‡å‡ºç¾åœ¨ã€ŒéœéŸ³ã€é é¢ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨é‚£è£¡æŸ¥çœ‹ã€ç®¡ç†æˆ–å»¶é•·éœéŸ³æ™‚é–“ã€‚
                </Text>
              </div>
            </div>
          </Modal>
        </React.Fragment >
      );
    };

    const AIAnalysisModal = ({ open, onClose, incidents, onNavigate }) => {
      const [isLoading, setIsLoading] = useState(true);
      const [analysisResult, setAnalysisResult] = useState(null);

      // å¯¦é«”é€£çµæ¸²æŸ“å‡½æ•¸
      const renderEntityLinkedText = (text) => {
        const entityPatterns = [
          { pattern: /'([^']+)' æœå‹™/g, type: 'service' },
          { pattern: /([a-zA-Z-]+\d+(?:-[a-zA-Z]+)*)/g, type: 'resource' },
          { pattern: /äººå“¡([^ã€‚ï¼Œ\s]+)åŠŸèƒ½/g, type: 'business' },
          { pattern: /äººå“¡æ•¸æ“šåº«/g, type: 'database' }
        ];

        let result = text;
        let linkIndex = 0;

        entityPatterns.forEach(({ pattern, type }) => {
          result = result.replace(pattern, (match, p1) => {
            const entityName = p1 || match;
            const linkId = `entity-link-${linkIndex++}`;

            let href = '#';
            let color = 'blue';

            switch (type) {
              case 'service':
                href = `/dashboard/service/${entityName}`;
                color = 'green';
                break;
              case 'resource':
                href = `/dashboard/resource/${entityName}`;
                color = 'orange';
                break;
              case 'business':
                href = `/dashboard/business/${entityName}`;
                color = 'purple';
                break;
              case 'database':
                href = `/dashboard/database/user-database`;
                color = 'blue';
                break;
            }

            return `<a href="${href}" style="color: var(--brand-${color}); text-decoration: underline; cursor: pointer;" onclick="window.open('${href}', '_blank'); return false;">${match}</a>`;
          });
        });

        return <span dangerouslySetInnerHTML={{ __html: result }} />;
      };

      // åŸ·è¡Œæ“ä½œçš„è™•ç†å‡½æ•¸
      const handleActionClick = (recommendation) => {
        switch (recommendation.type) {
          case 'restart':
            Modal.confirm({
              title: 'ç¢ºèªé‡å•Ÿæœå‹™',
              content: `æ‚¨ç¢ºå®šè¦é‡å•Ÿ ${recommendation.service} æœå‹™å—ï¼Ÿ`,
              okText: 'ç¢ºèªé‡å•Ÿ',
              cancelText: 'å–æ¶ˆ',
              onOk: () => {
                message.success(`æ­£åœ¨é‡å•Ÿ ${recommendation.service} æœå‹™...`);
              }
            });
            break;
          case 'rollback':
            window.open(`/deployment/rollback/${recommendation.service}`, '_blank');
            break;
          case 'logs':
            window.open(`/logs/search?resource=${recommendation.resource}`, '_blank');
            break;
          case 'scale':
            window.open(`/scaling/configure/${recommendation.service}`, '_blank');
            break;
          default:
            message.info('æ­£åœ¨åŸ·è¡Œæ“ä½œ...');
        }
      };

      useEffect(() => {
        if (open) {
          setIsLoading(true);
          setAnalysisResult(null);
          // Simulate AI analysis delay
          const timer = setTimeout(() => {
            // Mocked analysis result
            const rootCause = "æ ¹æœ¬åŸå› å¾ˆå¯èƒ½åœ¨æ–¼ 'user-authentication' æœå‹™ä¸­çš„å…§å­˜æ´©æ¼ï¼Œå°è‡´ä¸‹æ¸¸æœå‹™çš„é€£é–æ•…éšœã€‚";
            const impact = "å°äººå“¡ç™»éŒ„å’Œè¨»å†ŠåŠŸèƒ½é€ æˆåš´é‡å½±éŸ¿ã€‚äººå“¡æ•¸æ“šåº«å¯èƒ½å­˜åœ¨æ•¸æ“šä¸ä¸€è‡´çš„é¢¨éšªã€‚";
            const recommendations = [
              {
                text: "ç«‹å³é‡å•Ÿ 'user-authentication' æœå‹™",
                type: "restart",
                service: "user-authentication",
                urgent: true
              },
              {
                text: "å›æ»¾ 'user-authentication' æœå‹™çš„æœ€æ–°éƒ¨ç½²",
                type: "rollback",
                service: "user-authentication",
                urgent: false
              },
              {
                text: "æª¢æŸ¥ db-prod-01 æ—¥èªŒ",
                type: "logs",
                resource: "db-prod-01",
                urgent: false
              },
              {
                text: "å¢åŠ  'user-authentication' æœå‹™çš„å…§å­˜åˆ†é…",
                type: "scale",
                service: "user-authentication",
                urgent: false
              }
            ];
            const confidence = 85; // AIåˆ†æä¿¡å¿ƒåº¦
            const analyzedEvents = incidents.map(inc => ({
              ...inc,
              analyzed: true
            }));
            setAnalysisResult({ rootCause, impact, recommendations, confidence, analyzedEvents });
            setIsLoading(false);
          }, 1500);
          return () => clearTimeout(timer);
        }
      }, [open, incidents]);

      return (
        <Modal
          title={
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
              <RobotOutlined style={{ color: 'var(--brand-info)' }} />
              <Title level={4} style={{ margin: 0 }}>AI äº‹ä»¶åˆ†æå ±å‘Š</Title>
            </div>
          }
          open={open}
          onCancel={onClose}
          footer={[
            <Button
              key="ack"
              type="default"
              icon={<CheckOutlined />}
              onClick={() => {
                message.success('å·²ç¢ºèªæ”¶åˆ°åˆ†æå ±å‘Š');
                onClose();
              }}
            >
              ç¢ºèªæ”¶åˆ° (Ack)
            </Button>,
            <Button key="close" onClick={onClose}>é—œé–‰</Button>
          ]}
          width={800}
          centered
        >
          <Spin spinning={isLoading} tip="AI å¼•æ“æ­£åœ¨åˆ†æä¸­ï¼Œè«‹ç¨å€™...">
            {analysisResult ? (
              <div style={{ marginTop: '24px', display: 'flex', flexDirection: 'column', gap: '24px' }}>
                <div className="modal-section">
                  <Title level={5} className="section-title">
                    åˆ†æäº‹ä»¶ ({incidents.length})
                    {incidents.length > 3 && (
                      <Tag color="blue" size="small" style={{ marginLeft: '8px' }}>
                        æ‰¹é‡åˆ†æ
                      </Tag>
                    )}
                  </Title>
                  <List
                    size="small"
                    dataSource={incidents.slice(0, 3)}
                    renderItem={item => (
                      <List.Item>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' }}>
                          <span>{item.summary}</span>
                          <Tag color={
                            item.severity === 'critical' ? 'red' :
                              item.severity === 'major' ? 'orange' :
                                item.severity === 'minor' ? 'green' : 'blue'
                          } size="small">
                            {item.severity.toUpperCase()}
                          </Tag>
                        </div>
                      </List.Item>
                    )}
                  />
                  {incidents.length > 3 && (
                    <Typography.Text type="secondary" style={{ fontSize: '12px', marginTop: '8px', display: 'block' }}>
                      + å¦å¤– {incidents.length - 3} å€‹äº‹ä»¶å·²ç´å…¥åˆ†æç¯„åœ
                    </Typography.Text>
                  )}
                </div>
                <div className="modal-section">
                  <Title level={5} className="section-title">
                    æ ¹æœ¬åŸå› åˆ†æ (RCA)
                    <Tag color="blue" style={{ marginLeft: '8px', fontSize: '12px' }}>
                      ä¿¡å¿ƒåº¦: {analysisResult.confidence}%
                    </Tag>
                  </Title>
                  <Paragraph>{renderEntityLinkedText(analysisResult.rootCause)}</Paragraph>
                </div>
                <div className="modal-section">
                  <Title level={5} className="section-title">å½±éŸ¿ç¯„åœè©•ä¼°</Title>
                  <Paragraph>{renderEntityLinkedText(analysisResult.impact)}</Paragraph>
                </div>
                <div className="modal-section">
                  <Title level={5} className="section-title">å»ºè­°æ“ä½œ</Title>
                  <List
                    size="small"
                    dataSource={analysisResult.recommendations}
                    renderItem={item => (
                      <List.Item>
                        <div style={{ width: '100%', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                          <div style={{ display: 'flex', alignItems: 'center', flex: 1 }}>
                            <BulbOutlined style={{
                              color: item.urgent ? 'var(--status-critical)' : 'var(--brand-primary)',
                              marginRight: '8px'
                            }} />
                            <span style={{ flex: 1 }}>{item.text}</span>
                            {item.urgent && (
                              <Tag color="red" size="small" style={{ marginLeft: '8px' }}>
                                ç·Šæ€¥
                              </Tag>
                            )}
                          </div>
                          <Button
                            type={item.urgent ? "primary" : "default"}
                            size="small"
                            danger={item.urgent}
                            style={{ marginLeft: '12px', minWidth: '80px' }}
                            onClick={() => handleActionClick(item)}
                          >
                            {item.type === 'restart' ? 'é‡å•Ÿ' :
                              item.type === 'rollback' ? 'å›æ»¾' :
                                item.type === 'logs' ? 'æŸ¥çœ‹æ—¥èªŒ' :
                                  item.type === 'scale' ? 'æ“´å±•' : 'åŸ·è¡Œ'}
                          </Button>
                        </div>
                      </List.Item>
                    )}
                  />
                </div>
              </div>
            ) : (
              <div style={{ height: '350px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                {/* Placeholder while loading */}
              </div>
            )}
          </Spin>
        </Modal>
      );
    };


    const AlertingRulesPage = () => {
      const [metrics, setMetrics] = useState([]);

      // å®šç¾©äº‹ä»¶è¦å‰‡å»ºç«‹çš„æ­¥é©Ÿ
      const steps = [
        { title: 'åŸºæœ¬è³‡è¨Š', description: 'è¨­å®šè¦å‰‡åç¨±å’Œç›®æ¨™' },
        { title: 'è§¸ç™¼æ¢ä»¶', description: 'å®šç¾©äº‹ä»¶è§¸ç™¼æ¢ä»¶' },
        { title: 'é€šçŸ¥è¨­å®š', description: 'é…ç½®é€šçŸ¥ç®¡é“å’Œç­–ç•¥' },
        { title: 'ç¢ºèªè¨­å®š', description: 'æª¢æŸ¥ä¸¦ä¿å­˜è¦å‰‡' }
      ];

      const mockScripts = [
        { id: 's_1', name: 'Auto-scaling for Web Servers', params: [{ name: 'instance_count', type: 'number', label: 'å¯¦ä¾‹æ•¸é‡' }] },
        { id: 's_2', name: 'Increase Database Disk Volume', params: [{ name: 'increase_gb', type: 'number', label: 'å¢åŠ å®¹é‡ (GB)' }] },
        { id: 's_3', name: 'Restart Pod', params: [{ name: 'pod_name', type: 'string', label: 'Pod åç¨±' }] },
      ];
      const mockChannels = [{ id: 'c_1', name: 'Email' }, { id: 'c_2', name: 'Slack' }, { id: 'c_3', name: 'Webhook' }];

      const initialRules = [
        {
          key: 'rule_1',
          name: 'é«˜ CPU ä½¿ç”¨ç‡',
          target: 'Production Web Servers',
          resource_tags: { "env": "production", "app": "web" }, // æ”¹ç‚ºç‰©ä»¶ä»¥å°æ‡‰ JSONB
          conditions: { // çµæ§‹å·²ç¬¦åˆ JSONB å„²å­˜
            operator: 'AND',
            conditions: [
              { metric: 'cpu_utilization', operator: '>', value: 90, duration: 5, durationUnit: 'minutes' },
              { metric: 'memory_usage', operator: '>', value: 85, duration: 3, durationUnit: 'minutes' }
            ]
          },
          notifications: [ // æ”¹ç‚ºç‰©ä»¶é™£åˆ—ä»¥å°æ‡‰ JSONB
            { type: 'slack', target: '#alerts-critical', template: 'slack-critical-template', enabled: true }
          ],
          enabled: true
        },
        {
          key: 'rule_2',
          name: 'è³‡æ–™åº«å»¶é²',
          target: 'Production Database',
          resource_tags: { "env": "production", "db": "mysql" },
          conditions: {
            operator: 'OR',
            conditions: [
              { metric: 'replication_lag_s', operator: '>', value: 10, duration: 2, durationUnit: 'minutes' },
              { metric: 'cpu_utilization', operator: '>', value: 95, duration: 1, durationUnit: 'minutes' }
            ]
          },
          notifications: [
            { type: 'email', target: 'db-admins@example.com', template: 'default-email', enabled: true },
            { type: 'slack', target: '#db-alerts', template: 'slack-db-template', enabled: true }
          ],
          enabled: true
        },
        {
          key: 'rule_3',
          name: 'æ¸¬è©¦ç’°å¢ƒè³‡æºç›£æ§',
          target: 'Staging Environment',
          resource_tags: { "env": "staging" },
          conditions: {
            operator: 'AND',
            conditions: [
              { metric: 'memory_usage', operator: '>', value: 80, duration: 10, durationUnit: 'minutes' },
              { metric: 'disk_space', operator: '<', value: 15, duration: 5, durationUnit: 'minutes' }
            ]
          },
          notifications: [
            { type: 'email', target: 'qa-team@example.com', template: 'default-email', enabled: true }
          ],
          enabled: false
        },
        {
          key: 'rule_4',
          name: 'ç¶²è·¯åŸºç¤è¨­æ–½ç›£æ§',
          target: 'Network Infrastructure',
          conditions: {
            operator: 'OR',
            conditions: [
              { metric: 'p95_latency_ms', operator: '>', value: 500, duration: 3, durationUnit: 'minutes' },
              { metric: 'cpu_utilization', operator: '>', value: 80, duration: 5, durationUnit: 'minutes' }
            ]
          },
          notifications: ['PagerDuty'],
          enabled: true
        },
        {
          key: 'rule_5',
          name: 'è¤‡é›œäº‹ä»¶è¦å‰‡',
          target: 'Monitoring Systems',
          conditions: {
            operator: 'AND',
            conditions: [
              {
                operator: 'OR',
                conditions: [
                  { metric: 'cpu_utilization', operator: '>', value: 90, duration: 5, durationUnit: 'minutes' },
                  { metric: 'memory_usage', operator: '>', value: 90, duration: 3, durationUnit: 'minutes' }
                ]
              },
              { metric: 'disk_space', operator: '<', value: 10, duration: 10, durationUnit: 'minutes' }
            ]
          },
          notifications: ['Slack', 'PagerDuty'],
          enabled: true
        }
      ];

      const [rules, setRules] = useLocalStorageState('sre-alert-rules', initialRules);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingRule, setEditingRule] = useState(null);
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // Filter state
      const [filters, setFilters] = useState({
        enabled: [],
        target: []
      });
      const [isFilterOpen, setIsFilterOpen] = useState(false);

      // Column settings state
      const [isColumnSettingsOpen, setIsColumnSettingsOpen] = useState(false);
      const [visibleColumns, setVisibleColumns] = useState(() => {
        const saved = localStorage.getItem('alert-rules-visible-columns');
        return saved ? JSON.parse(saved) : {
          enabled: true,
          name: true,
          target: true,
          resource_tags: true,
          conditions: true,
          notifications: true
        };
      });

      // Save column settings to localStorage when changed
      useEffect(() => {
        localStorage.setItem('alert-rules-visible-columns', JSON.stringify(visibleColumns));
      }, [visibleColumns]);

      // Filter functions
      const applyFilters = () => {
        setIsFilterOpen(false);
      };

      const resetFilters = () => {
        setFilters({
          enabled: [],
          target: []
        });
        setIsFilterOpen(false);
      };

      // Calculate active filters count
      const activeFiltersCount = (filters.enabled?.length || 0) + (filters.target?.length || 0);

      // Filter component
      const AlertRulesFilterPopover = () => (
        <div style={{ width: '300px', padding: '16px' }}>
          <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
            <div>
              <div style={{
                marginBottom: '8px',
                fontWeight: 600,
                color: 'rgba(255, 255, 255, 0.9)',
                fontSize: '13px'
              }}>
                å•Ÿç”¨ç‹€æ…‹
              </div>
              <Select
                mode="multiple"
                placeholder="é¸æ“‡ç‹€æ…‹"
                value={filters.enabled}
                onChange={(value) => setFilters(f => ({ ...f, enabled: value }))}
                style={{ width: '100%' }}
                size="small"
                maxTagCount={2}
              >
                <Select.Option value={true}>âœ… å·²å•Ÿç”¨</Select.Option>
                <Select.Option value={false}>âŒ å·²åœç”¨</Select.Option>
              </Select>
            </div>
            <div>
              <div style={{
                marginBottom: '8px',
                fontWeight: 600,
                color: 'rgba(255, 255, 255, 0.9)',
                fontSize: '13px'
              }}>
                ç›£æ§å°è±¡
              </div>
              <Select
                mode="multiple"
                placeholder="é¸æ“‡ç›£æ§å°è±¡"
                value={filters.target}
                onChange={(value) => setFilters(f => ({ ...f, target: value }))}
                style={{ width: '100%' }}
                size="small"
                maxTagCount={2}
              >
                <Select.Option value="Production Web Servers">Production Web Servers</Select.Option>
                <Select.Option value="Production Database">Production Database</Select.Option>
                <Select.Option value="Network Infrastructure">Network Infrastructure</Select.Option>
              </Select>
            </div>
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              gap: '8px',
              paddingTop: '12px',
              borderTop: '1px solid rgba(255, 255, 255, 0.1)'
            }}>
              <Button
                onClick={resetFilters}
                style={{
                  flex: 1,
                  background: 'rgba(255, 255, 255, 0.05)',
                  borderColor: 'rgba(255, 255, 255, 0.2)'
                }}
              >
                é‡è¨­
              </Button>
              <Button
                type="primary"
                onClick={applyFilters}
                style={{ flex: 1 }}
              >
                å¥—ç”¨ç¯©é¸
              </Button>
            </div>
          </div>
        </div>
      );

      useEffect(() => {
        // Simulate fetching metrics from an API
        const fetchMetrics = () => {
          const fetchedMetrics = [
            { id: 'cpu_utilization', name: 'CPU ä½¿ç”¨ç‡ (%)' },
            { id: 'memory_usage', name: 'è¨˜æ†¶é«”ä½¿ç”¨ç‡ (%)' },
            { id: 'disk_space', name: 'ç£ç¢Ÿç©ºé–“ä½¿ç”¨ç‡ (%)' },
            { id: 'replication_lag_s', name: 'è³‡æ–™åº«è¤‡è£½å»¶é² (ç§’)' },
            { id: 'p95_latency_ms', name: 'P95 å»¶é² (ms)' },
          ];
          setMetrics(fetchedMetrics);
        };

        fetchMetrics();
      }, []);

      const [selectedScriptId, setSelectedScriptId] = useState(null);
      const [activeField, setActiveField] = useState('title_template'); // è·Ÿè¸ªç•¶å‰æ­£åœ¨ç·¨è¼¯çš„å­—æ®µ
      const [currentStep, setCurrentStep] = useState(1); // æ­¥é©Ÿæ§åˆ¶

      const handleFormChange = (changedValues, allValues) => {
        if ('automation_script' in changedValues) {
          setSelectedScriptId(changedValues.automation_script);
        }
      };

      const selectedScript = mockScripts.find(s => s.id === selectedScriptId);

      const applyAlertTemplate = (templateType) => {
        const templates = {
          cpu_multi_level: {
            name: 'CPU å¤šç­‰ç´šäº‹ä»¶è¦å‰‡',
            description: 'æ ¹æ“šä¸åŒçš„ CPU ä½¿ç”¨ç‡è¨­å®šä¸åŒç­‰ç´šçš„äº‹ä»¶',
            condition_groups: [
              {
                severity: 'critical',
                conditions: [{
                  metric: 'cpu_utilization',
                  operator: '>',
                  value: 95,
                  duration: 1,
                  duration_unit: 'minutes'
                }]
              },
              {
                severity: 'warning',
                conditions: [{
                  metric: 'cpu_utilization',
                  operator: '>',
                  value: 80,
                  duration: 5,
                  duration_unit: 'minutes'
                }]
              }
            ],
            title_template: 'ğŸš¨ {{resource.name}} CPU ç•°å¸¸',
            content_template: '{{resource.name}} çš„ CPU ä½¿ç”¨ç‡å·²é” {{metric.value}}%ï¼ŒæŒçºŒæ™‚é–“ï¼š{{duration}} {{duration_unit}}ã€‚è«‹ç«‹å³é—œæ³¨ç³»çµ±ç‹€æ…‹ã€‚'
          },
          cpu_high: {
            name: 'CPU ä½¿ç”¨ç‡éé«˜',
            description: 'ç•¶ CPU ä½¿ç”¨ç‡è¶…é 80% æ™‚è§¸ç™¼äº‹ä»¶',
            condition_groups: [{
              severity: 'warning',
              conditions: [{
                metric: 'cpu_utilization',
                operator: '>',
                value: 80,
                duration: 5,
                duration_unit: 'minutes'
              }]
            }],
            title_template: 'ğŸš¨ {{resource.name}} CPU ä½¿ç”¨ç‡ç•°å¸¸',
            content_template: '{{resource.name}} çš„ CPU ä½¿ç”¨ç‡å·²æŒçºŒ {{duration}} åˆ†é˜è¶…éé–¾å€¼ {{threshold}}%ï¼Œç›®å‰æ•¸å€¼ç‚º {{metric.value}}%ã€‚å»ºè­°ç«‹å³æª¢æŸ¥ç³»çµ±è² è¼‰ã€‚',
            automation_enabled: true,
            automation_script: 's_1'
          },
          memory_high: {
            name: 'è¨˜æ†¶é«”ä½¿ç”¨ç‡éé«˜',
            description: 'ç•¶è¨˜æ†¶é«”ä½¿ç”¨ç‡è¶…é 85% æ™‚è§¸ç™¼äº‹ä»¶',
            condition_groups: [{
              severity: 'warning',
              conditions: [{
                metric: 'memory_usage',
                operator: '>',
                value: 85,
                duration: 3,
                duration_unit: 'minutes'
              }]
            }],
            title_template: 'ğŸš¨ {{resource.name}} è¨˜æ†¶é«”ä½¿ç”¨ç‡ç•°å¸¸',
            content_template: '{{resource.name}} çš„è¨˜æ†¶é«”ä½¿ç”¨ç‡å·²æŒçºŒ {{duration}} åˆ†é˜è¶…éé–¾å€¼ {{threshold}}%ï¼Œç›®å‰æ•¸å€¼ç‚º {{metric.value}}%ã€‚å¯èƒ½éœ€è¦æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼çš„è¨˜æ†¶é«”ä½¿ç”¨æƒ…æ³ã€‚',
          },
          disk_space_low: {
            name: 'ç£ç¢Ÿç©ºé–“ä¸è¶³',
            description: 'ç•¶ç£ç¢Ÿç©ºé–“ä½¿ç”¨ç‡è¶…é 90% æ™‚è§¸ç™¼äº‹ä»¶',
            condition_groups: [{
              severity: 'critical',
              conditions: [{
                metric: 'disk_space',
                operator: '>',
                value: 90,
                duration: 10,
                duration_unit: 'minutes'
              }]
            }],
            title_template: 'ğŸš¨ {{resource.name}} ç£ç¢Ÿç©ºé–“ä¸è¶³',
            content_template: '{{resource.name}} çš„ç£ç¢Ÿç©ºé–“ä½¿ç”¨ç‡å·²æŒçºŒ {{duration}} åˆ†é˜è¶…éé–¾å€¼ {{threshold}}%ï¼Œç›®å‰æ•¸å€¼ç‚º {{metric.value}}%ã€‚å»ºè­°ç«‹å³æ¸…ç†ç£ç¢Ÿç©ºé–“æˆ–æ“´å±•å„²å­˜å®¹é‡ã€‚',
            automation_enabled: true,
            automation_script: 's_2'
          },
          database_lag: {
            name: 'è³‡æ–™åº«è¤‡è£½å»¶é²',
            description: 'ç•¶è³‡æ–™åº«è¤‡è£½å»¶é²è¶…é 5 ç§’æ™‚è§¸ç™¼äº‹ä»¶',
            condition_groups: [{
              severity: 'critical',
              conditions: [{
                metric: 'replication_lag_s',
                operator: '>',
                value: 5,
                duration: 2,
                duration_unit: 'minutes'
              }]
            }],
            title_template: 'ğŸš¨ {{resource.name}} è³‡æ–™åº«è¤‡è£½å»¶é²',
            content_template: '{{resource.name}} çš„è³‡æ–™åº«è¤‡è£½å»¶é²å·²æŒçºŒ {{duration}} åˆ†é˜è¶…éé–¾å€¼ {{threshold}} ç§’ï¼Œç›®å‰å»¶é²ç‚º {{metric.value}} ç§’ã€‚è«‹æª¢æŸ¥è³‡æ–™åº«è¤‡è£½ç‹€æ…‹ã€‚'
          },
          api_latency: {
            name: 'API å»¶é²éé«˜',
            description: 'ç•¶ P95 å»¶é²è¶…é 500ms æ™‚è§¸ç™¼äº‹ä»¶',
            condition_groups: [{
              severity: 'warning',
              conditions: [{
                metric: 'p95_latency_ms',
                operator: '>',
                value: 500,
                duration: 5,
                duration_unit: 'minutes'
              }]
            }],
            title_template: 'ğŸš¨ {{resource.name}} API å»¶é²éé«˜',
            content_template: '{{resource.name}} çš„ API P95 å»¶é²å·²æŒçºŒ {{duration}} åˆ†é˜è¶…éé–¾å€¼ {{threshold}}msï¼Œç›®å‰å»¶é²ç‚º {{metric.value}}msã€‚å»ºè­°æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼æ•ˆèƒ½å’Œè² è¼‰æƒ…æ³ã€‚'
          }
        };

        const template = templates[templateType];
        if (template) {
          form.setFieldsValue(template);
          if (template.automation_script) {
            setSelectedScriptId(template.automation_script);
          }
          message.success(`å·²å¥—ç”¨ç¯„æœ¬ï¼š${template.name}`);
        }
      };

      const showModal = (rule = null) => {
        setEditingRule(rule);
        const initialValues = rule || {
          name: '',
          description: '',
          condition_groups: [{ severity: 'warning', conditions: [{ duration: 5, duration_unit: 'minutes' }] }],
          automation_enabled: false
        };
        form.setFieldsValue(initialValues);
        setSelectedScriptId(initialValues.automation_script || null);
        setActiveField('title_template'); // é‡ç½®ç‚ºæ¨™é¡Œå­—æ®µ
        setCurrentStep(1); // é‡ç½®æ­¥é©Ÿ
        setIsModalOpen(true);

        // å»¶é²èšç„¦ä»¥ç¢ºä¿DOMå·²ç¶“æ¸²æŸ“
        setTimeout(() => {
          const titleInput = document.querySelector('input[placeholder="ä½¿ç”¨è®Šæ•¸ä¾†è‡ªè¨‚äº‹ä»¶æ¨™é¡Œ"]');
          if (titleInput) {
            titleInput.focus();
          }
        }, 100);
      };

      const handleCancel = () => {
        setIsModalOpen(false);
        setEditingRule(null);
        form.resetFields();
        setSelectedScriptId(null);
      };

      const onFinish = (values) => {
        if (editingRule) {
          setRules(rules.map(r => (r.key === editingRule.key ? { ...r, ...values } : r)));
        } else {
          setRules([...rules, { ...values, key: `rule_${Date.now()}`, enabled: true }]);
        }
        message.success(editingRule ? 'è¦å‰‡æ›´æ–°æˆåŠŸ' : 'è¦å‰‡æ–°å¢æˆåŠŸ');
        handleCancel();
      };

      const handleDelete = (key) => {
        confirmDelete('è¦å‰‡', () => {
          setRules(rules.filter(r => r.key !== key));
        });
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} æ¢è¦å‰‡å—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setRules(rules.filter(r => !selectedRowKeys.includes(r.key)));
            setSelectedRowKeys([]);
            message.success('æ‰¹æ¬¡åˆªé™¤æˆåŠŸ');
          }
        });
      };

      const handleToggleEnable = (key, checked) => {
        setRules(rules.map(r => r.key === key ? { ...r, enabled: checked } : r));
        message.success(`è¦å‰‡å·²${checked ? 'å•Ÿç”¨' : 'åœç”¨'}`);
      };

      const handleTestRule = (rule) => {
        message.loading({ content: `æ­£åœ¨æ¸¬è©¦è¦å‰‡ "${rule.name}"...`, key: 'test_rule' });
        // Simulate API call
        setTimeout(() => {
          const success = Math.random() > 0.3; // 70% success rate
          if (success) {
            message.success({ content: 'æ¸¬è©¦æˆåŠŸï¼šè¦å‰‡å·²æˆåŠŸè§¸ç™¼æ¨¡æ“¬äº‹ä»¶ã€‚', key: 'test_rule' });
          } else {
            message.error({ content: 'æ¸¬è©¦å¤±æ•—ï¼šç„¡æ³•è§¸ç™¼äº‹ä»¶ï¼Œè«‹æª¢æŸ¥æ¢ä»¶è¨­å®šã€‚', key: 'test_rule' });
          }
        }, 1500);
      };

      const columns = [
        { title: 'å•Ÿç”¨', dataIndex: 'enabled', width: '8%', render: (enabled, record) => <Switch checked={enabled} onChange={(checked) => handleToggleEnable(record.key, checked)} /> },
        { title: 'è¦å‰‡åç¨±', dataIndex: 'name', width: '20%', sorter: (a, b) => a.name.localeCompare(b.name) },
        { title: 'ç›£æ§å°è±¡', dataIndex: 'target', width: '15%' },
        {
          title: 'è³‡æºæ¨™ç±¤',
          dataIndex: 'resource_tags',
          key: 'resource_tags',
          width: '15%',
          render: (tags) => (
            <Space size={[4, 4]} wrap>
              {tags && typeof tags === 'object' && Object.keys(tags).length > 0 ? Object.entries(tags).map(([key, value]) => {
                const tagColorMap = {
                  'production': 'red',
                  'staging': 'orange',
                  'database': 'blue',
                  'web': 'green',
                  'mysql': 'purple',
                  'env': 'cyan'
                };
                return <Tag key={key} color={tagColorMap[value] || tagColorMap[key] || 'default'} size="small">{key}: {value}</Tag>;
              }) : <span style={{ color: 'var(--text-secondary)' }}>ç„¡æ¨™ç±¤</span>}
            </Space>
          )
        },
        {
          title: 'è§¸ç™¼æ¢ä»¶',
          dataIndex: 'conditions',
          width: '25%',
          render: (conditions) => {
            if (!conditions || !conditions.conditions || conditions.conditions.length === 0) {
              return <Text type="secondary">ç„¡æ¢ä»¶</Text>;
            }

            const { operator = 'AND', conditions: conditionList } = conditions;
            const displayConditions = conditionList.slice(0, 2);
            const remainingCount = conditionList.length - displayConditions.length;

            return (
              <Tooltip title={
                <div style={{ maxWidth: '350px' }}>
                  <div style={{ marginBottom: '8px', fontWeight: 600 }}>
                    è§¸ç™¼æ¢ä»¶ ({operator} é‚è¼¯)ï¼š
                  </div>
                  {conditionList.map((condition, i) => (
                    <div key={i} style={{ marginBottom: '6px' }}>
                      <Tag size="small" color="green">{condition.metric}</Tag>
                      <span style={{ margin: '0 4px', color: 'rgba(255,255,255,0.8)' }}>{condition.operator}</span>
                      <span style={{ color: 'rgba(255,255,255,0.9)' }}>{condition.value}</span>
                      <span style={{ margin: '0 4px', color: 'rgba(255,255,255,0.6)' }}>
                        ({condition.duration} {condition.durationUnit})
                      </span>
                    </div>
                  ))}
                </div>
              }
                placement="topLeft"
              >
                <div>
                  <Space size={[4, 4]} wrap style={{ maxWidth: '100%' }}>
                    {displayConditions.map((condition, i) => (
                      <Tag
                        key={i}
                        size="small"
                        color="green"
                        style={{
                          maxWidth: '140px',
                          overflow: 'hidden',
                          textOverflow: 'ellipsis',
                          whiteSpace: 'nowrap',
                          display: 'inline-block'
                        }}
                      >
                        {`${condition.metric} ${condition.operator} ${condition.value}`}
                      </Tag>
                    ))}
                    {remainingCount > 0 && (
                      <Tag size="small" style={{ color: 'rgba(255,255,255,0.6)' }}>
                        +{remainingCount}
                      </Tag>
                    )}
                  </Space>
                  {conditionList.length > 1 && (
                    <Text style={{ fontSize: '11px', color: 'rgba(255,255,255,0.5)', marginTop: '2px' }}>
                      {operator} é‚è¼¯
                    </Text>
                  )}
                </div>
              </Tooltip>
            );
          }
        },
        {
          title: 'é€šçŸ¥å°è±¡',
          dataIndex: 'notifications',
          key: 'notifications',
          width: '12%',
          render: (notifications) => (
            <Space size={[4, 4]} wrap>
              {notifications && notifications.length > 0 ?
                notifications.map((n, index) => (
                  typeof n === 'string' ?
                    <Tag key={index}>{n}</Tag> :
                    <Tag key={index}>{n.type}: {n.target}</Tag>
                )) : '-'
              }
            </Space>
          )
        },
        {
          title: 'æ“ä½œ', key: 'action', width: '10%', render: (_, record) => (
            <Space size="small">
              <Tooltip title="ç·¨è¼¯">
                <Button type="text" icon={<EditOutlined />} onClick={() => showModal(record)} />
              </Tooltip>
              <Tooltip title="åˆªé™¤">
                <Button type="text" danger icon={<DeleteOutlined />} onClick={() => handleDelete(record.key)} />
              </Tooltip>
            </Space>
          )
        }
      ];

      // æ ¹æ®å¯è§åˆ—è®¾ç½®è¿‡æ»¤è¡¨æ ¼åˆ—
      const filteredColumns = columns.filter(col => {
        if (col.key === 'action') return true; // æ“ä½œåˆ—å§‹ç»ˆæ˜¾ç¤º
        if (col.dataIndex === 'enabled') return visibleColumns.enabled;
        if (col.dataIndex === 'name') return visibleColumns.name;
        if (col.dataIndex === 'target') return visibleColumns.target;
        if (col.dataIndex === 'resource_tags') return visibleColumns.resource_tags;
        if (col.dataIndex === 'conditions') return visibleColumns.conditions;
        if (col.dataIndex === 'notifications') return visibleColumns.notifications;
        return true; // é»˜è®¤æ˜¾ç¤º
      });

      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      // Apply filters and search
      const filteredRules = rules.filter(rule => {
        // Search filter
        const matchesSearch = rule.name.toLowerCase().includes(searchText.toLowerCase()) ||
          (rule.target && rule.target.toLowerCase().includes(searchText.toLowerCase()));

        // Status filter
        const matchesEnabled = filters.enabled.length === 0 ||
          filters.enabled.includes(rule.enabled);

        // Target filter
        const matchesTarget = filters.target.length === 0 ||
          filters.target.includes(rule.target);

        return matchesSearch && matchesEnabled && matchesTarget;
      });

      return (
        <React.Fragment>

          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="æœå°‹è¦å‰‡åç¨±æˆ–ç›£æ§å°è±¡..."
                onChange={e => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Popover
                content={<AlertRulesFilterPopover />}
                title="ç¯©é¸æ¢ä»¶"
                trigger="click"
                open={isFilterOpen}
                onOpenChange={setIsFilterOpen}
                placement="bottomLeft"
                overlayClassName="filter-popover-overlay"
              >
                <Badge count={activeFiltersCount} size="small">
                  <Button
                    className="toolbar-btn"
                    icon={<FilterOutlined />}
                    type={activeFiltersCount > 0 ? "primary" : "default"}
                  >
                    ç¯©é¸
                  </Button>
                </Badge>
              </Popover>
            </Space>
            <Space>
              <Popover
                content={
                  <div style={{ width: '200px' }}>
                    <div style={{ marginBottom: '12px', fontWeight: 600, color: 'rgba(255, 255, 255, 0.9)' }}>
                      æ¬„ä½é¡¯ç¤ºè¨­å®š
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                      {Object.keys({
                        enabled: 'å•Ÿç”¨ç‹€æ…‹',
                        name: 'è¦å‰‡åç¨±',
                        target: 'ç›£æ§å°è±¡',
                        resource_tags: 'è³‡æºæ¨™ç±¤',
                        conditions: 'è§¸ç™¼æ¢ä»¶',
                        notifications: 'é€šçŸ¥å°è±¡'
                      }).map(key => (
                        <div key={key} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                          <Checkbox
                            checked={visibleColumns[key]}
                            onChange={(e) => setVisibleColumns(prev => ({ ...prev, [key]: e.target.checked }))}
                            style={{ marginRight: '8px' }}
                          />
                          <span style={{ color: 'rgba(255, 255, 255, 0.8)', fontSize: '13px' }}>
                            {{
                              enabled: 'å•Ÿç”¨ç‹€æ…‹',
                              name: 'è¦å‰‡åç¨±',
                              target: 'ç›£æ§å°è±¡',
                              resource_tags: 'è³‡æºæ¨™ç±¤',
                              conditions: 'è§¸ç™¼æ¢ä»¶',
                              notifications: 'é€šçŸ¥å°è±¡'
                            }[key]}
                          </span>
                        </div>
                      ))}
                    </div>
                  </div>
                }
                title={null}
                trigger="click"
                open={isColumnSettingsOpen}
                onOpenChange={setIsColumnSettingsOpen}
                placement="bottomRight"
                overlayStyle={{
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  backdropFilter: 'blur(8px)',
                  border: '1px solid rgba(255, 255, 255, 0.1)'
                }}
              >
                <Button className="toolbar-btn" icon={<EyeOutlined />}>
                  æ¬„ä½è¨­å®š
                </Button>
              </Popover>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>
                æ–°å¢è¦å‰‡
              </Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            {
              filteredRules.length > 0 ?
                <Table rowSelection={rowSelection} columns={filteredColumns} dataSource={filteredRules} rowKey="key" className="transparent-bg" size="small" /> :
                <Empty description="å°šç„¡ä»»ä½•äº‹ä»¶è¦å‰‡">
                  <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>ç«‹å³æ–°å¢è¦å‰‡</Button>
                </Empty>
            }
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>æ‰¹æ¬¡åˆªé™¤</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          <Modal
            title={null}
            open={isModalOpen}
            onCancel={handleCancel}
            width={900}
            footer={null}
            centered
            className="multi-step-modal alert-rule-modal"
          >
            {/* Modal Header */}
            <div className="modal-header" style={{
              borderBottom: '1px solid rgba(255, 255, 255, 0.08)',
              paddingBottom: '20px',
              marginBottom: '20px'
            }}>
              <Title level={3} style={{ margin: 0 }}>
                {editingRule ? 'ç·¨è¼¯äº‹ä»¶è¦å‰‡' : 'æ–°å¢äº‹ä»¶è¦å‰‡'}
              </Title>
              <Paragraph type="secondary" style={{ marginBottom: 0, marginTop: 8 }}>
                {currentStep === 1 && 'è¨­å®šäº‹ä»¶è¦å‰‡çš„åŸºæœ¬è³‡è¨Š'}
                {currentStep === 2 && 'å®šç¾©ä½•æ™‚è§¸ç™¼äº‹ä»¶'}
                {currentStep === 3 && 'è‡ªè¨‚äº‹ä»¶å…§å®¹èˆ‡é€šçŸ¥'}
                {currentStep === 4 && 'è¨­å®šè‡ªå‹•åŒ–éŸ¿æ‡‰å‹•ä½œ'}
              </Paragraph>
            </div>

            {/* Steps Navigation */}
            <div className="steps-container" style={{
              marginBottom: '32px'
            }}>
              <div className="steps" style={{
                display: 'flex',
                position: 'relative'
              }}>
                {[
                  { step: 1, label: 'åŸºæœ¬è³‡è¨Š', icon: 'ğŸ“‹' },
                  { step: 2, label: 'è§¸ç™¼æ¢ä»¶', icon: 'âš¡' },
                  { step: 3, label: 'äº‹ä»¶å…§å®¹', icon: 'ğŸ“¢' },
                  { step: 4, label: 'è‡ªå‹•åŒ–', icon: 'ğŸ¤–' }
                ].map(({ step, label, icon }) => {
                  const isActive = currentStep === step;
                  const isCompleted = currentStep > step;

                  return (
                    <div
                      key={step}
                      className="step-item"
                      onClick={() => setCurrentStep(step)}
                      style={{
                        flex: 1,
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        gap: '8px',
                        cursor: 'pointer',
                        position: 'relative',
                        zIndex: 1
                      }}
                    >
                      <div
                        className="step-indicator"
                        style={{
                          width: '40px',
                          height: '40px',
                          borderRadius: '50%',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          background: isActive ? 'linear-gradient(135deg, #1890ff 0%, #36cfc9 100%)' :
                            isCompleted ? 'rgba(52, 168, 83, 0.9)' : 'rgba(255, 255, 255, 0.08)',
                          border: `2px solid ${isActive ? 'transparent' :
                            isCompleted ? 'rgba(52, 168, 83, 0.6)' : 'rgba(255, 255, 255, 0.2)'
                            }`,
                          fontSize: '18px',
                          transition: 'all 0.3s ease',
                          boxShadow: isActive ? '0 0 20px rgba(24, 144, 255, 0.4)' : 'none'
                        }}
                      >
                        {isCompleted ? 'âœ“' : icon}
                      </div>
                      <span className="step-label">
                        {label}
                      </span>
                    </div>
                  );
                })}
                {/* Progress line */}
                <div
                  style={{
                    position: 'absolute',
                    top: '20px',
                    left: '20px',
                    right: '20px',
                    height: '2px',
                    background: 'rgba(255, 255, 255, 0.08)',
                    zIndex: 0
                  }}
                >
                  <div
                    style={{
                      position: 'absolute',
                      top: 0,
                      left: 0,
                      height: '100%',
                      width: `${((currentStep - 1) / 3) * 100}%`,
                      background: 'linear-gradient(90deg, #52a853 0%, #1890ff 100%)',
                      transition: 'width 0.3s ease'
                    }}
                  />
                </div>
              </div>
            </div>

            <Form form={form} layout="vertical" onFinish={onFinish} onValuesChange={handleFormChange}>
              {/* Step Content */}
              <div className="step-content" style={{
                minHeight: '400px',
                position: 'relative',
                overflow: 'hidden',
                padding: '24px 0'
              }}>
                {/* Step 1: Basic Info */}
                {currentStep === 1 && (
                  <>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
                      <div className="severity-indicator severity-critical"></div>
                      <Title level={4} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.9)' }}>å¿«é€Ÿå¥—ç”¨ç¯„æœ¬</Title>
                    </div>
                    <div style={{ padding: '20px', background: 'rgba(255, 255, 255, 0.02)', border: '1px solid rgba(255, 255, 255, 0.08)', borderRadius: '8px', marginBottom: '32px' }}>
                      <Space wrap size={[12, 8]}>
                        {[
                          { key: 'cpu_multi_level', label: 'CPU å¤šç­‰ç´šäº‹ä»¶', icon: 'ğŸ¯' },
                          { key: 'cpu_high', label: 'CPU ä½¿ç”¨ç‡éé«˜', icon: 'ğŸ–¥ï¸' },
                          { key: 'memory_high', label: 'è¨˜æ†¶é«”ä½¿ç”¨ç‡éé«˜', icon: 'ğŸ§ ' },
                          { key: 'disk_space_low', label: 'ç£ç¢Ÿç©ºé–“ä¸è¶³', icon: 'ğŸ’¾' },
                          { key: 'database_lag', label: 'è³‡æ–™åº«å»¶é²', icon: 'ğŸ—„ï¸' },
                          { key: 'api_latency', label: 'API å»¶é²éé«˜', icon: 'âš¡' }
                        ].map(template => (
                          <Button
                            key={template.key}
                            className="btn btn--ghost btn--sm"
                            onClick={() => applyAlertTemplate(template.key)}
                          >
                            {template.icon} {template.label}
                          </Button>
                        ))}
                      </Space>
                    </div>

                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
                      <div className="severity-indicator severity-success"></div>
                      <Title level={4} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.9)' }}>åŸºæœ¬è³‡è¨Š</Title>
                    </div>
                    <div style={{ padding: '20px', background: 'rgba(255, 255, 255, 0.02)', border: '1px solid rgba(255, 255, 255, 0.08)', borderRadius: '8px', marginBottom: '32px' }}>
                      <Form.Item name="name" label="è¦å‰‡åç¨±" rules={[{ required: true, message: 'è«‹è¼¸å…¥è¦å‰‡åç¨±' }]}>
                        <Input placeholder="ä¾‹å¦‚ï¼šWeb ä¼ºæœå™¨ CPU ä½¿ç”¨ç‡äº‹ä»¶" />
                      </Form.Item>
                      <Form.Item name="description" label="æè¿°">
                        <TextArea rows={2} placeholder="ç•¶ CPU ä½¿ç”¨ç‡è¶…é 80% æ™‚è§¸ç™¼äº‹ä»¶ï¼Œä¸¦è‡ªå‹•æ“´å±•å¯¦ä¾‹" />
                      </Form.Item>
                      <Form.Item name="resource_tags" label="ç›£æ§è³‡æºæ¨™ç±¤" tooltip="é¸æ“‡è¦ç›£æ§çš„è³‡æºæ¨™ç±¤ï¼Œäº‹ä»¶è¦å‰‡å°‡æ‡‰ç”¨æ–¼å…·æœ‰é€™äº›æ¨™ç±¤çš„æ‰€æœ‰è³‡æº">
                        <SmartTagInput
                          placeholder="é¸æ“‡è³‡æºæ¨™ç±¤..."
                          style={{ width: '100%' }}
                        />
                      </Form.Item>
                    </div>
                  </>
                )}

                {/* Step 2: Trigger Conditions */}
                {currentStep === 2 && (
                  <>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
                      <div className="severity-indicator severity-warning"></div>
                      <Title level={4} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.9)' }}>è§¸ç™¼æ¢ä»¶</Title>
                    </div>
                    <Form.List name="condition_groups">
                      {(fields, { add, remove }) => (
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
                          {fields.map(({ key, name, ...restField }) => (
                            <div key={key} style={{ padding: '16px', background: 'rgba(255, 255, 255, 0.03)', border: '1px solid rgba(255, 255, 255, 0.1)', borderRadius: '8px' }}>
                              <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '16px' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                                  <span style={{ color: 'rgba(255, 255, 255, 0.7)', fontSize: '12px', background: 'rgba(255, 255, 255, 0.1)', padding: '2px 8px', borderRadius: '4px' }}>
                                    ä»»ä¸€ (OR)
                                  </span>
                                  <span style={{ color: 'rgba(255, 255, 255, 0.85)', fontWeight: '500' }}>
                                    æ¢ä»¶ç¾¤çµ„ {name + 1}
                                  </span>
                                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <span style={{ color: 'rgba(255, 255, 255, 0.8)', fontSize: '13px', fontWeight: '400' }}>äº‹ä»¶ç­‰ç´š:</span>
                                    <Form.Item
                                      noStyle
                                      shouldUpdate={(prevValues, currentValues) => {
                                        const prevSeverity = prevValues.condition_groups?.[name]?.severity;
                                        const currentSeverity = currentValues.condition_groups?.[name]?.severity;
                                        return prevSeverity !== currentSeverity;
                                      }}
                                    >
                                      {({ getFieldValue }) => {
                                        const severity = getFieldValue(['condition_groups', name, 'severity']) || 'warning';

                                        return (
                                          <div style={{ display: 'flex', gap: '6px' }}>
                                            {[
                                              { value: 'info', label: 'INFO', color: 'blue' },
                                              { value: 'warning', label: 'WARNING', color: 'orange' },
                                              { value: 'critical', label: 'CRITICAL', color: 'red' }
                                            ].map(option => (
                                              <Tag
                                                key={option.value}
                                                color={severity === option.value ? option.color : 'default'}
                                                style={{
                                                  cursor: 'pointer',
                                                  opacity: severity === option.value ? 1 : 0.6,
                                                  border: severity === option.value ? `1px solid ${option.color}` : '1px solid rgba(255, 255, 255, 0.3)',
                                                  transition: 'all 0.2s'
                                                }}
                                                onClick={() => {
                                                  const currentGroups = form.getFieldValue('condition_groups') || [];
                                                  const newGroups = [...currentGroups];
                                                  if (newGroups[name]) {
                                                    newGroups[name] = { ...newGroups[name], severity: option.value };
                                                  } else {
                                                    newGroups[name] = { severity: option.value };
                                                  }
                                                  form.setFieldsValue({ condition_groups: newGroups });
                                                }}
                                              >
                                                {option.label}
                                              </Tag>
                                            ))}
                                          </div>
                                        );
                                      }}
                                    </Form.Item>
                                    <Form.Item name={[name, 'severity']} initialValue="warning" style={{ display: 'none' }}>
                                      <Input />
                                    </Form.Item>
                                  </div>
                                </div>
                                {fields.length > 1 && (
                                  <Button type="text" danger size="small" icon={<MinusCircleOutlined />} onClick={() => remove(name)} />
                                )}
                              </div>
                              <Form.List name={[name, 'conditions']}>
                                {(subFields, { add: subAdd, remove: subRemove }) => (
                                  <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                                    {subFields.map((subField) => (
                                      <div key={subField.key} style={{ display: 'flex', alignItems: 'center', gap: '8px', padding: '8px', background: 'rgba(0,0,0,0.2)', borderRadius: '6px' }}>
                                        <Form.Item {...subField} name={[subField.name, 'metric']} rules={[{ required: true }]} style={{ margin: 0, flex: 1 }}>
                                          <Select className="select-full" options={metrics.map(m => ({ label: m.name, value: m.id }))} placeholder="æŒ‡æ¨™é¸æ“‡" loading={metrics.length === 0} />
                                        </Form.Item>
                                        <Form.Item {...subField} name={[subField.name, 'operator']} initialValue=">" rules={[{ required: true }]} style={{ margin: 0 }}>
                                          <Select className="select-sm">
                                            <Select.Option value=">">&gt;</Select.Option>
                                            <Select.Option value="<">&lt;</Select.Option>
                                            <Select.Option value="=">=</Select.Option>
                                          </Select>
                                        </Form.Item>
                                        <Form.Item {...subField} name={[subField.name, 'value']} rules={[{ required: true }]} style={{ margin: 0 }}>
                                          <InputNumber placeholder="é–¾å€¼" className="select-md" />
                                        </Form.Item>
                                        <span style={{ color: 'rgba(255, 255, 255, 0.6)', fontSize: '12px' }}>åœ¨</span>
                                        <Form.Item {...subField} name={[subField.name, 'duration']} initialValue="5" rules={[{ required: true }]} style={{ margin: 0 }}>
                                          <InputNumber placeholder="æŒçºŒæ™‚é–“" className="select-md" />
                                        </Form.Item>
                                        <Form.Item {...subField} name={[subField.name, 'duration_unit']} initialValue="minutes" rules={[{ required: true }]} style={{ margin: 0 }}>
                                          <Select className="select-md">
                                            <Select.Option value="seconds">ç§’</Select.Option>
                                            <Select.Option value="minutes">åˆ†é˜</Select.Option>
                                            <Select.Option value="hours">å°æ™‚</Select.Option>
                                          </Select>
                                        </Form.Item>
                                        {subFields.length > 1 && (
                                          <Button type="text" danger size="small" icon={<DeleteOutlined />} onClick={() => subRemove(subField.name)} />
                                        )}
                                      </div>
                                    ))}
                                    {subFields.length > 1 && (
                                      <div style={{ textAlign: 'center', margin: '8px 0' }}>
                                        <span style={{ color: 'rgba(255, 255, 255, 0.6)', fontSize: '12px', background: 'rgba(255, 255, 255, 0.1)', padding: '2px 8px', borderRadius: '4px' }}>
                                          ä¸”æ»¿è¶³æ‰€æœ‰æ¢ä»¶ (AND)
                                        </span>
                                      </div>
                                    )}
                                    <Button
                                      className="btn btn--dashed btn--sm"
                                      onClick={() => subAdd({ duration: 5, duration_unit: 'minutes' })}
                                      icon={<PlusOutlined />}
                                      style={{ borderColor: 'rgba(255, 255, 255, 0.3)', width: '100%' }}
                                    >
                                      + æ–°å¢ AND æ¢ä»¶
                                    </Button>
                                  </div>
                                )}
                              </Form.List>
                            </div>
                          ))}
                          <Button
                            className="btn btn--dashed"
                            onClick={() => add({ severity: 'warning', conditions: [{ duration: 5, duration_unit: 'minutes' }] })}
                            icon={<PlusOutlined />}
                            size="large"
                            style={{ height: '48px', borderColor: 'rgba(255, 255, 255, 0.3)', fontWeight: '500', width: '100%' }}
                          >
                            + æ–°å¢ OR æ¢ä»¶ç¾¤çµ„
                          </Button>
                        </div>
                      )}
                    </Form.List>
                  </>
                )}

                {/* Step 3: Event Content */}
                {currentStep === 3 && (
                  <>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
                      <div className="severity-indicator severity-info"></div>
                      <Title level={4} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.9)' }}>äº‹ä»¶å…§å®¹èˆ‡é€šçŸ¥</Title>
                    </div>
                    <div style={{ padding: '20px', background: 'rgba(255, 255, 255, 0.02)', border: '1px solid rgba(255, 255, 255, 0.08)', borderRadius: '8px', marginBottom: '32px' }}>
                      <Form.Item name="title_template" label={
                        <span>
                          äº‹ä»¶æ¨™é¡Œæ¨£æ¿
                          {activeField === 'title_template' && <span style={{ color: '#1890ff', marginLeft: '8px', fontSize: '12px' }}>â—</span>}
                        </span>
                      } rules={[{ required: true }]} initialValue="ğŸš¨ {{resource.name}} - {{metric.name}} ç•°å¸¸">
                        <Input
                          placeholder="ä½¿ç”¨è®Šæ•¸ä¾†è‡ªè¨‚äº‹ä»¶æ¨™é¡Œ"
                          onFocus={() => setActiveField('title_template')}
                        />
                      </Form.Item>
                      <Form.Item name="content_template" label={
                        <span>
                          äº‹ä»¶å…§å®¹æ¨£æ¿
                          {activeField === 'content_template' && <span style={{ color: '#1890ff', marginLeft: '8px', fontSize: '12px' }}>â—</span>}
                        </span>
                      } rules={[{ required: true }]} initialValue="{{resource.name}} çš„ {{metric.name}} å·²æŒçºŒ {{duration}} åˆ†é˜è¶…éé–¾å€¼ {{threshold}}ï¼Œç›®å‰æ•¸å€¼ç‚º {{metric.value}}ã€‚è«‹ç«‹å³é—œæ³¨ï¼">
                        <TextArea
                          rows={3}
                          placeholder="ä½¿ç”¨è®Šæ•¸ä¾†è‡ªè¨‚äº‹ä»¶å…§å®¹"
                          onFocus={() => setActiveField('content_template')}
                        />
                      </Form.Item>
                      <div style={{ marginBottom: '24px' }}>
                        <div style={{ marginBottom: '8px', fontSize: '12px', color: 'rgba(255, 255, 255, 0.7)' }}>
                          å¯ç”¨è®Šæ•¸ï¼ˆé»æ“Šæ’å…¥ï¼‰ï¼š
                          <span style={{ color: '#1890ff', marginLeft: '8px' }}>
                            ç•¶å‰ç·¨è¼¯ï¼š{activeField === 'title_template' ? 'äº‹ä»¶æ¨™é¡Œæ¨£æ¿' : 'äº‹ä»¶å…§å®¹æ¨£æ¿'}
                          </span>
                        </div>
                        <Space wrap size={[8, 4]}>
                          {[
                            { label: '{{resource.name}}', desc: 'è³‡æºåç¨±' },
                            { label: '{{resource.type}}', desc: 'è³‡æºé¡å‹' },
                            { label: '{{metric.name}}', desc: 'æŒ‡æ¨™åç¨±' },
                            { label: '{{metric.value}}', desc: 'æŒ‡æ¨™æ•¸å€¼' },
                            { label: '{{threshold}}', desc: 'é–¾å€¼' },
                            { label: '{{operator}}', desc: 'é‹ç®—å­' },
                            { label: '{{duration}}', desc: 'æŒçºŒæ™‚é–“' },
                            { label: '{{duration_unit}}', desc: 'æŒçºŒæ™‚é–“å–®ä½' },
                            { label: '{{severity}}', desc: 'åš´é‡ç¨‹åº¦' },
                            { label: '{{timestamp}}', desc: 'è§¸ç™¼æ™‚é–“' }
                          ].map(variable => (
                            <Tooltip key={variable.label} title={variable.desc}>
                              <Tag
                                style={{
                                  cursor: 'pointer',
                                  background: 'rgba(24, 144, 255, 0.1)',
                                  borderColor: 'rgba(24, 144, 255, 0.3)',
                                  color: 'rgba(24, 144, 255, 0.9)',
                                  transition: 'all 0.2s'
                                }}
                                onClick={(e) => {
                                  // ä½¿ç”¨çµ„ä»¶ç‹€æ…‹è·Ÿè¸ªçš„ç•¶å‰æ´»å‹•å­—æ®µ
                                  const fieldName = activeField;

                                  // æ ¹æ“šå­—æ®µåæ‰¾åˆ°å°æ‡‰çš„è¼¸å…¥æ¡†
                                  let targetInput = null;
                                  if (fieldName === 'title_template') {
                                    targetInput = document.querySelector('input[placeholder="ä½¿ç”¨è®Šæ•¸ä¾†è‡ªè¨‚äº‹ä»¶æ¨™é¡Œ"]');
                                  } else if (fieldName === 'content_template') {
                                    targetInput = document.querySelector('textarea[placeholder="ä½¿ç”¨è®Šæ•¸ä¾†è‡ªè¨‚äº‹ä»¶å…§å®¹"]');
                                  }

                                  if (targetInput && form) {
                                    // ç²å–ç•¶å‰å…‰æ¨™ä½ç½®ï¼Œå¦‚æœæ²’æœ‰é¸æ“‡å‰‡åœ¨çµå°¾æ’å…¥
                                    const start = targetInput.selectionStart || targetInput.selectionEnd || targetInput.value.length;
                                    const end = targetInput.selectionEnd || targetInput.selectionStart || targetInput.value.length;
                                    const value = targetInput.value;
                                    const newValue = value.substring(0, start) + variable.label + value.substring(end);

                                    // æ›´æ–°è¡¨å–®å€¼
                                    form.setFieldsValue({ [fieldName]: newValue });

                                    // ä½¿ç”¨setTimeoutç¢ºä¿DOMæ›´æ–°å¾Œå†èšç„¦ä¸¦å®šä½å…‰æ¨™
                                    setTimeout(() => {
                                      targetInput.focus();
                                      const newPosition = start + variable.label.length;
                                      targetInput.setSelectionRange(newPosition, newPosition);
                                    }, 10);
                                  } else {
                                    // å¦‚æœæ‰¾ä¸åˆ°ç›®æ¨™è¼¸å…¥æ¡†ï¼Œé¡¯ç¤ºæç¤º
                                    message.warning('è«‹å…ˆé¸æ“‡è¦ç·¨è¼¯çš„å­—æ®µ');
                                  }
                                }}
                                onMouseEnter={(e) => {
                                  e.target.style.background = 'rgba(24, 144, 255, 0.15)';
                                  e.target.style.transform = 'scale(1.05)';
                                }}
                                onMouseLeave={(e) => {
                                  e.target.style.background = 'rgba(24, 144, 255, 0.1)';
                                  e.target.style.transform = 'scale(1)';
                                }}
                              >
                                {variable.label}
                              </Tag>
                            </Tooltip>
                          ))}
                        </Space>
                      </div>
                    </div>
                  </>
                )}

                {/* Step 4: Automation */}
                {currentStep === 4 && (
                  <>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '16px' }}>
                      <div style={{ width: '4px', height: '24px', background: 'linear-gradient(135deg, #13c2c2 0%, #36cfc9 100%)', borderRadius: '2px', marginRight: '12px' }}></div>
                      <Title level={4} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.9)' }}>è‡ªå‹•åŒ–éŸ¿æ‡‰</Title>
                    </div>
                    <div style={{ padding: '16px', background: 'rgba(255, 255, 255, 0.02)', border: '1px solid rgba(255, 255, 255, 0.08)', borderRadius: '8px' }}>
                      <Form.Item name="automation_enabled" valuePropName="checked" style={{ marginBottom: '12px' }}>
                        <Checkbox>å•Ÿç”¨è‡ªå‹•åŒ–éŸ¿æ‡‰</Checkbox>
                      </Form.Item>
                      <Form.Item
                        noStyle
                        shouldUpdate={(prevValues, currentValues) => prevValues.automation_enabled !== currentValues.automation_enabled}
                      >
                        {({ getFieldValue }) =>
                          getFieldValue('automation_enabled') ? (
                            <Form.Item name="automation_script" label="é¸æ“‡è…³æœ¬" rules={[{ required: true, message: 'è«‹é¸æ“‡è‡ªå‹•åŒ–è…³æœ¬' }]} style={{ marginBottom: '12px' }}>
                              <Select allowClear placeholder="é¸æ“‡è‡ªå‹•åŒ–è…³æœ¬" options={mockScripts.map(s => ({ label: s.name, value: s.id }))} />
                            </Form.Item>
                          ) : null
                        }
                      </Form.Item>
                      <Form.Item
                        noStyle
                        shouldUpdate={(prevValues, currentValues) =>
                          prevValues.automation_enabled !== currentValues.automation_enabled ||
                          prevValues.automation_script !== currentValues.automation_script
                        }
                      >
                        {({ getFieldValue }) => {
                          const automationEnabled = getFieldValue('automation_enabled');
                          const selectedScriptId = getFieldValue('automation_script');
                          const currentSelectedScript = mockScripts.find(s => s.id === selectedScriptId);

                          return automationEnabled && currentSelectedScript && currentSelectedScript.params ? (
                            <div className="script-params-container" style={{ marginTop: '16px', padding: '16px', background: 'rgba(255, 255, 255, 0.03)', border: '1px solid rgba(255, 255, 255, 0.1)', borderRadius: '8px' }}>
                              <div className="script-params-header" style={{ marginBottom: '12px' }}>
                                <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.85)' }}>è…³æœ¬åƒæ•¸</Title>
                              </div>
                              <div className="script-params-content">
                                {currentSelectedScript.params.map(p => (
                                  <Form.Item key={p.name} name={['automation_params', p.name]} label={p.label} rules={[{ required: true }]}>
                                    {p.type === 'number' ? <InputNumber className="select-full" /> : <Input />}
                                  </Form.Item>
                                ))}
                              </div>
                            </div>
                          ) : null;
                        }}
                      </Form.Item>
                    </div>
                  </>
                )}
              </div>

              {/* Footer Buttons */}
              <div className="modal-footer">
                <div>
                  {currentStep > 1 && (
                    <Button
                      onClick={() => setCurrentStep(currentStep - 1)}
                    >
                      {`ä¸Šä¸€æ­¥ï¼š${steps[currentStep - 1]?.title || 'ä¸Šä¸€æ­¥'}`}
                    </Button>
                  )}
                </div>
                <div>
                  <Button onClick={handleCancel}>
                    å–æ¶ˆ
                  </Button>
                  {currentStep < 4 ? (
                    <Button
                      type="primary"
                      onClick={() => setCurrentStep(currentStep + 1)}
                    >
                      {`ä¸‹ä¸€æ­¥ï¼š${steps[currentStep]?.title || 'ä¸‹ä¸€æ­¥'}`}
                    </Button>
                  ) : (
                    <Button
                      type="primary"
                      onClick={() => form.submit()}
                    >
                      å®Œæˆ
                    </Button>
                  )}
                </div>
              </div>
            </Form>
          </Modal>

        </React.Fragment >
      );
    };

    const NotificationStrategiesPage = () => {
      // ğŸš€ é€šçŸ¥ç­–ç•¥æ¨¡æ“¬æ•¸æ“š - ä¼æ¥­ç´šé€šçŸ¥é…ç½®ç¯„ä¾‹
      const defaultStrategies = [
        {
          key: 'ns_1',
          name: 'Production Database Critical Alerts',
          description: 'ç”Ÿç”¢è³‡æ–™åº«åš´é‡å‘Šè­¦ç­–ç•¥',
          resourceGroup: { key: 'rg_prod_db', name: 'Production-Database' },
          team: { key: 'team_6', name: 'Database Team' },
          channels: [
            { key: 'c_pagerduty_db', name: 'Database Team PagerDuty', type: 'PagerDuty' },
            { key: 'c_slack_db', name: 'Database Slack Channel', type: 'Slack' }
          ],
          conditions: [
            { field: 'severity', operator: 'equals', value: 'critical' },
            { field: 'resource_type', operator: 'equals', value: 'database' }
          ],
          priority: 'high',
          enabled: true,
          created_at: dayjs().subtract(15, 'day'),
          lastTriggered: dayjs().subtract(2, 'hour'),
          triggerCount: 8
        },
        {
          key: 'ns_2',
          name: 'Web Services Performance Degradation',
          description: 'Webæœå‹™æ€§èƒ½é™ç´šå‘Šè­¦ç­–ç•¥',
          resourceGroup: { key: 'rg_prod_web', name: 'Production-Web' },
          team: { key: 'team_9', name: 'Operations Team' },
          channels: [
            { key: 'c_pagerduty_ops', name: 'Operations Team PagerDuty', type: 'PagerDuty' },
            { key: 'c_slack_ops', name: 'Operations Slack Channel', type: 'Slack' }
          ],
          conditions: [
            { field: 'severity', operator: 'in', value: ['warning', 'critical'] },
            { field: 'metric', operator: 'contains', value: 'response_time' },
            { field: 'resource_group', operator: 'equals', value: 'rg_prod_web' }
          ],
          priority: 'high',
          enabled: true,
          created_at: dayjs().subtract(8, 'day'),
          lastTriggered: dayjs().subtract(25, 'minute'),
          triggerCount: 23
        },
        {
          key: 'ns_3',
          name: 'Network Infrastructure Alerts',
          description: 'ç¶²è·¯åŸºç¤è¨­æ–½å‘Šè­¦ç­–ç•¥',
          resourceGroup: { key: 'rg_monitoring', name: 'Monitoring' },
          team: { key: 'team_7', name: 'Network Team' },
          channels: [
            { key: 'c_pagerduty_network', name: 'Network Team PagerDuty', type: 'PagerDuty' },
            { key: 'c_slack_network', name: 'Network Slack Channel', type: 'Slack' }
          ],
          conditions: [
            { field: 'component', operator: 'in', value: ['network', 'firewall', 'load_balancer'] },
            { field: 'severity', operator: 'not_equals', value: 'info' }
          ],
          priority: 'medium',
          enabled: true,
          created_at: dayjs().subtract(22, 'day'),
          lastTriggered: dayjs().subtract(3, 'hour'),
          triggerCount: 12
        },
        {
          key: 'ns_4',
          name: 'Security Incident Escalation',
          description: 'å®‰å…¨äº‹ä»¶å‡ç´šå‘Šè­¦ç­–ç•¥',
          resourceGroup: { key: 'rg_prod_web', name: 'Production-Web' },
          team: { key: 'team_8', name: 'Security Team' },
          channels: [
            { key: 'c_email_security', name: 'Security Email', type: 'Email' }
          ],
          conditions: [
            { field: 'category', operator: 'equals', value: 'security' },
            { field: 'severity', operator: 'in', value: ['critical', 'high'] },
            { field: 'tags', operator: 'contains', value: 'intrusion' }
          ],
          priority: 'critical',
          enabled: true,
          created_at: dayjs().subtract(30, 'day'),
          lastTriggered: dayjs().subtract(1, 'day'),
          triggerCount: 3
        },
        {
          key: 'ns_5',
          name: 'Staging Environment Issues',
          description: 'æ¸¬è©¦ç’°å¢ƒå•é¡Œå‘Šè­¦ç­–ç•¥',
          resourceGroup: { key: 'rg_staging', name: 'Staging' },
          team: { key: 'team_5', name: 'DevOps Team' },
          channels: [
            { key: 'c_email_devops', name: 'DevOps Email', type: 'Email' }
          ],
          conditions: [
            { field: 'environment', operator: 'equals', value: 'staging' },
            { field: 'severity', operator: 'in', value: ['warning', 'critical'] }
          ],
          priority: 'low',
          enabled: false,
          created_at: dayjs().subtract(5, 'day'),
          lastTriggered: dayjs().subtract(6, 'hour'),
          triggerCount: 15
        },
        {
          key: 'ns_6',
          name: 'Platform Infrastructure Health',
          description: 'å¹³å°åŸºç¤è¨­æ–½å¥åº·åº¦å‘Šè­¦ç­–ç•¥',
          resourceGroup: { key: 'rg_monitoring', name: 'Monitoring' },
          team: { key: 'team_10', name: 'Platform Team' },
          channels: [
            { key: 'c_pagerduty_platform', name: 'Platform Team PagerDuty', type: 'PagerDuty' },
            { key: 'c_slack_platform', name: 'Platform Slack Channel', type: 'Slack' }
          ],
          conditions: [
            { field: 'service', operator: 'in', value: ['kubernetes', 'docker', 'consul'] },
            { field: 'health_score', operator: 'less_than', value: '80' },
            { field: 'severity', operator: 'not_equals', value: 'info' }
          ],
          priority: 'high',
          enabled: true,
          created_at: dayjs().subtract(12, 'day'),
          lastTriggered: dayjs().subtract(45, 'minute'),
          triggerCount: 19
        }
      ];

      const [strategies, setStrategies] = useLocalStorageState('sre-notification-strategies', defaultStrategies);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingStrategy, setEditingStrategy] = useState(null);
      const [currentStep, setCurrentStep] = useState(1);
      const [selectedResourceGroup, setSelectedResourceGroup] = useState(null);
      const [selectedTeam, setSelectedTeam] = useState(null);
      const [selectedChannels, setSelectedChannels] = useState([]);
      const [matchConditions, setMatchConditions] = useState([]);
      const [strategyName, setStrategyName] = useState('');
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [manualTeamSelection, setManualTeamSelection] = useState(false);
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // æ¨¡æ“¬æ•¸æ“š
      const mockResourceGroups = [
        { key: 'rg_prod_db', name: 'Production-Database', description: 'ç”Ÿç”¢ç’°å¢ƒè³‡æ–™åº«è³‡æº' },
        { key: 'rg_prod_web', name: 'Production-Web', description: 'ç”Ÿç”¢ç’°å¢ƒWebæœå‹™è³‡æº' },
        { key: 'rg_staging', name: 'Staging', description: 'æ¸¬è©¦ç’°å¢ƒè³‡æº' },
        { key: 'rg_monitoring', name: 'Monitoring', description: 'ç›£æ§ç³»çµ±è³‡æº' }
      ];

      const mockTeams = [
        { key: 'team_1', name: 'Developers', description: 'è² è²¬é–‹ç™¼èˆ‡ç¶­è­·çš„æ ¸å¿ƒåœ˜éšŠ' },
        { key: 'team_2', name: 'Viewers', description: 'åƒ…æœ‰æª¢è¦–æ¬Šé™çš„è§€å¯Ÿå“¡' },
        { key: 'team_3', name: 'Administrators', description: 'å¹³å°æœ€é«˜æ¬Šé™ç®¡ç†è€…' },
        { key: 'team_4', name: 'QA Team', description: 'å“è³ªä¿è­‰èˆ‡æ¸¬è©¦åœ˜éšŠ' },
        { key: 'team_5', name: 'DevOps Team', description: 'è² è²¬CI/CDå’ŒåŸºç¤è¨­æ–½è‡ªå‹•åŒ–çš„åœ˜éšŠ' },
        { key: 'team_6', name: 'Database Team', description: 'è² è²¬è³‡æ–™åº«ç®¡ç†èˆ‡å„ªåŒ–çš„åœ˜éšŠ' },
        { key: 'team_7', name: 'Network Team', description: 'è² è²¬ç¶²è·¯åŸºç¤è¨­æ–½èˆ‡å®‰å…¨çš„åœ˜éšŠ' },
        { key: 'team_8', name: 'Security Team', description: 'è² è²¬è³‡è¨Šå®‰å…¨èˆ‡åˆè¦çš„åœ˜éšŠ' },
        { key: 'team_9', name: 'Operations Team', description: 'è² è²¬ç³»çµ±é‹ç‡Ÿèˆ‡ç›£æ§çš„åœ˜éšŠ' },
        { key: 'team_10', name: 'Platform Team', description: 'è² è²¬å¹³å°æ¶æ§‹èˆ‡æŠ€è¡“åŸºç¤è¨­æ–½çš„åœ˜éšŠ' }
      ];

      const mockChannels = [
        { key: 'c_pagerduty_db', name: 'Database Team PagerDuty', type: 'PagerDuty', team: 'team_6' },
        { key: 'c_slack_db', name: 'Database Slack Channel', type: 'Slack', team: 'team_6' },
        { key: 'c_pagerduty_ops', name: 'Operations Team PagerDuty', type: 'PagerDuty', team: 'team_9' },
        { key: 'c_slack_ops', name: 'Operations Slack Channel', type: 'Slack', team: 'team_9' },
        { key: 'c_email_devops', name: 'DevOps Email', type: 'Email', team: 'team_5' },
        { key: 'c_pagerduty_network', name: 'Network Team PagerDuty', type: 'PagerDuty', team: 'team_7' },
        { key: 'c_slack_network', name: 'Network Slack Channel', type: 'Slack', team: 'team_7' },
        { key: 'c_email_security', name: 'Security Email', type: 'Email', team: 'team_8' },
        { key: 'c_pagerduty_platform', name: 'Platform Team PagerDuty', type: 'PagerDuty', team: 'team_10' },
        { key: 'c_slack_platform', name: 'Platform Slack Channel', type: 'Slack', team: 'team_10' }
      ];

      // ğŸ¯ æ™ºæ…§åŒ¹é…å€¼è¼¸å…¥å‡½æ•¸ - æ ¹æ“šæ¨™ç±¤é¡å‹é¸æ“‡æœ€ä½³è¼¸å…¥æ–¹å¼
      const getSmartValueInput = (condition, index) => {
        const { key, value } = condition;

        // æ¨¡æ“¬æ•¸æ“š - å¯¦éš›æ‡‰è©²å¾ API ç²å–
        const mockData = {
          severity: ['critical', 'warning', 'info', 'debug'],
          env: ['production', 'staging', 'development', 'testing'],
          team: ['Developers', 'DevOps Team', 'Database Team', 'Network Team', 'Security Team', 'Operations Team', 'Platform Team'],
          component: ['network', 'firewall', 'load_balancer', 'kubernetes', 'docker', 'consul'],
          category: ['security', 'performance', 'availability', 'capacity', 'configuration'],
          instance: ['web-prod-01', 'web-prod-02', 'db-master-01', 'cache-01', 'api-gateway-01'],
          service: ['user-service', 'order-service', 'payment-service', 'notification-service', 'analytics-service']
        };

        // æª¢æŸ¥æ˜¯å¦ç‚ºå¤šé¸é‹ç®—å­
        const isMultiSelectOperator = condition.operator === 'in' || condition.operator === 'not_in';

        // æ ¹æ“šæ¨™ç±¤é¡å‹é¸æ“‡è¼¸å…¥æ–¹å¼
        switch (key) {
          // ğŸ“‹ ä¸‹æ‹‰é¸å–® - æœ‰é™ä¸”å›ºå®šå€¼
          case 'severity':
          case 'env':
          case 'team':
          case 'component':
          case 'category':
            if (isMultiSelectOperator) {
              // å¤šé¸æ¨¡å¼
              return (
                <Select
                  mode="multiple"
                  placeholder="é¸æ“‡å¤šå€‹å€¼"
                  style={{ flex: 1 }}
                  value={value ? value.split(',').map(v => v.trim()) : []}
                  onChange={vals => updateMatchCondition(index, 'value', vals.join(', '))}
                  showSearch
                  optionFilterProp="children"
                >
                  {mockData[key]?.map(option => (
                    <Select.Option key={option} value={option}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                        {key === 'severity' && (
                          <Tag color={
                            option === 'critical' ? 'red' :
                              option === 'warning' ? 'orange' :
                                option === 'info' ? 'blue' : 'gray'
                          } size="small">
                            {option.toUpperCase()}
                          </Tag>
                        )}
                        {option}
                      </div>
                    </Select.Option>
                  ))}
                </Select>
              );
            } else {
              // å–®é¸æ¨¡å¼
              return (
                <Select
                  placeholder="é¸æ“‡å€¼"
                  style={{ flex: 1 }}
                  value={value}
                  onChange={val => updateMatchCondition(index, 'value', val)}
                  showSearch
                  optionFilterProp="children"
                >
                  {mockData[key]?.map(option => (
                    <Select.Option key={option} value={option}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                        {key === 'severity' && (
                          <Tag color={
                            option === 'critical' ? 'red' :
                              option === 'warning' ? 'orange' :
                                option === 'info' ? 'blue' : 'gray'
                          } size="small">
                            {option.toUpperCase()}
                          </Tag>
                        )}
                        {option}
                      </div>
                    </Select.Option>
                  ))}
                </Select>
              );
            }

          // ğŸ” è‡ªå‹•å®Œæˆè¼¸å…¥æ¡† - å¤§é‡ä¸”ä¸å›ºå®šå€¼
          case 'instance':
          case 'service':
            return (
              <AutoComplete
                placeholder="è¼¸å…¥æˆ–é¸æ“‡å€¼"
                style={{ flex: 1 }}
                value={value}
                onChange={val => updateMatchCondition(index, 'value', val)}
                options={mockData[key]?.map(option => ({
                  value: option,
                  label: (
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <SearchOutlined style={{ color: 'rgba(255,255,255,0.5)' }} />
                      {option}
                    </div>
                  )
                }))}
                filterOption={(inputValue, option) =>
                  option.value.toLowerCase().includes(inputValue.toLowerCase())
                }
              />
            );

          // âœï¸ è‡ªç”±è¼¸å…¥ - éˆæ´»åŒ¹é…
          case 'alert_name':
          default:
            return (
              <Input
                placeholder="è¼¸å…¥åŒ¹é…å€¼"
                style={{ flex: 1 }}
                value={value}
                onChange={e => updateMatchCondition(index, 'value', e.target.value)}
                prefix={<EditOutlined style={{ color: 'rgba(255,255,255,0.5)' }} />}
              />
            );
        }
      };

      const showModal = (strategy = null) => {
        setEditingStrategy(strategy);
        setCurrentStep(1);
        setSelectedResourceGroup(null);
        setSelectedTeam(null);
        setSelectedChannels([]);
        setMatchConditions([]);
        setStrategyName(strategy ? strategy.name : '');
        setManualTeamSelection(false);
        setIsModalOpen(true);
      };

      const handleCancel = () => {
        setIsModalOpen(false);
        setEditingStrategy(null);
        resetForm();
      };

      const resetForm = () => {
        setCurrentStep(1);
        setSelectedResourceGroup(null);
        setSelectedTeam(null);
        setSelectedChannels([]);
        setMatchConditions([]);
        setStrategyName('');
        setManualTeamSelection(false);
      };

      const handleResourceGroupSelect = (resourceGroupKey) => {
        const resourceGroup = mockResourceGroups.find(rg => rg.key === resourceGroupKey);
        setSelectedResourceGroup(resourceGroup);

        // æ ¹æ“šè³‡æºç¾¤çµ„è‡ªå‹•å»ºè­°åœ˜éšŠï¼ˆæ¨¡æ“¬é‚è¼¯ï¼‰
        if (resourceGroupKey === 'rg_prod_db') {
          setSelectedTeam(mockTeams.find(t => t.key === 'team_6'));
          setSelectedChannels(mockChannels.filter(c => c.team === 'team_6'));
        } else if (resourceGroupKey === 'rg_prod_web') {
          setSelectedTeam(mockTeams.find(t => t.key === 'team_9'));
          setSelectedChannels(mockChannels.filter(c => c.team === 'team_9'));
        } else if (resourceGroupKey === 'rg_monitoring') {
          setSelectedTeam(mockTeams.find(t => t.key === 'team_9'));
          setSelectedChannels(mockChannels.filter(c => c.team === 'team_9'));
        } else {
          setSelectedTeam(mockTeams.find(t => t.key === 'team_5'));
          setSelectedChannels(mockChannels.filter(c => c.team === 'team_5'));
        }
      };

      const handleTeamSelect = (teamKey) => {
        const team = mockTeams.find(t => t.key === teamKey);
        setSelectedTeam(team);
        setSelectedChannels(mockChannels.filter(c => c.team === teamKey));
      };

      const addMatchCondition = () => {
        setMatchConditions([...matchConditions, { key: '', operator: '=', value: '' }]);
      };

      const updateMatchCondition = (index, field, value) => {
        const newConditions = [...matchConditions];
        newConditions[index] = { ...newConditions[index], [field]: value };
        setMatchConditions(newConditions);
      };

      const removeMatchCondition = (index) => {
        setMatchConditions(matchConditions.filter((_, i) => i !== index));
      };

      const handleCreateStrategy = () => {
        if (!selectedResourceGroup || !selectedTeam || selectedChannels.length === 0) {
          message.error('è«‹å®Œæˆæ‰€æœ‰å¿…è¦è¨­å®š');
          return;
        }

        const strategy = {
          key: editingStrategy ? editingStrategy.key : `ns_${Date.now()}`,
          name: strategyName || `${selectedResourceGroup.name} é€šçŸ¥ç­–ç•¥`,
          resourceGroup: selectedResourceGroup,
          team: selectedTeam,
          channels: selectedChannels,
          matchConditions: matchConditions.filter(cond => cond.key && cond.value),
          created_at: editingStrategy ? editingStrategy.created_at : dayjs(),
          enabled: true
        };

        if (editingStrategy) {
          setStrategies(strategies.map(s => s.key === editingStrategy.key ? strategy : s));
          message.success('é€šçŸ¥ç­–ç•¥æ›´æ–°æˆåŠŸ');
        } else {
          setStrategies([...strategies, strategy]);
          message.success('é€šçŸ¥ç­–ç•¥å»ºç«‹æˆåŠŸ');
        }

        handleCancel();
      };

      const handleDelete = (strategy) => {
        confirmDelete('é€šçŸ¥ç­–ç•¥', () => {
          setStrategies(strategies.filter(s => s.key !== strategy.key));
        }, `ç­–ç•¥ "${strategy.name}"`);
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} æ¢ç­–ç•¥å—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setStrategies(strategies.filter(s => !selectedRowKeys.includes(s.key)));
            setSelectedRowKeys([]);
            message.success('æ‰¹æ¬¡åˆªé™¤æˆåŠŸ');
          }
        });
      };

      const handleToggleEnabled = (strategyKey, enabled) => {
        setStrategies(strategies.map(strategy =>
          strategy.key === strategyKey
            ? { ...strategy, enabled }
            : strategy
        ));
        message.success(`é€šçŸ¥ç­–ç•¥å·²${enabled ? 'å•Ÿç”¨' : 'åœç”¨'}`);
      };

      const columns = [
        {
          title: 'å•Ÿç”¨',
          dataIndex: 'enabled',
          width: '8%',
          render: (enabled, record) => (
            <Switch
              checked={enabled}
              onChange={(checked) => handleToggleEnabled(record.key, checked)}
            />
          )
        },
        { title: 'ç­–ç•¥åç¨±', dataIndex: 'name', sorter: (a, b) => a.name.localeCompare(b.name) },
        { title: 'è³‡æºç¾¤çµ„', dataIndex: 'resourceGroup', render: rg => rg?.name, sorter: (a, b) => a.resourceGroup?.name.localeCompare(b.resourceGroup?.name) },
        { title: 'è² è²¬åœ˜éšŠ', dataIndex: 'team', render: team => team?.name, sorter: (a, b) => a.team?.name.localeCompare(b.team?.name) },
        { title: 'é€šçŸ¥ç®¡é“æ•¸', dataIndex: 'channels', render: channels => channels?.length || 0, sorter: (a, b) => (a.channels?.length || 0) - (b.channels?.length || 0) },
        {
          title: 'æ“ä½œ',
          key: 'action',
          render: (_, record) => (
            <Space>
              <Tooltip title="ç·¨è¼¯">
                <Button type="text" icon={<EditOutlined />} onClick={() => showModal(record)} />
              </Tooltip>
              <Tooltip title="åˆªé™¤">
                <Button type="text" danger icon={<DeleteOutlined />} onClick={() => handleDelete(record)} />
              </Tooltip>
            </Space>
          )
        }
      ];

      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;
      const filteredStrategies = strategies.filter(s =>
        s.name.toLowerCase().includes(searchText.toLowerCase()) ||
        s.resourceGroup?.name.toLowerCase().includes(searchText.toLowerCase()) ||
        s.team?.name.toLowerCase().includes(searchText.toLowerCase())
      );

      return (
        <React.Fragment>

          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="æœå°‹ç­–ç•¥åç¨±ã€ç¾¤çµ„æˆ–åœ˜éšŠ..."
                onChange={e => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                ç¯©é¸
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>
                æ–°å¢é€šçŸ¥ç­–ç•¥
              </Button>
            </Space>
          </Space>

          <div className="table-wrapper">
            {strategies.length > 0 ? (
              <Table
                rowSelection={rowSelection}
                columns={columns}
                dataSource={filteredStrategies}
                rowKey="key"
                className="transparent-bg"
                pagination={{ pageSize: 10, position: ['bottomRight'], size: 'small' }}
                size="small"
              />
            ) : (
              <div style={{ padding: '40px 20px', textAlign: 'center' }}>
                <Empty description="å°šç„¡ä»»ä½•é€šçŸ¥ç­–ç•¥" />
              </div>
            )}
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>æ‰¹æ¬¡åˆªé™¤</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          {/* æ–°å¢/ç·¨è¼¯é€šçŸ¥ç­–ç•¥æ¨¡æ…‹æ¡† */}
          <Modal
            title={null}
            open={isModalOpen}
            onCancel={handleCancel}
            width={900}
            footer={null}
            centered
            className="notification-strategy-modal"
            style={{
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
              borderRadius: '12px'
            }}
          >
            {/* Modal Header */}
            <div className="modal-header" style={{
              borderBottom: '1px solid rgba(255, 255, 255, 0.08)',
              paddingBottom: '20px',
              marginBottom: '20px'
            }}>
              <Title level={3} style={{ margin: 0, color: 'var(--text-primary)' }}>
                {editingStrategy ? 'ç·¨è¼¯é€šçŸ¥ç­–ç•¥' : 'æ–°å¢é€šçŸ¥ç­–ç•¥'}
              </Title>
              <Paragraph type="secondary" style={{ marginBottom: 0, marginTop: 8 }}>
                {currentStep === 1 && 'é¸æ“‡è³‡æºç¾¤çµ„ï¼Œæ±ºå®šç›£æ§ç¯„åœ'}
                {currentStep === 2 && 'è¨­å®šé€šçŸ¥ç®¡é“ï¼Œé¸æ“‡è² è²¬åœ˜éšŠå’Œç®¡é“'}
                {currentStep === 3 && 'æ–°å¢åŒ¹é…æ¢ä»¶ï¼Œè¨­å®šé¡å¤–éæ¿¾æ¢ä»¶'}
              </Paragraph>
            </div>

            {/* Steps Navigation */}
            <div className="steps-container" style={{
              marginBottom: '32px',
            }}>
              <div style={{ marginBottom: '16px', textAlign: 'center' }}>
                <Text style={{ fontSize: '12px', color: 'rgba(255,255,255,0.6)' }}>
                  ğŸ’¡ é»æ“Šä»»ä¸€æ­¥é©Ÿå³å¯ç›´æ¥è·³è½‰ç·¨è¼¯
                </Text>
              </div>
              <div className="steps" style={{
                display: 'flex',
                position: 'relative'
              }}>
                {[
                  { step: 1, label: 'é¸æ“‡è³‡æºç¾¤çµ„', icon: 'ğŸ¯', subtitle: 'æ±ºå®šç›£æ§ç¯„åœ' },
                  { step: 2, label: 'è¨­å®šé€šçŸ¥ç®¡é“', icon: 'ğŸ‘¥', subtitle: 'é¸æ“‡è² è²¬åœ˜éšŠå’Œç®¡é“' },
                  { step: 3, label: 'æ–°å¢åŒ¹é…æ¢ä»¶', icon: 'âš™ï¸', subtitle: 'è¨­å®šé¡å¤–éæ¿¾æ¢ä»¶' }
                ].map(({ step, label, icon, subtitle }) => {
                  const isActive = currentStep === step;
                  const isCompleted = currentStep > step;

                  return (
                    <div
                      key={step}
                      className="step-item"
                      onClick={() => setCurrentStep(step)}
                      style={{
                        flex: 1,
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        gap: '8px',
                        cursor: 'pointer',
                        position: 'relative',
                        zIndex: 1
                      }}
                    >
                      <div
                        className="step-indicator"
                        style={{
                          width: '50px',
                          height: '50px',
                          borderRadius: '50%',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          background: isActive ? 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)' :
                            isCompleted ? 'rgba(52, 168, 83, 0.9)' : 'rgba(255, 255, 255, 0.08)',
                          border: `2px solid ${isActive ? 'transparent' :
                            isCompleted ? 'rgba(52, 168, 83, 0.6)' : 'rgba(255, 255, 255, 0.2)'
                            }`,
                          fontSize: '20px',
                          transition: 'all 0.3s ease',
                          boxShadow: isActive ? '0 0 20px rgba(24, 144, 255, 0.4)' : 'none'
                        }}
                      >
                        {isCompleted ? 'âœ“' : step}
                      </div>
                      <div style={{ textAlign: 'center' }}>
                        <div style={{
                          fontSize: '13px',
                          color: isActive ? '#1890ff' : isCompleted ? '#52a853' : 'rgba(255, 255, 255, 0.85)',
                          fontWeight: isActive ? '600' : '500',
                          transition: 'all 0.3s ease',
                          marginBottom: '2px'
                        }}>
                          {label}
                        </div>
                        <div style={{
                          fontSize: '11px',
                          color: 'rgba(255, 255, 255, 0.5)',
                          lineHeight: '1.2'
                        }}>
                          {subtitle}
                        </div>
                      </div>
                    </div>
                  );
                })}
                {/* Progress line */}
                <div
                  style={{
                    position: 'absolute',
                    top: '25px',
                    left: '25px',
                    right: '25px',
                    height: '2px',
                    background: 'rgba(255, 255, 255, 0.08)',
                    zIndex: 0
                  }}
                >
                  <div
                    style={{
                      position: 'absolute',
                      top: 0,
                      left: 0,
                      height: '100%',
                      width: `${((currentStep - 1) / 2) * 100}%`,
                      background: 'linear-gradient(90deg, #52a853 0%, #1890ff 100%)',
                      transition: 'width 0.3s ease'
                    }}
                  />
                </div>
              </div>
            </div>

            {/* Step Content Container */}
            <div className="step-content" style={{
              minHeight: '400px',
              position: 'relative',
              overflow: 'hidden',
              padding: '24px 0'
            }}>

              {/* ç¬¬1æ­¥ï¼šé¸æ“‡è³‡æºç¾¤çµ„ */}
              {currentStep === 1 && (
                <div style={{ padding: '0 20px' }}>
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '12px',
                    padding: '24px',
                    marginBottom: '24px'
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
                      <div style={{
                        width: '8px',
                        height: '32px',
                        background: 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)',
                        borderRadius: '4px',
                        marginRight: '12px'
                      }} />
                      <Title level={4} style={{ margin: 0, color: 'var(--text-primary)' }}>
                        ç¬¬ä¸€æ­¥ï¼šé¸æ“‡æ‚¨é—œå¿ƒçš„ç¯„åœ
                      </Title>
                    </div>

                    <Row gutter={[24, 16]}>
                      <Col span={24}>
                        <Form.Item
                          label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>è³‡æºç¾¤çµ„</span>}
                          rules={[{ required: true, message: 'è«‹é¸æ“‡è³‡æºç¾¤çµ„' }]}
                        >
                          <Select
                            placeholder="è«‹é¸æ“‡ä¸€å€‹è³‡æºç¾¤çµ„..."
                            style={{
                              width: '100%',
                              height: '48px'
                            }}
                            value={selectedResourceGroup?.key}
                            onChange={handleResourceGroupSelect}
                          >
                            {mockResourceGroups.map(rg => (
                              <Select.Option key={rg.key} value={rg.key}>
                                <div style={{ padding: '4px 0' }}>
                                  <div style={{
                                    fontWeight: '500',
                                    fontSize: '14px',
                                    color: 'var(--text-primary)',
                                    lineHeight: '1.4',
                                    marginBottom: '2px'
                                  }}>
                                    {rg.name}
                                  </div>
                                  <div style={{
                                    fontSize: '12px',
                                    color: 'var(--text-tertiary)',
                                    lineHeight: '1.3'
                                  }}>
                                    {rg.description}
                                  </div>
                                </div>
                              </Select.Option>
                            ))}
                          </Select>
                        </Form.Item>
                      </Col>
                      <Col span={24}>
                        <Form.Item label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>ç­–ç•¥åç¨±</span>}>
                          <Input
                            placeholder="è‡ªå‹•ç”Ÿæˆæˆ–è‡ªè¨‚åç¨±"
                            style={{ height: '48px' }}
                            value={strategyName}
                            onChange={e => setStrategyName(e.target.value)}
                          />
                        </Form.Item>
                      </Col>
                    </Row>
                  </div>
                </div>
              )}

              {/* ç¬¬2æ­¥ï¼šè¨­å®šé€šçŸ¥ç®¡é“ */}
              {currentStep === 2 && selectedResourceGroup && (
                <div>
                  <div style={{ marginBottom: '24px' }}>
                    <Text strong style={{ fontSize: '16px', color: 'rgba(255, 255, 255, 0.9)' }}>
                      ç¬¬äºŒæ­¥ï¼šé¸æ“‡é€šçŸ¥ç®¡é“
                    </Text>
                  </div>

                  {/* ç³»çµ±å»ºè­° */}
                  {selectedTeam && !manualTeamSelection && (
                    <div style={{ marginBottom: '16px', padding: '12px', background: 'rgba(24, 144, 255, 0.1)', borderRadius: '6px', border: '1px solid rgba(24, 144, 255, 0.2)' }}>
                      <Text style={{ color: 'rgba(24, 144, 255, 0.9)' }}>
                        ğŸ’¡ ç³»çµ±å»ºè­°ï¼šæ­¤è³‡æºç¾¤çµ„ç”± <strong>{selectedTeam.name}</strong> åœ˜éšŠè² è²¬
                      </Text>
                    </div>
                  )}

                  {/* è² è²¬åœ˜éšŠé¸æ“‡ */}
                  {(!selectedTeam || manualTeamSelection) && (
                    <Form.Item label="è² è²¬åœ˜éšŠ" rules={[{ required: true, message: 'è«‹é¸æ“‡è² è²¬åœ˜éšŠ' }]}>
                      <Select
                        placeholder="é¸æ“‡è² è²¬åœ˜éšŠ"
                        style={{ width: '100%' }}
                        value={selectedTeam?.key}
                        onChange={handleTeamSelect}
                      >
                        {mockTeams.map(team => (
                          <Select.Option key={team.key} value={team.key}>
                            {team.name} - {team.description}
                          </Select.Option>
                        ))}
                      </Select>
                    </Form.Item>
                  )}

                  {/* é€šçŸ¥ç®¡é“é¸æ“‡ */}
                  {selectedTeam && (
                    <Form.Item label="é€šçŸ¥ç®¡é“" rules={[{ required: true, message: 'è«‹é¸æ“‡è‡³å°‘ä¸€å€‹é€šçŸ¥ç®¡é“' }]}>
                      <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                        {mockChannels
                          .filter(channel => channel.team === selectedTeam.key)
                          .map(channel => (
                            <div key={channel.key} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                              <Checkbox
                                checked={selectedChannels.some(c => c.key === channel.key)}
                                onChange={(e) => {
                                  if (e.target.checked) {
                                    setSelectedChannels([...selectedChannels, channel]);
                                  } else {
                                    setSelectedChannels(selectedChannels.filter(c => c.key !== channel.key));
                                  }
                                }}
                              />
                              <Tag color={
                                channel.type === 'PagerDuty' ? 'red' :
                                  channel.type === 'Slack' ? 'blue' : 'green'
                              }>
                                {channel.type}
                              </Tag>
                              <Text style={{ color: 'rgba(255, 255, 255, 0.8)' }}>
                                {channel.name}
                              </Text>
                            </div>
                          ))}
                      </div>
                    </Form.Item>
                  )}

                  {/* æ‰‹å‹•é¸æ“‡å…¶ä»–åœ˜éšŠçš„é€£çµ */}
                  {!manualTeamSelection && (
                    <div style={{ marginTop: '12px' }}>
                      <Button
                        type="link"
                        size="small"
                        onClick={() => setManualTeamSelection(true)}
                        style={{ padding: 0, fontSize: '12px' }}
                      >
                        æ‰‹å‹•é¸æ“‡å…¶ä»–åœ˜éšŠ?
                      </Button>
                    </div>
                  )}
                </div>
              )}

              {/* ç¬¬3æ­¥ï¼šæ–°å¢åŒ¹é…æ¢ä»¶ */}
              {currentStep === 3 && (
                <div>
                  <div style={{ marginBottom: '24px' }}>
                    <Text strong style={{ fontSize: '16px', color: 'rgba(255, 255, 255, 0.9)' }}>
                      ç¬¬ä¸‰æ­¥ï¼šæ–°å¢æ›´å¤šåŒ¹é…æ¢ä»¶ (å¯é¸)
                    </Text>
                    <br />
                    <Text style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                      é™¤äº†è³‡æºç¾¤çµ„å¤–ï¼Œé‚„å¯ä»¥è¨­å®šé¡å¤–çš„æ¨™ç±¤åŒ¹é…æ¢ä»¶
                    </Text>
                  </div>

                  <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                    {matchConditions.map((condition, index) => (
                      <div key={index} style={{ display: 'flex', alignItems: 'center', gap: '8px', padding: '8px', background: 'rgba(0,0,0,0.2)', borderRadius: '6px' }}>
                        <Text style={{ color: 'rgba(255, 255, 255, 0.7)', fontSize: '12px', minWidth: '60px' }}>
                          ä¸” (AND)
                        </Text>
                        <Select
                          placeholder="é¸æ“‡æ¨™ç±¤"
                          style={{ width: '120px', flexShrink: 0 }}
                          value={condition.key}
                          onChange={value => updateMatchCondition(index, 'key', value)}
                        >
                          <Select.Option value="severity">severity</Select.Option>
                          <Select.Option value="alert_name">alert_name</Select.Option>
                          <Select.Option value="instance">instance</Select.Option>
                          <Select.Option value="service">service</Select.Option>
                          <Select.Option value="env">env</Select.Option>
                          <Select.Option value="team">team</Select.Option>
                          <Select.Option value="component">component</Select.Option>
                          <Select.Option value="category">category</Select.Option>
                        </Select>
                        <Select
                          style={{ width: '80px', flexShrink: 0 }}
                          value={condition.operator}
                          onChange={value => updateMatchCondition(index, 'operator', value)}
                        >
                          <Select.Option value="=">=</Select.Option>
                          <Select.Option value="!=">!=</Select.Option>
                          <Select.Option value="~">~</Select.Option>
                          <Select.Option value="!~">!~</Select.Option>
                          <Select.Option value="in">in</Select.Option>
                          <Select.Option value="not_in">not_in</Select.Option>
                        </Select>

                        {/* ğŸ¯ æ™ºæ…§åŒ¹é…å€¼è¼¸å…¥ - æ ¹æ“šæ¨™ç±¤é¡å‹é¸æ“‡æœ€ä½³è¼¸å…¥æ–¹å¼ */}
                        {getSmartValueInput(condition, index)}

                        <Button
                          type="text"
                          danger
                          icon={<DeleteOutlined />}
                          onClick={() => removeMatchCondition(index)}
                        />
                      </div>
                    ))}

                    <Button
                      type="dashed"
                      onClick={addMatchCondition}
                      icon={<PlusOutlined />}
                      style={{ borderColor: 'rgba(255, 255, 255, 0.3)' }}
                    >
                      æ–°å¢åŒ¹é…æ¢ä»¶
                    </Button>
                  </div>

                  {/* ğŸ’¡ ä½¿ç”¨æç¤º */}
                  <div style={{
                    marginTop: '16px',
                    padding: '12px',
                    background: 'rgba(24, 144, 255, 0.1)',
                    border: '1px solid rgba(24, 144, 255, 0.2)',
                    borderRadius: '6px'
                  }}>
                    <Text style={{ fontSize: '12px', color: 'rgba(24, 144, 255, 0.9)' }}>
                      ğŸ’¡ <strong>æ™ºæ…§è¼¸å…¥æç¤ºï¼š</strong><br />
                      â€¢ <strong>severityã€envã€team</strong>ï¼šæä¾›ä¸‹æ‹‰é¸å–®ï¼Œç¢ºä¿æº–ç¢ºæ€§<br />
                      â€¢ <strong>instanceã€service</strong>ï¼šæ”¯æ´è‡ªå‹•å®Œæˆï¼Œæ–¹ä¾¿è¼¸å…¥<br />
                      â€¢ <strong>alert_nameã€component</strong>ï¼šè‡ªç”±è¼¸å…¥ï¼Œéˆæ´»åŒ¹é…<br />
                      â€¢ <strong>in/not_in é‹ç®—å­</strong>ï¼šæ”¯æ´å¤šé¸å€¼ï¼Œæé«˜éˆæ´»æ€§
                    </Text>
                  </div>
                </div>
              )}

            </div>

            {/* åº•éƒ¨æŒ‰éˆ•å€åŸŸ */}
            <div className="modal-footer">
              <div>
                {currentStep > 1 && (
                  <Button
                    onClick={() => setCurrentStep(currentStep - 1)}
                  >
                    ä¸Šä¸€æ­¥
                  </Button>
                )}
              </div>
              <div>
                <Button
                  onClick={handleCancel}
                >
                  å–æ¶ˆ
                </Button>
                {currentStep < 3 && (
                  <Button
                    type="primary"
                    onClick={() => {
                      if (currentStep === 1 && !selectedResourceGroup) {
                        message.warning('è«‹å…ˆé¸æ“‡è³‡æºç¾¤çµ„');
                        return;
                      }
                      if (currentStep === 2 && (!selectedTeam || selectedChannels.length === 0)) {
                        message.warning('è«‹é¸æ“‡è² è²¬åœ˜éšŠå’Œé€šçŸ¥ç®¡é“');
                        return;
                      }
                      setCurrentStep(currentStep + 1);
                    }}
                  >
                    ä¸‹ä¸€æ­¥
                  </Button>
                )}
                {currentStep === 3 && (
                  <Button
                    type="primary"
                    onClick={handleCreateStrategy}
                  >
                    {editingStrategy ? 'æ›´æ–°ç­–ç•¥' : 'å»ºç«‹ç­–ç•¥'}
                  </Button>
                )}
              </div>
            </div>
          </Modal>
        </React.Fragment >
      );
    };

    const SilencesPage = () => {
      const initialSilences = [
        {
          key: 's_1',
          name: 'é€±æœ«ä¾‹è¡Œç¶­è­·',
          description: 'è³‡æ–™åº«ä¾‹è¡Œç¶­è­·ï¼Œé æœŸæœƒæœ‰çŸ­æš«é€£ç·šä¸­æ–·',
          type: 'recurring',
          recurringPattern: 'weekly',
          weekdays: [6, 0], // é€±å…­æ—¥
          timeSlot: ['02:00', '04:00'],
          validUntil: dayjs().add(6, 'month'),
          creator: 'admin',
          matchers: [
            { key: 'resource_group', op: '=', value: 'Production Database' },
            { key: 'resource_tag', op: '=', value: 'database' }
          ],
          enabled: true
        },
        {
          key: 's_2',
          name: 'æœˆåº•æ‰¹æ¬¡ä½œæ¥­',
          description: 'è²¡å‹™çµç®—æœŸé–“é«˜è² è¼‰',
          type: 'recurring',
          recurringPattern: 'monthly',
          monthlyType: 'lastday',
          timeSlot: ['22:00', '06:00'],
          validUntil: null,
          creator: 'admin',
          matchers: [
            { key: 'alert_name', op: '=', value: 'CPU high' },
            { key: 'resource_tag', op: '=', value: 'production' }
          ],
          enabled: true
        },
        {
          key: 's_3',
          name: 'ç·Šæ€¥ç¶­è­·è¦–çª—',
          description: 'ç·Šæ€¥ä¿®å¾©ä½œæ¥­',
          type: 'once',
          timeRange: [dayjs().add(1, 'day'), dayjs().add(1, 'day').add(4, 'hour')],
          creator: 'ops_user',
          matchers: [
            { key: 'resource_name', op: '=', value: 'api-gateway' },
            { key: 'resource_tag', op: '=', value: 'high-priority' }
          ],
          enabled: true
        },
        {
          key: 's_4',
          name: 'æ¯æœˆç¬¬äºŒå€‹é€±äºŒç™¼å¸ƒ',
          description: 'æ¯æœˆç¬¬äºŒå€‹é€±äºŒé€²è¡Œä¾‹è¡Œæ€§ç™¼å¸ƒï¼ŒæœŸé–“ç›¸é—œæœå‹™äº‹ä»¶éœéŸ³',
          type: 'recurring',
          recurringPattern: 'monthly',
          monthlyType: 'weekday',
          monthlySchedule: { week: 2, day: 2 },
          timeSlot: ['14:00', '16:00'],
          validUntil: null,
          creator: 'devops_lead',
          matchers: [
            { key: 'resource_group', op: '=', value: 'Production Web Servers' }
          ],
          enabled: true
        }
      ];

      const [silences, setSilences] = useLocalStorageState('sre-silences-v2', initialSilences);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingSilence, setEditingSilence] = useState(null);
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [currentStep, setCurrentStep] = useState(0);
      const [silenceType, setSilenceType] = useState('once');
      const [recurringPattern, setRecurringPattern] = useState('weekly');
      const [monthlyType, setMonthlyType] = useState('date');
      const [validityType, setValidityType] = useState('forever');
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // Column settings state
      const defaultVisibleColumns = {
        enabled: true,
        name: true,
        status: true,
        type: true,
        matchers: true,
        schedule: true,
        nextExecution: true,
        creator: true,
        action: true
      };
      const [visibleColumns, setVisibleColumns] = useLocalStorageState('sre-silence-columns', defaultVisibleColumns);
      const [isColumnSettingsOpen, setIsColumnSettingsOpen] = useState(false);

      // æ­¥é©Ÿå°èˆªå‡½æ•¸
      const nextStep = () => setCurrentStep(currentStep + 1);
      const prevStep = () => setCurrentStep(currentStep - 1);
      const resetSteps = () => setCurrentStep(0);

      // æ­¥é©Ÿé…ç½®
      const steps = [
        { title: 'åŸºæœ¬è³‡è¨Š', description: 'è¨­å®šè¦å‰‡åç¨±å’Œæè¿°' },
        { title: 'è¨­å®šæ’ç¨‹', description: 'è¨­å®šéœéŸ³ç”Ÿæ•ˆçš„æ™‚é–“' },
        { title: 'è¨­å®šç¯„åœ', description: 'è¨­å®šè¦éœéŸ³çš„äº‹ä»¶æ¢ä»¶' }
      ];

      // å¿«é€Ÿç¯„æœ¬
      const quickTemplates = [
        {
          name: 'é€±æœ«ç¶­è­·çª—å£',
          template: {
            type: 'recurring',
            recurringPattern: 'weekly',
            weekdays: [6, 0],
            timeSlot: ['02:00', '04:00'],
            validityType: 'until',
            validUntil: dayjs().add(6, 'month')
          }
        },
        {
          name: 'æœˆåº•æ‰¹æ¬¡ä½œæ¥­',
          template: {
            type: 'recurring',
            recurringPattern: 'monthly',
            monthlyType: 'lastday',
            timeSlot: ['22:00', '06:00'],
            validityType: 'forever'
          }
        },
        {
          name: 'æ¯æ—¥æ·±å¤œç¶­è­·',
          template: {
            type: 'recurring',
            recurringPattern: 'daily',
            timeSlot: ['01:00', '03:00'],
            validityType: 'forever'
          }
        }
      ];

      const applyTemplate = (templateData) => {
        setSilenceType(templateData.type);
        setRecurringPattern(templateData.recurringPattern || 'weekly');
        setMonthlyType(templateData.monthlyType || 'date');
        setValidityType(templateData.validityType || 'forever');
        form.setFieldsValue(templateData);
      };

      const getStatus = (record) => {
        if (!record.enabled) return { color: 'gray', text: 'å·²åœç”¨' };

        if (record.type === 'once') {
          const now = dayjs();
          const start = record.timeRange[0];
          const end = record.timeRange[1];
          if (now.isBefore(start)) return { color: 'blue', text: 'å¾…ç”Ÿæ•ˆ' };
          if (now.isAfter(end)) return { color: 'gray', text: 'å·²éæœŸ' };
          return { color: 'green', text: 'ç”Ÿæ•ˆä¸­' };
        } else {
          // é€±æœŸæ€§éœéŸ³ç‹€æ…‹åˆ¤æ–·
          if (record.validUntil && dayjs().isAfter(record.validUntil)) {
            return { color: 'gray', text: 'å·²éæœŸ' };
          }
          return { color: 'green', text: 'é€±æœŸç”Ÿæ•ˆ' };
        }
      };

      const getNextExecution = (record) => {
        if (record.type === 'once') return null;

        // ç°¡åŒ–çš„ä¸‹æ¬¡åŸ·è¡Œæ™‚é–“è¨ˆç®—
        if (record.recurringPattern === 'weekly' && record.weekdays) {
          const nextSaturday = dayjs().day(6).hour(parseInt(record.timeSlot[0])).minute(0);
          return nextSaturday.isAfter(dayjs()) ? nextSaturday : nextSaturday.add(1, 'week');
        }
        return dayjs().add(1, 'day').hour(parseInt(record.timeSlot?.[0] || '02')).minute(0);
      };

      const showModal = (silence = null) => {
        setEditingSilence(silence);
        setCurrentStep(0); // é‡ç½®åˆ°ç¬¬ä¸€æ­¥
        if (silence) {
          setSilenceType(silence.type || 'once');
          setRecurringPattern(silence.recurringPattern || 'weekly');
          setMonthlyType(silence.monthlyType || 'date');
          setValidityType(silence.validUntil ? 'until' : 'forever');
          form.setFieldsValue(silence);
        } else {
          setSilenceType('once');
          setRecurringPattern('weekly');
          setMonthlyType('date');
          setValidityType('forever');
          form.setFieldsValue({ matchers: [{}], enabled: true });
        }
        setIsModalOpen(true);
      };

      const handleCancel = () => {
        setIsModalOpen(false);
        setEditingSilence(null);
        form.resetFields();
      };

      // ğŸ¯ éœéŸ³è¦å‰‡æ™ºæ…§è¼¸å…¥å‡½æ•¸ - æ ¹æ“šæ¨™ç±¤é¡å‹é¸æ“‡æœ€ä½³è¼¸å…¥æ–¹å¼
      const getSilenceSmartValueInput = (selectedKey, style = {}) => {
        // éœéŸ³è¦å‰‡çš„æ¨™ç±¤é¸é …
        const silenceOptions = {
          severity: ['critical', 'warning', 'info', 'debug'],
          environment: ['production', 'staging', 'development', 'testing'],
          resource_name: ['web-server-01', 'db-master-01', 'cache-01', 'api-gateway-01'],
          resource_group: ['production-web', 'production-db', 'staging-web', 'monitoring'],
          alert_name: ['CPUä½¿ç”¨ç‡éé«˜', 'è¨˜æ†¶é«”ä¸è¶³', 'ç£ç¢Ÿç©ºé–“ä¸è¶³', 'ç¶²è·¯ç•°å¸¸'],
          resource_tag: ['production', 'staging', 'database', 'web-server', 'high-priority', 'team-alpha'],
          component: ['network', 'firewall', 'load_balancer', 'kubernetes', 'docker', 'consul'],
          team: ['Developers', 'DevOps Team', 'Database Team', 'Network Team', 'Security Team', 'Operations Team', 'Platform Team'],
          category: ['security', 'performance', 'availability', 'capacity', 'configuration']
        };

        // æ ¹æ“šæ¨™ç±¤é¡å‹é¸æ“‡è¼¸å…¥æ–¹å¼
        switch (selectedKey) {
          // ğŸ“‹ ä¸‹æ‹‰é¸å–® - æœ‰é™ä¸”å›ºå®šå€¼
          case 'severity':
          case 'environment':
          case 'resource_group':
          case 'resource_tag':
          case 'component':
          case 'team':
          case 'category':
            return (
              <Select
                placeholder="é¸æ“‡å€¼"
                style={{ ...style }}
                showSearch
                filterOption={(input, option) =>
                  (option?.children ?? '').toLowerCase().includes(input.toLowerCase())
                }
              >
                {silenceOptions[selectedKey]?.map(option => (
                  <Select.Option key={option} value={option}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      {selectedKey === 'severity' && (
                        <Tag color={
                          option === 'critical' ? 'red' :
                            option === 'warning' ? 'orange' :
                              option === 'info' ? 'blue' : 'gray'
                        } size="small">
                          {option.toUpperCase()}
                        </Tag>
                      )}
                      {option}
                    </div>
                  </Select.Option>
                ))}
              </Select>
            );

          // ğŸ” è‡ªå‹•å®Œæˆè¼¸å…¥æ¡† - å¤§é‡ä¸”ä¸å›ºå®šå€¼
          case 'resource_name':
          case 'alert_name':
            return (
              <AutoComplete
                placeholder={`è¼¸å…¥æˆ–é¸æ“‡${selectedKey === 'resource_name' ? 'è³‡æºåç¨±' : 'äº‹ä»¶åç¨±'}`}
                style={{ ...style }}
                options={silenceOptions[selectedKey]?.map(option => ({
                  value: option,
                  label: (
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <SearchOutlined style={{ color: 'rgba(255,255,255,0.5)' }} />
                      {option}
                    </div>
                  )
                }))}
                filterOption={(inputValue, option) =>
                  option.value.toLowerCase().includes(inputValue.toLowerCase())
                }
              />
            );

          // âœï¸ è‡ªç”±è¼¸å…¥ - éˆæ´»åŒ¹é…
          case 'alert_name':
          default:
            return (
              <Input
                placeholder="è¼¸å…¥åŒ¹é…å€¼"
                style={{ ...style }}
                prefix={<EditOutlined style={{ color: 'rgba(255,255,255,0.5)' }} />}
              />
            );
        }
      };

      const onFinish = (values) => {
        const newSilence = {
          ...values,
          key: editingSilence ? editingSilence.key : `s_${Date.now()}`,
          creator: editingSilence ? editingSilence.creator : 'admin',
          type: silenceType,
          recurringPattern: silenceType === 'recurring' ? recurringPattern : null,
          monthlyType: recurringPattern === 'monthly' ? monthlyType : null
        };

        if (editingSilence) {
          setSilences(silences.map(s => s.key === editingSilence.key ? newSilence : s));
          message.success('éœéŸ³è¦å‰‡æ›´æ–°æˆåŠŸ');
        } else {
          setSilences([newSilence, ...silences]);
          message.success('éœéŸ³è¦å‰‡æ–°å¢æˆåŠŸ');
        }
        handleCancel();
      };

      const handleDelete = (key) => {
        confirmDelete('éœéŸ³è¦å‰‡', () => {
          setSilences(silences.filter(s => s.key !== key));
        });
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} æ¢éœéŸ³è¦å‰‡å—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setSilences(silences.filter(s => !selectedRowKeys.includes(s.key)));
            setSelectedRowKeys([]);
            message.success('æ‰¹æ¬¡åˆªé™¤æˆåŠŸ');
          }
        });
      };

      const toggleEnabled = (key) => {
        setSilences(silences.map(s =>
          s.key === key ? { ...s, enabled: !s.enabled } : s
        ));
        message.success('éœéŸ³è¦å‰‡ç‹€æ…‹å·²æ›´æ–°');
      };

      // Define all possible columns
      const allColumns = {
        enabled: {
          title: 'å•Ÿç”¨',
          dataIndex: 'enabled',
          width: '8%',
          render: (enabled) => (
            <Switch
              checked={enabled}
              onChange={(checked) => {
                // é€™è£¡å¯ä»¥æ–°å¢åˆ‡æ›é‚è¼¯
                // TODO: å¯¦ä½œå•Ÿç”¨/åœç”¨é‚è¼¯
              }}
            />
          )
        },
        name: {
          title: 'åç¨±',
          dataIndex: 'name',
          width: '14%'
        },
        status: {
          title: 'ç‹€æ…‹',
          key: 'status',
          width: '8%',
          render: (_, record) => {
            const status = getStatus(record);
            return <Tag color={status.color}>{status.text}</Tag>;
          }
        },
        type: {
          title: 'é¡å‹',
          dataIndex: 'type',
          width: '7%',
          render: (type) => (
            <Tag color={type === 'once' ? 'blue' : 'green'}>
              {type === 'once' ? 'å–®æ¬¡' : 'é€±æœŸ'}
            </Tag>
          )
        },
        matchers: {
          title: 'åŒ¹é…æ¢ä»¶',
          dataIndex: 'matchers',
          width: '20%',
          render: (matchers) => {
            if (!matchers || matchers.length === 0) {
              return <Text type="secondary">ç„¡æ¢ä»¶</Text>;
            }

            const displayMatchers = matchers.slice(0, 3);
            const remainingCount = matchers.length - displayMatchers.length;

            const allMatchersText = matchers.map(m => `${m.key} ${m.op || '='} ${m.value}`).join(', ');

            return (
              <Tooltip title={
                <div style={{ maxWidth: '300px' }}>
                  <div style={{ marginBottom: '8px', fontWeight: 600 }}>æ‰€æœ‰åŒ¹é…æ¢ä»¶ï¼š</div>
                  {matchers.map((m, i) => (
                    <div key={i} style={{ marginBottom: '4px' }}>
                      <Tag size="small" color="default">{m.key}</Tag>
                      <span style={{ margin: '0 4px', color: 'rgba(255,255,255,0.8)' }}>{m.op || '='}</span>
                      <span style={{ color: 'rgba(255,255,255,0.9)' }}>{m.value}</span>
                    </div>
                  ))}
                </div>
              }
                placement="topLeft"
              >
                <Space size={[4, 4]} wrap style={{ maxWidth: '100%' }}>
                  {displayMatchers.map((m, i) => (
                    <Tag
                      key={i}
                      size="small"
                      color="default"
                      style={{
                        maxWidth: '120px',
                        overflow: 'hidden',
                        textOverflow: 'ellipsis',
                        whiteSpace: 'nowrap',
                        display: 'inline-block'
                      }}
                    >
                      {`${m.key}${m.op || '='}${m.value}`}
                    </Tag>
                  ))}
                  {remainingCount > 0 && (
                    <Tag size="small" style={{ color: 'rgba(255,255,255,0.6)' }}>
                      +{remainingCount}
                    </Tag>
                  )}
                </Space>
              </Tooltip>
            );
          }
        },
        schedule: {
          title: 'æ’ç¨‹',
          key: 'schedule',
          width: '15%',
          render: (_, record) => {
            if (record.type === 'once') {
              return record.timeRange?.[0]?.format('MM-DD HH:mm') + ' - ' + record.timeRange?.[1]?.format('MM-DD HH:mm');
            } else if (record.recurringPattern === 'weekly') {
              const days = record.weekdays?.map(d => ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][d]).join(',') || '';
              return `æ¯é€±${days} ${record.timeSlot?.[0]}-${record.timeSlot?.[1]}`;
            } else if (record.recurringPattern === 'monthly') {
              return `æ¯æœˆ${record.monthlyType === 'lastday' ? 'æœ€å¾Œä¸€å¤©' : 'ç‰¹å®šæ—¥æœŸ'} ${record.timeSlot?.[0]}-${record.timeSlot?.[1]}`;
            }
            return '-';
          }
        },
        nextExecution: {
          title: 'ä¸‹æ¬¡åŸ·è¡Œ',
          key: 'nextExecution',
          width: '10%',
          render: (_, record) => {
            const next = getNextExecution(record);
            return next ? next.format('MM-DD HH:mm') : '-';
          }
        },
        creator: {
          title: 'å‰µå»ºè€…',
          dataIndex: 'creator',
          width: '8%',
          render: (creator) => creator || '-'
        },
        action: {
          title: 'æ“ä½œ',
          key: 'action',
          width: '12%',
          render: (_, record) => (
            <Space>
              <Tooltip title="ç·¨è¼¯">
                <Button type="text" icon={<EditOutlined />} onClick={() => showModal(record)} />
              </Tooltip>
              <Tooltip title="åˆªé™¤">
                <Button type="text" danger icon={<DeleteOutlined />} onClick={() => handleDelete(record.key)} />
              </Tooltip>
            </Space>
          )
        }
      };

      // Generate dynamic columns based on visible settings
      const columns = Object.keys(allColumns)
        .filter(key => visibleColumns[key])
        .map(key => allColumns[key]);

      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;
      const filteredSilences = silences.filter(s =>
        s.name.toLowerCase().includes(searchText.toLowerCase()) ||
        s.description.toLowerCase().includes(searchText.toLowerCase())
      );

      return (
        <React.Fragment>

          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="æœå°‹è¦å‰‡åç¨±æˆ–æè¿°..."
                onChange={e => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                ç¯©é¸
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              <Popover
                content={
                  <div style={{ width: '200px' }}>
                    <div style={{ marginBottom: '12px', fontWeight: 600, color: 'rgba(255, 255, 255, 0.9)' }}>
                      æ¬„ä½é¡¯ç¤ºè¨­å®š
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                      {Object.keys(allColumns).map(key => (
                        <div key={key} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                          <Checkbox
                            checked={visibleColumns[key]}
                            onChange={(e) => setVisibleColumns(prev => ({ ...prev, [key]: e.target.checked }))}
                            style={{ marginRight: '8px' }}
                          />
                          <span style={{ color: 'rgba(255, 255, 255, 0.8)', fontSize: '13px' }}>
                            {allColumns[key].title}
                          </span>
                        </div>
                      ))}
                    </div>
                  </div>
                }
                title={null}
                trigger="click"
                open={isColumnSettingsOpen}
                onOpenChange={setIsColumnSettingsOpen}
                placement="bottomRight"
                overlayStyle={{
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  backdropFilter: 'blur(8px)',
                  border: '1px solid rgba(255, 255, 255, 0.1)'
                }}
              >
                <Button className="toolbar-btn" icon={<EyeOutlined />}>
                  æ¬„ä½è¨­å®š
                </Button>
              </Popover>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>
                æ–°å¢è¦å‰‡
              </Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            {
              filteredSilences.length > 0 ?
                <Table
                  rowSelection={rowSelection}
                  columns={columns}
                  dataSource={filteredSilences}
                  rowKey="key"
                  className="transparent-bg"
                  size="small"
                /> :
                <Empty description="å°šç„¡ä»»ä½•éœéŸ³è¦å‰‡">
                  <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>ç«‹å³æ–°å¢è¦å‰‡</Button>
                </Empty>
            }
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>æ‰¹æ¬¡åˆªé™¤</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          <Modal
            title={null}
            open={isModalOpen}
            onCancel={handleCancel}
            footer={null}
            width={900}
            centered
            className="silence-modal"
            style={{
              background: 'var(--bg-elevated)',
              border: '1px solid var(--border-base)',
              borderRadius: '12px'
            }}
          >
            {/* Modal Header */}
            <div className="modal-header" style={{
              borderBottom: '1px solid rgba(255, 255, 255, 0.08)',
              paddingBottom: '20px',
              marginBottom: '20px'
            }}>
              <Title level={3} style={{ margin: 0 }}>
                {editingSilence ? 'ç·¨è¼¯éœéŸ³è¦å‰‡' : 'æ–°å¢éœéŸ³è¦å‰‡'}
              </Title>
              <Paragraph type="secondary" style={{ marginBottom: 0, marginTop: 8 }}>
                {currentStep === 0 && 'è¨­å®šè¦å‰‡åŸºæœ¬è³‡è¨Šå’Œå¿«é€Ÿç¯„æœ¬'}
                {currentStep === 1 && 'è¨­å®šéœéŸ³ç”Ÿæ•ˆçš„æ™‚é–“'}
                {currentStep === 2 && 'è¨­å®šè¦éœéŸ³çš„äº‹ä»¶æ¢ä»¶'}
              </Paragraph>
            </div>

            {/* Steps Navigation */}
            <div className="steps-container" style={{
              marginBottom: '32px',
            }}>
              <div style={{ marginBottom: '16px', textAlign: 'center' }}>
                <Text style={{ fontSize: '12px', color: 'rgba(255,255,255,0.6)' }}>
                  ğŸ’¡ é»æ“Šä»»ä¸€æ­¥é©Ÿå³å¯ç›´æ¥è·³è½‰ç·¨è¼¯
                </Text>
              </div>
              <div className="steps" style={{
                display: 'flex',
                position: 'relative'
              }}>
                {[
                  { step: 0, label: 'åŸºæœ¬è³‡è¨Š', icon: 'ğŸ“‹' },
                  { step: 1, label: 'è¨­å®šæ’ç¨‹', icon: 'â°' },
                  { step: 2, label: 'è¨­å®šç¯„åœ', icon: 'ğŸ¯' }
                ].map(({ step, label, icon }) => {
                  const isActive = currentStep === step;
                  const isCompleted = currentStep > step;

                  return (
                    <div
                      key={step}
                      className="step-item"
                      onClick={() => setCurrentStep(step)}
                      style={{
                        flex: 1,
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        gap: '8px',
                        cursor: 'pointer',
                        position: 'relative',
                        zIndex: 1
                      }}
                    >
                      <div
                        className="step-indicator"
                        style={{
                          width: '40px',
                          height: '40px',
                          borderRadius: '50%',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          background: isActive ? 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)' :
                            isCompleted ? 'rgba(52, 168, 83, 0.9)' : 'rgba(255, 255, 255, 0.08)',
                          border: `2px solid ${isActive ? 'transparent' :
                            isCompleted ? 'rgba(52, 168, 83, 0.6)' : 'rgba(255, 255, 255, 0.2)'
                            }`,
                          fontSize: '18px',
                          transition: 'all 0.3s ease',
                          boxShadow: isActive ? '0 0 20px rgba(24, 144, 255, 0.4)' : 'none'
                        }}
                      >
                        {isCompleted ? 'âœ“' : icon}
                      </div>
                      <span className="step-label">
                        {label}
                      </span>
                    </div>
                  );
                })}
                {/* Progress line */}
                <div
                  style={{
                    position: 'absolute',
                    top: '20px',
                    left: '20px',
                    right: '20px',
                    height: '2px',
                    background: 'rgba(255, 255, 255, 0.08)',
                    zIndex: 0
                  }}
                >
                  <div
                    style={{
                      position: 'absolute',
                      top: 0,
                      left: 0,
                      height: '100%',
                      width: `${((currentStep) / 2) * 100}%`,
                      background: 'linear-gradient(90deg, #52a853 0%, #1890ff 100%)',
                      transition: 'width 0.3s ease'
                    }}
                  />
                </div>
              </div>
            </div>

            <Form form={form} layout="vertical" onFinish={onFinish}>
              {/* Step Content Container */}
              <div className="step-content" style={{
                minHeight: '400px',
                position: 'relative',
                overflow: 'hidden',
                padding: '24px 0'
              }}>
                {/* ç¬¬ä¸€æ­¥ï¼šåŸºæœ¬è³‡è¨Š */}
                {currentStep === 0 && (
                  <div>
                    <div style={{ marginBottom: 24 }}>
                      <div style={{ display: 'flex', alignItems: 'center', marginBottom: '16px' }}>
                        <div className="severity-indicator severity-info"></div>
                        <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.9)' }}>å¿«é€Ÿå¥—ç”¨ç¯„æœ¬</Title>
                      </div>
                      <div style={{ padding: '16px', background: 'rgba(0,0,0,0.2)', borderRadius: '8px' }}>
                        <Space wrap size={[8, 8]}>
                          {quickTemplates.map((template, index) => (
                            <Button
                              key={index}
                              className="table-action-btn"
                              onClick={() => applyTemplate(template.template)}
                            >
                              {template.name}
                            </Button>
                          ))}
                        </Space>
                      </div>
                    </div>

                    <Form.Item name="name" label="è¦å‰‡åç¨±" rules={[{ required: true }]}>
                      <Input placeholder="ä¾‹å¦‚ï¼šé€±æœ«ä¾‹è¡Œç¶­è­·" />
                    </Form.Item>

                    <Form.Item name="description" label="æè¿°">
                      <TextArea rows={3} placeholder="è³‡æ–™åº«ä¾‹è¡Œç¶­è­·ï¼Œé æœŸæœƒæœ‰çŸ­æš«é€£ç·šä¸­æ–·" />
                    </Form.Item>
                  </div>
                )}

                {/* ç¬¬äºŒæ­¥ï¼šè¨­å®šæ’ç¨‹ */}
                {currentStep === 1 && (
                  <div>
                    {/* éœéŸ³é¡å‹ */}
                    <Form.Item label="éœéŸ³é¡å‹" required>
                      <Radio.Group value={silenceType} onChange={e => setSilenceType(e.target.value)}>
                        <Radio value="once">å–®æ¬¡éœéŸ³</Radio>
                        <Radio value="recurring">é€±æœŸæ€§éœéŸ³</Radio>
                      </Radio.Group>
                    </Form.Item>

                    {/* å–®æ¬¡éœéŸ³è¨­å®š */}
                    {silenceType === 'once' && (
                      <Form.Item name="timeRange" label="æ™‚é–“ç¯„åœ" rules={[{ required: true }]}>
                        <RangePicker
                          showTime
                          format="YYYY-MM-DD HH:mm"
                          style={{ width: '100%' }}
                          placeholder={['é–‹å§‹æ™‚é–“', 'çµæŸæ™‚é–“']}
                        />
                      </Form.Item>
                    )}

                    {/* é€±æœŸæ€§éœéŸ³è¨­å®š */}
                    {silenceType === 'recurring' && (
                      <>
                        <Form.Item label="é‡è¤‡æ¨¡å¼" required>
                          <Select
                            value={recurringPattern}
                            onChange={setRecurringPattern}
                            placeholder="é¸æ“‡é‡è¤‡æ¨¡å¼"
                          >
                            <Select.Option value="daily">æ¯æ—¥</Select.Option>
                            <Select.Option value="weekly">æ¯é€±</Select.Option>
                            <Select.Option value="monthly">æ¯æœˆ</Select.Option>
                            <Select.Option value="custom">è‡ªè¨‚ Cron</Select.Option>
                          </Select>
                        </Form.Item>

                        {/* æ¯é€±è¨­å®š */}
                        {recurringPattern === 'weekly' && (
                          <Form.Item name="weekdays" label="é¸æ“‡æ˜ŸæœŸ">
                            <Checkbox.Group>
                              <Checkbox value={1}>é€±ä¸€</Checkbox>
                              <Checkbox value={2}>é€±äºŒ</Checkbox>
                              <Checkbox value={3}>é€±ä¸‰</Checkbox>
                              <Checkbox value={4}>é€±å››</Checkbox>
                              <Checkbox value={5}>é€±äº”</Checkbox>
                              <Checkbox value={6}>é€±å…­</Checkbox>
                              <Checkbox value={0}>é€±æ—¥</Checkbox>
                            </Checkbox.Group>
                          </Form.Item>
                        )}

                        {/* æ¯æœˆè¨­å®š */}
                        {recurringPattern === 'monthly' && (
                          <Form.Item label="åŸ·è¡Œæ—¥æœŸ">
                            <Radio.Group value={monthlyType} onChange={e => setMonthlyType(e.target.value)}>
                              <Radio value="date">æ¯æœˆç‰¹å®šæ—¥æœŸ</Radio>
                              <Radio value="weekday">æ¯æœˆç‰¹å®šæ˜ŸæœŸ</Radio>
                              <Radio value="lastday">æ¯æœˆæœ€å¾Œä¸€å¤©</Radio>
                            </Radio.Group>

                            {monthlyType === 'date' && (
                              <Form.Item name="monthlyDates" style={{ marginTop: 8 }}>
                                <Select mode="multiple" placeholder="é¸æ“‡æ—¥æœŸ">
                                  {[...Array(31)].map((_, i) => (
                                    <Select.Option key={i + 1} value={i + 1}>{i + 1}æ—¥</Select.Option>
                                  ))}
                                </Select>
                              </Form.Item>
                            )}
                          </Form.Item>
                        )}

                        {/* è‡ªè¨‚ Cron */}
                        {recurringPattern === 'custom' && (
                          <Form.Item
                            name="cronExpression"
                            label="Cron è¡¨é”å¼"
                            extra="ä¾‹å¦‚: 0 2 * * 6,0 (æ¯é€±å…­æ—¥å‡Œæ™¨2é»)"
                          >
                            <Input placeholder="è¼¸å…¥ Cron è¡¨é”å¼" />
                          </Form.Item>
                        )}

                        {/* æ™‚æ®µè¨­å®š */}
                        <Row gutter={16}>
                          <Col span={12}>
                            <Form.Item name="timeSlot" label="éœéŸ³æ™‚æ®µ" rules={[{ required: true }]}>
                              <Input placeholder="ä¾‹å¦‚: ['02:00', '04:00']" />
                            </Form.Item>
                          </Col>
                          <Col span={12}>
                            <Form.Item name="duration" label="æŒçºŒæ™‚é–“">
                              <InputNumber
                                addonAfter="å°æ™‚"
                                min={0.5}
                                max={24}
                                step={0.5}
                                style={{ width: '100%' }}
                              />
                            </Form.Item>
                          </Col>
                        </Row>

                        {/* æœ‰æ•ˆæœŸé™ */}
                        <Form.Item label="æœ‰æ•ˆæœŸé™">
                          <Radio.Group value={validityType} onChange={e => setValidityType(e.target.value)}>
                            <Radio value="forever">æ°¸ä¹…æœ‰æ•ˆ</Radio>
                            <Radio value="until">æˆªæ­¢åˆ°ç‰¹å®šæ—¥æœŸ</Radio>
                            <Radio value="count">åŸ·è¡Œç‰¹å®šæ¬¡æ•¸</Radio>
                          </Radio.Group>

                          {validityType === 'until' && (
                            <Form.Item name="validUntil" style={{ marginTop: 8 }}>
                              <DatePicker placeholder="é¸æ“‡æˆªæ­¢æ—¥æœŸ" style={{ width: '100%' }} />
                            </Form.Item>
                          )}

                          {validityType === 'count' && (
                            <Form.Item name="executionCount" style={{ marginTop: 8 }}>
                              <InputNumber min={1} max={100} addonAfter="æ¬¡" className="select-full" />
                            </Form.Item>
                          )}
                        </Form.Item>
                      </>
                    )}
                  </div>
                )}

                {/* ç¬¬ä¸‰æ­¥ï¼šè¨­å®šç¯„åœ */}
                {currentStep === 2 && (
                  <div>
                    {/* åŒ¹é…æ¢ä»¶ */}
                    <Form.Item label="éœéŸ³ç¯„åœ" required>
                      <Tabs size="small">
                        <Tabs.TabPane tab="éœéŸ³æ¢ä»¶" key="matchers">
                          <Form.List name="matchers">
                            {(fields, { add, remove }) => (
                              <React.Fragment>
                                {fields.map(({ key, name, ...restField }) => (
                                  <Space key={key} style={{ display: 'flex', marginBottom: 8 }} align="baseline">
                                    <Form.Item {...restField} name={[name, 'key']} rules={[{ required: true }]}>
                                      <Select className="select-xl" placeholder="é¸æ“‡åŒ¹é…æ¢ä»¶">
                                        <Select.Option value="severity">åš´é‡æ€§</Select.Option>
                                        <Select.Option value="environment">ç’°å¢ƒ</Select.Option>
                                        <Select.Option value="resource_name">è³‡æºåç¨±</Select.Option>
                                        <Select.Option value="resource_group">è³‡æºç¾¤çµ„</Select.Option>
                                        <Select.Option value="resource_tag">è³‡æºæ¨™ç±¤</Select.Option>
                                        <Select.Option value="alert_name">äº‹ä»¶åç¨±</Select.Option>
                                        <Select.Option value="component">çµ„ä»¶é¡å‹</Select.Option>
                                        <Select.Option value="team">è² è²¬åœ˜éšŠ</Select.Option>
                                        <Select.Option value="category">äº‹ä»¶é¡åˆ¥</Select.Option>
                                      </Select>
                                    </Form.Item>
                                    <Form.Item {...restField} name={[name, 'op']} rules={[{ required: true }]} initialValue="=">
                                      <Select className="select-sm">
                                        <Select.Option value="=">=</Select.Option>
                                        <Select.Option value="!=">!=</Select.Option>
                                        <Select.Option value="=~">~=</Select.Option>
                                      </Select>
                                    </Form.Item>
                                    <Form.Item {...restField} name={[name, 'value']} rules={[{ required: true }]}>
                                      <Form.Item noStyle shouldUpdate>
                                        {({ getFieldValue }) => {
                                          const selectedKey = getFieldValue(['matchers', name, 'key']);
                                          return getSilenceSmartValueInput(selectedKey, { width: 150 });
                                        }}
                                      </Form.Item>
                                    </Form.Item>
                                    <MinusCircleOutlined onClick={() => remove(name)} />
                                  </Space>
                                ))}
                                <Form.Item>
                                  <Button type="dashed" onClick={() => add()} block icon={<PlusOutlined />}>
                                    æ–°å¢åŒ¹é…æ¢ä»¶
                                  </Button>
                                </Form.Item>
                              </React.Fragment>
                            )}
                          </Form.List>
                        </Tabs.TabPane>
                      </Tabs>
                    </Form.Item>

                    {/* å…¶ä»–è¨­å®š */}
                    <Form.Item name="enabled" valuePropName="checked" initialValue={true}>
                      <Checkbox>ç«‹å³å•Ÿç”¨æ­¤éœéŸ³è¦å‰‡</Checkbox>
                    </Form.Item>

                    <Form.Item name="notifyOnChange" valuePropName="checked">
                      <Checkbox>éœéŸ³é–‹å§‹/çµæŸæ™‚ç™¼é€é€šçŸ¥</Checkbox>
                    </Form.Item>
                  </div>
                )}
              </div>
            </Form>

            {/* Footer Buttons */}
            <div className="modal-footer">
              <div>
                {currentStep > 0 && (
                  <Button
                    onClick={() => setCurrentStep(currentStep - 1)}
                  >
                    ä¸Šä¸€æ­¥
                  </Button>
                )}
              </div>
              <div>
                <Button onClick={handleCancel}>
                  å–æ¶ˆ
                </Button>
                {currentStep < 2 ? (
                  <Button
                    type="primary"
                    onClick={() => setCurrentStep(currentStep + 1)}
                  >
                    ä¸‹ä¸€æ­¥
                  </Button>
                ) : (
                  <Button
                    type="primary"
                    onClick={() => form.submit()}
                  >
                    å„²å­˜è¦å‰‡
                  </Button>
                )}
              </div>
            </div>
          </Modal>
        </React.Fragment >
      );
    };

    const ScriptsPage = ({ scripts, setScripts, addExecution, schedules }) => {
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingScript, setEditingScript] = useState(null);
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [scheduleReferenceModal, setScheduleReferenceModal] = useState({ visible: false, script: null, schedules: [] });
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      const getHumanReadableCron = (cron) => {
        try {
          const parts = cron.split(' ');
          if (parts.length !== 5) return cron;

          const [minute, hour, day, month, weekday] = parts;

          // æ¯æ—¥æ¨¡å¼
          if (minute === '0' && hour !== '*' && day === '*' && month === '*' && weekday === '*') {
            return `æ¯æ—¥ ${hour}:00`;
          }

          // æ¯å°æ™‚æ¨¡å¼
          if (minute !== '*' && hour === '*' && day === '*' && month === '*' && weekday === '*') {
            return `æ¯å°æ™‚ç¬¬ ${minute} åˆ†`;
          }

          // æ¯å‘¨æ¨¡å¼
          if (weekday !== '*' && day === '*' && month === '*') {
            const weekdayMap = { '0': 'æ—¥', '1': 'ä¸€', '2': 'äºŒ', '3': 'ä¸‰', '4': 'å››', '5': 'äº”', '6': 'å…­' };
            const weekdays = weekday.split(',').map(w => weekdayMap[w] || w).join('ã€');
            return `æ¯é€± ${weekdays} ${hour}:${minute.padStart(2, '0')}`;
          }

          // æ¯æœˆæ¨¡å¼
          if (day !== '*' && month === '*' && weekday === '*') {
            return `æ¯æœˆ ${day} æ—¥ ${hour}:${minute.padStart(2, '0')}`;
          }

          return cron; // å¦‚æœä¸åŒ¹é…ä»»ä½•æ¨¡å¼ï¼Œè¿”å›åŸå§‹CRON
        } catch (e) {
          return cron;
        }
      };

      const showScheduleReference = (script) => {
        const relatedSchedules = schedules.filter(s => s.script_id === script.key);
        setScheduleReferenceModal({
          visible: true,
          script: script,
          schedules: relatedSchedules
        });
      };

      const hideScheduleReference = () => {
        setScheduleReferenceModal({ visible: false, script: null, schedules: [] });
      };

      const showModal = (script = null) => {
        setEditingScript(script);
        form.setFieldsValue(script || { name: '', type: 'Python', description: '', code: '' });
        setIsModalOpen(true);
      };

      const handleCancel = () => setIsModalOpen(false);

      const onFinish = (values) => {
        if (editingScript) {
          setScripts(scripts.map(s => s.key === editingScript.key ? { ...s, ...values } : s));
          message.success('è…³æœ¬æ›´æ–°æˆåŠŸ');
        } else {
          const newScript = { ...values, key: `s_${Date.now()}`, creator: 'admin' };
          setScripts([newScript, ...scripts]);
          message.success('è…³æœ¬æ–°å¢æˆåŠŸ');
        }
        handleCancel();
      };

      const handleRun = (script) => {
        modal.confirm({
          title: `ç¢ºå®šè¦åŸ·è¡Œè…³æœ¬ "${script.name}" å—?`,
          icon: <PlayCircleOutlined />,
          onOk: () => {
            message.loading({ content: 'åŸ·è¡Œä¸­...', key: 'run_script' });
            setTimeout(() => {
              addExecution({
                key: `e_${Date.now()}`,
                script_name: script.name,
                trigger: { type: 'Manual', user: 'admin' },
                status: 'success',
                start_time: dayjs(),
                duration: `${(Math.random() * 5).toFixed(1)}s`
              });
              message.success({ content: 'åŸ·è¡ŒæˆåŠŸ', key: 'run_script' });
            }, 1000);
          }
        })
      };

      const handleDelete = (key) => {
        confirmDelete('è…³æœ¬', () => {
          setScripts(scripts.filter(s => s.key !== key));
        });
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} å€‹è…³æœ¬å—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setScripts(scripts.filter(s => !selectedRowKeys.includes(s.key)));
            setSelectedRowKeys([]);
            message.success('æ‰¹æ¬¡åˆªé™¤æˆåŠŸ');
          }
        });
      };

      const onSelectChange = (newSelectedRowKeys) => {
        setSelectedRowKeys(newSelectedRowKeys);
      };

      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      const columns = [
        { title: 'è…³æœ¬åç¨±', dataIndex: 'name', width: '20%' },
        { title: 'é¡å‹', dataIndex: 'type', width: '10%', render: t => <Tag>{t}</Tag> },
        { title: 'å‰µå»ºè€…', dataIndex: 'creator', width: '10%' },
        {
          title: 'æ’ç¨‹å¼•ç”¨',
          dataIndex: 'scheduleCount',
          width: '15%',
          render: (count, record) => {
            const scheduleCount = schedules.filter(s => s.script_id === record.key).length;
            return scheduleCount > 0 ? (
              <Button
                type="link"
                style={{ padding: 0, height: 'auto' }}
                onClick={() => showScheduleReference(record)}
              >
                {`å·²è¢« ${scheduleCount} å€‹æ’ç¨‹ä½¿ç”¨`}
              </Button>
            ) : (
              <Text type="secondary">æœªè¢«å¼•ç”¨</Text>
            );
          }
        },
        { title: 'æè¿°', dataIndex: 'description', width: '25%' },
        {
          title: 'æ“ä½œ', key: 'action', width: '21%', render: (_, record) => (
            <Space size="small">
              <Tooltip title="é‹è¡Œ" placement="top">
                <Button type="text" icon={<PlayCircleOutlined style={{ color: '#52c41a' }} />} onClick={() => handleRun(record)} />
              </Tooltip>
              <Tooltip title="ç·¨è¼¯" placement="top">
                <Button type="text" icon={<EditOutlined />} onClick={() => showModal(record)} />
              </Tooltip>
              <Tooltip title="åˆªé™¤" placement="top">
                <Button type="text" icon={<DeleteOutlined />} danger onClick={() => handleDelete(record.key)} />
              </Tooltip>
            </Space>
          )
        }
      ];

      return (
        <React.Fragment>

          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="æœå°‹è…³æœ¬åç¨±æˆ–æè¿°..."
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                ç¯©é¸
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>
                æ–°å¢è…³æœ¬
              </Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            {
              scripts.length > 0 ?
                <Table rowSelection={rowSelection} columns={columns} dataSource={scripts} rowKey="key" className="transparent-bg" size="small" /> :
                <Empty description="å°šç„¡ä»»ä½•è…³æœ¬">
                  <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>ç«‹å³æ–°å¢è…³æœ¬</Button>
                </Empty>
            }
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>æ‰¹æ¬¡åˆªé™¤</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          <Modal
            title={editingScript ? 'ç·¨è¼¯è…³æœ¬' : 'æ–°å¢è…³æœ¬'}
            open={isModalOpen}
            onCancel={handleCancel}
            footer={
              <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '12px' }}>
                <Button key="cancel" onClick={handleCancel}>å–æ¶ˆ</Button>
                <Button key="submit" type="primary" onClick={() => form.submit()}>å„²å­˜</Button>
              </div>
            }
          >
            <Form form={form} layout="vertical" onFinish={onFinish} style={{ marginTop: 24 }}>
              <Form.Item name="name" label="è…³æœ¬åç¨±" rules={[{ required: true }]}>
                <Input />
              </Form.Item>
              <Form.Item name="type" label="é¡å‹" rules={[{ required: true }]}>
                <Select><Select.Option value="Python">Python</Select.Option><Select.Option value="Bash">Bash</Select.Option></Select>
              </Form.Item>
              <Form.Item name="description" label="æè¿°">
                <TextArea rows={2} />
              </Form.Item>
              <Form.List name="parameters">
                {(fields, { add, remove }) => (
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '16px' }}>
                    {fields.map(({ key, name, ...restField }) => (
                      <Space key={key} align="baseline">
                        <Form.Item {...restField} name={[name, 'name']} rules={[{ required: true, message: 'è«‹è¼¸å…¥åƒæ•¸åç¨±' }]}>
                          <Input placeholder="åƒæ•¸åç¨±" />
                        </Form.Item>
                        <Form.Item {...restField} name={[name, 'type']} initialValue="string" rules={[{ required: true, message: 'è«‹é¸æ“‡é¡å‹' }]}>
                          <Select className="select-lg">
                            <Select.Option value="string">String</Select.Option>
                            <Select.Option value="number">Number</Select.Option>
                          </Select>
                        </Form.Item>
                        <MinusCircleOutlined onClick={() => remove(name)} />
                      </Space>
                    ))}
                    <Button type="dashed" onClick={() => add()} block icon={<PlusOutlined />}>æ–°å¢åƒæ•¸</Button>
                  </div>
                )}
              </Form.List>
              <Form.Item name="code" label="è…³æœ¬å…§å®¹" rules={[{ required: true }]}>
                <TextArea
                  rows={10}
                  className="code-editor-like"
                  style={{
                    resize: 'none',
                    overflowY: 'auto',
                    maxHeight: '200px',
                    fontFamily: 'SFMono-Regular, Consolas, "Liberation Mono", Menlo, Courier, monospace',
                    fontSize: '13px',
                    lineHeight: '1.4'
                  }}
                />
              </Form.Item>
            </Form>
          </Modal>

          {/* æ’ç¨‹å¼•ç”¨Modal */}
          <Modal
            title={
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <ScheduleOutlined />
                æ’ç¨‹å¼•ç”¨è©³æƒ…
              </div>
            }
            open={scheduleReferenceModal.visible}
            onCancel={hideScheduleReference}
            footer={[
              <Button key="close" onClick={hideScheduleReference}>
                é—œé–‰
              </Button>
            ]}
            width={700}
          >
            {scheduleReferenceModal.script && (
              <div>
                <div style={{ marginBottom: '16px', padding: '12px', background: 'rgba(24, 144, 255, 0.1)', borderRadius: '6px' }}>
                  <Text strong style={{ display: 'block', marginBottom: '4px' }}>
                    è…³æœ¬ï¼š{scheduleReferenceModal.script.name}
                  </Text>
                  <Text type="secondary">
                    é¡å‹ï¼š{scheduleReferenceModal.script.type} â€¢ å‰µå»ºè€…ï¼š{scheduleReferenceModal.script.creator}
                  </Text>
                </div>

                <div style={{ marginBottom: '16px' }}>
                  <Text strong style={{ fontSize: '16px' }}>
                    å¼•ç”¨æ’ç¨‹ ({scheduleReferenceModal.schedules.length} å€‹)
                  </Text>
                </div>

                {scheduleReferenceModal.schedules.length > 0 ? (
                  <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                    <List
                      dataSource={scheduleReferenceModal.schedules}
                      renderItem={(schedule) => (
                        <List.Item style={{
                          padding: '12px 16px',
                          marginBottom: '8px',
                          background: 'rgba(255, 255, 255, 0.02)',
                          borderRadius: '6px',
                          border: '1px solid rgba(255, 255, 255, 0.06)'
                        }}>
                          <List.Item.Meta
                            title={
                              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <Text strong>{schedule.name}</Text>
                              </div>
                            }
                            description={
                              <div style={{ marginTop: '4px' }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '4px' }}>
                                  <Text type="secondary" style={{ fontSize: '12px' }}>
                                    <ClockCircleOutlined style={{ marginRight: '4px' }} />
                                    {getHumanReadableCron(schedule.cron)}
                                  </Text>
                                  <Text type="secondary" style={{ fontSize: '12px' }}>
                                    å‰µå»ºè€…ï¼š{schedule.creator}
                                  </Text>
                                </div>
                                {schedule.last_run && (
                                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                    <Text type="secondary" style={{ fontSize: '12px' }}>
                                      ä¸Šæ¬¡åŸ·è¡Œï¼š{dayjs(schedule.last_run).format('YYYY-MM-DD HH:mm')}
                                    </Text>
                                    <Tag
                                      size="small"
                                      color={schedule.last_status === 'success' ? 'green' : schedule.last_status === 'failed' ? 'red' : 'orange'}
                                    >
                                      {schedule.last_status === 'success' ? 'æˆåŠŸ' : schedule.last_status === 'failed' ? 'å¤±æ•—' : 'é€²è¡Œä¸­'}
                                    </Tag>
                                  </div>
                                )}
                              </div>
                            }
                          />
                        </List.Item>
                      )}
                    />
                  </div>
                ) : (
                  <Empty description="æ²’æœ‰æ‰¾åˆ°ç›¸é—œçš„æ’ç¨‹ä»»å‹™" />
                )}
              </div>
            )}
          </Modal>
        </React.Fragment >
      );
    };

    const SchedulesPage = ({ scripts, schedules, setSchedules, onNavigate }) => {

      // å¦‚æœè³‡æ–™æ²’æœ‰creatoræ¬„ä½ï¼Œæ–°å¢é è¨­å€¼
      React.useEffect(() => {
        const updatedSchedules = schedules.map(schedule => ({
          ...schedule,
          creator: schedule.creator || 'system' // å¦‚æœæ²’æœ‰creatoræ¬„ä½ï¼Œé è¨­è¨­å®šç‚º'system'
        }));

        // å¦‚æœè³‡æ–™æœ‰æ›´æ–°ï¼Œå„²å­˜åˆ°localStorage
        if (JSON.stringify(updatedSchedules) !== JSON.stringify(schedules)) {
          setSchedules(updatedSchedules);
        }
      }, [schedules, setSchedules]);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingSchedule, setEditingSchedule] = useState(null);
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [scheduleMode, setScheduleMode] = useState('simple'); // 'simple' æˆ– 'advanced'
      const [frequency, setFrequency] = useState('daily');
      const [selectedWeekdays, setSelectedWeekdays] = useState([]);
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();

      const handleDelete = (key) => {
        modal.confirm({
          title: 'ç¢ºå®šè¦åˆªé™¤æ­¤æ’ç¨‹å—ï¼Ÿ',
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setSchedules(schedules.filter(s => s.key !== key));
            message.success('æ’ç¨‹åˆªé™¤æˆåŠŸ');
          }
        });
      };
      const selectedScriptId = Form.useWatch('script_id', form);
      const selectedScript = scripts.find(function (s) { return s.key === selectedScriptId; });

      // ç›£è½è¡¨å–®å€¼è®ŠåŒ–ï¼Œå¯¦æ™‚æ›´æ–°CRONè¡¨é”å¼
      React.useEffect(() => {
        if (scheduleMode === 'simple') {
          const cron = generateCronExpression();
          form.setFieldsValue({ cron });
        }
      }, [frequency, selectedWeekdays, scheduleMode, form]);
      const mockResources = [
        { key: 'host_1', name: 'db-prod-01' }, { key: 'host_2', name: 'web-prod-02' }, { key: 'host_3', name: 'api-gateway-prod' }, { key: 'host_4', name: 'cache-redis-prod' }
      ];

      // äººæ€§åŒ–æ’ç¨‹å™¨è¼”åŠ©å‡½æ•¸
      const generateCronExpression = () => {
        const timeValues = form.getFieldValue('scheduleTime');
        if (!timeValues) return '0 * * * *';

        const hour = timeValues.hour() || 0;
        const minute = timeValues.minute() || 0;

        switch (frequency) {
          case 'minute':
            return `*/${form.getFieldValue('minuteInterval') || 5} * * * *`;
          case 'hourly':
            return `${minute} * * * *`;
          case 'daily':
            return `${minute} ${hour} * * *`;
          case 'weekly':
            const weekdays = selectedWeekdays.length > 0 ? selectedWeekdays.join(',') : '*';
            return `${minute} ${hour} * * ${weekdays}`;
          case 'monthly':
            return `${minute} ${hour} ${form.getFieldValue('monthlyDay') || 1} * *`;
          default:
            return '0 * * * *';
        }
      };

      const getHumanReadableDescription = () => {
        const timeValues = form.getFieldValue('scheduleTime');
        if (!timeValues) return 'è«‹è¨­å®šåŸ·è¡Œæ™‚é–“';

        const timeStr = timeValues.format('HH:mm');

        switch (frequency) {
          case 'minute':
            return `æ¯ ${form.getFieldValue('minuteInterval') || 5} åˆ†é˜åŸ·è¡Œä¸€æ¬¡`;
          case 'hourly':
            return `æ¯å°æ™‚çš„ç¬¬ ${timeValues.minute()} åˆ†é˜åŸ·è¡Œ`;
          case 'daily':
            return `æ¯æ—¥ ${timeStr} åŸ·è¡Œ`;
          case 'weekly':
            if (selectedWeekdays.length === 0) return `æ¯é€± ${timeStr} åŸ·è¡Œ`;
            const weekdayNames = selectedWeekdays.map(d => ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][d]).join('ã€');
            return `æ¯é€±${weekdayNames}çš„ ${timeStr} åŸ·è¡Œ`;
          case 'monthly':
            return `æ¯æœˆ ${form.getFieldValue('monthlyDay') || 1} æ—¥çš„ ${timeStr} åŸ·è¡Œ`;
          default:
            return 'æœªçŸ¥æ’ç¨‹';
        }
      };

      const getNextExecutionTime = (cron) => {
        // ç°¡æ˜“è¨ˆç®—ä¸‹æ¬¡åŸ·è¡Œæ™‚é–“ï¼ˆå¯¦éš›å°ˆæ¡ˆä¸­æ‡‰è©²ä½¿ç”¨cronå‡½å¼åº«ï¼‰
        try {
          // é€™è£¡åªæ˜¯æ¨¡æ“¬ï¼Œå¯¦éš›æ‡‰è©²è§£æCRONè¡¨é”å¼
          if (cron === '0 2 * * *') {
            return dayjs().hour(2).minute(0).second(0).isBefore(dayjs()) ?
              dayjs().add(1, 'day').hour(2).minute(0).second(0) :
              dayjs().hour(2).minute(0).second(0);
          } else if (cron === '0 * * * *') {
            return dayjs().minute(0).second(0).add(1, 'hour');
          }
          return dayjs().add(1, 'hour');
        } catch (e) {
          return dayjs().add(1, 'hour');
        }
      };

      const getScriptName = (id) => {
        const script = scripts.find(function (s) { return s.key === id; });
        return script ? script.name : 'æœªçŸ¥è…³æœ¬';
      };

      const handleRunNow = (record) => {
        message.info(`æ­£åœ¨åŸ·è¡Œä»»å‹™ã€Œ${record.name}ã€...`);
        // æ¨¡æ“¬åŸ·è¡Œéç¨‹
        setTimeout(() => {
          message.success(`ä»»å‹™ã€Œ${record.name}ã€åŸ·è¡Œå®Œæˆ`);
        }, 2000);
      };

      const handleViewHistory = (record) => {
        message.info(`æŸ¥çœ‹ä»»å‹™ã€Œ${record.name}ã€çš„åŸ·è¡Œæ­·å²`);
        // é€™è£¡å¯ä»¥è·³è½‰åˆ°åŸ·è¡Œæ—¥èªŒé é¢ä¸¦ç¯©é¸è©²ä»»å‹™çš„æ­·å²
      };

      const getHumanReadableCron = (cron) => {
        try {
          const parts = cron.split(' ');
          if (parts.length !== 5) return cron;

          const [minute, hour, day, month, weekday] = parts;

          // æ¯æ—¥æ¨¡å¼
          if (minute === '0' && hour !== '*' && day === '*' && month === '*' && weekday === '*') {
            return `æ¯æ—¥ ${hour}:00`;
          }

          // æ¯å°æ™‚æ¨¡å¼
          if (minute !== '*' && hour === '*' && day === '*' && month === '*' && weekday === '*') {
            return `æ¯å°æ™‚ç¬¬ ${minute} åˆ†`;
          }

          // æ¯å‘¨æ¨¡å¼
          if (weekday !== '*' && day === '*' && month === '*') {
            const weekdayMap = { '0': 'æ—¥', '1': 'ä¸€', '2': 'äºŒ', '3': 'ä¸‰', '4': 'å››', '5': 'äº”', '6': 'å…­' };
            const weekdays = weekday.split(',').map(w => weekdayMap[w] || w).join('ã€');
            return `æ¯é€± ${weekdays} ${hour}:${minute.padStart(2, '0')}`;
          }

          // æ¯æœˆæ¨¡å¼
          if (day !== '*' && month === '*' && weekday === '*') {
            return `æ¯æœˆ ${day} æ—¥ ${hour}:${minute.padStart(2, '0')}`;
          }

          return cron; // å¦‚æœä¸åŒ¹é…ä»»ä½•æ¨¡å¼ï¼Œè¿”å›åŸå§‹CRON
        } catch (e) {
          return cron;
        }
      };

      const showModal = (schedule = null) => {
        setEditingSchedule(schedule);
        setScheduleMode('simple');
        setFrequency('daily');
        setSelectedWeekdays([]);
        form.setFieldsValue(schedule || {
          name: '',
          description: '',
          cron: '0 * * * *',
          enabled: true,
          scheduleTime: dayjs().hour(2).minute(0),
          minuteInterval: 5
        });
        setIsModalOpen(true);
      };
      const handleCancel = () => setIsModalOpen(false);
      const onFinish = (values) => {
        // å¦‚æœæ˜¯ç°¡æ˜“æ¨¡å¼ï¼Œç”¢ç”ŸCRONè¡¨é”å¼
        if (scheduleMode === 'simple') {
          values.cron = generateCronExpression();
        }

        message.success(editingSchedule ? 'æ’ç¨‹æ›´æ–°æˆåŠŸ' : 'æ’ç¨‹æ–°å¢æˆåŠŸ');
        handleCancel();
      };

      const onSelectChange = (newSelectedRowKeys) => {
        setSelectedRowKeys(newSelectedRowKeys);
      };

      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      const handleBatchDelete = () => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} å€‹æ’ç¨‹å—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setSchedules(schedules.filter(s => !selectedRowKeys.includes(s.key)));
            setSelectedRowKeys([]);
            message.success('æ‰¹æ¬¡åˆªé™¤æˆåŠŸ');
          }
        });
      };

      const columns = [
        { title: 'å•Ÿç”¨', dataIndex: 'enabled', width: '5%', render: e => <Switch defaultChecked={e} /> },
        { title: 'ä»»å‹™åç¨±', dataIndex: 'name', width: '15%', render: name => <Text style={{ fontSize: '13px' }}>{name}</Text> },
        {
          title: 'è…³æœ¬åç¨±',
          dataIndex: 'script_id',
          width: '10%',
          render: id => {
            const scriptName = getScriptName(id);
            return (
              <Button
                type="link"
                style={{ padding: 0, height: 'auto', fontSize: '13px' }}
                onClick={() => {
                  // è·³è½¬åˆ°è…³æœ¬åº«Tab
                  onNavigate('scripts');
                  // è¿™é‡Œå¯ä»¥æ·»åŠ é«˜äº®é€»è¾‘ï¼Œä½†ç”±äºæ˜¯å‡½æ•°å¼ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡URLå‚æ•°æˆ–å…¨å±€çŠ¶æ€æ¥å®ç°
                  message.info(`å·²è·³è½‰åˆ°è…³æœ¬åº«ï¼Œè…³æœ¬ï¼š${scriptName}`);
                }}
              >
                {scriptName}
              </Button>
            );
          }
        },
        {
          title: 'CRON æ¢ä»¶',
          dataIndex: 'cron',
          width: '10%',
          render: c => (
            <Tooltip title={`åŸå§‹è¡¨é”å¼: ${c}`}>
              <span style={{ fontSize: '13px', cursor: 'pointer', color: 'rgba(255, 255, 255, 0.85)' }}>
                {getHumanReadableCron(c)}
              </span>
            </Tooltip>
          )
        },
        {
          title: 'ä¸Šæ¬¡ç‹€æ…‹', dataIndex: 'last_status', width: '10%', render: status => (
            status === 'success' ? (
              <Tag color="green" style={{ fontSize: '13px' }}>SUCCESS</Tag>
            ) : status === 'failed' ? (
              <Tag color="red" style={{ fontSize: '13px' }}>FAILED</Tag>
            ) : (
              <Tag color="gray" style={{ fontSize: '13px' }}>PENDING</Tag>
            )
          )
        },
        {
          title: 'ä¸Šæ¬¡åŸ·è¡Œæ™‚é–“', dataIndex: 'last_run', width: '12%', render: lastRun => (
            lastRun ? (
              <Text style={{ fontSize: '13px' }}>
                {lastRun.format('MM-DD HH:mm')}
              </Text>
            ) : (
              <Text style={{ fontSize: '13px', color: 'rgba(255,255,255,0.5)' }}>å°šæœªåŸ·è¡Œ</Text>
            )
          )
        },
        {
          title: 'ä¸‹æ¬¡åŸ·è¡Œ', dataIndex: 'cron', width: '12%', render: cron => (
            <Text style={{ fontSize: '13px' }}>
              {getNextExecutionTime(cron).format('MM-DD HH:mm')}
            </Text>
          )
        },
        {
          title: 'æ“ä½œ', key: 'action', width: '26%', render: (_, record) => (
            <Space size="small">
              <Tooltip title="æŸ¥çœ‹æ­·å²" placement="top">
                <Button type="text" icon={<HistoryOutlined />} onClick={() => handleViewHistory(record)} />
              </Tooltip>
              <Tooltip title="ç·¨è¼¯" placement="top">
                <Button type="text" icon={<EditOutlined />} onClick={() => showModal(record)} />
              </Tooltip>
              <Tooltip title="åˆªé™¤" placement="top">
                <Button type="text" icon={<DeleteOutlined />} danger onClick={() => handleDelete(record.key)} />
              </Tooltip>
            </Space>
          )
        }
      ];

      return (
        <React.Fragment>

          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="æœå°‹æ’ç¨‹åç¨±æˆ–æè¿°..."
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                ç¯©é¸
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>
                æ–°å¢æ’ç¨‹
              </Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            {
              schedules.length > 0 ?
                <Table rowSelection={rowSelection} columns={columns} dataSource={schedules} rowKey="key" className="transparent-bg" size="small" /> :
                <Empty description="å°šç„¡ä»»ä½•æ’ç¨‹">
                  <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>ç«‹å³æ–°å¢æ’ç¨‹</Button>
                </Empty>
            }
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>æ‰¹æ¬¡åˆªé™¤</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          <Modal
            title={editingSchedule ? 'ç·¨è¼¯æ’ç¨‹' : 'æ–°å¢æ’ç¨‹'}
            open={isModalOpen}
            onCancel={handleCancel}
            width={600}
            bodyStyle={{ maxHeight: '70vh', overflowY: 'auto' }}
            footer={
              <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '12px' }}>
                <Button key="cancel" onClick={handleCancel}>å–æ¶ˆ</Button>
                <Button key="submit" type="primary" onClick={() => form.submit()}>å„²å­˜</Button>
              </div>
            }
          >
            <Form form={form} layout="vertical" onFinish={onFinish} style={{ marginTop: 8 }}>
              <Form.Item name="name" label="ä»»å‹™åç¨±" rules={[{ required: true }]} style={{ marginBottom: 8 }}><Input /></Form.Item>
              <Form.Item name="description" label="æè¿°" style={{ marginBottom: 8 }}><TextArea rows={2} /></Form.Item>
              <Form.Item name="script_id" label="åŸ·è¡Œè…³æœ¬" rules={[{ required: true }]} style={{ marginBottom: 8 }}>
                <Select showSearch options={scripts.map(s => ({ label: s.name, value: s.key }))} />
              </Form.Item>
              <Form.Item name="target_resources" label="ç›®æ¨™è³‡æº" style={{ marginBottom: 10 }}>
                <Select mode="multiple" allowClear showSearch options={mockResources.map(r => ({ label: r.name, value: r.key }))} />
              </Form.Item>
              {/* äººæ€§åŒ–æ’ç¨‹å™¨ */}
              <div style={{ marginBottom: 10 }}>
                <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
                  <div className="severity-indicator severity-warning"></div>
                  <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.9)' }}>æ’ç¨‹è¨­å®š</Title>
                </div>
                <Card size="small" style={{ background: 'rgba(255, 255, 255, 0.03)', border: '1px solid rgba(255, 255, 255, 0.1)', padding: '8px 12px' }}>
                  {/* æ¨¡å¼åˆ‡æ¢ */}
                  <div style={{ marginBottom: 8 }}>
                    <Radio.Group value={scheduleMode} onChange={e => setScheduleMode(e.target.value)} size="small">
                      <Radio.Button value="simple">ç°¡æ˜“æ¨¡å¼</Radio.Button>
                      <Radio.Button value="advanced">é€²éšæ¨¡å¼</Radio.Button>
                    </Radio.Group>
                  </div>

                  {scheduleMode === 'simple' ? (
                    <div>
                      {/* é¢‘ç‡é€‰æ‹© */}
                      <Form.Item label="åŸ·è¡Œé »ç‡" style={{ marginBottom: 8 }}>
                        <Select value={frequency} onChange={setFrequency} style={{ width: 200 }}>
                          <Select.Option value="minute">æ¯åˆ†é˜</Select.Option>
                          <Select.Option value="hourly">æ¯å°æ™‚</Select.Option>
                          <Select.Option value="daily">æ¯æ—¥</Select.Option>
                          <Select.Option value="weekly">æ¯é€±</Select.Option>
                          <Select.Option value="monthly">æ¯æœˆ</Select.Option>
                        </Select>
                      </Form.Item>

                      {/* åŠ¨æ€æ˜¾ç¤ºçš„é…ç½®é¡¹ */}
                      {frequency === 'minute' && (
                        <Form.Item name="minuteInterval" label="é–“éš”åˆ†é˜" rules={[{ required: true }]} style={{ marginBottom: 8 }}>
                          <InputNumber min={1} max={59} addonAfter="åˆ†é˜" style={{ width: 150 }} />
                        </Form.Item>
                      )}

                      {frequency === 'hourly' && (
                        <Form.Item name="scheduleTime" label="åŸ·è¡Œæ™‚é–“" rules={[{ required: true }]} style={{ marginBottom: 8 }}>
                          <TimePicker format="mm" style={{ width: 150 }} placeholder="é¸æ“‡åˆ†é˜" />
                        </Form.Item>
                      )}

                      {(frequency === 'daily' || frequency === 'weekly' || frequency === 'monthly') && (
                        <Form.Item name="scheduleTime" label="åŸ·è¡Œæ™‚é–“" rules={[{ required: true }]} style={{ marginBottom: 8 }}>
                          <TimePicker format="HH:mm" style={{ width: 150 }} />
                        </Form.Item>
                      )}

                      {frequency === 'weekly' && (
                        <Form.Item label="é¸æ“‡æ˜ŸæœŸ" style={{ marginTop: 4, marginBottom: 8 }}>
                          <Checkbox.Group
                            value={selectedWeekdays}
                            onChange={setSelectedWeekdays}
                            options={[
                              { label: 'æ—¥', value: 0 },
                              { label: 'ä¸€', value: 1 },
                              { label: 'äºŒ', value: 2 },
                              { label: 'ä¸‰', value: 3 },
                              { label: 'å››', value: 4 },
                              { label: 'äº”', value: 5 },
                              { label: 'å…­', value: 6 }
                            ]}
                          />
                        </Form.Item>
                      )}

                      {frequency === 'monthly' && (
                        <Form.Item name="monthlyDay" label="æ¯æœˆå¹¾è™Ÿ" rules={[{ required: true }]} style={{ marginBottom: 8 }}>
                          <InputNumber min={1} max={31} addonAfter="æ—¥" style={{ width: 150 }} />
                        </Form.Item>
                      )}

                      {/* äººç±»å¯è¯»çš„æè¿° */}
                      <div style={{ marginTop: 8, padding: '6px 10px', background: 'rgba(24, 144, 255, 0.1)', borderRadius: '4px', border: '1px solid rgba(24, 144, 255, 0.3)' }}>
                        <Text style={{ color: '#1890ff', fontWeight: 'bold', fontSize: '12px' }}>
                          ğŸ“… {getHumanReadableDescription()}
                        </Text>
                      </div>

                      {/* ç”Ÿæˆçš„CRONè¡¨è¾¾å¼ï¼ˆéšè—å­—æ®µï¼‰ */}
                      <Form.Item name="cron" style={{ display: 'none' }}>
                        <Input />
                      </Form.Item>
                    </div>
                  ) : (
                    <div>
                      {/* é«˜çº§æ¨¡å¼ï¼šCRONè¡¨è¾¾å¼è¾“å…¥ */}
                      <Form.Item name="cron" label={
                        <Space>
                          <span>CRON è¡¨é”å¼</span>
                          <Tooltip title="ä¾åºç‚ºï¼šåˆ† æ™‚ æ—¥ æœˆ é€±ã€‚ `* * * * *` è¡¨ç¤ºæ¯åˆ†é˜åŸ·è¡Œä¸€æ¬¡ã€‚">
                            <InfoCircleOutlined />
                          </Tooltip>
                        </Space>
                      } rules={[{ required: true }]}>
                        <Input placeholder="0 2 * * *" />
                      </Form.Item>
                    </div>
                  )}
                </Card>
              </div>
              {selectedScript && selectedScript.params && selectedScript.params.length > 0 && (
                <div style={{ marginBottom: 12 }}>
                  <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
                    <div className="severity-indicator severity-success"></div>
                    <Title level={5} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.9)' }}>
                      è…³æœ¬åƒæ•¸è¨­å®š
                    </Title>
                    <Text style={{ marginLeft: 8, fontSize: '11px', color: 'rgba(255, 255, 255, 0.6)' }}>
                      ({selectedScript.name})
                    </Text>
                  </div>
                  <Card size="small" style={{ background: 'rgba(0, 34, 43, 0.3)', border: '1px solid rgba(0, 255, 128, 0.2)', padding: '8px 12px' }}>
                    <div style={{ marginBottom: 8 }}>
                      <Text style={{ color: 'rgba(0, 255, 128, 0.8)', fontSize: '11px' }}>
                        ğŸ’¡ é€™äº›åƒæ•¸å°‡å‚³éçµ¦è…³æœ¬åŸ·è¡Œï¼Œè«‹æ ¹æ“šå¯¦éš›éœ€æ±‚å¡«å¯«
                      </Text>
                    </div>
                    {selectedScript.params.map(p => (
                      <div key={p.name} style={{ marginBottom: 10 }}>
                        <Form.Item
                          name={['params', p.name]}
                          label={
                            <Space size={4}>
                              <span style={{ fontSize: '13px' }}>{p.label}</span>
                              {p.type === 'number' && <Tag size="small" color="blue">æ•¸å­—</Tag>}
                              {p.type === 'string' && <Tag size="small" color="green">æ–‡å­—</Tag>}
                              {p.type === 'boolean' && <Tag size="small" color="orange">å¸ƒæ—</Tag>}
                            </Space>
                          }
                          rules={[{ required: true, message: `è«‹è¼¸å…¥${p.label}` }]}
                          tooltip={p.description || `è¨­å®š ${p.label} åƒæ•¸`}
                          style={{ marginBottom: 8 }}
                        >
                          {p.type === 'number' ? (
                            <InputNumber
                              className="select-full"
                              placeholder={`è¼¸å…¥ ${p.label}`}
                              min={p.min || undefined}
                              max={p.max || undefined}
                              step={p.step || 1}
                            />
                          ) : p.type === 'boolean' ? (
                            <Radio.Group>
                              <Radio value={true}>æ˜¯</Radio>
                              <Radio value={false}>å¦</Radio>
                            </Radio.Group>
                          ) : (
                            <Input placeholder={`è¼¸å…¥ ${p.label}`} />
                          )}
                        </Form.Item>
                        {p.description && (
                          <Text style={{ fontSize: '11px', color: 'rgba(255, 255, 255, 0.5)', display: 'block', marginTop: -6, marginBottom: 6 }}>
                            {p.description}
                          </Text>
                        )}
                      </div>
                    ))}
                  </Card>
                </div>
              )}
            </Form>
          </Modal>
        </React.Fragment >
      );
    };

    const ExecutionsPage = ({ executions, setExecutions, pageParams }) => {
      const [logModal, setLogModal] = useState({ open: false, log: '', structuredLogs: [], record: null });
      const [searchText, setSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [logLevelFilter, setLogLevelFilter] = useState('');
      const [dateRange, setDateRange] = useState([dayjs().subtract(7, 'days'), dayjs()]);

      // æ ¹æ“š pageParams åˆå§‹åŒ–ç¯©é¸
      React.useEffect(() => {
        if (pageParams && pageParams.filter === 'alert-triggered') {
          // ç¯©é¸å‡ºç”±å‘Šè­¦äº‹ä»¶è§¸ç™¼çš„åŸ·è¡Œè¨˜éŒ„
          setLogLevelFilter('Event');
          message.info('å·²ç¯©é¸é¡¯ç¤ºç”±å‘Šè­¦äº‹ä»¶è§¸ç™¼çš„åŸ·è¡Œè¨˜éŒ„');
        }
      }, [pageParams]);

      const viewLog = (record) => {
        // ç”¢ç”Ÿçµæ§‹åŒ–çš„æ—¥èªŒè³‡æ–™
        const baseTime = record.start_time || dayjs();
        const structuredLogs = [
          {
            timestamp: baseTime.format('HH:mm:ss.SSS'),
            level: 'INFO',
            message: `Starting execution for script: ${record.script_name}`,
            color: '#1890ff'
          },
          {
            timestamp: baseTime.add(100, 'millisecond').format('HH:mm:ss.SSS'),
            level: 'INFO',
            message: `Triggered by: ${record.trigger.type}${record.trigger.type === 'Manual' ? ` (${record.trigger.user})` : record.trigger.type === 'Event' ? ` - ${record.trigger.event_summary || 'High CPU usage alert'}` : ''}`,
            color: '#1890ff'
          },
          {
            timestamp: baseTime.add(500, 'millisecond').format('HH:mm:ss.SSS'),
            level: 'INFO',
            message: `Loading script parameters and dependencies`,
            color: '#1890ff'
          },
          {
            timestamp: baseTime.add(800, 'millisecond').format('HH:mm:ss.SSS'),
            level: 'WARN',
            message: `Warning: Resource utilization is high (85%)`,
            color: '#faad14'
          },
          {
            timestamp: baseTime.add(1, 'second').format('HH:mm:ss.SSS'),
            level: 'INFO',
            message: `Script execution started successfully`,
            color: '#1890ff'
          },
          {
            timestamp: baseTime.add(2, 'second').format('HH:mm:ss.SSS'),
            level: 'ERROR',
            message: `Failed to connect to target resource: web-prod-02`,
            color: '#ff4d4f'
          },
          {
            timestamp: baseTime.add(2.5, 'second').format('HH:mm:ss.SSS'),
            level: 'INFO',
            message: `Retrying connection (attempt 2/3)`,
            color: '#1890ff'
          },
          {
            timestamp: baseTime.add(3, 'second').format('HH:mm:ss.SSS'),
            level: 'INFO',
            message: `Connection established successfully`,
            color: '#1890ff'
          },
          {
            timestamp: baseTime.add(4, 'second').format('HH:mm:ss.SSS'),
            level: 'INFO',
            message: `Script execution completed`,
            color: '#1890ff'
          },
          {
            timestamp: baseTime.add(4.1, 'second').format('HH:mm:ss.SSS'),
            level: 'INFO',
            message: `Execution ${record.status}. Duration: ${record.duration}`,
            color: record.status === 'success' ? '#52c41a' : '#ff4d4f'
          }
        ];

        // ç”¢ç”Ÿç´”æ–‡å­—ç‰ˆæœ¬ç”¨æ–¼è¤‡è£½
        const logContent = structuredLogs.map(log =>
          `[${log.timestamp}] ${log.level}: ${log.message}`
        ).join('\n');

        setLogModal({
          open: true,
          log: logContent,
          structuredLogs: structuredLogs,
          record: record
        });
      };

      const copyLog = () => {
        navigator.clipboard.writeText(logModal.log);
        message.success('æ—¥èªŒå·²è¤‡è£½');
      };

      const onSelectChange = (newSelectedRowKeys) => {
        setSelectedRowKeys(newSelectedRowKeys);
      };

      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      const handleBatchDelete = () => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} å€‹åŸ·è¡Œæ—¥èªŒå—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setExecutions(executions.filter(e => !selectedRowKeys.includes(e.key)));
            setSelectedRowKeys([]);
            message.success('æ‰¹æ¬¡åˆªé™¤æˆåŠŸ');
          }
        });
      };

      const columns = [
        { title: 'ç‹€æ…‹', dataIndex: 'status', render: s => <Tag color={s === 'success' ? 'green' : 'red'}>{s ? s.toUpperCase() : 'UNKNOWN'}</Tag> },
        { title: 'è…³æœ¬åç¨±', dataIndex: 'script_name' },
        { title: 'è§¸ç™¼æ–¹å¼', dataIndex: 'trigger', render: t => t.type === 'Manual' ? `æ‰‹å‹• (${t.user})` : t.type },
        { title: 'é–‹å§‹æ™‚é–“', dataIndex: 'start_time', render: t => t ? t.format('YYYY-MM-DD HH:mm:ss') : '-' },
        { title: 'åŸ·è¡Œè€—æ™‚', dataIndex: 'duration' },
        {
          title: 'æ“ä½œ', key: 'action', render: (_, record) => (
            <Tooltip title="æŸ¥çœ‹æ—¥èªŒ">
              <Button type="text" icon={<FileTextOutlined />} onClick={() => viewLog(record)} />
            </Tooltip>
          )
        }
      ];

      return (
        <React.Fragment>
          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <RangePicker
                showTime
                value={dateRange}
                onChange={setDateRange}
                style={{ width: 400 }}
                placeholder={['é–‹å§‹æ™‚é–“', 'çµæŸæ™‚é–“']}
              />
              <Input.Search
                placeholder="æœå°‹è…³æœ¬åç¨±æˆ–è§¸ç™¼è€…..."
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                ç¯©é¸
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            <Table
              rowSelection={rowSelection}
              columns={columns}
              dataSource={executions}
              rowKey="key"
              className="transparent-bg"
              size="small"
              onRow={(record) => ({
                onClick: () => viewLog(record),
                style: { cursor: 'pointer' }
              })}
            />
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>æ‰¹æ¬¡åˆªé™¤</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          <Modal
            title="åŸ·è¡Œæ—¥èªŒè©³æƒ…"
            open={logModal.open}
            onCancel={() => setLogModal({ open: false, log: '', structuredLogs: [], record: null })}
            footer={[
              <Button key="copy" className="modal-footer-btn" icon={<CopyOutlined />} onClick={copyLog}>
                è¤‡è£½æ—¥èªŒ
              </Button>
            ]}
            width={800}
            centered
          >
            <div style={{ marginTop: 16 }}>
              {/* åŸ·è¡Œè³‡è¨Šå€å¡Š */}
              <Card size="small" style={{ marginBottom: 16, background: 'rgba(0,0,0,0.02)' }}>
                <Row gutter={16}>
                  <Col span={12}>
                    <div style={{ marginBottom: 8 }}>
                      <Text strong style={{ fontSize: '12px', color: 'rgba(255,255,255,0.6)' }}>è…³æœ¬åç¨±</Text>
                      <div style={{ marginTop: 4 }}>
                        <Button
                          type="link"
                          className="table-action-btn"
                          style={{
                            padding: 0,
                            height: 'auto',
                            color: '#1890ff'
                          }}
                          onClick={() => {
                            // é€™è£å¯ä»¥è·³è½‰åˆ°è…³æœ¬å®šç¾©é é¢
                            message.info(`æ­£åœ¨æ‰“é–‹è…³æœ¬: ${logModal.record?.script_name}`);
                          }}
                        >
                          {logModal.record?.script_name || 'æœªçŸ¥è…³æœ¬'}
                        </Button>
                      </div>
                    </div>
                  </Col>
                  <Col span={12}>
                    <div style={{ marginBottom: 8 }}>
                      <Text strong style={{ fontSize: '12px', color: 'rgba(255,255,255,0.6)' }}>è§¸ç™¼æ–¹å¼</Text>
                      <div style={{ marginTop: 4 }}>
                        {logModal.record?.trigger?.type === 'Manual' ? (
                          <Tag color="blue">
                            æ‰‹å‹• ({logModal.record?.trigger?.user})
                          </Tag>
                        ) : logModal.record?.trigger?.type === 'Event' ? (
                          <Button
                            type="link"
                            className="table-action-btn"
                            style={{
                              padding: 0,
                              height: 'auto'
                            }}
                            onClick={() => {
                              // é€™è£å¯ä»¥è·³è½‰åˆ°äº‹ä»¶è©³æƒ…é é¢
                              message.info(`æ­£åœ¨æ‰“é–‹äº‹ä»¶è©³æƒ…: ${logModal.record?.trigger?.event_id || 'æœªçŸ¥äº‹ä»¶'}`);
                            }}
                          >
                            <Tag color="orange" style={{ marginRight: '4px' }}>
                              äº‹ä»¶è§¸ç™¼
                            </Tag>
                            {logModal.record?.trigger?.event_summary || 'æŸ¥çœ‹äº‹ä»¶è©³æƒ…'}
                          </Button>
                        ) : (
                          <Tag color="green">
                            {logModal.record?.trigger?.type || 'æœªçŸ¥'}
                          </Tag>
                        )}
                      </div>
                    </div>
                  </Col>
                  <Col span={12}>
                    <div style={{ marginBottom: 8 }}>
                      <Text strong style={{ fontSize: '12px', color: 'rgba(255,255,255,0.6)' }}>æœ€çµ‚ç‹€æ…‹</Text>
                      <div style={{ marginTop: 4 }}>
                        <Tag color={logModal.record?.status === 'success' ? 'green' : 'red'}>
                          {logModal.record?.status?.toUpperCase() || 'UNKNOWN'}
                        </Tag>
                      </div>
                    </div>
                  </Col>
                  <Col span={12}>
                    <div style={{ marginBottom: 8 }}>
                      <Text strong style={{ fontSize: '12px', color: 'rgba(255,255,255,0.6)' }}>åŸ·è¡Œè€—æ™‚</Text>
                      <div style={{ marginTop: 4 }}>
                        <Text style={{ color: 'rgba(255,255,255,0.9)' }}>
                          {logModal.record?.duration || 'æœªçŸ¥'}
                        </Text>
                      </div>
                    </div>
                  </Col>
                </Row>
              </Card>

              {/* æ—¥èªŒè¼¸å‡ºå€å¡Š */}
              <Card size="small" title="æ—¥èªŒè¼¸å‡º" extra={
                <Space>
                  <Select
                    placeholder="æ—¥èªŒç­‰ç´š"
                    size="small"
                    style={{ width: 100 }}
                    allowClear
                    onChange={(value) => setLogLevelFilter(value)}
                  >
                    <Select.Option value="INFO">INFO</Select.Option>
                    <Select.Option value="WARN">WARN</Select.Option>
                    <Select.Option value="ERROR">ERROR</Select.Option>
                  </Select>
                  <Input
                    placeholder="æœå°‹æ—¥èªŒ..."
                    size="small"
                    style={{ width: 150 }}
                    onChange={(e) => setSearchText(e.target.value)}
                    prefix={<SearchOutlined />}
                  />
                </Space>
              }>
                <div className="log-viewer" style={{ maxHeight: '300px' }}>
                  {logModal.structuredLogs && logModal.structuredLogs.length > 0 ? (
                    <div style={{ fontSize: '13px', lineHeight: '1.6', fontFamily: 'SFMono-Regular, Consolas, "Liberation Mono", Menlo, Courier, monospace' }}>
                      {logModal.structuredLogs
                        .filter(log =>
                          (!logLevelFilter || log.level === logLevelFilter) &&
                          (!searchText || log.message.toLowerCase().includes(searchText.toLowerCase()) || log.level.toLowerCase().includes(searchText.toLowerCase()))
                        )
                        .map((log, index) => (
                          <div key={index} style={{
                            padding: '2px 0',
                            borderLeft: `3px solid ${log.color}`,
                            paddingLeft: '8px',
                            marginLeft: '-8px',
                            backgroundColor: index % 2 === 0 ? 'rgba(0,0,0,0.02)' : 'transparent'
                          }}>
                            <span style={{ color: '#666', fontSize: '11px', marginRight: '8px' }}>
                              {log.timestamp}
                            </span>
                            <span style={{
                              color: log.color,
                              fontWeight: 'bold',
                              fontSize: '11px',
                              marginRight: '8px',
                              minWidth: '45px',
                              display: 'inline-block'
                            }}>
                              {log.level}
                            </span>
                            <span style={{ color: 'rgba(255,255,255,0.9)' }}>
                              {log.message}
                            </span>
                          </div>
                        ))}
                    </div>
                  ) : (
                    <pre style={{ margin: 0, fontSize: '13px', lineHeight: '1.5' }}>
                      {logModal.log}
                    </pre>
                  )}
                </div>
              </Card>
            </div>
          </Modal>
        </React.Fragment >
      );
    };

    const CapacityPlanningPage = ({ themeMode }) => {
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const [analysisResult, setAnalysisResult] = useState(null);
      const [isLoading, setIsLoading] = useState(false);
      const [confirmModal, setConfirmModal] = useState({ open: false, script: null });

      const mockResourceGroups = [
        { id: 'g_1', name: 'Production Database' },
        { id: 'g_2', name: 'Production Web Servers' },
      ];
      const mockMetrics = [
        { id: 'cpu_utilization', name: 'CPU ä½¿ç”¨ç‡ (%)' },
        { id: 'memory_usage', name: 'è¨˜æ†¶é«”ä½¿ç”¨ç‡ (GB)' },
        { id: 'disk_space', name: 'ç£ç¢Ÿç©ºé–“ä½¿ç”¨ç‡ (%)' },
      ];
      const mockScripts = [
        { id: 's_1', name: 'Auto-scaling for Web Servers' },
        { id: 's_2', name: 'Increase Database Disk Volume' },
      ];

      const handleAnalysis = (values) => {
        setIsLoading(true);
        setAnalysisResult(null);
        setTimeout(() => {
          const historical = Array.from({ length: 30 }, (_, i) => {
            const date = dayjs().subtract(30 - i, 'days').format('YYYY-MM-DD');
            const value = 50 + i * 0.5 + Math.random() * 5;
            return [date, value.toFixed(2)];
          });

          const lastValue = parseFloat(historical[historical.length - 1][1]);
          const prediction = Array.from({ length: 90 }, (_, i) => {
            const date = dayjs().add(i + 1, 'days').format('YYYY-MM-DD');
            const value = lastValue + i * 0.3 + Math.random() * 2;
            return [date, value.toFixed(2)];
          });

          setAnalysisResult({
            key_metrics: { days_to_threshold: 45, threshold: 80, current_value: lastValue.toFixed(2), },
            chart_data: { historical, prediction },
            suggestions: [
              { text: 'ç›®å‰çš„è³‡æºå¢é•·è¶¨å‹¢ç©©å®šï¼Œä½†é è¨ˆåœ¨ 45 å¤©å¾Œé”åˆ° 80% çš„è­¦æˆ’ç·šã€‚', actionable: false },
              { text: 'å»ºè­°åŸ·è¡Œæ“´å®¹è…³æœ¬ï¼Œå¢åŠ  2 å€‹ Web Server å¯¦ä¾‹ä»¥æ‡‰å°é æœŸæµé‡å¢é•·ã€‚', actionable: true, action_type: 'åŸ·è¡Œæ“´å®¹è…³æœ¬', action_target: { script_id: 's_1' } },
              { text: 'è€ƒæ…®å°è³‡æ–™åº«é€²è¡Œå‚ç›´æ“´å®¹ï¼Œå°‡å¯¦ä¾‹é¡å‹å‡ç´šè‡³ä¸‹ä¸€å€‹ç´šåˆ¥ã€‚', actionable: false },
            ]
          });
          setIsLoading(false);
        }, 1500);
      };

      const handleActionClick = (suggestion) => {
        const script = mockScripts.find(s => s.id === suggestion.action_target.script_id);
        if (script) {
          setConfirmModal({ open: true, script: script });
        }
      };

      const handleConfirmOk = () => {
        message.loading({ content: 'æ­£åœ¨åŸ·è¡Œè…³æœ¬...', key: 'exec' });
        setTimeout(() => {
          message.success({ content: `è…³æœ¬ "${confirmModal.script.name}" å·²æˆåŠŸåŸ·è¡Œ`, key: 'exec' });
          setConfirmModal({ open: false, script: null });
        }, 1000);
      };

      const chartOption = analysisResult ? {
        backgroundColor: 'transparent',
        tooltip: { trigger: 'axis' },
        legend: { data: ['æ­·å²æ•¸æ“š', 'é æ¸¬è¶¨å‹¢'] },
        xAxis: {
          type: 'category',
          data: [
            ...analysisResult.chart_data.historical.map(d => d[0]),
            ...analysisResult.chart_data.prediction.map(d => d[0])
          ]
        },
        yAxis: {
          type: 'value',
          axisLabel: { formatter: '{value} %' }
        },
        series: [
          {
            name: 'æ­·å²æ•¸æ“š',
            type: 'line',
            data: analysisResult.chart_data.historical,
            smooth: true
          },
          {
            name: 'é æ¸¬è¶¨å‹¢',
            type: 'line',
            data: [
              ...Array(Math.max(0, analysisResult.chart_data.historical.length - 1)).fill(null),
              analysisResult.chart_data.historical[analysisResult.chart_data.historical.length - 1],
              ...analysisResult.chart_data.prediction
            ].filter(item => item !== undefined),
            smooth: true,
            lineStyle: { type: 'dashed' }
          },
          {
            name: 'è­¦æˆ’ç·š',
            type: 'line',
            markLine: {
              silent: true,
              data: [{ yAxis: 80, name: '80% è­¦æˆ’ç·š' }],
              label: { position: 'end', formatter: '{b}', color: '#ff4d4f' },
              lineStyle: { color: '#ff4d4f' }
            }
          }
        ]
      } : {};

      return (
        <React.Fragment>
          <Form form={form} layout="inline" onFinish={handleAnalysis} style={{ marginBottom: 16, padding: '12px', background: 'rgba(0,0,0,0.2)', borderRadius: '8px' }}>
            <Form.Item name="resource_group" label="è³‡æºç¾¤çµ„" rules={[{ required: true }]} initialValue="g_1" style={{ marginBottom: 4 }}>
              <Select className="select-xxl" placeholder="é¸æ“‡è³‡æºç¾¤çµ„" options={mockResourceGroups.map(g => ({ label: g.name, value: g.id }))} />
            </Form.Item>
            <Form.Item name="metric" label="æ•ˆèƒ½æŒ‡æ¨™" rules={[{ required: true }]} initialValue="cpu_utilization" style={{ marginBottom: 4 }}>
              <Select className="select-xxl" placeholder="é¸æ“‡æŒ‡æ¨™" options={mockMetrics.map(m => ({ label: m.name, value: m.id }))} />
            </Form.Item>
            <Form.Item name="period" label="é æ¸¬æœŸé–“" initialValue="90d" rules={[{ required: true }]} style={{ marginBottom: 4 }}>
              <Select className="select-lg">
                <Select.Option value="30d">30 å¤©</Select.Option>
                <Select.Option value="60d">60 å¤©</Select.Option>
                <Select.Option value="90d">90 å¤©</Select.Option>
              </Select>
            </Form.Item>
            <Form.Item style={{ marginBottom: 4 }}>
              <Space>
                <Button type="primary" htmlType="submit" loading={isLoading}>é–‹å§‹åˆ†æ</Button>
                <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              </Space>
            </Form.Item>
          </Form>

          <Spin spinning={isLoading} tip="æ­£åœ¨é€²è¡Œæ•¸æ“šåˆ†æèˆ‡è¶¨å‹¢é æ¸¬...">
            {analysisResult ? (
              <Row gutter={[16, 12]} align="stretch">
                <Col xs={24} md={8}>
                  <div style={{ display: 'flex', flexDirection: 'column', height: '320px', gap: '16px' }}>
                    {/* ç›®å‰ä½¿ç”¨ç‡å¡ç‰‡ */}
                    <div style={{
                      flex: '1',
                      background: 'linear-gradient(135deg, rgba(24, 144, 255, 0.1) 0%, rgba(24, 144, 255, 0.05) 100%)',
                      border: '1px solid rgba(24, 144, 255, 0.2)',
                      borderRadius: '12px',
                      padding: '24px',
                      display: 'flex',
                      flexDirection: 'column',
                      justifyContent: 'center',
                      alignItems: 'center',
                      backdropFilter: 'blur(20px) saturate(180%)',
                      WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                      boxShadow: '0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                    }}>
                      <div style={{ fontSize: '14px', color: 'rgba(255, 255, 255, 0.7)', marginBottom: '8px' }}>ç›®å‰ä½¿ç”¨ç‡</div>
                      <div style={{ fontSize: '36px', fontWeight: 'bold', color: '#1890ff', marginBottom: '4px' }}>
                        {analysisResult.key_metrics.current_value}<span style={{ fontSize: '24px' }}>%</span>
                      </div>
                    </div>

                    {/* è­¦æˆ’ç·šå¡ç‰‡ */}
                    <div style={{
                      flex: '1',
                      background: 'linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%)',
                      border: '1px solid rgba(255, 193, 7, 0.2)',
                      borderRadius: '12px',
                      padding: '24px',
                      display: 'flex',
                      flexDirection: 'column',
                      justifyContent: 'center',
                      alignItems: 'center',
                      backdropFilter: 'blur(20px) saturate(180%)',
                      WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                      boxShadow: '0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                    }}>
                      <div style={{ fontSize: '14px', color: 'rgba(255, 255, 255, 0.7)', marginBottom: '8px' }}>é è¨ˆé”åˆ° 80% è­¦æˆ’ç·š</div>
                      <div style={{ fontSize: '36px', fontWeight: 'bold', color: '#ffc107', marginBottom: '4px' }}>
                        {analysisResult.key_metrics.days_to_threshold} <span style={{ fontSize: '16px' }}>å¤©å¾Œ</span>
                      </div>
                    </div>
                  </div>
                </Col>
                <Col xs={24} md={16}>
                  <div style={{
                    height: '320px',
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '12px',
                    padding: '24px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                  }}>
                    <Title level={5} style={{ margin: 0, marginBottom: 16, color: 'rgba(255, 255, 255, 0.85)' }}>è¶¨å‹¢é æ¸¬åœ–</Title>
                    <div style={{ height: 'calc(100% - 40px)' }}>
                      <EchartsForReact option={chartOption} isDark={themeMode === 'dark'} />
                    </div>
                  </div>
                </Col>
                <Col xs={24}>
                  <div style={{
                    background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                    border: '1px solid rgba(255, 255, 255, 0.08)',
                    borderRadius: '12px',
                    padding: '24px',
                    backdropFilter: 'blur(20px) saturate(180%)',
                    WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                    boxShadow: '0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)',
                    marginTop: '8px'
                  }}>
                    <Title level={5} style={{ margin: 0, marginBottom: 16, color: 'rgba(255, 255, 255, 0.85)', display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <RobotOutlined style={{ color: '#722ed1' }} />
                      åˆ†æèˆ‡å»ºè­°
                    </Title>
                    <List
                      size="small"
                      dataSource={analysisResult.suggestions}
                      renderItem={item => (
                        <List.Item
                          actions={item.actionable ? [
                            <Button
                              size="small"
                              type="primary"
                              icon={<ThunderboltOutlined />}
                              onClick={() => handleActionClick(item)}
                              style={{
                                background: 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)',
                                border: 'none',
                                borderRadius: '6px',
                                fontWeight: '500',
                                marginRight: 0
                              }}
                            >
                              {item.action_type}
                            </Button>
                          ] : []}
                        >
                          <List.Item.Meta description={<span style={{ color: 'rgba(255, 255, 255, 0.85)' }}>{item.text}</span>} />
                        </List.Item>
                      )}
                    />
                  </div>
                </Col>
              </Row>
            ) : (
              !isLoading && <div className="empty-analysis" style={{ marginTop: 8, textAlign: 'center' }}><Empty description="è«‹é¸æ“‡è³‡æºèˆ‡æŒ‡æ¨™ä»¥é–‹å§‹åˆ†æ" /></div>
            )}
          </Spin>

          <Modal
            title="ç¢ºèªåŸ·è¡Œè‡ªå‹•åŒ–è…³æœ¬"
            open={confirmModal.open}
            onOk={handleConfirmOk}
            onCancel={() => setConfirmModal({ open: false, script: null })}
            okText="ç¢ºèªåŸ·è¡Œ"
            cancelText="å–æ¶ˆ"
          >
            {confirmModal.script && <p>æ‚¨ç¢ºå®šè¦åŸ·è¡Œä»¥ä¸‹è…³æœ¬å—ï¼Ÿ<br /><strong>è…³æœ¬åç¨±:</strong> {confirmModal.script.name}</p>}
          </Modal>
        </React.Fragment>
      );
    };

    // å…±äº«çš„æ•¸æ“šå’Œå·¥å…·å‡½æ•¸
    const mockRoles = [
      { id: 'super_admin', name: 'è¶…ç´šç®¡ç†å“¡', color: 'red' },
      { id: 'team_manager', name: 'åœ˜éšŠç®¡ç†å“¡', color: 'orange' },
      { id: 'team_member', name: 'åœ˜éšŠæˆå“¡', color: 'blue' },
      { id: 'viewer', name: 'å”¯è®€äººå“¡', color: 'gray' }
    ];


    const PersonnelManagementPage = () => {
      const initialUsers = [
        // è¨»ï¼šæ­¤ç‚ºæ¨¡æ“¬æ•¸æ“šï¼Œå¯¦éš›æ‡‰å¾ API ç²å–ã€‚æ–°å¢ login_count å’Œ preferences æ¬„ä½ä»¥ç¬¦åˆæ›´æ–°å¾Œçš„ schemaã€‚
        { key: 'user_1', name: 'Admin User', email: 'admin@example.com', teams: ['team_3'], roles: ['super_admin'], status: 'active', last_login: dayjs().subtract(1, 'day'), loginCount: 102, preferences: { theme: 'dark' }, created_at: dayjs().subtract(30, 'day') },
        { key: 'user_2', name: 'Dev User', email: 'dev@example.com', teams: ['team_1'], roles: ['team_manager', 'team_member'], status: 'active', last_login: dayjs().subtract(2, 'hours'), loginCount: 55, preferences: { theme: 'light' }, created_at: dayjs().subtract(15, 'day') },
        { key: 'user_3', name: 'View User', email: 'view@example.com', teams: ['team_2'], roles: ['viewer'], status: 'inactive', last_login: dayjs().subtract(7, 'day'), loginCount: 12, preferences: {}, created_at: dayjs().subtract(45, 'day') },
        { key: 'user_4', name: 'Ops User', email: 'ops@example.com', teams: ['team_1', 'team_3'], roles: ['team_member'], status: 'active', last_login: dayjs().subtract(30, 'minutes'), loginCount: 230, preferences: { theme: 'dark' }, created_at: dayjs().subtract(10, 'day') },
      ];

      const [users, setUsers] = useLocalStorageState('sre-users', initialUsers);
      const [isUserModalOpen, setIsUserModalOpen] = useState(false);
      const [editingUser, setEditingUser] = useState(null);
      const [userSearchText, setUserSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [userForm] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // å›¢é˜Ÿåç§°æ˜ å°„ï¼ˆåœ¨PersonnelManagementPageä¸­å®šä¹‰ï¼Œé¿å…ä¾èµ–å¤–éƒ¨teamsï¼‰
      const teamNameMap = {
        'team_1': 'Developers',
        'team_2': 'Viewers',
        'team_3': 'Administrators',
        'team_4': 'QA Team',
        'team_5': 'DevOps Team',
        'team_6': 'Database Team',
        'team_7': 'Network Team',
        'team_8': 'Security Team',
        'team_9': 'Operations Team',
        'team_10': 'Platform Team'
      };

      const getTeamNames = (teamIds) => teamIds.map(id => teamNameMap[id] || id);
      const getRoleNames = (roleIds) => roleIds.map(id => {
        const role = mockRoles.find(r => r.id === id);
        return role ? role.name : id;
      });

      // äººå“¡æ“ä½œå‡½æ•¸
      const showUserModal = (user = null) => {
        setEditingUser(user);
        userForm.setFieldsValue(user || { name: '', email: '', teams: [], roles: ['viewer'], status: 'active' });
        setIsUserModalOpen(true);
      };
      const handleUserCancel = () => {
        setIsUserModalOpen(false);
        setEditingUser(null);
        userForm.resetFields();
      };
      const handleUserFinish = (values) => {
        const newUser = {
          ...values,
          key: editingUser ? editingUser.key : `u_${Date.now()}`,
          created_at: editingUser ? editingUser.created_at : dayjs(),
          last_login: editingUser ? editingUser.last_login : null
        };
        if (editingUser) {
          setUsers(users.map(u => u.key === editingUser.key ? newUser : u));
          message.success('äººå“¡æ›´æ–°æˆåŠŸ');
        } else {
          setUsers([newUser, ...users]);
          message.success('äººå“¡æ–°å¢æˆåŠŸ');
        }
        handleUserCancel();
      };
      const handleToggleUserStatus = (userKey, newStatus) => {
        const user = users.find(u => u.key === userKey);
        if (!user) return;

        // æª¢æŸ¥äººå“¡ç•¶å‰ç‹€æ…‹
        if (user.status === 'pending') {
          message.warning('å¾…æ¿€æ´»ç”¨äººå“¡ç„¡æ³•ç›´æ¥åˆ‡æ›ç‹€æ…‹ï¼Œè«‹å…ˆæ¿€æ´»ç”¨äººå“¡');
          return;
        }
        if (user.status === 'locked') {
          message.warning('é–å®šäººå“¡ç„¡æ³•ç›´æ¥åˆ‡æ›ç‹€æ…‹ï¼Œè«‹è¯ç¹«ç®¡ç†å“¡');
          return;
        }

        const statusText = newStatus === 'active' ? 'å•Ÿç”¨' : 'åœç”¨';
        modal.confirm({
          title: `ç¢ºå®šè¦${statusText}æ­¤äººå“¡å—ï¼Ÿ`,
          content: `${statusText}äººå“¡ "${user.name}" çš„å¸³è™Ÿã€‚${newStatus === 'inactive' ? 'åœç”¨å¾Œäººå“¡å°‡ç„¡æ³•ç™»å…¥ç³»çµ±ï¼Œä½†ä¿ç•™æ‰€æœ‰æ¬Šé™è¨­å®šã€‚' : 'å•Ÿç”¨å¾Œäººå“¡å¯ä»¥æ­£å¸¸ä½¿ç”¨ç³»çµ±ã€‚'}`,
          okText: 'ç¢ºå®š',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setUsers(users.map(u => u.key === userKey ? { ...u, status: newStatus } : u));
            message.success(`äººå“¡${statusText}æˆåŠŸ`);
          }
        });
      };

      const handleUserDelete = (user) => {
        confirmDelete('äººå“¡', () => {
          setUsers(users.filter(u => u.key !== user.key));
        }, `äººå“¡ "${user.name}"`);
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} ä½äººå“¡å—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setUsers(users.filter(u => !selectedRowKeys.includes(u.key)));
            setSelectedRowKeys([]);
            message.success('æ‰¹æ¬¡åˆªé™¤æˆåŠŸ');
          }
        });
      };

      const userColumns = [
        {
          title: 'å•Ÿç”¨', key: 'enable', width: 80, render: (_, record) => (
            <Tooltip title={record.status === 'active' ? 'åœç”¨äººå“¡' : record.status === 'inactive' ? 'å•Ÿç”¨äººå“¡' : 'åˆ‡æ›ç‹€æ…‹'}>
              <Switch
                checked={record.status === 'active'}
                disabled={record.status === 'pending' || record.status === 'locked'}
                onChange={(checked) => handleToggleUserStatus(record.key, checked ? 'active' : 'inactive')}
              />
            </Tooltip>
          )
        },
        { title: 'å§“å', dataIndex: 'name', sorter: (a, b) => a.name.localeCompare(b.name) },
        { title: 'é›»å­éƒµä»¶', dataIndex: 'email', sorter: (a, b) => a.email.localeCompare(b.email) },
        { title: 'åœ˜éšŠ', dataIndex: 'teams', render: ids => getTeamNames(ids).join(', ') },
        {
          title: 'è§’è‰²', dataIndex: 'roles', render: ids => ids.map(id => {
            const role = mockRoles.find(r => r.id === id);
            return <Tag key={id} color={role && role.color}>{getRoleNames([id])}</Tag>;
          })
        },
        { title: 'æœ€å¾Œç™»å…¥', dataIndex: 'last_login', render: time => time ? time.fromNow() : 'å¾æœªç™»å…¥', sorter: (a, b) => (a.last_login || dayjs(0)).valueOf() - (b.last_login || dayjs(0)).valueOf() },
        {
          title: 'ç®¡ç†', key: 'action', width: 120, render: (_, record) => (
            <Space>
              <Tooltip title="ç·¨è¼¯">
                <Button type="text" icon={<EditOutlined />} onClick={() => showUserModal(record)} />
              </Tooltip>
              <Tooltip title="åˆªé™¤">
                <Button type="text" danger icon={<DeleteOutlined />} onClick={() => handleUserDelete(record)} />
              </Tooltip>
            </Space>
          )
        }
      ];

      // ç¯©é¸äººå“¡
      const filteredUsers = users.filter(user =>
        user.name.toLowerCase().includes(userSearchText.toLowerCase()) ||
        user.email.toLowerCase().includes(userSearchText.toLowerCase())
      );

      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      return (
        <React.Fragment>

          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="æœå°‹äººå“¡å§“åæˆ–é›»å­éƒµä»¶"
                onChange={e => setUserSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                ç¯©é¸
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showUserModal()}>æ–°å¢äººå“¡</Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            <Table
              rowSelection={rowSelection}
              dataSource={filteredUsers}
              columns={userColumns}
              rowKey="key"
              className="transparent-bg"
              pagination={{ pageSize: 10, position: ['bottomRight'] }}
              size="small"
            />
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>æ‰¹æ¬¡åˆªé™¤</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          {/* äººå“¡ç·¨è¼¯æ¨¡æ…‹æ¡† */}
          <Modal
            title={null}
            open={isUserModalOpen}
            onCancel={handleUserCancel}
            footer={null}
            width={700}
            centered
            className="user-edit-modal"
            style={{
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
              borderRadius: '12px'
            }}
          >
            {/* Modal Header */}
            <div className="modal-header" style={{
              borderBottom: '1px solid rgba(255, 255, 255, 0.08)',
              paddingBottom: '20px',
              marginBottom: '24px'
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                <div style={{
                  width: '48px',
                  height: '48px',
                  borderRadius: '50%',
                  background: 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  fontSize: '20px'
                }}>
                  ğŸ‘¤
                </div>
                <div>
                  <Title level={3} style={{ margin: 0, color: 'var(--text-primary)' }}>
                    {editingUser ? 'ç·¨è¼¯äººå“¡' : 'æ–°å¢äººå“¡'}
                  </Title>
                  <Paragraph type="secondary" style={{ marginBottom: 0, marginTop: 4, fontSize: '13px' }}>
                    {editingUser ? 'ä¿®æ”¹äººå“¡åŸºæœ¬è³‡è¨Šèˆ‡æ¬Šé™è¨­å®š' : 'å»ºç«‹æ–°äººå“¡ä¸¦è¨­å®šåŸºæœ¬è³‡è¨Šèˆ‡æ¬Šé™'}
                  </Paragraph>
                </div>
              </div>
            </div>

            <Form form={userForm} layout="vertical" onFinish={handleUserFinish}>
              {/* åŸºæœ¬è³‡è¨Šå€å¡Š */}
              <div style={{
                background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                border: '1px solid rgba(255, 255, 255, 0.08)',
                borderRadius: '12px',
                padding: '24px',
                marginBottom: '24px'
              }}>
                <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
                  <div style={{
                    width: '6px',
                    height: '24px',
                    background: 'linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)',
                    borderRadius: '3px',
                    marginRight: '12px'
                  }} />
                  <Title level={5} style={{ margin: 0, color: 'var(--text-primary)', fontWeight: '600' }}>
                    åŸºæœ¬è³‡è¨Š
                  </Title>
                </div>

                <Row gutter={[24, 16]}>
                  <Col span={12}>
                    <Form.Item
                      name="name"
                      label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>äººå“¡å§“å</span>}
                      rules={[{ required: true, message: 'è«‹è¼¸å…¥äººå“¡å§“å' }]}
                    >
                      <Input
                        placeholder="è«‹è¼¸å…¥äººå“¡å§“å"
                        style={{ height: '44px' }}
                        prefix={<UserOutlined style={{ color: 'var(--text-tertiary)' }} />}
                      />
                    </Form.Item>
                  </Col>
                  <Col span={12}>
                    <Form.Item
                      name="email"
                      label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>é›»å­éƒµä»¶</span>}
                      rules={[
                        { required: true, message: 'è«‹è¼¸å…¥é›»å­éƒµä»¶' },
                        { type: 'email', message: 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶åœ°å€' }
                      ]}
                    >
                      <Input
                        placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶åœ°å€"
                        style={{ height: '44px' }}
                        prefix={<MailOutlined style={{ color: 'var(--text-tertiary)' }} />}
                      />
                    </Form.Item>
                  </Col>
                </Row>
              </div>

              {/* æ¬Šé™è¨­å®šå€å¡Š */}
              <div style={{
                background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                border: '1px solid rgba(255, 255, 255, 0.08)',
                borderRadius: '12px',
                padding: '24px',
                marginBottom: '24px'
              }}>
                <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px' }}>
                  <div style={{
                    width: '6px',
                    height: '24px',
                    background: 'linear-gradient(135deg, #52c41a 0%, #389e0d 100%)',
                    borderRadius: '3px',
                    marginRight: '12px'
                  }} />
                  <Title level={5} style={{ margin: 0, color: 'var(--text-primary)', fontWeight: '600' }}>
                    æ¬Šé™è¨­å®š
                  </Title>
                </div>

                <Row gutter={[24, 16]}>
                  <Col span={12}>
                    <Form.Item
                      name="teams"
                      label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>æ‰€å±¬åœ˜éšŠ</span>}
                    >
                      <Select
                        mode="multiple"
                        placeholder="è«‹é¸æ“‡æ‰€å±¬åœ˜éšŠ"
                        style={{ minHeight: '44px' }}
                        options={Object.entries(teamNameMap).map(([key, name]) => ({ label: name, value: key }))}
                      />
                    </Form.Item>
                  </Col>
                  <Col span={12}>
                    <Form.Item
                      name="roles"
                      label={<span style={{ color: 'var(--text-primary)', fontWeight: '500' }}>è§’è‰²</span>}
                      rules={[{ required: true, message: 'è«‹é¸æ“‡è‡³å°‘ä¸€å€‹è§’è‰²' }]}
                    >
                      <Select
                        mode="multiple"
                        placeholder="è«‹é¸æ“‡äººå“¡è§’è‰²"
                        style={{ minHeight: '44px' }}
                        options={mockRoles.map(r => ({ label: r.name, value: r.id }))}
                      />
                    </Form.Item>
                  </Col>
                </Row>
              </div>

              {/* åº•éƒ¨æŒ‰éˆ•å€åŸŸ */}
              <div className="modal-footer">
                <div></div>
                <div>
                  <Button onClick={handleUserCancel}>
                    å–æ¶ˆ
                  </Button>
                  <Button type="primary" htmlType="submit">
                    {editingUser ? 'æ›´æ–°äººå“¡' : 'æ–°å¢äººå“¡'}
                  </Button>
                </div>
              </div>
            </Form>
          </Modal>
        </React.Fragment >
      );
    };

    const TeamManagementPage = () => {
      const initialTeams = [
        { key: 'team_1', name: 'Developers', description: 'è² è²¬é–‹ç™¼èˆ‡ç¶­è­·çš„æ ¸å¿ƒåœ˜éšŠ', members: ['user_2', 'user_4'], subscribers: ['user_1', 'slack_devops'], created_at: dayjs().subtract(60, 'day'), owner: 'user_2' },
        { key: 'team_2', name: 'Viewers', description: 'åƒ…æœ‰æª¢è¦–æ¬Šé™çš„è§€å¯Ÿå“¡', members: ['user_3'], subscribers: ['user_2'], created_at: dayjs().subtract(45, 'day'), owner: 'user_1' },
        { key: 'team_3', name: 'Administrators', description: 'å¹³å°æœ€é«˜æ¬Šé™ç®¡ç†è€…', members: ['user_1', 'user_4'], subscribers: ['user_1', 'slack_network', 'email_security', 'oncall_security'], created_at: dayjs().subtract(90, 'day'), owner: 'user_1' },
        { key: 'team_4', name: 'QA Team', description: 'å“è³ªä¿è­‰èˆ‡æ¸¬è©¦åœ˜éšŠ', members: [], subscribers: ['user_3', 'email_ops'], created_at: dayjs().subtract(20, 'day'), owner: 'user_1' },
        { key: 'team_5', name: 'DevOps Team', description: 'è² è²¬CI/CDå’ŒåŸºç¤è¨­æ–½è‡ªå‹•åŒ–çš„åœ˜éšŠ', members: ['user_2', 'user_4'], subscribers: ['user_1', 'slack_devops'], created_at: dayjs().subtract(30, 'day'), owner: 'user_2' },
        { key: 'team_6', name: 'Database Team', description: 'è² è²¬è³‡æ–™åº«ç®¡ç†èˆ‡å„ªåŒ–çš„åœ˜éšŠ', members: ['user_1'], subscribers: ['user_1', 'slack_database'], created_at: dayjs().subtract(40, 'day'), owner: 'user_1' },
        { key: 'team_7', name: 'Network Team', description: 'è² è²¬ç¶²è·¯åŸºç¤è¨­æ–½èˆ‡å®‰å…¨çš„åœ˜éšŠ', members: ['user_3'], subscribers: ['user_3', 'slack_network'], created_at: dayjs().subtract(50, 'day'), owner: 'user_3' },
        { key: 'team_8', name: 'Security Team', description: 'è² è²¬è³‡è¨Šå®‰å…¨èˆ‡åˆè¦çš„åœ˜éšŠ', members: ['user_4'], subscribers: ['user_4', 'email_security', 'oncall_security'], created_at: dayjs().subtract(35, 'day'), owner: 'user_4' },
        { key: 'team_9', name: 'Operations Team', description: 'è² è²¬ç³»çµ±é‹ç‡Ÿèˆ‡ç›£æ§çš„åœ˜éšŠ', members: ['user_1', 'user_2', 'user_3'], subscribers: ['user_1', 'slack_operations'], created_at: dayjs().subtract(25, 'day'), owner: 'user_1' },
        { key: 'team_10', name: 'Platform Team', description: 'è² è²¬å¹³å°æ¶æ§‹èˆ‡æŠ€è¡“åŸºç¤è¨­æ–½çš„åœ˜éšŠ', members: ['user_2', 'user_4'], subscribers: ['user_1', 'slack_platform'], created_at: dayjs().subtract(15, 'day'), owner: 'user_2' },
      ];

      const [teams, setTeams] = useLocalStorageState('sre-teams', initialTeams);
      const [isTeamModalOpen, setIsTeamModalOpen] = useState(false);
      const [editingTeam, setEditingTeam] = useState(null);
      const [teamSearchText, setTeamSearchText] = useState('');
      const [selectedRowKeys, setSelectedRowKeys] = useState([]);
      const [selectedMembers, setSelectedMembers] = useState([]);
      const [selectedSubscribers, setSelectedSubscribers] = useState([]);
      const [userSearchResults, setUserSearchResults] = useState([]);
      const [teamForm] = Form.useForm();
      const { message, modal } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // æ¨¡æ“¬äººå“¡è³‡æ–™ï¼ˆç”¨æ–¼åœ˜éšŠç®¡ç†ä¸­çš„æˆå“¡é¸æ“‡ï¼‰
      const mockUsers = [
        { key: 'user_1', name: 'ç‹å·¥ç¨‹å¸«', email: 'wang@example.com' },
        { key: 'user_2', name: 'é™³ç¶“ç†', email: 'chen@example.com' },
        { key: 'user_3', name: 'æé–‹ç™¼', email: 'li@example.com' },
        { key: 'user_4', name: 'å¼µç®¡ç†å“¡', email: 'zhang@example.com' },
      ];

      // æ¨¡æ“¬é€šçŸ¥è¨‚é–±è€…è³‡æ–™
      const mockSubscribers = [
        // äººå“¡
        { key: 'user_1', name: 'ç‹å·¥ç¨‹å¸«', type: 'USER', icon: 'ğŸ‘¤' },
        { key: 'user_2', name: 'é™³ç¶“ç†', type: 'USER', icon: 'ğŸ‘¤' },
        { key: 'user_3', name: 'æé–‹ç™¼', type: 'USER', icon: 'ğŸ‘¤' },
        // Slacké »é“
        { key: 'slack_network', name: 'ç¶²è·¯ä¸€éƒ¨ Slack', type: 'SLACK_CHANNEL', icon: '#ï¸âƒ£' },
        { key: 'slack_devops', name: 'DevOps åœ˜éšŠ Slack', type: 'SLACK_CHANNEL', icon: '#ï¸âƒ£' },
        // Emailç¾¤çµ„
        { key: 'email_security', name: 'è³‡å®‰åœ˜éšŠ Email ç¾¤çµ„', type: 'EMAIL_GROUP', icon: 'âœ‰ï¸' },
        { key: 'email_ops', name: 'é‹ç‡Ÿåœ˜éšŠ Email ç¾¤çµ„', type: 'EMAIL_GROUP', icon: 'âœ‰ï¸' },
        // On-Callå€¼ç­è¡¨
        { key: 'oncall_network', name: 'ç¶²è·¯åœ˜éšŠ On-Call å€¼ç­è¡¨', type: 'ON_CALL_SCHEDULE', icon: 'ğŸ“' },
        { key: 'oncall_security', name: 'è³‡å®‰åœ˜éšŠ On-Call å€¼ç­è¡¨', type: 'ON_CALL_SCHEDULE', icon: 'ğŸ“' }
      ];

      const getUserName = (userId) => {
        const user = mockUsers.find(u => u.key === userId);
        return user ? user.name : userId;
      };

      // åœ˜éšŠæ“ä½œå‡½æ•¸
      const showTeamModal = (team = null) => {
        setEditingTeam(team);
        const initialMembers = team ? team.members || [] : [];
        const initialSubscribers = team ? team.subscribers || [] : [];
        setSelectedMembers(initialMembers);
        setSelectedSubscribers(initialSubscribers);
        teamForm.setFieldsValue(team || { name: '', description: '' });
        setIsTeamModalOpen(true);
      };
      const handleTeamCancel = () => {
        setIsTeamModalOpen(false);
        setEditingTeam(null);
        setSelectedMembers([]);
        setSelectedSubscribers([]);
        teamForm.resetFields();
      };
      const handleTeamFinish = (values) => {
        const newTeam = {
          ...values,
          members: selectedMembers,
          subscribers: selectedSubscribers,
          key: editingTeam ? editingTeam.key : `t_${Date.now()}`,
          created_at: editingTeam ? editingTeam.created_at : dayjs(),
          owner: editingTeam ? editingTeam.owner : 'user_1' // é è¨­å‰µå»ºè€…ç‚ºç®¡ç†å“¡
        };
        if (editingTeam) {
          setTeams(teams.map(t => t.key === editingTeam.key ? newTeam : t));
          message.success('åœ˜éšŠæ›´æ–°æˆåŠŸ');
        } else {
          setTeams([newTeam, ...teams]);
          message.success('åœ˜éšŠæ–°å¢æˆåŠŸ');
        }
        handleTeamCancel();
      };
      const handleTeamDelete = (team) => {
        confirmDelete('åœ˜éšŠ', () => {
          setTeams(teams.filter(t => t.key !== team.key));
        }, `åœ˜éšŠ "${team.name}"`);
      };

      const handleUserSearch = (direction, value) => {
        if (direction === 'left') {
          if (value) {
            const results = mockUsers.filter(user =>
              user.name.toLowerCase().includes(value.toLowerCase()) ||
              user.email.toLowerCase().includes(value.toLowerCase())
            );
            setUserSearchResults(results);
          } else {
            setUserSearchResults([]);
          }
        }
      };

      const transferDataSource = [
        ...userSearchResults,
        ...mockUsers.filter(user => selectedMembers.includes(user.key) && !userSearchResults.some(u => u.key === user.key))
      ];

      const handleBatchDelete = () => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} å€‹åœ˜éšŠå—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setTeams(teams.filter(t => !selectedRowKeys.includes(t.key)));
            setSelectedRowKeys([]);
            message.success('æ‰¹æ¬¡åˆªé™¤æˆåŠŸ');
          }
        });
      };

      const teamColumns = [
        { title: 'åœ˜éšŠåç¨±', dataIndex: 'name', sorter: (a, b) => a.name.localeCompare(b.name) },
        { title: 'æˆå“¡æ•¸', dataIndex: 'members', render: m => m ? m.length : 0, sorter: (a, b) => (a.members?.length || 0) - (b.members?.length || 0) },
        { title: 'è¨‚é–±è€…æ•¸', dataIndex: 'subscribers', render: s => s ? s.length : 0, sorter: (a, b) => (a.subscribers?.length || 0) - (b.subscribers?.length || 0) },
        { title: 'è² è²¬äºº', dataIndex: 'owner', render: owner => getUserName(owner) || 'æœªè¨­å®š' },
        { title: 'æè¿°', dataIndex: 'description', render: desc => desc || 'ç„¡æè¿°' },
        { title: 'å‰µå»ºæ™‚é–“', dataIndex: 'created_at', render: time => time ? time.format('YYYY-MM-DD') : 'æœªçŸ¥', sorter: (a, b) => (a.created_at || dayjs(0)).valueOf() - (b.created_at || dayjs(0)).valueOf() },
        {
          title: 'æ“ä½œ', key: 'action', width: 120, render: (_, record) => (
            <Space>
              <Tooltip title="ç·¨è¼¯">
                <Button type="text" icon={<EditOutlined />} onClick={() => showTeamModal(record)} />
              </Tooltip>
              <Tooltip title="åˆªé™¤">
                <Button type="text" danger icon={<DeleteOutlined />} onClick={() => handleTeamDelete(record)} />
              </Tooltip>
            </Space>
          )
        }
      ];

      // ç¯©é¸åœ˜éšŠ
      const filteredTeams = teams.filter(team =>
        team.name.toLowerCase().includes(teamSearchText.toLowerCase()) ||
        team.description.toLowerCase().includes(teamSearchText.toLowerCase()) ||
        (team.subscribers && team.subscribers.some(subscriberKey =>
          mockSubscribers.find(s => s.key === subscriberKey)?.name.toLowerCase().includes(teamSearchText.toLowerCase())
        ))
      );

      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      return (
        <React.Fragment>

          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="æœå°‹åœ˜éšŠåç¨±æˆ–æè¿°"
                onChange={e => setTeamSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                ç¯©é¸
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showTeamModal()}>æ–°å¢åœ˜éšŠ</Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            <Table
              rowSelection={rowSelection}
              dataSource={filteredTeams}
              columns={teamColumns}
              rowKey="key"
              className="transparent-bg"
              pagination={{ pageSize: 10, position: ['bottomRight'] }}
              size="small"
            />
          </div>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>æ‰¹æ¬¡åˆªé™¤</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          {/* åœ˜éšŠç·¨è¼¯æ¨¡æ…‹æ¡† */}
          <Modal
            title={editingTeam ? 'ç·¨è¼¯åœ˜éšŠ' : 'æ–°å¢åœ˜éšŠ'}
            open={isTeamModalOpen}
            onCancel={handleTeamCancel}
            footer={null}
            width={900}
          >
            <Form form={teamForm} layout="vertical" onFinish={handleTeamFinish} style={{ marginTop: 24 }}>
              <Row gutter={16}>
                <Col span={12}>
                  <Form.Item name="name" label="åœ˜éšŠåç¨±" rules={[{ required: true, message: 'è«‹è¼¸å…¥åœ˜éšŠåç¨±' }]}>
                    <Input />
                  </Form.Item>
                </Col>
                <Col span={12}>
                  <Form.Item name="owner" label="è² è²¬äºº" rules={[{ required: true, message: 'è«‹é¸æ“‡è² è²¬äºº' }]}>
                    <Select options={mockUsers.map(u => ({ label: u.name, value: u.key }))} />
                  </Form.Item>
                </Col>
              </Row>
              <Form.Item name="description" label="åœ˜éšŠæè¿°" rules={[{ required: true, message: 'è«‹è¼¸å…¥åœ˜éšŠæè¿°' }]}>
                <TextArea rows={3} />
              </Form.Item>
              <Form.Item label="åœ˜éšŠæˆå“¡">
                <Transfer
                  dataSource={transferDataSource.map(user => ({
                    key: user.key,
                    title: `${user.name} (${user.email})`,
                    description: user.email,
                    name: user.name,
                    email: user.email
                  }))}
                  showSearch
                  onSearch={handleUserSearch}
                  targetKeys={selectedMembers}
                  onChange={(targetKeys) => {
                    setSelectedMembers(targetKeys);
                  }}
                  render={item => {
                    const user = mockUsers.find(u => u.key === item.key);
                    return (
                      <div style={{ padding: '4px 0', display: 'flex', alignItems: 'center', gap: '8px' }}>
                        <div style={{ fontWeight: '500', color: 'rgba(255, 255, 255, 0.9)', flex: 1 }}>
                          {item.name}
                        </div>
                        <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)', flexShrink: 0 }}>
                          {item.email}
                        </div>
                      </div>
                    );
                  }}
                  listStyle={{
                    width: 420,
                    height: 300,
                  }}
                  locale={{
                    itemUnit: 'å€‹äººå“¡',
                    itemsUnit: 'å€‹äººå“¡',
                    searchPlaceholder: 'æœå°‹äººå“¡å§“åæˆ–éƒµç®±'
                  }}
                  titles={['å¯ç”¨äººå“¡', 'åœ˜éšŠæˆå“¡']}
                />
              </Form.Item>

              <div style={{ display: 'flex', alignItems: 'center', marginBottom: '20px', marginTop: '32px' }}>
                <div className="severity-indicator severity-info"></div>
                <Title level={4} style={{ margin: 0, color: 'rgba(255, 255, 255, 0.9)' }}>é€šçŸ¥è¨‚é–±è€…</Title>
              </div>
              <div style={{ padding: '20px', background: 'rgba(255, 255, 255, 0.02)', border: '1px solid rgba(255, 255, 255, 0.08)', borderRadius: '8px', marginBottom: '32px' }}>
                <Form.Item label="é¸æ“‡é€šçŸ¥è¨‚é–±è€…" extra="åœ˜éšŠçš„äº‹ä»¶å°‡ç™¼é€çµ¦é¸ä¸­çš„è¨‚é–±è€…">
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                    {/* æŒ‰é¡å‹åˆ†çµ„é¡¯ç¤ºé¸é … */}
                    {[
                      { title: 'ğŸ‘¥ äººå“¡', type: 'USER', data: mockSubscribers.filter(s => s.type === 'USER') },
                      { title: '#ï¸âƒ£ Slack é »é“', type: 'SLACK_CHANNEL', data: mockSubscribers.filter(s => s.type === 'SLACK_CHANNEL') },
                      { title: 'âœ‰ï¸ Email ç¾¤çµ„', type: 'EMAIL_GROUP', data: mockSubscribers.filter(s => s.type === 'EMAIL_GROUP') },
                      { title: 'ğŸ“ On-Call å€¼ç­è¡¨', type: 'ON_CALL_SCHEDULE', data: mockSubscribers.filter(s => s.type === 'ON_CALL_SCHEDULE') }
                    ].map(group => (
                      <div key={group.type} style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                        <Text strong style={{ color: 'rgba(255, 255, 255, 0.8)', fontSize: '14px' }}>
                          {group.title || 'æœªå‘½åç¾¤çµ„'}
                        </Text>
                        <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                          {group.data.map(subscriber => {
                            const isSelected = selectedSubscribers.includes(subscriber.key);
                            return (
                              <Tag
                                key={subscriber.key}
                                style={{
                                  cursor: 'pointer',
                                  background: isSelected ? 'rgba(24, 144, 255, 0.15)' : 'rgba(255, 255, 255, 0.05)',
                                  borderColor: isSelected ? 'rgba(24, 144, 255, 0.4)' : 'rgba(255, 255, 255, 0.3)',
                                  color: isSelected ? 'rgba(24, 144, 255, 0.9)' : 'rgba(255, 255, 255, 0.8)',
                                  transition: 'all 0.2s',
                                  padding: '4px 8px',
                                  fontSize: '12px'
                                }}
                                onClick={() => {
                                  if (isSelected) {
                                    setSelectedSubscribers(selectedSubscribers.filter(key => key !== subscriber.key));
                                  } else {
                                    setSelectedSubscribers([...selectedSubscribers, subscriber.key]);
                                  }
                                }}
                              >
                                {subscriber.icon} {subscriber.name}
                              </Tag>
                            );
                          })}
                        </div>
                      </div>
                    ))}
                  </div>
                </Form.Item>

                {selectedSubscribers.length > 0 && (
                  <div style={{ marginTop: '16px', padding: '12px', background: 'rgba(24, 144, 255, 0.08)', borderRadius: '6px', border: '1px solid rgba(24, 144, 255, 0.2)' }}>
                    <Text strong style={{ color: 'rgba(24, 144, 255, 0.9)', fontSize: '12px' }}>
                      ğŸ“‹ å·²é¸æ“‡çš„è¨‚é–±è€… ({selectedSubscribers.length})ï¼š
                    </Text>
                    <div style={{ marginTop: '8px', display: 'flex', gap: '6px', flexWrap: 'wrap' }}>
                      {selectedSubscribers.map(subscriberKey => {
                        const subscriber = mockSubscribers.find(s => s.key === subscriberKey);
                        return subscriber ? (
                          <Tag
                            key={subscriberKey}
                            color="blue"
                            closable
                            onClose={() => setSelectedSubscribers(selectedSubscribers.filter(key => key !== subscriberKey))}
                            style={{ fontSize: '11px' }}
                          >
                            {subscriber.icon} {subscriber.name}
                          </Tag>
                        ) : null;
                      })}
                    </div>
                  </div>
                )}
              </div>

              <div className="modal-footer">
                <div></div>
                <div>
                  <Button onClick={handleTeamCancel}>å–æ¶ˆ</Button>
                  <Button type="primary" htmlType="submit">{editingTeam ? 'æ›´æ–°åœ˜éšŠ' : 'å‰µå»ºåœ˜éšŠ'}</Button>
                </div>
              </div>
            </Form>
          </Modal>

        </React.Fragment >
      );
    };

    const RoleManagementPage = () => {
      const permissionTreeData = [
        {
          title: 'è³‡æºç®¡ç†', key: 'resources', children: [
            { title: 'è®€å–è³‡æºåˆ—è¡¨', key: 'res:list:read' },
            { title: 'å¯«å…¥è³‡æº', key: 'res:list:write' },
            { title: 'è®€å–è³‡æºç¾¤çµ„', key: 'res:group:read' },
            { title: 'å¯«å…¥è³‡æºç¾¤çµ„', key: 'res:group:write' },
          ]
        },
        {
          title: 'äº‹ä»¶ç®¡ç†', key: 'incidents', children: [
            { title: 'è®€å–äº‹ä»¶', key: 'inc:list:read' },
            { title: 'ç¢ºèª/è§£æ±ºäº‹ä»¶', key: 'inc:list:update' },
            { title: 'è®€å–äº‹ä»¶è¦å‰‡', key: 'inc:rule:read' },
            { title: 'å¯«å…¥äº‹ä»¶è¦å‰‡', key: 'inc:rule:write' },
          ]
        },
      ];
      const initialRoles = [
        { key: 'super_admin', name: 'è¶…ç´šç®¡ç†å“¡', isBuiltIn: true, permissions: ['resources', 'incidents'] },
        { key: 'team_manager', name: 'åœ˜éšŠç®¡ç†å“¡', isBuiltIn: true, permissions: ['res:list:read', 'res:list:write', 'inc:list:read', 'inc:rule:write'] },
        { key: 'viewer', name: 'å”¯è®€äººå“¡', isBuiltIn: true, permissions: ['res:list:read', 'inc:list:read'] },
        { key: 'custom_role_1', name: 'è‡ªå®šç¾©DBAè§’è‰²', isBuiltIn: false, permissions: ['res:list:read', 'res:group:write'] },
      ];

      const [roles, setRoles] = useLocalStorageState('sre-roles', initialRoles);
      const [selectedRoleKey, setSelectedRoleKey] = useState('super_admin');
      const [checkedKeys, setCheckedKeys] = useState([]);
      const [isCreateRoleModalOpen, setIsCreateRoleModalOpen] = useState(false);
      const [newRolePermissions, setNewRolePermissions] = useState([]);
      const [roleForm] = Form.useForm();
      const { message, modal } = antd.App.useApp();

      const selectedRole = roles.find(r => r.key === selectedRoleKey);

      useEffect(() => {
        if (selectedRole) {
          setCheckedKeys(selectedRole.permissions);
        }
      }, [selectedRole]);

      const handleSelectRole = (key) => setSelectedRoleKey(key);
      const onCheck = (keys) => setCheckedKeys(keys);
      const handleSave = () => message.success(`è§’è‰² "${selectedRole.name}" çš„æ¬Šé™å·²æ›´æ–°`);

      const handleCreateRole = () => {
        setIsCreateRoleModalOpen(true);
        setNewRolePermissions([]);
        roleForm.resetFields();
      };

      const handleCreateRoleCancel = () => {
        setIsCreateRoleModalOpen(false);
        setNewRolePermissions([]);
        roleForm.resetFields();
      };

      const handleCreateRoleFinish = (values) => {
        const newRole = {
          key: `custom_role_${Date.now()}`,
          name: values.name,
          isBuiltIn: false,
          permissions: newRolePermissions
        };

        setRoles([...roles, newRole]);
        setSelectedRoleKey(newRole.key);
        message.success(`è§’è‰² "${values.name}" å»ºç«‹æˆåŠŸ`);
        handleCreateRoleCancel();
      };

      const onNewRolePermissionsCheck = (keys) => setNewRolePermissions(keys);

      return (
        <React.Fragment>
          <Row gutter={24}>
            <Col span={8}>
              <div className="role-list-container">
                <div className="role-list-header">
                  <Title level={5} style={{ margin: 0, color: 'var(--text-primary)', fontWeight: 600 }}>è§’è‰²åˆ—è¡¨</Title>
                  <Button
                    type="primary"
                    size="small"
                    icon={<PlusOutlined />}
                    onClick={handleCreateRole}
                    className="toolbar-btn"
                    style={{
                      height: '28px',
                      fontSize: '12px',
                      fontWeight: '500'
                    }}
                  >
                    æ–°å¢è§’è‰²
                  </Button>
                </div>
                <div className="role-list-content">
                  <List
                    dataSource={roles}
                    renderItem={item => (
                      <List.Item
                        key={item.key}
                        onClick={() => handleSelectRole(item.key)}
                        style={{
                          cursor: 'pointer',
                          background: selectedRoleKey === item.key ? 'var(--bg-active)' : 'transparent',
                          padding: '12px 16px',
                          borderRadius: 'var(--radius-md)',
                          margin: '4px 0',
                          border: selectedRoleKey === item.key ? '1px solid var(--brand-primary)' : '1px solid transparent',
                          transition: 'all 0.2s ease'
                        }}
                        className="role-list-item"
                      >
                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', width: '100%' }}>
                          <span style={{
                            color: 'var(--text-primary)',
                            fontWeight: selectedRoleKey === item.key ? '600' : '400',
                            fontSize: '14px'
                          }}>
                            {item.name}
                          </span>
                          {item.isBuiltIn && (
                            <Tag size="small" color="orange" style={{ fontSize: '10px', padding: '0 4px' }}>
                              å…§å»º
                            </Tag>
                          )}
                        </div>
                      </List.Item>
                    )}
                  />
                </div>
              </div>
            </Col>
            <Col span={16}>
              {selectedRole ? (
                <div className="role-permissions-container">
                  <div className="role-permissions-header">
                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                      <Space size="middle">
                        <Title level={4} style={{ margin: 0, color: 'var(--text-primary)' }}>
                          {selectedRole.name}
                        </Title>
                        <Tag
                          color={selectedRole.isBuiltIn ? 'red' : 'blue'}
                          style={{
                            fontSize: '12px',
                            fontWeight: '500',
                            borderRadius: 'var(--radius-md)'
                          }}
                        >
                          {selectedRole.isBuiltIn ? 'å…§å»ºè§’è‰²' : 'è‡ªå®šç¾©è§’è‰²'}
                        </Tag>
                      </Space>
                      {selectedRole.isBuiltIn && (
                        <Text type="secondary" style={{ fontSize: '12px' }}>
                          å…§å»ºè§’è‰²æ¬Šé™ç„¡æ³•ä¿®æ”¹
                        </Text>
                      )}
                    </div>
                  </div>
                  <div className="role-permissions-content">
                    <div style={{ marginBottom: 'var(--spacing-lg)' }}>
                      <Title level={5} style={{
                        color: 'var(--text-primary)',
                        marginBottom: 'var(--spacing-md)',
                        fontWeight: 600
                      }}>
                        æ¬Šé™è¨­å®š
                      </Title>
                      <div style={{
                        background: 'var(--bg-container)',
                        border: '1px solid var(--border-light)',
                        borderRadius: 'var(--radius-lg)',
                        padding: 'var(--spacing-lg)',
                        maxHeight: '400px',
                        overflowY: 'auto'
                      }}>
                        <Tree
                          checkable
                          treeData={permissionTreeData}
                          checkedKeys={checkedKeys}
                          onCheck={onCheck}
                          disabled={selectedRole.isBuiltIn}
                          defaultExpandAll
                          style={{
                            background: 'transparent',
                            color: 'var(--text-primary)'
                          }}
                        />
                      </div>
                    </div>
                    {!selectedRole.isBuiltIn && (
                      <div style={{ textAlign: 'right' }}>
                        <Button
                          type="primary"
                          onClick={handleSave}
                          size="large"
                          style={{
                            height: '40px',
                            borderRadius: 'var(--radius-lg)',
                            fontWeight: '500'
                          }}
                        >
                          å„²å­˜è®Šæ›´
                        </Button>
                      </div>
                    )}
                  </div>
                </div>
              ) : (
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  height: '400px',
                  background: 'var(--bg-elevated)',
                  border: '1px solid var(--border-light)',
                  borderRadius: 'var(--radius-lg)',
                  flexDirection: 'column',
                  gap: 'var(--spacing-md)'
                }}>
                  <UserOutlined style={{ fontSize: '48px', color: 'var(--text-tertiary)' }} />
                  <Text type="secondary" style={{ fontSize: '16px' }}>
                    è«‹å¾å·¦å´é¸æ“‡ä¸€å€‹è§’è‰²ä»¥æŸ¥çœ‹å’Œç·¨è¼¯æ¬Šé™
                  </Text>
                </div>
              )}
            </Col>
          </Row>

          {/* æ–°å¢è§’è‰²å½ˆçª— */}
          <Modal
            title={
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <UserOutlined style={{ color: '#1890ff' }} />
                <span>æ–°å¢è§’è‰²</span>
              </div>
            }
            open={isCreateRoleModalOpen}
            onCancel={handleCreateRoleCancel}
            footer={null}
            width={700}
            style={{
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
              borderRadius: '12px'
            }}
          >
            <Form
              form={roleForm}
              layout="vertical"
              onFinish={handleCreateRoleFinish}
              style={{ marginTop: '24px' }}
            >
              {/* åŸºæœ¬è³‡è¨Šå€å¡Š */}
              <div style={{
                background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                border: '1px solid rgba(255, 255, 255, 0.08)',
                borderRadius: '12px',
                padding: '20px',
                marginBottom: '24px',
                backdropFilter: 'blur(20px) saturate(180%)',
                WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                boxShadow: '0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
              }}>
                <Title level={4} style={{ margin: 0, marginBottom: '16px', color: 'rgba(255, 255, 255, 0.85)' }}>
                  åŸºæœ¬è³‡è¨Š
                </Title>
                <Form.Item
                  name="name"
                  label="è§’è‰²åç¨±"
                  rules={[
                    { required: true, message: 'è«‹è¼¸å…¥è§’è‰²åç¨±' },
                    { min: 2, message: 'è§’è‰²åç¨±è‡³å°‘éœ€è¦2å€‹å­—ç¬¦' },
                    { max: 50, message: 'è§’è‰²åç¨±ä¸èƒ½è¶…é50å€‹å­—ç¬¦' }
                  ]}
                >
                  <Input
                    placeholder="ä¾‹å¦‚ï¼šè³‡æ–™åº«ç®¡ç†å“¡"
                    prefix={<UserOutlined style={{ color: 'rgba(255, 255, 255, 0.4)' }} />}
                    style={{
                      background: 'rgba(255, 255, 255, 0.05)',
                      border: '1px solid rgba(255, 255, 255, 0.15)',
                      color: 'rgba(255, 255, 255, 0.85)',
                      borderRadius: '6px'
                    }}
                  />
                </Form.Item>
              </div>

              {/* æ¬Šé™è¨­å®šå€å¡Š */}
              <div style={{
                background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                border: '1px solid rgba(255, 255, 255, 0.08)',
                borderRadius: '12px',
                padding: '20px',
                marginBottom: '24px',
                backdropFilter: 'blur(20px) saturate(180%)',
                WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                boxShadow: '0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
              }}>
                <Title level={4} style={{ margin: 0, marginBottom: '16px', color: 'rgba(255, 255, 255, 0.85)' }}>
                  æ¬Šé™è¨­å®š
                </Title>
                <div style={{
                  background: 'rgba(255, 255, 255, 0.02)',
                  border: '1px solid rgba(255, 255, 255, 0.1)',
                  borderRadius: '8px',
                  padding: '16px'
                }}>
                  <Tree
                    checkable
                    treeData={permissionTreeData}
                    checkedKeys={newRolePermissions}
                    onCheck={onNewRolePermissionsCheck}
                    defaultExpandAll
                    style={{
                      background: 'transparent',
                      color: 'rgba(255, 255, 255, 0.85)'
                    }}
                  />
                </div>
                {newRolePermissions.length > 0 && (
                  <div style={{
                    marginTop: '16px',
                    padding: '12px',
                    background: 'linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%)',
                    border: '1px solid rgba(34, 197, 94, 0.2)',
                    borderRadius: '6px'
                  }}>
                    <Text style={{ color: '#52c41a', fontWeight: '500' }}>
                      å·²é¸æ“‡ {newRolePermissions.length} é …æ¬Šé™
                    </Text>
                  </div>
                )}
              </div>

              {/* åº•éƒ¨æŒ‰éˆ•å€å¡Š */}
              <div style={{
                background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(200, 200, 200, 0.02) 100%)',
                border: '1px solid rgba(255, 255, 255, 0.08)',
                borderRadius: '12px',
                padding: '20px',
                backdropFilter: 'blur(20px) saturate(180%)',
                WebkitBackdropFilter: 'blur(20px) saturate(180%)',
                boxShadow: '0 8px 32px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
              }}>
                <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '12px' }}>
                  <Button
                    className="modal-footer-btn"
                    onClick={handleCreateRoleCancel}
                  >
                    å–æ¶ˆ
                  </Button>
                  <Button
                    type="primary"
                    className="modal-footer-btn"
                    htmlType="submit"
                    disabled={newRolePermissions.length === 0}
                  >
                    å»ºç«‹è§’è‰²
                  </Button>
                </div>
                {newRolePermissions.length === 0 && (
                  <Text type="secondary" style={{ display: 'block', marginTop: '8px', fontSize: '12px' }}>
                    è«‹è‡³å°‘é¸æ“‡ä¸€å€‹æ¬Šé™æ‰èƒ½å»ºç«‹è§’è‰²
                  </Text>
                )}
              </div>
            </Form>
          </Modal>
        </React.Fragment>
      );
    };

    // æ™ºèƒ½æ¨™ç±¤è¼¸å…¥çµ„ä»¶
    const SmartTagInput = ({ value = {}, onChange, placeholder = "è¼¸å…¥æ¨™ç±¤...", style }) => {
      const [tags] = useLocalStorageState('sre-unified-tags', []);
      const [currentKey, setCurrentKey] = useState('');
      const [currentValue, setCurrentValue] = useState('');
      const [keyInputMode, setKeyInputMode] = useState(true);
      const { message } = antd.App.useApp();

      // å¾æ¨™ç±¤ç®¡ç†ç³»çµ±ç²å– Key é¸é …
      const keyOptions = tags.map(tag => ({
        value: tag.name,
        label: tag.displayName || tag.name,
        description: tag.description,
        required: tag.required,
        valueCount: tag.values.length,
        values: tag.values
      }));

      // ç•¶å‰é¸ä¸­çš„æ¨™ç±¤å®šç¾©
      const selectedTagDef = tags.find(tag => tag.name === currentKey);

      // ç”Ÿæˆå€¼é¸é …ï¼ˆåŸºæ–¼æ¨™ç±¤çš„é è¨­å€¼ï¼‰
      const getValueOptions = (keyName) => {
        const tagDef = tags.find(tag => tag.name === keyName);
        if (!tagDef || !tagDef.values) return [];

        return tagDef.values.map(val => ({
          value: val.value,
          label: val.displayName || val.value,
          color: val.color,
          description: val.displayName,
          usageCount: val.usageCount
        }));
      };

      // é©—è­‰å€¼æ˜¯å¦å­˜åœ¨æ–¼æ¨™ç±¤çš„é è¨­å€¼åˆ—è¡¨ä¸­
      const validateValue = (keyName, inputValue) => {
        const tagDef = tags.find(tag => tag.name === keyName);
        if (!tagDef) return true;

        // å¦‚æœæ¨™ç±¤æœ‰é è¨­å€¼åˆ—è¡¨ï¼Œæª¢æŸ¥æ˜¯å¦åœ¨åˆ—è¡¨ä¸­
        if (tagDef.values && tagDef.values.length > 0) {
          return tagDef.values.some(val => val.value === inputValue);
        }

        // å¦‚æœæ²’æœ‰é è¨­å€¼åˆ—è¡¨ï¼Œå…è¨±ä»»æ„å€¼
        return true;
      };

      // è™•ç†æ¨™ç±¤æ·»åŠ 
      const handleAddTag = () => {
        if (!currentKey || !currentValue) return;

        // é©—è­‰å€¼
        if (!validateValue(currentKey, currentValue)) {
          const tagDef = tags.find(tag => tag.name === currentKey);
          if (tagDef?.values && tagDef.values.length > 0) {
            const validValues = tagDef.values.map(val => val.value).join(', ');
            message.error(`"${currentKey}" çš„å€¼å¿…é ˆæ˜¯: ${validValues}`);
          } else {
            message.error(`"${currentKey}" çš„å€¼æ ¼å¼ä¸æ­£ç¢º`);
          }
          return;
        }

        // æ·»åŠ æ¨™ç±¤
        const newTags = { ...value, [currentKey]: currentValue };
        onChange?.(newTags);

        // é‡ç½®è¼¸å…¥
        setCurrentKey('');
        setCurrentValue('');
        setKeyInputMode(true);
      };

      // è™•ç†æ¨™ç±¤åˆªé™¤
      const handleRemoveTag = (key) => {
        const newTags = { ...value };
        delete newTags[key];
        onChange?.(newTags);
      };

      // è™•ç† Key é¸æ“‡
      const handleKeySelect = (selectedKey) => {
        setCurrentKey(selectedKey);
        setCurrentValue('');
        setKeyInputMode(false);
      };

      // è™•ç† Key è¼¸å…¥
      const handleKeyInput = (inputKey) => {
        setCurrentKey(inputKey);
      };

      return (
        <div style={style}>
          {/* ç¾æœ‰æ¨™ç±¤é¡¯ç¤º */}
          <div style={{ marginBottom: 8 }}>
            <Space size={[4, 4]} wrap>
              {Object.entries(value || {}).map(([key, val]) => {
                const tagDef = tags.find(tag => tag.name === key);
                const valueDef = tagDef?.values?.find(v => v.value === val);

                // ä½¿ç”¨å€¼å®šç¾©ä¸­çš„é¡è‰²ï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨æ¨™ç±¤åˆ†é¡çš„é è¨­é¡è‰²
                const tagColor = valueDef?.color ||
                  (tagDef?.category === 'infrastructure' ? '#1890ff' :
                    tagDef?.category === 'application' ? '#52c41a' :
                      tagDef?.category === 'organization' ? '#fa8c16' :
                        tagDef?.category === 'business' ? '#722ed1' :
                          tagDef?.category === 'finance' ? '#eb2f96' :
                            tagDef?.category === 'security' ? '#f5222d' : '#1890ff');

                return (
                  <Tag
                    key={key}
                    closable
                    color={tagColor}
                    onClose={() => handleRemoveTag(key)}
                    style={{ fontWeight: 500 }}
                  >
                    <strong>{tagDef?.displayName || key}</strong>: {valueDef?.displayName || val}
                  </Tag>
                );
              })}
            </Space>
          </div>

          {/* æ¨™ç±¤è¼¸å…¥å€åŸŸ */}
          <div style={{ display: 'flex', gap: 8, alignItems: 'flex-start' }}>
            {keyInputMode ? (
              // Key è¼¸å…¥æ¨¡å¼
              <div style={{ flex: 1 }}>
                <Select
                  showSearch
                  placeholder="é¸æ“‡æ¨™ç±¤ Key..."
                  style={{ width: '100%' }}
                  value={currentKey || undefined}
                  onSelect={handleKeySelect}
                  onSearch={handleKeyInput}
                  filterOption={(input, option) =>
                    option?.value?.toLowerCase().includes(input.toLowerCase()) ||
                    option?.label?.toLowerCase().includes(input.toLowerCase())
                  }
                  dropdownRender={(menu) => (
                    <div>
                      {menu}
                      {currentKey && !keyOptions.find(opt => opt.value === currentKey) && (
                        <div style={{ padding: 8, borderTop: '1px solid #f0f0f0' }}>
                          <Button
                            type="link"
                            size="small"
                            onClick={() => {
                              message.info('è‡ªå®šç¾© Key åŠŸèƒ½éœ€è¦ç®¡ç†å“¡æ¬Šé™');
                            }}
                          >
                            + å‰µå»ºæ–° Key "{currentKey}"
                          </Button>
                        </div>
                      )}
                    </div>
                  )}
                >
                  {keyOptions.map(option => (
                    <Select.Option key={option.value} value={option.value} label={option.label}>
                      <div>
                        <div style={{ fontWeight: 500 }}>
                          {option.label}
                          {option.required && <Tag size="small" color="red" style={{ marginLeft: 4 }}>å¿…å¡«</Tag>}
                        </div>
                        <div style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>
                          {option.description}
                        </div>
                      </div>
                    </Select.Option>
                  ))}
                </Select>
              </div>
            ) : (
              // å€¼è¼¸å…¥æ¨¡å¼
              <div style={{ flex: 1, display: 'flex', gap: 8 }}>
                <Select
                  disabled
                  value={selectedTagDef?.displayName || currentKey}
                  style={{ width: 150 }}
                />
                <div style={{ flex: 1 }}>
                  {selectedTagDef?.values && selectedTagDef.values.length > 0 ? (
                    <Select
                      placeholder="é¸æ“‡å€¼..."
                      value={currentValue || undefined}
                      onChange={setCurrentValue}
                      style={{ width: '100%' }}
                      showSearch
                      filterOption={(input, option) =>
                        option?.label?.toLowerCase().includes(input.toLowerCase()) ||
                        option?.value?.toLowerCase().includes(input.toLowerCase())
                      }
                    >
                      {getValueOptions(currentKey).map(option => (
                        <Select.Option key={option.value} value={option.value} label={option.label}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                              <Tag color={option.color} style={{ margin: 0 }}>
                                {option.value}
                              </Tag>
                              <span>{option.description}</span>
                            </div>
                            <Text type="secondary" style={{ fontSize: '11px' }}>
                              {option.usageCount} æ¬¡ä½¿ç”¨
                            </Text>
                          </div>
                        </Select.Option>
                      ))}
                    </Select>
                  ) : (
                    <Input
                      placeholder="è¼¸å…¥æ¨™ç±¤å€¼..."
                      value={currentValue}
                      onChange={(e) => setCurrentValue(e.target.value)}
                      onPressEnter={handleAddTag}
                    />
                  )}
                </div>
                <Button
                  type="primary"
                  size="small"
                  onClick={handleAddTag}
                  disabled={!currentKey || !currentValue}
                >
                  æ·»åŠ 
                </Button>
                <Button
                  size="small"
                  onClick={() => {
                    setKeyInputMode(true);
                    setCurrentKey('');
                    setCurrentValue('');
                  }}
                >
                  å–æ¶ˆ
                </Button>
              </div>
            )}
          </div>

          {/* Key æè¿°å’Œæç¤º */}
          {selectedTagDef && !keyInputMode && (
            <div style={{ marginTop: 4, fontSize: '12px', color: 'var(--text-secondary)' }}>
              {selectedTagDef.description}
              {selectedTagDef.values && selectedTagDef.values.length > 0 && (
                <div>
                  å¯é¸å€¼: {selectedTagDef.values.slice(0, 3).map(val => val.value).join(', ')}
                  {selectedTagDef.values.length > 3 && '...ç­‰'}
                  {` (${selectedTagDef.values.length} å€‹)`}
                </div>
              )}
            </div>
          )}
        </div>
      );
    };


    // Dashboard Administration Page - Card navigation style
    const DashboardAdministrationPage = ({ onNavigate }) => {
      // State for default dashboard setting
      const [defaultDashboard, setDefaultDashboard] = useState(() => {
        return localStorage.getItem('default-dashboard') || 'business-dashboard';
      });

      // Function to set a dashboard as default
      const setAsDefaultDashboard = (dashboardKey) => {
        setDefaultDashboard(dashboardKey);
        localStorage.setItem('default-dashboard', dashboardKey);
        antd.message.success(`å·²å°‡ã€Œ${dashboardCards.find(d => d.key === dashboardKey)?.title || 'æœªçŸ¥å„€è¡¨æ¿'}ã€è¨­ç‚ºé è¨­é¦–é `);
      };

      // Define dashboard cards using the exact pattern from Settings
      const dashboardCards = [
        {
          key: 'alerts-insights',
          icon: <ExclamationCircleOutlined />,
          title: 'åŸºç¤è¨­æ–½æ´å¯Ÿ',
          description: 'æ•´åˆäº‹ä»¶ç›£æ§èˆ‡è³‡æºå¥åº·åº¦åˆ†æã€‚',
          category: 'è³‡æºç›£æ§',
          features: ['å³æ™‚å‘Šè­¦', 'è³‡æºå¥åº·åº¦', 'è¶¨å‹¢åˆ†æ'],
          enabled: true
        },
        {
          key: 'resource-overview',
          icon: <HddOutlined />,
          title: 'è³‡æºç¸½è¦½',
          description: 'è³‡æºä½¿ç”¨æƒ…æ³èˆ‡å¥åº·ç‹€æ…‹ç¸½è¦½ã€‚',
          category: 'è³‡æºç®¡ç†',
          features: ['è³‡æºå¥åº·åº¦', 'ä½¿ç”¨ç‡çµ±è¨ˆ', 'è² è¼‰åˆ†ä½ˆ'],
          enabled: true
        },
        {
          key: 'business-dashboard',
          icon: <BarChartOutlined />,
          title: 'SRE æˆ°æƒ…å®¤',
          description: 'æ¥­å‹™æŒ‡æ¨™èˆ‡æ•ˆèƒ½ç›£æ§å„€è¡¨æ¿ã€‚',
          category: 'æ¥­å‹™ç›£æ§',
          features: ['KPIè¿½è¹¤', 'æ•ˆèƒ½æŒ‡æ¨™', 'æ¥­å‹™å¥åº·åº¦'],
          enabled: true
        },
        {
          key: 'integrated-resource-overview',
          icon: <GlobalOutlined />,
          title: 'æ•´åˆè³‡æºç¸½è¦½',
          description: 'è·¨é›†ç¾¤è³‡æºæ•´åˆè¦–åœ–ã€‚',
          category: 'è³‡æºç®¡ç†',
          features: ['å¤šé›†ç¾¤è¦–åœ–', 'çµ±ä¸€ç›£æ§', 'è³‡æºèª¿åº¦'],
          enabled: true
        }
      ];

      // Reusable card content component
      const CardContent = ({ item }) => (
        <div
          className={`nav-item ${!item.enabled ? 'disabled-card' : ''}`}
          style={{ height: '90px', width: '100%', position: 'relative' }}
        >
          {/* Default dashboard indicator */}
          {defaultDashboard === item.key && (
            <div style={{
              position: 'absolute',
              top: '12px',
              right: '12px',
              background: '#52c41a',
              color: 'white',
              padding: '2px 6px',
              borderRadius: '10px',
              fontSize: '10px',
              fontWeight: 600,
              zIndex: 10,
              boxShadow: '0 2px 8px rgba(0, 0, 0, 0.15)',
              whiteSpace: 'nowrap'
            }}>
              <HomeOutlined style={{ marginRight: '2px', fontSize: '10px' }} />
              é è¨­é¦–é 
            </div>
          )}

          {/* Main card content */}
          <div
            className="nav-item-content"
            onClick={() => item.enabled && onNavigate(item.key)}
            style={{
              display: 'flex',
              alignItems: 'center',
              height: '100%',
              cursor: item.enabled ? 'pointer' : 'not-allowed',
              position: 'relative'
            }}
          >
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', width: '100%', justifyContent: 'space-between' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px', flex: 1 }}>
                <div className="nav-item-icon" style={{
                  background: 'rgba(24, 144, 255, 0.1)',
                  padding: '8px',
                  borderRadius: '8px',
                  fontSize: '24px',
                  color: item.enabled ? '#1890ff' : 'rgba(255, 255, 255, 0.3)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  flexShrink: 0
                }}>
                  {item.icon}
                </div>
                <div style={{ flex: 1, minWidth: 0 }}>
                  <div className="nav-item-title" style={{
                    color: item.enabled ? 'rgba(255, 255, 255, 0.9)' : 'rgba(255, 255, 255, 0.5)',
                    fontSize: '16px',
                    fontWeight: 600,
                    marginBottom: '4px',
                    lineHeight: '1.2'
                  }}>
                    {item.title || 'æœªå‘½åé …ç›®'}
                  </div>
                  <div className="nav-item-description" style={{
                    color: 'rgba(255, 255, 255, 0.6)',
                    fontSize: '14px',
                    lineHeight: '1.4'
                  }}>
                    {item.description}
                  </div>
                </div>
              </div>

              {/* Set as default button */}
              {item.enabled && (
                <Tooltip title={defaultDashboard === item.key ? "å·²æ˜¯é è¨­é¦–é " : "è¨­ç‚ºé è¨­é¦–é "}>
                  <Button
                    type="text"
                    size="small"
                    icon={<HomeOutlined />}
                    onClick={(e) => {
                      e.stopPropagation();
                      if (defaultDashboard !== item.key) {
                        setAsDefaultDashboard(item.key);
                      }
                    }}
                    style={{
                      color: defaultDashboard === item.key ? '#52c41a' : 'rgba(255, 255, 255, 0.6)',
                      padding: '4px',
                      borderRadius: '4px',
                      transition: 'all 0.2s',
                      alignSelf: 'flex-end',
                      marginBottom: '-2px'
                    }}
                    className="set-default-btn"
                  />
                </Tooltip>
              )}
            </div>
          </div>
        </div>
      );

      // Helper to render a category section
      const renderCategory = (categoryName) => (
        <div style={{ marginBottom: '24px' }}>
          <Title level={5} style={{
            color: 'var(--text-secondary)',
            fontWeight: '500',
            marginBottom: '8px',
            fontSize: '16px'
          }}>
            {categoryName}
          </Title>
          <Row gutter={[16, 16]}>
            {dashboardCards.filter(item => item.category === categoryName).map(item => (
              <Col key={item.key} xs={24} md={12} lg={8} style={{ display: 'flex' }}>
                {item.enabled ? (
                  <CardContent item={item} />
                ) : (
                  <Badge.Ribbon text="å³å°‡æ¨å‡º">
                    <CardContent item={item} />
                  </Badge.Ribbon>
                )}
              </Col>
            ))}
          </Row>
        </div>
      );

      return (
        <React.Fragment>
          <Title level={2} className="page-title" style={{ marginBottom: '2px' }}>å„€è¡¨æ¿</Title>
          <Paragraph className="page-subtitle" type="secondary" style={{ marginBottom: '4px' }}>
            çµ±ä¸€çš„ç³»çµ±ç›£æ§èˆ‡æ¥­å‹™æ´å¯Ÿå„€è¡¨æ¿å…¥å£ã€‚
          </Paragraph>
          {/* åˆ†çµ„é¡¯ç¤ºå„€è¡¨æ¿åŠŸèƒ½ */}
          <div style={{ marginTop: '16px' }}>
            {renderCategory('è³‡æºç›£æ§')}
            {renderCategory('æ¥­å‹™ç›£æ§')}
          </div>
        </React.Fragment>
      );
    };

    // Settings Administration Page - Card navigation style
    const SettingsAdministrationPage = ({ onNavigate }) => {
      // Define settings cards using the exact pattern from Management Center
      const settingsCards = [
        {
          key: 'personnel-management',
          icon: <UserOutlined />,
          title: 'äººå“¡ç®¡ç†',
          description: 'ç®¡ç†ä½¿ç”¨è€…å¸³è™Ÿèˆ‡æ¬Šé™ã€‚',
          category: 'èº«ä»½èˆ‡å­˜å–ç®¡ç†',
          features: ['è§’è‰²é…ç½®', 'SSOæ•´åˆ', 'å¯†ç¢¼ç­–ç•¥'],
          enabled: true
        },
        {
          key: 'team-management',
          icon: <TeamOutlined />,
          title: 'åœ˜éšŠç®¡ç†',
          description: 'ç®¡ç†åœ˜éšŠçµæ§‹èˆ‡æˆå“¡é…ç½®ã€‚',
          category: 'èº«ä»½èˆ‡å­˜å–ç®¡ç†',
          features: ['éšå±¤æ¶æ§‹', 'æ¬Šé™ç¹¼æ‰¿', 'æˆå“¡ç®¡ç†'],
          enabled: true
        },
        {
          key: 'role-management',
          icon: <ApartmentOutlined />,
          title: 'è§’è‰²ç®¡ç†',
          description: 'å®šç¾©ç³»çµ±è§’è‰²èˆ‡å…¶æ¬Šé™ã€‚',
          category: 'èº«ä»½èˆ‡å­˜å–ç®¡ç†',
          features: ['RBACæ§åˆ¶', 'è‡ªè¨‚è§’è‰²', 'æ¬Šé™æ¨¡æ¿'],
          enabled: true
        },
        {
          key: 'audit-logs',
          icon: <AuditOutlined />,
          title: 'å¯©è¨ˆæ—¥èªŒ',
          description: 'æŸ¥çœ‹ç³»çµ±æ“ä½œå¯©è¨ˆè¨˜éŒ„ã€‚',
          category: 'èº«ä»½èˆ‡å­˜å–ç®¡ç†',
          features: ['æ“ä½œè¿½è¹¤', 'å®‰å…¨å¯©è¨ˆ', 'æ—¥èªŒåˆ†æ'],
          enabled: true
        },
        {
          key: 'notification-strategies',
          icon: <ApartmentOutlined />,
          title: 'é€šçŸ¥ç­–ç•¥',
          description: 'è¨­å®šäº‹ä»¶é€šçŸ¥çš„è·¯ç”±ç­–ç•¥ã€‚',
          category: 'é€šçŸ¥ç®¡ç†',
          features: ['æ™ºèƒ½è·¯ç”±', 'å‡ç´šè¦å‰‡', 'å€¼ç­æ•´åˆ'],
          enabled: true
        },
        {
          key: 'notification-channels',
          icon: <BellOutlined />,
          title: 'é€šçŸ¥ç®¡é“',
          description: 'ç®¡ç†ç³»çµ±é€šçŸ¥ç®¡é“ã€‚',
          category: 'é€šçŸ¥ç®¡ç†',
          features: ['å¤šå…ƒç®¡é“', 'æ¨¡æ¿ç®¡ç†', 'é€é”ç¢ºèª'],
          enabled: true
        },
        {
          key: 'tag-management',
          icon: <TagsOutlined />,
          title: 'æ¨™ç±¤ç®¡ç†',
          description: 'ç®¡ç†å…¨åŸŸæ¨™ç±¤èˆ‡åˆ†é¡ã€‚',
          category: 'å¹³å°è¨­å®š',
          features: ['æ¨™ç±¤æ¨™æº–åŒ–', 'å±¤ç´šæ¨™ç±¤', 'æ¨™ç±¤é©—è­‰'],
          enabled: true
        },
        {
          key: 'email-settings',
          icon: <MailOutlined />,
          title: 'éƒµä»¶è¨­å®š',
          description: 'é…ç½® SMTP ä¼ºæœå™¨ã€‚',
          category: 'å¹³å°è¨­å®š',
          features: ['SMTPè¨­å®š', 'ç™¼é€è¨˜éŒ„'],
          enabled: true
        },
        {
          key: 'auth-settings',
          icon: <SafetyOutlined />,
          title: 'èº«ä»½é©—è­‰',
          description: 'é…ç½®ç™»å…¥æ–¹å¼èˆ‡å®‰å…¨ç­–ç•¥ã€‚',
          category: 'å¹³å°è¨­å®š',
          features: ['SSOæ•´åˆ', 'å¤šå› ç´ èªè­‰', 'å¯†ç¢¼ç­–ç•¥'],
          enabled: true
        },
      ];

      // Reusable card content component
      const CardContent = ({ item }) => (
        <div
          className={`nav-item ${!item.enabled ? 'disabled-card' : ''}`}
          onClick={() => item.enabled && onNavigate(item.key)}
          style={{ height: '100%', width: '100%' }}
        >
          <div className="nav-item-content" style={{ flexDirection: 'column', alignItems: 'flex-start' }}>
            <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px', marginBottom: '6px', width: '100%' }}>
              <div className="nav-item-icon" style={{
                background: 'rgba(24, 144, 255, 0.1)',
                padding: '6px',
                borderRadius: '8px',
                fontSize: '20px',
                opacity: item.enabled ? 1 : 0.5
              }}>
                {item.icon}
              </div>
              <div className="nav-item-text" style={{ flex: 1 }}>
                <Title level={5} className="nav-item-title" style={{ marginBottom: '4px' }}>
                  {item.title || 'æœªå‘½åé …ç›®'}
                </Title>
                <Paragraph className="nav-item-description" style={{ marginBottom: 0 }}>{item.description}</Paragraph>
              </div>
            </div>
          </div>
        </div>
      );

      // Helper to render a category section
      const renderCategory = (categoryName) => (
        <div style={{ marginBottom: '24px' }}>
          <Title level={5} style={{
            color: 'var(--text-secondary)',
            fontWeight: '500',
            marginBottom: '8px',
            fontSize: '16px'
          }}>
            {categoryName}
          </Title>
          <Row gutter={[16, 16]}>
            {settingsCards.filter(item => item.category === categoryName).map(item => (
              <Col key={item.key} xs={24} md={12} lg={8} style={{ display: 'flex' }}>
                {item.enabled ? (
                  <CardContent item={item} />
                ) : (
                  <Badge.Ribbon text="å³å°‡æ¨å‡º">
                    <CardContent item={item} />
                  </Badge.Ribbon>
                )}
              </Col>
            ))}
          </Row>
        </div>
      );


      return (
        <React.Fragment>
          <Title level={2} className="page-title" style={{ marginBottom: '2px' }}>è¨­å®š</Title>
          <Paragraph className="page-subtitle" type="secondary" style={{ marginBottom: '4px' }}>
            é…ç½®å¹³å°çš„äººå“¡ã€æ¬Šé™èˆ‡ç³»çµ±åŠŸèƒ½è¨­å®šã€‚
          </Paragraph>
          {/* åˆ†çµ„é¡¯ç¤ºè¨­å®šåŠŸèƒ½ */}
          <div style={{ marginTop: '16px' }}>
            {renderCategory('èº«ä»½èˆ‡å­˜å–ç®¡ç†')}
            {renderCategory('é€šçŸ¥ç®¡ç†')}
            {renderCategory('å¹³å°è¨­å®š')}
          </div>
        </React.Fragment>
      );
    };

    // === ğŸ·ï¸ å„ªåŒ–å¾Œçš„æ¨™ç±¤ç®¡ç†é é¢ ===
    const TagKeyManagementPage = () => {
      // æ¨™ç±¤åˆ†é¡ç³»çµ±
      const tagCategories = [
        { id: 'infrastructure', name: 'åŸºç¤è¨­æ–½', color: '#1890ff', icon: <HddOutlined />, description: 'æœå‹™å™¨ã€ç¶²çµ¡ã€å­˜å„²ç­‰åŸºç¤è¨­æ–½ç›¸é—œæ¨™ç±¤' },
        { id: 'application', name: 'æ‡‰ç”¨ç¨‹åº', color: '#52c41a', icon: <CodeOutlined />, description: 'æ‡‰ç”¨æœå‹™ã€å¾®æœå‹™ç­‰æ‡‰ç”¨ç›¸é—œæ¨™ç±¤' },
        { id: 'organization', name: 'çµ„ç¹”çµæ§‹', color: '#fa8c16', icon: <TeamOutlined />, description: 'åœ˜éšŠã€éƒ¨é–€ã€è²¬ä»»äººç­‰çµ„ç¹”ç›¸é—œæ¨™ç±¤' },
        { id: 'business', name: 'æ¥­å‹™å±¬æ€§', color: '#722ed1', icon: <BuildOutlined />, description: 'é …ç›®ã€ç”¢å“ç·šã€å®¢æˆ¶ç­‰æ¥­å‹™ç›¸é—œæ¨™ç±¤' },
        { id: 'finance', name: 'æˆæœ¬ç®¡ç†', color: '#eb2f96', icon: <DollarOutlined />, description: 'æˆæœ¬ä¸­å¿ƒã€é ç®—ã€è¨ˆè²»ç­‰è²¡å‹™ç›¸é—œæ¨™ç±¤' },
        { id: 'security', name: 'å®‰å…¨åˆè¦', color: '#f5222d', icon: <SafetyOutlined />, description: 'å®‰å…¨ç­‰ç´šã€åˆè¦è¦æ±‚ç­‰å®‰å…¨ç›¸é—œæ¨™ç±¤' }
      ];

      // é è¨­çš„æ¨™ç±¤æ•¸æ“šï¼ˆåŒ…å«nameå’Œvaluesï¼‰
      const initialTags = [
        {
          id: 'team_1',
          name: 'environment',
          displayName: 'ç’°å¢ƒ',
          description: 'éƒ¨ç½²ç’°å¢ƒæ¨™è­˜ï¼Œç”¨æ–¼å€åˆ†ä¸åŒçš„é‹è¡Œç’°å¢ƒ',
          category: 'infrastructure',
          required: true,
          values: [
            { id: 'env_prod', value: 'production', displayName: 'ç”Ÿç”¢ç’°å¢ƒ', color: '#f5222d', usageCount: 45, created_at: dayjs().subtract(30, 'day') },
            { id: 'env_stage', value: 'staging', displayName: 'é ç™¼ç’°å¢ƒ', color: '#fa8c16', usageCount: 32, created_at: dayjs().subtract(25, 'day') },
            { id: 'env_dev', value: 'development', displayName: 'é–‹ç™¼ç’°å¢ƒ', color: '#52c41a', usageCount: 28, created_at: dayjs().subtract(20, 'day') },
            { id: 'env_test', value: 'testing', displayName: 'æ¸¬è©¦ç’°å¢ƒ', color: '#1890ff', usageCount: 15, created_at: dayjs().subtract(15, 'day') }
          ],
          totalUsage: 120,
          created_at: dayjs().subtract(30, 'day'),
          updated_at: dayjs().subtract(5, 'day')
        },
        {
          id: 'team_2',
          name: 'team',
          displayName: 'è² è²¬åœ˜éšŠ',
          description: 'è³‡æºæˆ–æœå‹™çš„è²¬ä»»åœ˜éšŠ',
          category: 'organization',
          required: false,
          values: [
            { id: 'team_fe', value: 'frontend', displayName: 'å‰ç«¯åœ˜éšŠ', color: '#722ed1', usageCount: 25, created_at: dayjs().subtract(20, 'day') },
            { id: 'team_be', value: 'backend', displayName: 'å¾Œç«¯åœ˜éšŠ', color: '#52c41a', usageCount: 35, created_at: dayjs().subtract(18, 'day') },
            { id: 'team_ops', value: 'devops', displayName: 'DevOps åœ˜éšŠ', color: '#1890ff', usageCount: 18, created_at: dayjs().subtract(15, 'day') },
            { id: 'team_qa', value: 'qa', displayName: 'QA åœ˜éšŠ', color: '#fa8c16', usageCount: 12, created_at: dayjs().subtract(12, 'day') },
            { id: 'team_data', value: 'data', displayName: 'æ•¸æ“šåœ˜éšŠ', color: '#13c2c2', usageCount: 8, created_at: dayjs().subtract(10, 'day') }
          ],
          totalUsage: 98,
          created_at: dayjs().subtract(25, 'day'),
          updated_at: dayjs().subtract(3, 'day')
        },
        {
          id: 'team_3',
          name: 'priority',
          displayName: 'å„ªå…ˆç´š',
          description: 'è³‡æºæˆ–äº‹ä»¶çš„å„ªå…ˆç´šåˆ¥',
          category: 'business',
          required: false,
          values: [
            { id: 'pri_crit', value: 'critical', displayName: 'ç·Šæ€¥', color: '#f5222d', usageCount: 8, created_at: dayjs().subtract(15, 'day') },
            { id: 'pri_high', value: 'high', displayName: 'é«˜', color: '#fa8c16', usageCount: 22, created_at: dayjs().subtract(12, 'day') },
            { id: 'pri_med', value: 'medium', displayName: 'ä¸­', color: '#1890ff', usageCount: 45, created_at: dayjs().subtract(10, 'day') },
            { id: 'pri_low', value: 'low', displayName: 'ä½', color: '#52c41a', usageCount: 31, created_at: dayjs().subtract(8, 'day') }
          ],
          totalUsage: 106,
          created_at: dayjs().subtract(15, 'day'),
          updated_at: dayjs().subtract(2, 'day')
        },
        {
          id: 'team_4',
          name: 'security-level',
          displayName: 'å®‰å…¨ç­‰ç´š',
          description: 'è³‡æºçš„å®‰å…¨åˆ†ç´šï¼Œç”¨æ–¼è¨ªå•æ§åˆ¶',
          category: 'security',
          required: true,
          values: [
            { id: 'sec_pub', value: 'public', displayName: 'å…¬é–‹', color: '#52c41a', usageCount: 45, created_at: dayjs().subtract(35, 'day') },
            { id: 'sec_int', value: 'internal', displayName: 'å…§éƒ¨', color: '#1890ff', usageCount: 38, created_at: dayjs().subtract(30, 'day') },
            { id: 'sec_conf', value: 'confidential', displayName: 'æ©Ÿå¯†', color: '#fa8c16', usageCount: 25, created_at: dayjs().subtract(25, 'day') },
            { id: 'sec_rest', value: 'restricted', displayName: 'é™åˆ¶', color: '#f5222d', usageCount: 12, created_at: dayjs().subtract(20, 'day') }
          ],
          totalUsage: 120,
          created_at: dayjs().subtract(35, 'day'),
          updated_at: dayjs().subtract(7, 'day')
        },
        {
          id: 'team_5',
          name: 'service-type',
          displayName: 'æœå‹™é¡å‹',
          description: 'æ‡‰ç”¨æˆ–æœå‹™çš„é¡å‹åˆ†é¡',
          category: 'application',
          required: false,
          values: [
            { id: 'svc_web', value: 'web-server', displayName: 'Web æœå‹™å™¨', color: '#52c41a', usageCount: 32, created_at: dayjs().subtract(25, 'day') },
            { id: 'svc_db', value: 'database', displayName: 'æ•¸æ“šåº«', color: '#1890ff', usageCount: 28, created_at: dayjs().subtract(22, 'day') },
            { id: 'svc_cache', value: 'cache', displayName: 'ç·©å­˜æœå‹™', color: '#fa8c16', usageCount: 15, created_at: dayjs().subtract(18, 'day') },
            { id: 'svc_lb', value: 'load-balancer', displayName: 'è² è¼‰å‡è¡¡å™¨', color: '#722ed1', usageCount: 12, created_at: dayjs().subtract(15, 'day') },
            { id: 'svc_api', value: 'api-gateway', displayName: 'API ç¶²é—œ', color: '#13c2c2', usageCount: 8, created_at: dayjs().subtract(12, 'day') }
          ],
          totalUsage: 95,
          created_at: dayjs().subtract(28, 'day'),
          updated_at: dayjs().subtract(4, 'day')
        }
      ];

      const [tags, setTags] = useLocalStorageState('sre-unified-tags', initialTags);
      const [selectedCategory, setSelectedCategory] = React.useState('all');
      const [searchText, setSearchText] = React.useState('');
      const [isTagModalOpen, setIsTagModalOpen] = React.useState(false);
      const [isValueModalOpen, setIsValueModalOpen] = React.useState(false);
      const [editingTag, setEditingTag] = React.useState(null);
      const [editingValue, setEditingValue] = React.useState(null);
      const [selectedTagForValue, setSelectedTagForValue] = React.useState(null);
      const [inlineEditingId, setInlineEditingId] = React.useState(null);
      const [inlineEditForm, setInlineEditForm] = React.useState({});
      const [displayNameManuallyChanged, setDisplayNameManuallyChanged] = React.useState(false);
      const [tagDisplayNameManuallyChanged, setTagDisplayNameManuallyChanged] = React.useState(false);
      const [selectedRowKeys, setSelectedRowKeys] = React.useState([]);
      const [tagForm] = Form.useForm();
      const [valueForm] = Form.useForm();
      const { modal, message } = antd.App.useApp();
      const confirmDelete = useDeleteConfirm();

      // è¨ˆç®—çµ±è¨ˆä¿¡æ¯
      const tagStats = React.useMemo(() => {
        const totalTags = tags.length;
        const totalValues = tags.reduce((sum, tag) => sum + tag.values.length, 0);
        const totalUsage = tags.reduce((sum, tag) => sum + tag.totalUsage, 0);
        const byCategory = tagCategories.map(cat => ({
          ...cat,
          count: tags.filter(tag => tag.category === cat.id).length
        }));

        return { totalTags, totalValues, totalUsage, byCategory };
      }, [tags]);

      // éæ¿¾æ•¸æ“š
      const filteredTags = React.useMemo(() => {
        return tags.filter(tag => {
          const matchesCategory = selectedCategory === 'all' || tag.category === selectedCategory;
          const matchesSearch = searchText === '' ||
            tag.name.toLowerCase().includes(searchText.toLowerCase()) ||
            tag.displayName.toLowerCase().includes(searchText.toLowerCase()) ||
            tag.description.toLowerCase().includes(searchText.toLowerCase()) ||
            tag.values.some(val =>
              val.value.toLowerCase().includes(searchText.toLowerCase()) ||
              val.displayName.toLowerCase().includes(searchText.toLowerCase())
            );
          return matchesCategory && matchesSearch;
        });
      }, [tags, selectedCategory, searchText]);

      // æ¨™ç±¤ç®¡ç†å‡½æ•¸
      const handleCreateTag = () => {
        setEditingTag(null);
        tagForm.resetFields();
        setIsTagModalOpen(true);
      };

      const handleEditTag = (record) => {
        setEditingTag(record);
        tagForm.setFieldsValue(record);
        setIsTagModalOpen(true);
      };

      const handleDeleteTag = (id) => {
        confirmDelete('æ¨™ç±¤', () => {
          setTags(prev => prev.filter(item => item.id !== id));
        });
      };

      const handleBatchDelete = () => {
        modal.confirm({
          title: `ç¢ºå®šè¦åˆªé™¤ ${selectedRowKeys.length} å€‹æ¨™ç±¤å—ï¼Ÿ`,
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setTags(tags.filter(t => !selectedRowKeys.includes(t.id)));
            setSelectedRowKeys([]);
            message.success('æ‰¹æ¬¡åˆªé™¤æˆåŠŸ');
          }
        });
      };

      const handleTagSubmit = (values) => {
        if (editingTag) {
          // ç·¨è¼¯ç¾æœ‰æ¨™ç±¤
          setTags(prev => prev.map(item =>
            item.id === editingTag.id
              ? { ...item, ...values, updated_at: dayjs() }
              : item
          ));
        } else {
          // æ–°å¢æ¨™ç±¤
          const newTag = {
            ...values,
            id: `t_${Date.now()}`,
            values: [],
            totalUsage: 0,
            created_at: dayjs(),
            updated_at: dayjs()
          };
          setTags(prev => [...prev, newTag]);
        }
        setIsTagModalOpen(false);
        tagForm.resetFields();
      };

      const handleTagCancel = () => {
        setIsTagModalOpen(false);
        tagForm.resetFields();
        setEditingTag(null);
        setTagDisplayNameManuallyChanged(false); // é‡ç½®è‡ªå‹•åŒæ­¥ç‹€æ…‹
      };

      // å€¼ç®¡ç†å‡½æ•¸
      const handleCreateValue = (tag) => {
        setSelectedTagForValue(tag);
        setEditingValue(null);
        valueForm.resetFields();
        setDisplayNameManuallyChanged(false); // é‡ç½®è‡ªå‹•åŒæ­¥ç‹€æ…‹
        setIsValueModalOpen(true);
      };

      const handleEditValue = (tag, value) => {
        setSelectedTagForValue(tag);
        setEditingValue(value);
        valueForm.setFieldsValue(value);
        setDisplayNameManuallyChanged(true); // ç·¨è¼¯æ¨¡å¼ä¸‹ä¸è‡ªå‹•åŒæ­¥
        setIsValueModalOpen(true);
      };

      // è™•ç†æ¨™ç±¤å€¼è¼¸å…¥è®ŠåŒ– - è‡ªå‹•åŒæ­¥åˆ°é¡¯ç¤ºåç¨±
      const handleValueInputChange = (e) => {
        const inputValue = e.target.value;
        // åªæœ‰åœ¨é¡¯ç¤ºåç¨±æ²’æœ‰è¢«æ‰‹å‹•ä¿®æ”¹éçš„æƒ…æ³ä¸‹æ‰è‡ªå‹•åŒæ­¥
        if (!displayNameManuallyChanged) {
          valueForm.setFieldValue('displayName', inputValue);
        }
      };

      // è™•ç†é¡¯ç¤ºåç¨±è¼¸å…¥è®ŠåŒ– - æ¨™è¨˜ç‚ºæ‰‹å‹•ä¿®æ”¹
      const handleDisplayNameChange = (e) => {
        setDisplayNameManuallyChanged(true);
      };

      // è™•ç†æ¨™ç±¤åç¨±è¼¸å…¥è®ŠåŒ– - è‡ªå‹•åŒæ­¥åˆ°é¡¯ç¤ºåç¨±
      const handleTagNameChange = (e) => {
        const inputValue = e.target.value;
        // åªæœ‰åœ¨é¡¯ç¤ºåç¨±æ²’æœ‰è¢«æ‰‹å‹•ä¿®æ”¹éçš„æƒ…æ³ä¸‹æ‰è‡ªå‹•åŒæ­¥
        if (!tagDisplayNameManuallyChanged) {
          tagForm.setFieldValue('displayName', inputValue);
        }
      };

      // è™•ç†æ¨™ç±¤é¡¯ç¤ºåç¨±è¼¸å…¥è®ŠåŒ– - æ¨™è¨˜ç‚ºæ‰‹å‹•ä¿®æ”¹
      const handleTagDisplayNameChange = (e) => {
        setTagDisplayNameManuallyChanged(true);
      };

      // è¡Œå…§ç·¨è¼¯ç›¸é—œå‡½æ•¸
      const handleInlineEdit = (value) => {
        setInlineEditingId(value.id);
        setInlineEditForm({
          value: value.value,
          displayName: value.displayName,
          color: value.color
        });
      };

      const handleInlineCancel = () => {
        setInlineEditingId(null);
        setInlineEditForm({});
      };

      const handleInlineSave = (tagId, valueId) => {
        setTags(prev => prev.map(tag =>
          tag.id === tagId
            ? {
              ...tag,
              values: tag.values.map(val =>
                val.id === valueId
                  ? { ...val, ...inlineEditForm }
                  : val
              )
            }
            : tag
        ));
        setInlineEditingId(null);
        setInlineEditForm({});
        message.success('æ¨™ç±¤å€¼å·²æ›´æ–°');
      };

      const handleDeleteValue = (tagId, valueId) => {
        setTags(prev => prev.map(tag =>
          tag.id === tagId
            ? {
              ...tag,
              values: tag.values.filter(val => val.id !== valueId),
              totalUsage: tag.values.filter(val => val.id !== valueId).reduce((sum, val) => sum + val.usageCount, 0),
              updated_at: dayjs()
            }
            : tag
        ));
      };

      const handleToggleRequired = (tagId, checked) => {
        setTags(prev => prev.map(tag =>
          tag.id === tagId
            ? { ...tag, required: checked, updated_at: dayjs() }
            : tag
        ));
      };

      const handleValueSubmit = (values) => {
        const processedValue = {
          ...values,
          id: editingValue ? editingValue.id : `val_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          usageCount: editingValue ? editingValue.usageCount : 0,
          created_at: editingValue ? editingValue.createdAt : dayjs()
        };

        setTags(prev => prev.map(tag => {
          if (tag.id === selectedTagForValue.id) {
            const updatedValues = editingValue
              ? tag.values.map(val => val.id === editingValue.id ? processedValue : val)
              : [...tag.values, processedValue];

            return {
              ...tag,
              values: updatedValues,
              totalUsage: updatedValues.reduce((sum, val) => sum + val.usageCount, 0),
              updated_at: dayjs()
            };
          }
          return tag;
        }));

        setIsValueModalOpen(false);
        valueForm.resetFields();
        setEditingValue(null);
        setSelectedTagForValue(null);
      };

      const handleValueCancel = () => {
        setIsValueModalOpen(false);
        valueForm.resetFields();
        setEditingValue(null);
        setSelectedTagForValue(null);
        setDisplayNameManuallyChanged(false); // é‡ç½®è‡ªå‹•åŒæ­¥ç‹€æ…‹
      };

      // è¡¨æ ¼æ¬„ä½
      const columns = [
        {
          title: 'æ¨™ç±¤åç¨±',
          dataIndex: 'name',
          key: 'name',
          width: '18%',
          sorter: (a, b) => a.name.localeCompare(b.name),
          render: (name, record) => (
            <div style={{ minWidth: 0 }}>
              <div style={{
                fontWeight: 600,
                fontSize: '14px',
                color: 'var(--text-primary)',
                marginBottom: '2px',
                textOverflow: 'ellipsis',
                overflow: 'hidden',
                whiteSpace: 'nowrap'
              }}>
                {record.displayName}
              </div>
              <div style={{
                fontSize: '12px',
                color: 'var(--text-tertiary)',
                fontFamily: 'monospace',
                textOverflow: 'ellipsis',
                overflow: 'hidden',
                whiteSpace: 'nowrap'
              }}>
                {name}
              </div>
            </div>
          ),
        },
        {
          title: 'åˆ†é¡',
          dataIndex: 'category',
          key: 'category',
          width: '12%',
          filters: tagCategories.map(cat => ({ text: cat.name, value: cat.id })),
          onFilter: (value, record) => record.category === value,
          render: (category) => {
            const cat = tagCategories.find(c => c.id === category);
            return cat ? (
              <div style={{
                display: 'inline-flex',
                alignItems: 'center',
                gap: '4px',
                padding: '3px 8px',
                background: `${cat.color}15`,
                border: `1px solid ${cat.color}30`,
                borderRadius: '12px',
                fontSize: '12px',
                fontWeight: 500
              }}>
                <div
                  style={{
                    width: '6px',
                    height: '6px',
                    borderRadius: '50%',
                    backgroundColor: cat.color,
                    flexShrink: 0
                  }}
                />
                <span style={{ color: cat.color }}>{cat.name}</span>
              </div>
            ) : null;
          },
        },
        {
          title: 'æ¨™ç±¤å€¼',
          dataIndex: 'values',
          key: 'values',
          width: '35%',
          render: (values, record) => {
            const displayValues = values.slice(0, 4);
            const hiddenCount = values.length - displayValues.length;

            const tooltipContent = (
              <div style={{
                display: 'flex',
                flexDirection: 'column',
                gap: '4px',
                maxWidth: '300px'
              }}>
                {values.map(val => (
                  <div key={val.id} style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    padding: '4px 0'
                  }}>
                    <div
                      style={{
                        width: '12px',
                        height: '12px',
                        borderRadius: '2px',
                        backgroundColor: val.color,
                        flexShrink: 0
                      }}
                    />
                    <span style={{ fontWeight: 500 }}>{val.displayName}</span>
                    <span style={{ color: 'var(--text-tertiary)', fontSize: '12px' }}>({val.value})</span>
                  </div>
                ))}
              </div>
            );

            return (
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px', flexWrap: 'wrap' }}>
                <Space wrap size={[4, 4]} align="center" style={{ flex: 1 }}>
                  {displayValues.map(val => (
                    <div key={val.id} style={{
                      display: 'inline-flex',
                      alignItems: 'center',
                      gap: '4px',
                      padding: '2px 6px',
                      background: `${val.color}20`,
                      border: `1px solid ${val.color}40`,
                      borderRadius: '4px',
                      fontSize: '12px',
                      fontWeight: 500
                    }}>
                      <div
                        style={{
                          width: '6px',
                          height: '6px',
                          borderRadius: '50%',
                          backgroundColor: val.color,
                          flexShrink: 0
                        }}
                      />
                      <span style={{ color: val.color }}>{val.displayName}</span>
                    </div>
                  ))}
                  {hiddenCount > 0 && (
                    <Tooltip title={tooltipContent} placement="topLeft">
                      <div style={{
                        display: 'inline-flex',
                        alignItems: 'center',
                        padding: '2px 6px',
                        background: 'rgba(255,255,255,0.1)',
                        border: '1px solid rgba(255,255,255,0.2)',
                        borderRadius: '4px',
                        fontSize: '12px',
                        cursor: 'pointer',
                        color: 'var(--text-secondary)'
                      }}>
                        +{hiddenCount}
                      </div>
                    </Tooltip>
                  )}
                </Space>
                <Tooltip title="æ–°å¢æ¨™ç±¤å€¼">
                  <Button
                    type="text"
                    size="small"
                    icon={<PlusOutlined />}
                    onClick={() => handleCreateValue(record)}
                    style={{
                      width: '24px',
                      height: '24px',
                      padding: 0,
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      fontSize: '12px',
                      color: 'var(--text-tertiary)',
                      borderRadius: '4px'
                    }}
                  />
                </Tooltip>
              </div>
            )
          }
        },
        {
          title: 'å¿…å¡«',
          dataIndex: 'required',
          key: 'required',
          width: '8%',
          filters: [
            { text: 'å¿…å¡«', value: true },
            { text: 'é¸å¡«', value: false },
          ],
          onFilter: (value, record) => record.required === value,
          render: (required, record) => (
            <Tooltip title={`é–‹å•Ÿå¾Œï¼Œæ‰€æœ‰'ç”Ÿç”¢ç’°å¢ƒ'çš„'è³‡æ–™åº«'é¡å‹è³‡æºéƒ½å¿…é ˆåŒ…å«æ­¤æ¨™ç±¤ã€‚`}>
              <Switch checked={required} onChange={(checked) => handleToggleRequired(record.id, checked)} />
            </Tooltip>
          ),
        },
        {
          title: 'ä½¿ç”¨æ¬¡æ•¸',
          dataIndex: 'totalUsage',
          key: 'totalUsage',
          width: '10%',
          sorter: (a, b) => a.totalUsage - b.totalUsage,
          render: (count) => (
            <div style={{
              display: 'flex',
              alignItems: 'center',
              gap: '6px'
            }}>
              <div style={{
                width: '8px',
                height: '8px',
                borderRadius: '50%',
                backgroundColor: count > 50 ? '#52c41a' : count > 10 ? '#fa8c16' : 'var(--text-tertiary)'
              }} />
              <Text style={{
                color: count > 50 ? '#52c41a' : count > 10 ? '#fa8c16' : 'var(--text-tertiary)',
                fontSize: '13px',
                fontWeight: 500
              }}>
                {count.toLocaleString()}
              </Text>
            </div>
          ),
        },
        {
          title: 'æ“ä½œ',
          key: 'action',
          width: '15%',
          fixed: 'right',
          render: (_, record) => (
            <Space size="small" style={{ display: 'flex', justifyContent: 'flex-end' }}>
              <Tooltip title="æ–°å¢å€¼">
                <Button
                  type="text"
                  size="small"
                  icon={<PlusOutlined />}
                  onClick={() => handleCreateValue(record)}
                  style={{
                    width: '28px',
                    height: '28px',
                    padding: 0,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '12px'
                  }}
                />
              </Tooltip>
              <Tooltip title="ç·¨è¼¯">
                <Button
                  type="text"
                  size="small"
                  icon={<EditOutlined />}
                  onClick={() => handleEditTag(record)}
                  style={{
                    width: '28px',
                    height: '28px',
                    padding: 0,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '12px'
                  }}
                />
              </Tooltip>
              <Tooltip title="åˆªé™¤">
                <Button
                  type="text"
                  danger
                  size="small"
                  icon={<DeleteOutlined />}
                  onClick={() => handleDeleteTag(record.id)}
                  style={{
                    width: '28px',
                    height: '28px',
                    padding: 0,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '12px'
                  }}
                />
              </Tooltip>
            </Space>
          ),
        },
      ];

      const onSelectChange = (newSelectedRowKeys) => setSelectedRowKeys(newSelectedRowKeys);
      const rowSelection = { selectedRowKeys, onChange: onSelectChange, columnWidth: 32 };
      const hasSelected = selectedRowKeys.length > 0;

      return (
        <React.Fragment>

          {/* åˆ†é¡ç¯©é¸å€ */}
          <div style={{
            display: 'flex',
            alignItems: 'center',
            gap: '16px',
            marginBottom: 'var(--spacing-lg)',
            flexWrap: 'wrap'
          }}>
            <Button.Group style={{
              borderRadius: '8px',
              overflow: 'hidden',
              boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',
              border: '1px solid rgba(255, 255, 255, 0.15)'
            }}>
              <Button
                type={selectedCategory === 'all' ? 'primary' : 'default'}
                onClick={() => setSelectedCategory('all')}
                style={{
                  height: '36px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  padding: '0 16px',
                  fontWeight: 500,
                  border: 'none',
                  borderRadius: '0',
                  background: selectedCategory === 'all' ? '#1890ff' : 'rgba(255, 255, 255, 0.05)',
                  color: selectedCategory === 'all' ? '#fff' : 'rgba(255, 255, 255, 0.85)',
                  borderRight: '1px solid rgba(255, 255, 255, 0.1)',
                  transition: 'all 0.2s ease'
                }}
              >
                <span style={{ fontSize: '13px' }}>å…¨éƒ¨</span>
                <div style={{
                  background: selectedCategory === 'all' ? 'rgba(255, 255, 255, 0.25)' : 'rgba(24, 144, 255, 0.15)',
                  color: selectedCategory === 'all' ? '#fff' : '#1890ff',
                  padding: '2px 6px',
                  borderRadius: '8px',
                  fontSize: '11px',
                  fontWeight: 600,
                  minWidth: '20px',
                  textAlign: 'center',
                  lineHeight: '14px'
                }}>
                  {tagStats.totalTags}
                </div>
              </Button>
              {tagStats.byCategory.map((cat, index) => (
                <Button
                  key={cat.id}
                  type={selectedCategory === cat.id ? 'primary' : 'default'}
                  onClick={() => setSelectedCategory(cat.id)}
                  style={{
                    height: '36px',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    padding: '0 14px',
                    fontWeight: 500,
                    border: 'none',
                    borderRadius: '0',
                    background: selectedCategory === cat.id ? cat.color : 'rgba(255, 255, 255, 0.05)',
                    color: selectedCategory === cat.id ? '#fff' : 'rgba(255, 255, 255, 0.85)',
                    borderRight: index < tagStats.byCategory.length - 1 ? '1px solid rgba(255, 255, 255, 0.1)' : 'none',
                    transition: 'all 0.2s ease'
                  }}
                >
                  <div style={{
                    width: '6px',
                    height: '6px',
                    borderRadius: '50%',
                    background: selectedCategory === cat.id ? '#fff' : cat.color,
                    opacity: selectedCategory === cat.id ? 0.9 : 0.8
                  }} />
                  <span style={{ fontSize: '13px' }}>
                    {cat.name}
                  </span>
                  <div style={{
                    background: selectedCategory === cat.id ? 'rgba(255, 255, 255, 0.25)' : `${cat.color}20`,
                    color: selectedCategory === cat.id ? '#fff' : cat.color,
                    padding: '2px 6px',
                    borderRadius: '8px',
                    fontSize: '11px',
                    fontWeight: 600,
                    minWidth: '18px',
                    textAlign: 'center',
                    lineHeight: '14px'
                  }}>
                    {cat.count}
                  </div>
                </Button>
              ))}
            </Button.Group>
          </div>

          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="æœå°‹æ¨™ç±¤åç¨±æˆ–å€¼..."
                onChange={(e) => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
                value={searchText}
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                ç¯©é¸
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={handleCreateTag}>
                æ–°å¢æ¨™ç±¤
              </Button>
            </Space>
          </Space>

          {hasSelected && (
            <div className="batch-actions-floating">
              <div className="batch-info">
                <CheckCircleOutlined style={{ color: 'var(--brand-primary)' }} />
                <span>å·²é¸æ“‡ <span className="batch-count">{selectedRowKeys.length}</span> é …</span>
              </div>
              <Space>
                <Button className="batch-action-button danger-button" onClick={handleBatchDelete}>æ‰¹æ¬¡åˆªé™¤</Button>
              </Space>
              <Button type="text" icon={<CloseOutlined />} onClick={() => setSelectedRowKeys([])} />
            </div>
          )}

          {/* æ¨™ç±¤è¡¨æ ¼ */}
          <div className="table-wrapper">
            {
              filteredTags.length > 0 ?
                <Table
                  rowSelection={rowSelection}
                  columns={[
                    {
                      title: 'æ¨™ç±¤åç¨±',
                      dataIndex: 'name',
                      key: 'name',
                      width: '15%',
                      sorter: (a, b) => a.name.localeCompare(b.name),
                      render: (text, record) => (
                        <div style={{ padding: '4px 0' }}>
                          <div style={{
                            fontWeight: 600,
                            fontSize: '14px',
                            color: 'rgba(255, 255, 255, 0.9)',
                            marginBottom: '4px',
                            letterSpacing: '0.3px'
                          }}>
                            {record.displayName}
                          </div>
                          <div style={{
                            fontSize: '11px',
                            color: 'rgba(255, 255, 255, 0.5)',
                            fontFamily: 'SFMono-Regular, Consolas, "Liberation Mono", Menlo, Courier, monospace',
                            background: 'rgba(255, 255, 255, 0.05)',
                            padding: '2px 6px',
                            borderRadius: '4px',
                            border: '1px solid rgba(255, 255, 255, 0.1)',
                            display: 'inline-block'
                          }}>
                            {text}
                          </div>
                        </div>
                      ),
                    },
                    {
                      title: 'åˆ†é¡',
                      dataIndex: 'category',
                      key: 'category',
                      width: '12%',
                      filters: tagCategories.map(cat => ({ text: cat.name, value: cat.id })),
                      onFilter: (value, record) => record.category === value,
                      render: (category) => {
                        const cat = tagCategories.find(c => c.id === category);
                        return cat ? (
                          <div style={{
                            display: 'inline-flex',
                            alignItems: 'center',
                            gap: '6px',
                            background: `${cat.color}15`,
                            border: `1px solid ${cat.color}40`,
                            borderRadius: '18px',
                            padding: '4px 12px',
                            fontSize: '12px',
                            fontWeight: 500,
                            color: 'rgba(255, 255, 255, 0.9)',
                            whiteSpace: 'nowrap'
                          }}>
                            <div style={{
                              width: '6px',
                              height: '6px',
                              borderRadius: '50%',
                              background: cat.color,
                              flexShrink: 0
                            }} />
                            <span>{cat.name}</span>
                          </div>
                        ) : null;
                      },
                    },
                    {
                      title: 'æ¨™ç±¤å€¼',
                      key: 'values',
                      width: '45%',
                      render: (_, record) => {
                        const maxDisplay = 3; // æœ€å¤šé¡¯ç¤º3å€‹
                        const displayValues = record.values.slice(0, maxDisplay);
                        const hiddenCount = record.values.length - displayValues.length;

                        return (
                          <div style={{
                            display: 'flex',
                            flexWrap: 'wrap',
                            gap: '6px',
                            alignItems: 'center',
                            minHeight: '24px'
                          }}>
                            {displayValues.map(value => (
                              <div
                                key={value.id}
                                style={{
                                  display: 'inline-flex',
                                  alignItems: 'center',
                                  gap: '4px',
                                  padding: '3px 8px',
                                  fontSize: '12px',
                                  fontWeight: 500,
                                  borderRadius: '4px',
                                  background: `${value.color || '#666'}20`,
                                  border: `1px solid ${value.color || '#666'}40`,
                                  color: value.color || '#fff',
                                  cursor: 'pointer',
                                  transition: 'all 0.2s ease'
                                }}
                                onClick={() => handleEditValue(record, value)}
                                onMouseEnter={(e) => {
                                  e.target.style.background = `${value.color || '#666'}30`;
                                  e.target.style.borderColor = `${value.color || '#666'}60`;
                                }}
                                onMouseLeave={(e) => {
                                  e.target.style.background = `${value.color || '#666'}20`;
                                  e.target.style.borderColor = `${value.color || '#666'}40`;
                                }}
                              >
                                <div style={{
                                  width: '6px',
                                  height: '6px',
                                  borderRadius: '50%',
                                  backgroundColor: value.color || '#666',
                                  flexShrink: 0
                                }} />
                                <span>{value.displayName}</span>
                              </div>
                            ))}
                            {hiddenCount > 0 && (
                              <Tooltip
                                title={
                                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px', maxWidth: '300px' }}>
                                    {record.values.slice(maxDisplay).map(val => (
                                      <div
                                        key={val.id}
                                        style={{
                                          display: 'inline-flex',
                                          alignItems: 'center',
                                          gap: '3px',
                                          padding: '2px 6px',
                                          fontSize: '11px',
                                          fontWeight: 500,
                                          borderRadius: '4px',
                                          background: `${val.color || '#666'}25`,
                                          border: `1px solid ${val.color || '#666'}50`,
                                          color: val.color || '#fff'
                                        }}
                                      >
                                        <div style={{
                                          width: '4px',
                                          height: '4px',
                                          borderRadius: '50%',
                                          backgroundColor: val.color || '#666'
                                        }} />
                                        <span>{val.displayName}</span>
                                      </div>
                                    ))}
                                  </div>
                                }
                                placement="topLeft"
                              >
                                <div style={{
                                  display: 'inline-flex',
                                  alignItems: 'center',
                                  justifyContent: 'center',
                                  background: 'rgba(255, 255, 255, 0.1)',
                                  color: 'rgba(255, 255, 255, 0.7)',
                                  padding: '2px 8px',
                                  borderRadius: '12px',
                                  fontSize: '11px',
                                  cursor: 'pointer',
                                  border: '1px solid rgba(255, 255, 255, 0.15)',
                                  transition: 'all 0.2s ease'
                                }}>
                                  +{hiddenCount}
                                </div>
                              </Tooltip>
                            )}
                            {record.values.length === 0 && (
                              <span style={{
                                color: 'rgba(255, 255, 255, 0.4)',
                                fontSize: '12px',
                                fontStyle: 'italic'
                              }}>
                                æš«ç„¡å€¼
                              </span>
                            )}
                          </div>
                        );
                      },
                    },
                    {
                      title: 'å¿…å¡«',
                      dataIndex: 'required',
                      key: 'required',
                      width: '8%',
                      align: 'center',
                      filters: [
                        { text: 'å¿…å¡«', value: true },
                        { text: 'é¸å¡«', value: false },
                      ],
                      onFilter: (value, record) => record.required === value,
                      render: (required) => (
                        <div style={{ display: 'flex', justifyContent: 'center' }}>
                          <div style={{
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            width: '18px',
                            height: '18px',
                            borderRadius: '50%',
                            background: required ? 'rgba(245, 34, 45, 0.1)' : 'rgba(255, 255, 255, 0.05)',
                            border: `1px solid ${required ? 'rgba(245, 34, 45, 0.3)' : 'rgba(255, 255, 255, 0.15)'}`,
                            fontSize: '11px',
                            fontWeight: 600,
                            color: required ? '#f5222d' : 'rgba(255, 255, 255, 0.5)',
                            lineHeight: 1
                          }}>
                            {required ? '!' : ''}
                          </div>
                        </div>
                      ),
                    },
                    {
                      title: 'ä½¿ç”¨æ¬¡æ•¸',
                      dataIndex: 'totalUsage',
                      key: 'totalUsage',
                      width: '8%',
                      sorter: (a, b) => a.totalUsage - b.totalUsage,
                      render: (count) => (
                        <Text style={{ color: 'rgba(255, 255, 255, 0.9)' }}>
                          {count.toLocaleString()}
                        </Text>
                      ),
                    },
                    {
                      title: 'æ“ä½œ',
                      key: 'action',
                      width: '20%',
                      align: 'center',
                      fixed: 'right',
                      render: (_, record) => (
                        <div style={{
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          gap: '4px'
                        }}>
                          <Tooltip title="æ–°å¢å€¼">
                            <Button
                              type="text"
                              size="small"
                              icon={<PlusOutlined />}
                              onClick={() => handleCreateValue(record)}
                              style={{
                                width: '28px',
                                height: '28px',
                                padding: 0,
                                fontSize: '12px',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                borderRadius: '4px',
                                color: 'var(--brand-primary)',
                                backgroundColor: 'transparent',
                                border: '1px solid var(--brand-primary)',
                                transition: 'all 0.2s ease'
                              }}
                            />
                          </Tooltip>
                          <Tooltip title="ç·¨è¼¯">
                            <Button
                              type="text"
                              size="small"
                              icon={<EditOutlined />}
                              onClick={() => handleEditTag(record)}
                              style={{
                                width: '28px',
                                height: '28px',
                                padding: 0,
                                fontSize: '12px',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                borderRadius: '4px',
                                color: 'var(--text-tertiary)'
                              }}
                            />
                          </Tooltip>
                          <Tooltip title="åˆªé™¤">
                            <Button
                              type="text"
                              danger
                              size="small"
                              icon={<DeleteOutlined />}
                              onClick={() => handleDeleteTag(record.id)}
                              style={{
                                width: '28px',
                                height: '28px',
                                padding: 0,
                                fontSize: '12px',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                borderRadius: '4px'
                              }}
                            />
                          </Tooltip>
                        </div>
                      ),
                    },
                  ]}
                  dataSource={filteredTags}
                  rowKey="id"
                  scroll={{ x: 1100 }}
                  pagination={{
                    total: filteredTags.length,
                    pageSize: 10,
                    showSizeChanger: true,
                    showQuickJumper: true,
                    showTotal: (total, range) => `ç¬¬ ${range[0]}-${range[1]} é …ï¼Œå…± ${total} é …`,
                    responsive: true,
                    position: ['bottomRight'],
                    size: 'small'
                  }}
                  locale={{
                    emptyText: (
                      <div style={{ padding: '40px 20px', textAlign: 'center' }}>
                        <div style={{ fontSize: '48px', marginBottom: '16px', opacity: 0.3 }}>ğŸ·ï¸</div>
                        <div style={{ color: 'rgba(255, 255, 255, 0.7)', marginBottom: '8px' }}>æš«ç„¡æ¨™ç±¤è³‡æ–™</div>
                        <div style={{ color: 'rgba(255, 255, 255, 0.5)', fontSize: '12px' }}>å»ºç«‹ç¬¬ä¸€å€‹æ¨™ç±¤ä¾†é–‹å§‹ç®¡ç†</div>
                      </div>
                    )
                  }}
                  size="small"
                  className="transparent-bg"
                  rowClassName={(record) =>
                    record.required ? 'required-tag-row' : ''
                  }
                /> :
                <Empty description="å°šç„¡ä»»ä½•æ¨™ç±¤">
                  <Button type="primary" icon={<PlusOutlined />} onClick={handleCreateTag}>ç«‹å³æ–°å¢æ¨™ç±¤</Button>
                </Empty>
            }
          </div>

          {/* æ–°å¢/ç·¨è¼¯æ¨™ç±¤å½ˆçª— */}
          <Modal
            title={editingTag ? 'ç·¨è¼¯æ¨™ç±¤' : 'æ–°å¢æ¨™ç±¤'}
            open={isTagModalOpen}
            onCancel={handleTagCancel}
            footer={null}
            width={600}
          >
            <Form
              form={tagForm}
              layout="vertical"
              onFinish={handleTagSubmit}
              autoComplete="off"
            >
              <Row gutter={16}>
                <Col span={12}>
                  <Form.Item
                    label="æ¨™ç±¤åç¨±"
                    name="name"
                    rules={[
                      { required: true, message: 'è«‹è¼¸å…¥æ¨™ç±¤åç¨±' },
                      { pattern: /^[a-z][a-z0-9_-]*$/, message: 'åªèƒ½åŒ…å«å°å¯«å­—æ¯ã€æ•¸å­—ã€ä¸‹åŠƒç·šå’Œé€£å­—ç¬¦ï¼Œä¸”é ˆä»¥å­—æ¯é–‹é ­' },
                      { max: 50, message: 'æ¨™ç±¤åç¨±ä¸èƒ½è¶…é50å€‹å­—ç¬¦' }
                    ]}
                  >
                    <Input placeholder="ä¾‹å¦‚ï¼šenvironment, team" onChange={handleTagNameChange} />
                  </Form.Item>
                </Col>
                <Col span={12}>
                  <Form.Item
                    label={
                      <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                        <span>é¡¯ç¤ºåç¨±</span>
                        {!tagDisplayNameManuallyChanged && (
                          <span style={{
                            fontSize: '11px',
                            color: 'rgba(255, 255, 255, 0.5)',
                            fontWeight: 400,
                            fontStyle: 'italic'
                          }}>
                            (è‡ªå‹•åŒæ­¥)
                          </span>
                        )}
                      </div>
                    }
                    name="displayName"
                    rules={[
                      { required: true, message: 'è«‹è¼¸å…¥é¡¯ç¤ºåç¨±' },
                      { max: 100, message: 'é¡¯ç¤ºåç¨±ä¸èƒ½è¶…é100å€‹å­—ç¬¦' }
                    ]}
                  >
                    <Input placeholder="ä¾‹å¦‚ï¼šç’°å¢ƒ, åœ˜éšŠ" onChange={handleTagDisplayNameChange} />
                  </Form.Item>
                </Col>
              </Row>

              <Row gutter={16}>
                <Col span={12}>
                  <Form.Item
                    label="åˆ†é¡"
                    name="category"
                    rules={[{ required: true, message: 'è«‹é¸æ“‡åˆ†é¡' }]}
                  >
                    <Select placeholder="é¸æ“‡æ¨™ç±¤åˆ†é¡">
                      {tagCategories.map(cat => (
                        <Select.Option key={cat.id} value={cat.id}>
                          <div style={{
                            display: 'inline-flex',
                            alignItems: 'center',
                            gap: '6px',
                            padding: '0 12px',
                            height: '26px',
                            background: `${cat.color}15`,
                            border: `1px solid ${cat.color}30`,
                            borderRadius: '12px',
                            fontSize: '12px',
                            fontWeight: 500,
                            color: cat.color,
                            margin: '7px 0',
                            boxSizing: 'border-box'
                          }}>
                            <div style={{
                              width: '6px',
                              height: '6px',
                              borderRadius: '50%',
                              backgroundColor: cat.color,
                              flexShrink: 0
                            }} />
                            <span>{cat.name}</span>
                          </div>
                        </Select.Option>
                      ))}
                    </Select>
                  </Form.Item>
                </Col>
                <Col span={12}>
                  <Form.Item
                    name="required"
                    valuePropName="checked"
                  >
                    <Checkbox>å¿…å¡«æ¨™ç±¤</Checkbox>
                  </Form.Item>
                </Col>
              </Row>

              <Form.Item
                label="æè¿°"
                name="description"
                rules={[
                  { required: true, message: 'è«‹è¼¸å…¥æè¿°' },
                  { max: 500, message: 'æè¿°ä¸èƒ½è¶…é500å€‹å­—ç¬¦' }
                ]}
              >
                <Input.TextArea
                  rows={3}
                  placeholder="è«‹è©³ç´°æè¿°æ­¤æ¨™ç±¤çš„ç”¨é€”å’Œä½¿ç”¨å ´æ™¯..."
                  showCount
                  maxLength={500}
                />
              </Form.Item>

              <Form.Item style={{ marginBottom: 0, marginTop: '24px' }}>
                <div style={{
                  display: 'flex',
                  justifyContent: 'flex-end',
                  gap: '8px'
                }}>
                  <Button onClick={handleTagCancel}>
                    å–æ¶ˆ
                  </Button>
                  <Button type="primary" htmlType="submit">
                    {editingTag ? 'æ›´æ–°' : 'å‰µå»º'}
                  </Button>
                </div>
              </Form.Item>
            </Form>
          </Modal>

          {/* ç®¡ç†æ¨™ç±¤å€¼å½ˆçª— */}
          <Modal
            title={
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <SettingOutlined />
                <span>ç®¡ç†æ¨™ç±¤å€¼: {selectedTagForValue?.displayName}</span>
              </div>
            }
            open={isValueModalOpen}
            onCancel={handleValueCancel}
            footer={null}
            width={800}
            style={{ top: 20 }}
          >
            <div style={{ display: 'flex', gap: '24px', minHeight: '500px' }}>
              {/* å·¦å´ï¼šè¡¨å–®å€åŸŸ */}
              <div style={{
                flex: '0 0 320px',
                padding: '20px',
                background: 'rgba(255, 255, 255, 0.03)',
                borderRadius: '8px',
                border: '1px solid rgba(255, 255, 255, 0.08)'
              }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  marginBottom: '20px',
                  paddingBottom: '16px',
                  borderBottom: '1px solid rgba(255, 255, 255, 0.1)'
                }}>
                  <div style={{
                    width: '6px',
                    height: '6px',
                    borderRadius: '50%',
                    background: '#1890ff'
                  }} />
                  <h4 style={{
                    margin: 0,
                    color: 'rgba(255, 255, 255, 0.9)',
                    fontSize: '14px',
                    fontWeight: 600
                  }}>
                    {editingValue ? 'ç·¨è¼¯æ¨™ç±¤å€¼' : 'æ–°å¢æ¨™ç±¤å€¼'}
                  </h4>
                </div>

                <Form
                  form={valueForm}
                  layout="vertical"
                  onFinish={handleValueSubmit}
                  autoComplete="off"
                >
                  <Form.Item
                    name="value"
                    label="æ¨™ç±¤å€¼"
                    rules={[{ required: true, message: 'è«‹è¼¸å…¥æ¨™ç±¤å€¼' }]}
                    style={{ marginBottom: '20px' }}
                  >
                    <Input
                      placeholder="ä¾‹å¦‚: production, staging"
                      onChange={handleValueInputChange}
                      style={{
                        background: 'rgba(255, 255, 255, 0.05)',
                        border: '1px solid rgba(255, 255, 255, 0.15)',
                        color: 'rgba(255, 255, 255, 0.9)'
                      }}
                    />
                  </Form.Item>

                  <Form.Item
                    name="displayName"
                    label={
                      <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                        <span>é¡¯ç¤ºåç¨±</span>
                        {!displayNameManuallyChanged && (
                          <span style={{
                            fontSize: '11px',
                            color: 'rgba(255, 255, 255, 0.5)',
                            fontWeight: 400,
                            fontStyle: 'italic'
                          }}>
                            (è‡ªå‹•åŒæ­¥)
                          </span>
                        )}
                      </div>
                    }
                    rules={[{ required: true, message: 'è«‹è¼¸å…¥é¡¯ç¤ºåç¨±' }]}
                    style={{ marginBottom: '20px' }}
                  >
                    <Input
                      placeholder="ä¾‹å¦‚: ç”Ÿç”¢ç’°å¢ƒ, æ¸¬è©¦ç’°å¢ƒ"
                      onChange={handleDisplayNameChange}
                      style={{
                        background: 'rgba(255, 255, 255, 0.05)',
                        border: '1px solid rgba(255, 255, 255, 0.15)',
                        color: 'rgba(255, 255, 255, 0.9)'
                      }}
                    />
                  </Form.Item>

                  <Form.Item
                    name="color"
                    label="é¡è‰²"
                    rules={[{ required: true, message: 'è«‹é¸æ“‡é¡è‰²' }]}
                    style={{ marginBottom: '24px' }}
                  >
                    <Select placeholder="é¸æ“‡é¡è‰²">
                      {['#f5222d', '#fa541c', '#fa8c16', '#faad14', '#fadb14', '#a0d911', '#52c41a', '#13c2c2', '#1890ff', '#2f54eb', '#722ed1', '#eb2f96'].map(color => (
                        <Select.Option key={color} value={color}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                            <div style={{ width: '16px', height: '16px', backgroundColor: color, borderRadius: '4px' }}></div>
                            <span style={{ fontFamily: 'monospace', fontSize: '12px' }}>{color}</span>
                          </div>
                        </Select.Option>
                      ))}
                    </Select>
                  </Form.Item>

                  <div style={{ display: 'flex', gap: '8px', justifyContent: 'flex-end' }}>
                    {editingValue && (
                      <Button
                        onClick={() => {
                          setEditingValue(null);
                          valueForm.resetFields();
                        }}
                        style={{
                          background: 'rgba(255, 255, 255, 0.05)',
                          border: '1px solid rgba(255, 255, 255, 0.15)',
                          color: 'rgba(255, 255, 255, 0.7)'
                        }}
                      >
                        å–æ¶ˆ
                      </Button>
                    )}
                    <Button type="primary" htmlType="submit">
                      {editingValue ? 'æ›´æ–°' : 'æ–°å¢'}
                    </Button>
                  </div>
                </Form>
              </div>

              {/* å³å´ï¼šåˆ—è¡¨å€åŸŸ */}
              <div style={{ flex: 1 }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'space-between',
                  marginBottom: '16px',
                  paddingBottom: '12px',
                  borderBottom: '1px solid rgba(255, 255, 255, 0.1)'
                }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <h4 style={{
                      margin: 0,
                      color: 'rgba(255, 255, 255, 0.9)',
                      fontSize: '14px',
                      fontWeight: 600
                    }}>
                      ç¾æœ‰å€¼åˆ—è¡¨ ({selectedTagForValue?.values?.length || 0})
                    </h4>
                  </div>
                </div>

                <div style={{
                  maxHeight: '420px',
                  overflowY: 'auto',
                  paddingRight: '8px'
                }}>
                  {(selectedTagForValue?.values || []).length > 0 ? (
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                      {selectedTagForValue.values.map((item) => (
                        <div
                          key={item.id}
                          style={{
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'space-between',
                            padding: '12px 16px',
                            background: 'rgba(255, 255, 255, 0.03)',
                            border: '1px solid rgba(255, 255, 255, 0.08)',
                            borderRadius: '6px',
                            transition: 'all 0.2s ease'
                          }}
                          onMouseEnter={(e) => {
                            e.target.style.background = 'rgba(255, 255, 255, 0.05)';
                            e.target.style.borderColor = 'rgba(255, 255, 255, 0.15)';
                          }}
                          onMouseLeave={(e) => {
                            e.target.style.background = 'rgba(255, 255, 255, 0.03)';
                            e.target.style.borderColor = 'rgba(255, 255, 255, 0.08)';
                          }}
                        >
                          <div style={{ display: 'flex', alignItems: 'center', gap: '12px', flex: 1 }}>
                            {/* é¡è‰²é¸æ“‡å™¨ - ç·¨è¼¯æ¨¡å¼æˆ–æ™®é€šæ¨¡å¼ */}
                            {inlineEditingId === item.id ? (
                              <Select
                                value={inlineEditForm.color}
                                onChange={(color) => setInlineEditForm(prev => ({ ...prev, color }))}
                                style={{
                                  width: '80px',
                                  background: 'rgba(255, 255, 255, 0.05)',
                                  border: '1px solid rgba(255, 255, 255, 0.15)'
                                }}
                                size="small"
                                dropdownStyle={{ backgroundColor: '#1f1f1f', border: '1px solid rgba(255, 255, 255, 0.15)' }}
                              >
                                {['#f5222d', '#fa541c', '#fa8c16', '#faad14', '#fadb14', '#a0d911', '#52c41a', '#13c2c2', '#1890ff', '#2f54eb', '#722ed1', '#eb2f96'].map(color => (
                                  <Select.Option key={color} value={color}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                                      <div style={{ width: '12px', height: '12px', backgroundColor: color, borderRadius: '50%' }}></div>
                                    </div>
                                  </Select.Option>
                                ))}
                              </Select>
                            ) : (
                              <div style={{
                                width: '12px',
                                height: '12px',
                                backgroundColor: item.color,
                                borderRadius: '50%'
                              }} />
                            )}

                            <div style={{ flex: 1 }}>
                              {/* é¡¯ç¤ºåç¨± - ç·¨è¼¯æ¨¡å¼æˆ–æ™®é€šæ¨¡å¼ */}
                              {inlineEditingId === item.id ? (
                                <Input
                                  value={inlineEditForm.displayName}
                                  onChange={(e) => setInlineEditForm(prev => ({ ...prev, displayName: e.target.value }))}
                                  size="small"
                                  style={{
                                    marginBottom: '4px',
                                    background: 'rgba(255, 255, 255, 0.05)',
                                    border: '1px solid rgba(255, 255, 255, 0.15)',
                                    color: 'rgba(255, 255, 255, 0.9)'
                                  }}
                                />
                              ) : (
                                <div style={{
                                  color: 'rgba(255, 255, 255, 0.9)',
                                  fontWeight: 500,
                                  fontSize: '13px',
                                  marginBottom: '2px'
                                }}>
                                  {item.displayName}
                                </div>
                              )}

                              {/* æ¨™ç±¤å€¼ - ç·¨è¼¯æ¨¡å¼æˆ–æ™®é€šæ¨¡å¼ */}
                              {inlineEditingId === item.id ? (
                                <Input
                                  value={inlineEditForm.value}
                                  onChange={(e) => setInlineEditForm(prev => ({ ...prev, value: e.target.value }))}
                                  size="small"
                                  style={{
                                    fontFamily: 'monospace',
                                    background: 'rgba(255, 255, 255, 0.05)',
                                    border: '1px solid rgba(255, 255, 255, 0.15)',
                                    color: 'rgba(255, 255, 255, 0.9)'
                                  }}
                                />
                              ) : (
                                <div style={{
                                  display: 'flex',
                                  alignItems: 'center',
                                  gap: '8px',
                                  fontSize: '11px',
                                  color: 'rgba(255, 255, 255, 0.6)'
                                }}>
                                  <span style={{ fontFamily: 'monospace' }}>{item.value}</span>
                                  <span>â€¢</span>
                                  <span>ä½¿ç”¨ {item.usageCount} æ¬¡</span>
                                </div>
                              )}
                            </div>
                          </div>
                          <div style={{ display: 'flex', gap: '4px' }}>
                            {inlineEditingId === item.id ? (
                              // ç·¨è¼¯æ¨¡å¼ï¼šé¡¯ç¤ºå„²å­˜å’Œå–æ¶ˆæŒ‰éˆ•
                              <>
                                <Tooltip title="å„²å­˜">
                                  <Button
                                    type="text"
                                    size="small"
                                    icon={<CheckOutlined />}
                                    onClick={() => handleInlineSave(selectedTagForValue.id, item.id)}
                                    style={{
                                      width: '28px',
                                      height: '28px',
                                      color: '#52c41a'
                                    }}
                                  />
                                </Tooltip>
                                <Tooltip title="å–æ¶ˆ">
                                  <Button
                                    type="text"
                                    size="small"
                                    icon={<CloseOutlined />}
                                    onClick={handleInlineCancel}
                                    style={{
                                      width: '28px',
                                      height: '28px',
                                      color: 'rgba(255, 255, 255, 0.6)'
                                    }}
                                  />
                                </Tooltip>
                              </>
                            ) : (
                              // æ™®é€šæ¨¡å¼ï¼šé¡¯ç¤ºç·¨è¼¯å’Œåˆªé™¤æŒ‰éˆ•
                              <>
                                <Tooltip title="ç·¨è¼¯">
                                  <Button
                                    type="text"
                                    size="small"
                                    icon={<EditOutlined />}
                                    onClick={() => handleInlineEdit(item)}
                                    style={{
                                      width: '28px',
                                      height: '28px',
                                      color: 'rgba(255, 255, 255, 0.6)'
                                    }}
                                  />
                                </Tooltip>
                                <Tooltip title="åˆªé™¤">
                                  <Button
                                    type="text"
                                    danger
                                    size="small"
                                    icon={<DeleteOutlined />}
                                    onClick={() => handleDeleteValue(selectedTagForValue.id, item.id)}
                                    style={{
                                      width: '28px',
                                      height: '28px'
                                    }}
                                  />
                                </Tooltip>
                              </>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <div style={{
                      textAlign: 'center',
                      padding: '60px 20px',
                      color: 'rgba(255, 255, 255, 0.5)'
                    }}>
                      <div style={{ fontSize: '32px', marginBottom: '12px' }}>ğŸ“</div>
                      <div style={{ fontSize: '14px', marginBottom: '8px' }}>æš«ç„¡æ¨™ç±¤å€¼</div>
                      <div style={{ fontSize: '12px' }}>ä½¿ç”¨å·¦å´è¡¨å–®æ–°å¢ç¬¬ä¸€å€‹æ¨™ç±¤å€¼</div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </Modal>
        </React.Fragment>
      );
    };

    const NotificationChannelsPage = () => {
      const initialChannels = [
        // è¨»ï¼šæ–°å¢ template æ¬„ä½ä»¥ç¬¦åˆæ›´æ–°å¾Œçš„ DB schema
        { key: 'nc_1', name: 'Default Email', type: 'Email', enabled: true, template: 'default-email-template', lastTest: { result: 'success', time: dayjs().subtract(1, 'day') } },
        { key: 'nc_2', name: 'On-call Slack', type: 'Slack', enabled: true, template: 'default-slack-template', lastTest: { result: 'success', time: dayjs().subtract(2, 'hour') } },
        { key: 'nc_3', name: 'Billing Webhook', type: 'Webhook', enabled: false, template: null, lastTest: { result: 'failed', time: dayjs().subtract(3, 'day'), message: 'Connection timed out' } },
      ];

      const [channels, setChannels] = useLocalStorageState('sre-channels', initialChannels);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingChannel, setEditingChannel] = useState(null);
      const [form] = Form.useForm();
      const { message, modal } = antd.App.useApp();

      const handleDelete = (key) => {
        modal.confirm({
          title: 'ç¢ºå®šè¦åˆªé™¤æ­¤é€šçŸ¥ç®¡é“å—ï¼Ÿ',
          icon: <ExclamationCircleOutlined />,
          content: 'æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
          okText: 'ç¢ºå®š',
          okType: 'danger',
          cancelText: 'å–æ¶ˆ',
          onOk() {
            setChannels(channels.filter(c => c.key !== key));
            message.success('é€šçŸ¥ç®¡é“åˆªé™¤æˆåŠŸ');
          }
        });
      };

      const channelType = Form.useWatch('type', form);

      const showModal = (channel = null) => {
        setEditingChannel(channel);
        form.setFieldsValue(channel || { name: '', type: 'Email', enabled: true });
        setIsModalOpen(true);
      };
      const handleCancel = () => setIsModalOpen(false);
      const onFinish = (values) => message.success('å„²å­˜æˆåŠŸ');
      const handleTest = () => {
        message.loading({ content: "æ­£åœ¨ç™¼é€æ¸¬è©¦è¨Šæ¯...", key: "test" });
        setTimeout(() => message.success({ content: "æ¸¬è©¦è¨Šæ¯ç™¼é€æˆåŠŸ", key: "test" }), 1000);
      }

      const columns = [
        { title: 'å•Ÿç”¨', dataIndex: 'enabled', width: '8%', render: e => <Switch defaultChecked={e} /> },
        { title: 'åç¨±', dataIndex: 'name', width: '20%' },
        { title: 'é¡å‹', dataIndex: 'type', width: '15%' },
        { title: 'æœ€è¿‘æ¸¬è©¦çµæœ', dataIndex: 'lastTest', width: '15%', render: lt => <Tag color={lt && lt.result === 'success' ? 'green' : 'red'}>{lt && lt.result ? lt.result.toUpperCase() : 'UNKNOWN'}</Tag> },
        { title: 'æœ€è¿‘æ¸¬è©¦æ™‚é–“', dataIndex: 'lastTest', width: '20%', render: lt => lt && lt.time ? lt.time.fromNow() : 'æœªçŸ¥' },
        {
          title: 'æ“ä½œ', key: 'action', width: '22%', render: (_, record) => (
            <Space size="small">
              <Tooltip title="ç·¨è¼¯">
                <Button type="text" icon={<EditOutlined />} onClick={() => showModal(record)} />
              </Tooltip>
              <Tooltip title="åˆªé™¤">
                <Button type="text" danger icon={<DeleteOutlined />} onClick={() => handleDelete(record.key)} />
              </Tooltip>
            </Space>
          )
        },
      ];

      return (
        <React.Fragment>
          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <Input.Search
                placeholder="æœå°‹ç®¡é“åç¨±æˆ–é¡å‹..."
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                ç¯©é¸
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
              <Button type="primary" icon={<PlusOutlined />} onClick={() => showModal()}>
                æ–°å¢é€šçŸ¥ç®¡é“
              </Button>
            </Space>
          </Space>

          <div className="table-wrapper">
            <Table columns={columns} dataSource={channels} rowKey="key" className="transparent-bg" />
          </div>
          <Modal title={editingChannel ? "ç·¨è¼¯é€šçŸ¥ç®¡é“" : "æ–°å¢é€šçŸ¥ç®¡é“"} open={isModalOpen} onCancel={handleCancel}
            footer={
              <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '12px' }}>
                <Button key="back" onClick={handleCancel}>å–æ¶ˆ</Button>
                <Button key="test" onClick={handleTest}>ç™¼é€æ¸¬è©¦</Button>
                <Button key="submit" type="primary" onClick={() => form.submit()}>å„²å­˜</Button>
              </div>
            }
          >
            <Form form={form} layout="vertical" onFinish={onFinish} style={{ marginTop: 24 }}>
              <Form.Item name="name" label="åç¨±" rules={[{ required: true }]}><Input /></Form.Item>
              <Form.Item name="type" label="ç®¡é“é¡å‹" rules={[{ required: true }]}>
                <Select>
                  <Select.Option value="Email">Email</Select.Option>
                  <Select.Option value="Webhook">Webhook (é€šç”¨)</Select.Option>
                  <Select.Option value="Slack">Slack</Select.Option>
                  <Select.Option value="LINE Notify">LINE Notify</Select.Option>
                  <Select.Option value="SMS">SMS</Select.Option>
                </Select>
              </Form.Item>

              {channelType === 'Email' && (
                <React.Fragment>
                  <Form.Item name="to" label="æ”¶ä»¶äºº (To)" rules={[{ required: true }]}><Input /></Form.Item>
                  <Form.Item name="cc" label="å‰¯æœ¬ (CC)"><Input /></Form.Item>
                  <Form.Item name="bcc" label="å¯†ä»¶å‰¯æœ¬ (BCC)"><Input /></Form.Item>
                </React.Fragment>
              )}
              {channelType === 'Webhook' && (
                <React.Fragment>
                  <Form.Item name="webhook_url" label="Webhook URL" rules={[{ required: true, type: 'url' }]}><Input /></Form.Item>
                  <Form.Item name="webhook_method" label="HTTP æ–¹æ³• (Method)" initialValue="POST">
                    <Select>
                      <Select.Option value="POST">POST</Select.Option>
                      <Select.Option value="PUT">PUT</Select.Option>
                    </Select>
                  </Form.Item>
                </React.Fragment>
              )}
              {channelType === 'Slack' && (
                <React.Fragment>
                  <Form.Item name="slack_url" label="Incoming Webhook URL" rules={[{ required: true, type: 'url' }]}><Input /></Form.Item>
                  <Form.Item name="slack_mention" label="æåŠå°è±¡ (Mention)"><Input placeholder="@channel, @here, or user_id" /></Form.Item>
                </React.Fragment>
              )}
              {channelType === 'LINE Notify' && (
                <Form.Item name="line_token" label="å­˜å–æ¬Šæ– (Access Token)" rules={[{ required: true }]}><Input.Password /></Form.Item>
              )}
              {channelType === 'SMS' && (
                <Form.Item name="sms_recipient" label="æ”¶ä»¶äººæ‰‹æ©Ÿè™Ÿç¢¼" rules={[{ required: true }]}><Input placeholder="ä¾‹å¦‚: +886912345678" /></Form.Item>
              )}
            </Form>
          </Modal>
        </React.Fragment >
      )
    };

    // é€šçŸ¥æ­·å²é é¢çµ„ä»¶
    const NotificationHistoryPage = () => {
      const [dateRange, setDateRange] = useState([dayjs().subtract(7, 'days'), dayjs()]);
      const [statusFilter, setStatusFilter] = useState([]);
      const [channelFilter, setChannelFilter] = useState('');
      const [searchText, setSearchText] = useState('');
      const [isDetailOpen, setIsDetailOpen] = useState(false);
      const [selectedNotification, setSelectedNotification] = useState(null);

      // æ¨¡æ“¬é€šçŸ¥æ­·å²æ•¸æ“š
      const notificationHistory = [
        {
          id: 'n_1',
          timestamp: dayjs().subtract(2, 'hours'),
          status: 'SUCCESS',
          channel: 'Slack: #sre-alerts',
          alert: 'CPU high on db-prod-01',
          actor: 'system',
          message: 'è³‡æ–™åº«ä¼ºæœå™¨ CPU ä½¿ç”¨ç‡éé«˜ï¼Œå·²æŒçºŒ 15 åˆ†é˜è¶…é 85%',
          errorMessage: null,
          payload: '{"channel": "#sre-alerts", "text": "CPU high on db-prod-01", "severity": "critical"}'
        },
        {
          id: 'n_2',
          timestamp: dayjs().subtract(4, 'hours'),
          status: 'FAILED',
          channel: 'Email: sre-team@company.com',
          alert: 'Memory high on web-prod-02',
          actor: 'system',
          message: 'Web ä¼ºæœå™¨è¨˜æ†¶é«”ä½¿ç”¨ç‡ç•°å¸¸',
          errorMessage: 'SMTP server timeout: connection refused',
          payload: '{"to": "sre-team@company.com", "subject": "Memory high on web-prod-02", "body": "..."}'
        },
        {
          id: 'n_3',
          timestamp: dayjs().subtract(1, 'day'),
          status: 'SUCCESS',
          channel: 'PagerDuty: SRE-OnCall',
          alert: 'Disk space low on storage-01',
          actor: 'system',
          message: 'å„²å­˜ç©ºé–“ä¸è¶³è­¦å‘Š',
          errorMessage: null,
          payload: '{"routing_key": "sre-oncall", "event_action": "trigger", "description": "Disk space low"}'
        },
        {
          id: 'n_4',
          timestamp: dayjs().subtract(2, 'days'),
          status: 'FAILED',
          channel: 'Webhook: monitoring-api',
          alert: 'Service down on api-gateway',
          actor: 'system',
          message: 'API é–˜é“å™¨æœå‹™ä¸å¯ç”¨',
          errorMessage: 'HTTP 500: Internal Server Error from webhook endpoint',
          payload: '{"alert": "Service down", "service": "api-gateway", "severity": "critical"}'
        },
        {
          id: 'n_5',
          timestamp: dayjs().subtract(3, 'days'),
          status: 'SUCCESS',
          channel: 'Teams: SRE Alerts',
          alert: 'Database connection pool exhausted',
          actor: 'system',
          message: 'è³‡æ–™åº«é€£æ¥æ± è€—ç›¡ï¼Œå·²è‡ªå‹•é‡å•Ÿæœå‹™',
          errorMessage: null,
          payload: '{"webhook_url": "https://outlook.office.com/webhook/...", "title": "Database Alert", "text": "..."}'
        },
        {
          id: 'n_6',
          timestamp: dayjs().subtract(5, 'days'),
          status: 'FAILED',
          channel: 'SMS: +886912345678',
          alert: 'Critical service outage',
          actor: 'system',
          message: 'æ ¸å¿ƒæœå‹™å®Œå…¨ä¸å¯ç”¨',
          errorMessage: 'SMS provider rejected: insufficient balance',
          payload: '{"to": "+886912345678", "message": "Critical service outage detected"}'
        }
      ];

      // ç¯©é¸æ•¸æ“š
      const filteredData = notificationHistory.filter(item => {
        const statusMatch = statusFilter.length === 0 || statusFilter.includes(item.status);
        const channelMatch = !channelFilter || item.channel.toLowerCase().includes(channelFilter.toLowerCase());
        const searchMatch = !searchText ||
          item.alert.toLowerCase().includes(searchText.toLowerCase()) ||
          item.channel.toLowerCase().includes(searchText.toLowerCase());
        const dateMatch = (!dateRange[0] || item.timestamp.isAfter(dateRange[0].startOf('day'))) &&
          (!dateRange[1] || item.timestamp.isBefore(dateRange[1].endOf('day')));

        return statusMatch && channelMatch && searchMatch && dateMatch;
      });

      // è¡¨æ ¼æ¬„ä½
      const columns = [
        {
          title: 'æ™‚é–“',
          dataIndex: 'timestamp',
          width: '180px',
          render: (timestamp) => timestamp.format('YYYY-MM-DD HH:mm:ss'),
          sorter: (a, b) => a.timestamp.unix() - b.timestamp.unix(),
          defaultSortOrder: 'descend'
        },
        {
          title: 'ç‹€æ…‹',
          dataIndex: 'status',
          width: '100px',
          render: (status) => (
            <Tag color={status === 'SUCCESS' ? 'success' : 'error'}>
              {status}
            </Tag>
          ),
          filters: [
            { text: 'SUCCESS', value: 'SUCCESS' },
            { text: 'FAILED', value: 'FAILED' }
          ],
          onFilter: (value, record) => record.status === value
        },
        {
          title: 'æ¥æ”¶ç®¡é“',
          dataIndex: 'channel',
          width: '200px',
          render: (channel) => <span style={{ fontSize: '12px' }}>{channel}</span>
        },
        {
          title: 'é—œè¯å‘Šè­¦',
          dataIndex: 'alert',
          render: (alert, record) => (
            <a
              href="#"
              onClick={(e) => {
                e.preventDefault();
                // é€™è£¡å¯ä»¥è·³è½‰åˆ°äº‹ä»¶è©³æƒ…é é¢
                console.log('Navigate to alert:', record.alert);
              }}
              style={{ color: '#1890ff' }}
            >
              {alert}
            </a>
          )
        },
        {
          title: 'æ“ä½œè€…',
          dataIndex: 'actor',
          width: '100px',
          render: (actor) => <span style={{ fontSize: '12px' }}>{actor}</span>
        },
        {
          title: 'æ“ä½œ',
          key: 'action',
          width: '80px',
          render: (_, record) => (
            <Button
              type="text"
              size="small"
              icon={<InfoCircleOutlined />}
              onClick={() => {
                setSelectedNotification(record);
                setIsDetailOpen(true);
              }}
            />
          )
        }
      ];

      return (
        <div>
          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <RangePicker
                showTime
                value={dateRange}
                onChange={setDateRange}
                style={{ width: 400 }}
                placeholder={['é–‹å§‹æ™‚é–“', 'çµæŸæ™‚é–“']}
              />
              <Input.Search
                placeholder="æœå°‹å‘Šè­¦æ‘˜è¦ã€è³‡æºåç¨±..."
                onChange={e => setSearchText(e.target.value)}
                style={{ width: 300 }}
                allowClear
              />
              <Button className="toolbar-btn" icon={<FilterOutlined />}>
                ç¯©é¸
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
            </Space>
          </Space>

          {/* é€šçŸ¥æ­·å²è¡¨æ ¼ */}
          <Card
            className="dashboard-card"
            title={
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <HistoryOutlined style={{ color: '#1890ff' }} />
                <span>é€šçŸ¥æ­·å²</span>
                <Badge count={filteredData.length} style={{ backgroundColor: '#1890ff' }} />
              </div>
            }
            bodyStyle={{ padding: '0' }}
          >
            <Table
              columns={columns}
              dataSource={filteredData}
              rowKey="id"
              size="small"
              pagination={{
                pageSize: 20,
                showSizeChanger: true,
                showQuickJumper: true,
                showTotal: (total, range) => `ç¬¬ ${range[0]}-${range[1]} æ¢ï¼Œå…± ${total} æ¢`
              }}
              rowClassName={(record) => record.status === 'FAILED' ? 'row-error' : ''}
              scroll={{ x: 800 }}
            />
          </Card>

          {/* è©³æƒ…å´é‚Šæ¬„ */}
          <Drawer
            title="é€šçŸ¥è©³æƒ…"
            placement="right"
            width={500}
            open={isDetailOpen}
            onClose={() => {
              setIsDetailOpen(false);
              setSelectedNotification(null);
            }}
          >
            {selectedNotification && (
              <div style={{ padding: '8px 0' }}>
                <Descriptions column={1} size="small">
                  <Descriptions.Item label="æ™‚é–“">
                    {selectedNotification.timestamp.format('YYYY-MM-DD HH:mm:ss')}
                  </Descriptions.Item>
                  <Descriptions.Item label="ç‹€æ…‹">
                    <Tag color={selectedNotification.status === 'SUCCESS' ? 'success' : 'error'}>
                      {selectedNotification.status}
                    </Tag>
                  </Descriptions.Item>
                  <Descriptions.Item label="æ¥æ”¶ç®¡é“">
                    {selectedNotification.channel}
                  </Descriptions.Item>
                  <Descriptions.Item label="é—œè¯å‘Šè­¦">
                    <a href="#" style={{ color: '#1890ff' }}>{selectedNotification.alert}</a>
                  </Descriptions.Item>
                  <Descriptions.Item label="æ“ä½œè€…">
                    {selectedNotification.actor}
                  </Descriptions.Item>
                </Descriptions>

                <Divider />

                <div style={{ marginBottom: '16px' }}>
                  <div style={{ fontWeight: 500, marginBottom: '8px' }}>é€šçŸ¥å…§å®¹é è¦½</div>
                  <div style={{
                    padding: '12px',
                    backgroundColor: 'rgba(0, 0, 0, 0.04)',
                    borderRadius: '4px',
                    fontSize: '12px',
                    fontFamily: 'monospace'
                  }}>
                    {selectedNotification.message}
                  </div>
                </div>

                {selectedNotification.errorMessage && (
                  <div style={{ marginBottom: '16px' }}>
                    <div style={{ fontWeight: 500, marginBottom: '8px', color: '#ff4d4f' }}>éŒ¯èª¤è¨Šæ¯</div>
                    <div style={{
                      padding: '12px',
                      backgroundColor: 'rgba(255, 77, 79, 0.1)',
                      borderRadius: '4px',
                      border: '1px solid rgba(255, 77, 79, 0.2)',
                      fontSize: '12px',
                      color: '#ff4d4f'
                    }}>
                      {selectedNotification.errorMessage}
                    </div>
                  </div>
                )}

                <div>
                  <div style={{ fontWeight: 500, marginBottom: '8px' }}>åŸå§‹ Payload</div>
                  <div style={{
                    padding: '12px',
                    backgroundColor: 'rgba(0, 0, 0, 0.04)',
                    borderRadius: '4px',
                    fontSize: '11px',
                    fontFamily: 'monospace',
                    maxHeight: '200px',
                    overflowY: 'auto'
                  }}>
                    <pre>{selectedNotification.payload}</pre>
                  </div>
                </div>
              </div>
            )}
          </Drawer>
        </div>
      );
    };

    // éƒµä»¶è¨­å®šé é¢çµ„ä»¶
    const EmailSettingsPage = () => {
      const [form] = Form.useForm();
      const { message } = antd.App.useApp();

      return (
        <React.Fragment>
          <Form form={form} layout="vertical">
            <Form.Item name="smtp_host" label="SMTP ä¼ºæœå™¨" style={{ marginBottom: 8, maxWidth: '600px' }}>
              <Input placeholder="ä¾‹å¦‚: smtp.gmail.com" />
            </Form.Item>
            <Form.Item name="smtp_port" label="åŸ è™Ÿ" style={{ marginBottom: 8, maxWidth: '600px' }}>
              <InputNumber placeholder="ä¾‹å¦‚: 587" className="select-full" />
            </Form.Item>
            <Form.Item name="smtp_user" label="ä½¿ç”¨è€…åç¨±" style={{ marginBottom: 8, maxWidth: '600px' }}>
              <Input placeholder="è¼¸å…¥éƒµä»¶å¸³è™Ÿ" />
            </Form.Item>
            <Form.Item name="smtp_pass" label="å¯†ç¢¼" style={{ marginBottom: 12, maxWidth: '600px' }}>
              <Input.Password placeholder="è¼¸å…¥éƒµä»¶å¯†ç¢¼" />
            </Form.Item>

            {/* æ“ä½œæŒ‰éˆ• */}
            <div style={{ maxWidth: '600px', marginBottom: '12px' }}>
              <Form.Item style={{ marginBottom: 0 }}>
                <Space size="middle" style={{ width: '100%', justifyContent: 'flex-end' }}>
                  <Button className="modal-footer-btn">é‚„åŸé è¨­å€¼</Button>
                  <Button type="primary" className="modal-footer-btn" onClick={() => message.success('éƒµä»¶è¨­å®šå·²å„²å­˜')}>
                    å„²å­˜
                  </Button>
                </Space>
              </Form.Item>
            </div>
          </Form>
        </React.Fragment>
      );
    };

    // èº«ä»½é©—è­‰è¨­å®šé é¢çµ„ä»¶
    const AuthSettingsPage = () => {
      const [form] = Form.useForm();
      const { message } = antd.App.useApp();

      return (
        <React.Fragment>
          <Form form={form} layout="vertical">
            <Form.Item name="oidc_enabled" label="å•Ÿç”¨ OIDC" style={{ marginBottom: 8, maxWidth: '600px' }}>
              <Select placeholder="é¸æ“‡æ˜¯å¦å•Ÿç”¨">
                <Select.Option value={true}>å•Ÿç”¨</Select.Option>
                <Select.Option value={false}>åœç”¨</Select.Option>
              </Select>
            </Form.Item>
            <Form.Item name="oidc_client_id" label="å®¢æˆ¶ç«¯ ID" style={{ marginBottom: 8, maxWidth: '600px' }}>
              <Input placeholder="è¼¸å…¥å®¢æˆ¶ç«¯ ID" />
            </Form.Item>
            <Form.Item name="oidc_client_secret" label="å®¢æˆ¶ç«¯å¯†é‘°" style={{ marginBottom: 12, maxWidth: '600px' }}>
              <Input.Password placeholder="è¼¸å…¥å®¢æˆ¶ç«¯å¯†é‘°" />
            </Form.Item>

            {/* æ“ä½œæŒ‰éˆ• */}
            <div style={{ maxWidth: '600px', marginBottom: '12px' }}>
              <Form.Item style={{ marginBottom: 0 }}>
                <Space size="middle" style={{ width: '100%', justifyContent: 'flex-end' }}>
                  <Button className="modal-footer-btn">é‚„åŸé è¨­å€¼</Button>
                  <Button type="primary" className="modal-footer-btn" onClick={() => message.success('èº«ä»½é©—è­‰è¨­å®šå·²å„²å­˜')}>
                    å„²å­˜
                  </Button>
                </Space>
              </Form.Item>
            </div>
          </Form>
        </React.Fragment>
      );
    };

    // å¹³å°è¨­å®šé é¢çµ„ä»¶
    const PlatformSettingsPage = ({ onNavigate, pageKey }) => {
      const tabKey = ['tag-management', 'email-settings', 'auth-settings', 'identity-access-management'].includes(pageKey) ? pageKey : 'tag-management';

      // å¹³å°è¨­å®šçµ±è¨ˆè³‡æ–™
      const settingsStats = {
        totalTags: 42,
        activeTags: 38,
        authSessions: 156,
        configChanges: 7,
        lastBackup: '2å°æ™‚å‰'
      };

      return (
        <React.Fragment>
          <PageHeader
            title="å¹³å°è¨­å®š"
            subtitle="ç®¡ç†å¹³å°åŸºæœ¬é…ç½®ï¼ŒåŒ…æ‹¬æ¨™ç±¤ç³»çµ±ã€éƒµä»¶è¨­å®šå’Œèº«ä»½é©—è­‰æ©Ÿåˆ¶"
            icon={<SettingOutlined />}
          />

          {/* å¹³å°è¨­å®š KPI å„€è¡¨æ¿ */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} lg={8}>
                <ContextualKPICard
                  title="æ¨™ç±¤ç¸½æ•¸"
                  value={settingsStats.totalTags}
                  unit="å€‹"
                  trend="+2.4%"
                  status="success"
                  description={`${settingsStats.activeTags} å€‹å•Ÿç”¨ä¸­`}
                  icon={<TagsOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={8}>
                <ContextualKPICard
                  title="æ´»èºæœƒè©±"
                  value={settingsStats.authSessions}
                  unit="å€‹"
                  trend="+8.7%"
                  status="success"
                  description="äººå“¡ç™»å…¥æœƒè©±"
                  icon={<LockOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={8}>
                <ContextualKPICard
                  title="é…ç½®ç•°å‹•"
                  value={settingsStats.configChanges}
                  unit="æ¬¡"
                  trend="+40%"
                  status="warning"
                  description={`æœ€å¾Œå‚™ä»½ï¼š${settingsStats.lastBackup}`}
                  icon={<FileProtectOutlined />}
                />
              </Col>
            </Row>
          </div>
          <Tabs
            defaultActiveKey={tabKey}
            onChange={(key) => onNavigate(key)}
            style={{
              '--tab-bar-margin': '0 0 var(--spacing-lg) 0'
            }}
          >
            <Tabs.TabPane
              tab={
                <span>
                  <TagsOutlined />
                  æ¨™ç±¤ç®¡ç†
                </span>
              }
              key="tag-management"
            >
              <TagKeyManagementPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <MailOutlined />
                  éƒµä»¶è¨­å®š
                </span>
              }
              key="email-settings"
            >
              <EmailSettingsPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <LockOutlined />
                  èº«ä»½é©—è­‰
                </span>
              }
              key="auth-settings"
            >
              <AuthSettingsPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <UserOutlined />
                  èº«ä»½èˆ‡å­˜å–ç®¡ç†
                </span>
              }
              key="identity-access-management"
            >
              <UserPermissionsPage />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    const SystemSettingsPage = () => {
      const [form] = Form.useForm();
      const { message } = antd.App.useApp();

      const handleSave = () => {
        form.validateFields().then(values => {
          console.log('ä¿å­˜è¨­å®š:', values);
          message.success('è¨­å®šå·²å„²å­˜');
        }).catch(err => {
          console.error('é©—è­‰éŒ¯èª¤:', err);
        });
      };

      const handleReset = () => {
        form.resetFields();
        message.info('å·²é‚„åŸç‚ºé è¨­å€¼');
      };

      return (
        <SettingsLayout>
          <SettingsSection
            title="åŸºæœ¬è¨­å®š"
            description="é…ç½®ç³»çµ±çš„åŸºæœ¬åƒæ•¸å’Œåå¥½è¨­å®š"
            actions={
              <Space>
                <PlatformButton onClick={handleReset}>
                  é‚„åŸé è¨­å€¼
                </PlatformButton>
                <PlatformButton type="primary" onClick={handleSave}>
                  å„²å­˜è¨­å®š
                </PlatformButton>
              </Space>
            }
          >
            <Form form={form} layout="vertical" className="settings-form">
              <SettingsFormRow
                label="ç³»çµ±åç¨±"
                description="è¨­å®šç³»çµ±é¡¯ç¤ºåç¨±ï¼Œç”¨æ–¼ä»‹é¢æ¨™é¡Œå’Œé€šçŸ¥è¨Šæ¯"
                required
              >
                <Input
                  placeholder="è«‹è¼¸å…¥ç³»çµ±åç¨±"
                  style={{ width: '100%' }}
                />
              </SettingsFormRow>

              <SettingsFormRow
                label="ç³»çµ±æ™‚å€"
                description="é¸æ“‡ç³»çµ±é è¨­æ™‚å€ï¼Œå½±éŸ¿æ—¥èªŒå’Œå ±å‘Šçš„æ™‚é–“é¡¯ç¤º"
              >
                <Select
                  placeholder="é¸æ“‡æ™‚å€"
                  style={{ width: '100%' }}
                >
                  <Select.Option value="Asia/Taipei">
                    Asia/Taipei (GMT+8) - å°åŒ—æ™‚é–“
                  </Select.Option>
                  <Select.Option value="UTC">
                    UTC (GMT+0) - ä¸–ç•Œå”èª¿æ™‚é–“
                  </Select.Option>
                  <Select.Option value="America/New_York">
                    America/New_York (GMT-5/-4) - ç´ç´„æ™‚é–“
                  </Select.Option>
                  <Select.Option value="Europe/London">
                    Europe/London (GMT+0/+1) - å€«æ•¦æ™‚é–“
                  </Select.Option>
                </Select>
              </SettingsFormRow>
            </Form>
          </SettingsSection>

          <SettingsSection
            title="é€šçŸ¥è¨­å®š"
            description="ç®¡ç†ç³»çµ±é€šçŸ¥å’Œå‘Šè­¦çš„é…ç½®"
          >
            <Form.Item>
              <SettingsFormRow
                label="é è¨­é€šçŸ¥ç®¡é“"
                description="é¸æ“‡æ¥æ”¶ç³»çµ±é€šçŸ¥çš„é è¨­ç®¡é“"
              >
                <Select
                  placeholder="é¸æ“‡é€šçŸ¥ç®¡é“"
                  style={{ width: '100%' }}
                >
                  <Select.Option value="email">é›»å­éƒµä»¶</Select.Option>
                  <Select.Option value="slack">Slack</Select.Option>
                  <Select.Option value="webhook">Webhook</Select.Option>
                </Select>
              </SettingsFormRow>

              <SettingsFormRow
                label="é€šçŸ¥é »ç‡é™åˆ¶"
                description="è¨­å®šç›¸åŒé¡å‹å‘Šè­¦çš„æœ€å°é€šçŸ¥é–“éš”ï¼ˆåˆ†é˜ï¼‰"
              >
                <InputNumber
                  min={1}
                  max={1440}
                  placeholder="15"
                  style={{ width: '100%' }}
                  addonAfter="åˆ†é˜"
                />
              </SettingsFormRow>
            </Form.Item>
          </SettingsSection>

          <SettingsSection
            title="å®‰å…¨è¨­å®š"
            description="é…ç½®ç³»çµ±å®‰å…¨ç›¸é—œåƒæ•¸"
          >
            <Form.Item>
              <SettingsFormRow
                label="æœƒè©±éæœŸæ™‚é–“"
                description="äººå“¡é–’ç½®å¤šä¹…å¾Œè‡ªå‹•ç™»å‡ºï¼ˆå°æ™‚ï¼‰"
              >
                <InputNumber
                  min={1}
                  max={24}
                  placeholder="8"
                  style={{ width: '100%' }}
                  addonAfter="å°æ™‚"
                />
              </SettingsFormRow>

              <SettingsFormRow
                label="ç™»å…¥å¤±æ•—é–å®š"
                description="é€£çºŒç™»å…¥å¤±æ•—å¹¾æ¬¡å¾Œé–å®šå¸³æˆ¶"
              >
                <InputNumber
                  min={3}
                  max={10}
                  placeholder="5"
                  style={{ width: '100%' }}
                  addonAfter="æ¬¡"
                />
              </SettingsFormRow>
            </Form.Item>
          </SettingsSection>
        </SettingsLayout>
      );
    };

    const AuditLogsPage = () => {
      const [drawer, setDrawer] = useState({ open: false, data: null });
      const initialLogs = [
        { key: 1, time: dayjs().subtract(5, 'minutes'), user: 'admin', action: 'execute', type: 'Script', id: 's_1', result: 'success' },
        { key: 2, time: dayjs().subtract(1, 'hour'), user: 'admin', action: 'update', type: 'AlertRule', id: 'rule_2', result: 'success', diff: { before: 'severity: warning', after: 'severity: critical' } },
        { key: 3, time: dayjs().subtract(3, 'hour'), user: 'dev_user', action: 'login', type: 'User', id: 'dev_user', result: 'success' },
        { key: 4, time: dayjs().subtract(4, 'hour'), user: 'system', action: 'create', type: 'Incident', id: 'i_4', result: 'failure', message: 'Rate limit exceeded' },
      ];

      const showDrawer = (record) => setDrawer({ open: true, data: record });
      const closeDrawer = () => setDrawer({ open: false, data: null });

      // å°‡è³‡æºIDè½‰æ›ç‚ºè³‡æºåç¨±çš„è¼”åŠ©å‡½æ•¸
      const getResourceName = (type, id) => {
        const resourceMap = {
          'Script': { 's_1': 'æ¯æ—¥å‚™ä»½è…³æœ¬', 's_2': 'æ¸…ç†è…³æœ¬', 's_3': 'ç›£æ§è…³æœ¬' },
          'AlertRule': { 'rule_1': 'CPUäº‹ä»¶è¦å‰‡', 'rule_2': 'è¨˜æ†¶é«”äº‹ä»¶è¦å‰‡', 'rule_3': 'ç£ç¢Ÿäº‹ä»¶è¦å‰‡' },
          'User': { 'admin': 'ç®¡ç†å“¡', 'dev_user': 'é–‹ç™¼äººå“¡', 'system': 'ç³»çµ±' },
          'Incident': { 'i_1': 'æœå‹™ä¸­æ–·äº‹ä»¶', 'i_2': 'æ•ˆèƒ½å•é¡Œ', 'i_3': 'é…ç½®éŒ¯èª¤', 'i_4': 'ç¶²è·¯å•é¡Œ' }
        };
        return resourceMap[type]?.[id] || id;
      };

      const columns = [
        { title: 'æ™‚é–“', dataIndex: 'time', render: t => t ? t.format('YYYY-MM-DD HH:mm:ss') : '-', width: '16%' },
        { title: 'æ“ä½œè€…', dataIndex: 'user', width: '10%' },
        { title: 'å‹•ä½œ', dataIndex: 'action', render: a => <Tag>{a ? a.toUpperCase() : 'UNKNOWN'}</Tag>, width: '8%' },
        { title: 'è³‡æºé¡å‹', dataIndex: 'type', width: '10%' },
        { title: 'è…³æœ¬åç¨±', dataIndex: 'id', render: (id, record) => record.type === 'Script' ? getResourceName(record.type, id) : '-', width: '14%' },
        { title: 'è³‡æºåç¨±', dataIndex: 'id', render: (id, record) => record.type !== 'Script' ? getResourceName(record.type, id) : '-', width: '14%' },
        { title: 'çµæœ', dataIndex: 'result', render: r => <Tag color={r === 'success' ? 'green' : 'red'}>{r ? r.toUpperCase() : 'UNKNOWN'}</Tag>, width: '8%' },
        {
          title: 'æ“ä½œ', key: 'action', render: (_, record) => (
            <Tooltip title="æŸ¥çœ‹è©³æƒ…">
              <Button type="text" icon={<InfoCircleOutlined />} onClick={() => showDrawer(record)} />
            </Tooltip>
          ), width: '10%'
        },
      ];

      return (
        <React.Fragment>
          {/* å·¥å…·åˆ— */}
          <Space style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: 'var(--spacing-lg)',
            width: '100%'
          }}>
            <Space>
              <RangePicker showTime />
              <Input placeholder="æœå°‹ä½¿ç”¨è€…..." style={{ width: 200 }} />
              <Select placeholder="å‹•ä½œé¡å‹" style={{ width: 150 }}>
                <Select.Option value="create">Create</Select.Option>
                <Select.Option value="update">Update</Select.Option>
                <Select.Option value="delete">Delete</Select.Option>
                <Select.Option value="login">Login</Select.Option>
              </Select>
              <Button className="toolbar-btn" icon={<SearchOutlined />}>
                æŸ¥è©¢
              </Button>
            </Space>
            <Space>
              <Button className="toolbar-btn" icon={<DownloadOutlined />}>åŒ¯å‡º</Button>
            </Space>
          </Space>
          <div className="table-wrapper">
            <Table columns={columns} dataSource={initialLogs} rowKey="key" rowClassName={r => r.result === 'failure' ? 'row-highlight' : ''} className="transparent-bg" size="small" />
          </div>
          <Drawer title="æ—¥èªŒè©³æƒ…" onClose={closeDrawer} open={drawer.open} width={500}>
            {drawer.data && (
              <List>
                <List.Item><Text strong>æ™‚é–“:</Text> {drawer.data.time ? drawer.data.time.format('YYYY-MM-DD HH:mm:ss') : '-'}</List.Item>
                <List.Item><Text strong>æ“ä½œè€…:</Text> {drawer.data.user}</List.Item>
                <List.Item><Text strong>å‹•ä½œ:</Text> {drawer.data.action}</List.Item>
                <List.Item><Text strong>è³‡æº:</Text> {drawer.data.type} ({drawer.data.id})</List.Item>
                <List.Item><Text strong>çµæœ:</Text> <Tag color={drawer.data && drawer.data.result === 'success' ? 'green' : 'red'}>{drawer.data && drawer.data.result ? drawer.data.result.toUpperCase() : 'UNKNOWN'}</Tag></List.Item>
                {drawer.data.message && <List.Item><Text strong>è¨Šæ¯:</Text> {drawer.data.message}</List.Item>}
                {drawer.data.diff && (
                  <List.Item>
                    <pre>
                      <strong>è®Šæ›´å·®ç•°:</strong><br />
                      - {drawer.data.diff.before}<br />
                      + {drawer.data.diff.after}
                    </pre>
                  </List.Item>
                )}
              </List>
            )}
          </Drawer>
        </React.Fragment>
      );
    };

    // é€šç”¨ä½”ä½ç¬¦é é¢çµ„ä»¶ - çµ±ä¸€ä½¿ç”¨PageHeader
    const PlaceholderPage = ({ title, subtitle, icon }) => {
      return (
        <React.Fragment>
          <PageHeader
            title={title}
            subtitle={subtitle}
            icon={icon}
          />
          <div style={{
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            height: '50vh',
            textAlign: 'center'
          }}>
            <div style={{
              fontSize: '64px',
              color: 'var(--text-quaternary)',
              marginBottom: 'var(--spacing-xl)'
            }}>
              {icon || <FileTextOutlined />}
            </div>
            <Title level={3} style={{
              color: 'var(--text-secondary)',
              marginBottom: 'var(--spacing-md)'
            }}>
              å³å°‡æ¨å‡º
            </Title>
            <div style={{
              padding: 'var(--spacing-lg)',
              backgroundColor: 'var(--bg-secondary)',
              borderRadius: 'var(--border-radius)',
              border: '1px dashed var(--border-base)',
              color: 'var(--text-tertiary)',
              fontSize: '14px',
              maxWidth: '400px'
            }}>
              ğŸš§ æ­¤åŠŸèƒ½æ­£åœ¨é–‹ç™¼ä¸­ï¼Œæ•¬è«‹æœŸå¾…
            </div>
          </div>
        </React.Fragment>
      );
    };

    // å€‹äººè³‡è¨Šçµ„ä»¶
    const PersonalInfoPage = () => {
      const [form] = Form.useForm();
      return (
        <div style={{ maxWidth: 500, paddingTop: 16 }}>
          <Form layout="vertical" form={form}>
            <Form.Item label="å§“å" name="name" initialValue="Admin User">
              <Input />
            </Form.Item>
            <Form.Item label="é›»å­éƒµä»¶" name="email" initialValue="admin@example.com">
              <Input disabled />
            </Form.Item>
            <Form.Item style={{ marginBottom: 0 }}>
              <div style={{ width: '100%', display: 'flex', justifyContent: 'flex-end' }}>
                <Button type="primary" onClick={() => message.success('å€‹äººè³‡è¨Šå·²æ›´æ–°')}>
                  æ›´æ–°å€‹äººè³‡è¨Š
                </Button>
              </div>
            </Form.Item>
          </Form>
        </div>
      );
    };

    // å¯†ç¢¼å®‰å…¨çµ„ä»¶
    const PasswordSecurityPage = () => {
      const [form] = Form.useForm();
      return (
        <div style={{ maxWidth: 500, paddingTop: 16 }}>
          <Form layout="vertical" form={form}>
            <Form.Item label="ç›®å‰å¯†ç¢¼" name="currentPassword">
              <Input.Password />
            </Form.Item>
            <Form.Item label="æ–°å¯†ç¢¼" name="newPassword">
              <Input.Password />
            </Form.Item>
            <Form.Item label="ç¢ºèªæ–°å¯†ç¢¼" name="confirmPassword">
              <Input.Password />
            </Form.Item>
            <Form.Item style={{ marginBottom: 0 }}>
              <div style={{ width: '100%', display: 'flex', justifyContent: 'flex-end' }}>
                <Button type="primary" onClick={() => message.success('å¯†ç¢¼å·²æ›´æ–°')}>
                  æ›´æ–°å¯†ç¢¼
                </Button>
              </div>
            </Form.Item>
          </Form>
        </div>
      );
    };

    // åå¥½è¨­å®šçµ„ä»¶
    const PreferencesPage = ({ themeMode, setThemeMode }) => {
      const [form] = Form.useForm();
      return (
        <div style={{ maxWidth: 500, paddingTop: 16 }}>
          <Form layout="vertical" form={form}>
            <Form.Item label="ä»‹é¢ä¸»é¡Œ" name="theme">
              <Select value={themeMode} onChange={setThemeMode}>
                <Select.Option value="dark">Dark</Select.Option>
                <Select.Option value="light">Light</Select.Option>
              </Select>
            </Form.Item>
            <Form.Item label="é è¨­é é¢" name="homeDashboard" initialValue="default">
              <Select>
                <Select.Option value="default">Default</Select.Option>
              </Select>
            </Form.Item>
            <Form.Item label="æ™‚å€" name="timezone" initialValue="utc">
              <Select>
                <Select.Option value="utc">UTC</Select.Option>
                <Select.Option value="local">Browser Time</Select.Option>
              </Select>
            </Form.Item>
            <Form.Item style={{ marginBottom: 0 }}>
              <div style={{ width: '100%', display: 'flex', justifyContent: 'flex-end' }}>
                <Button type="primary" onClick={() => message.success('åå¥½è¨­å®šå·²å„²å­˜')}>
                  å„²å­˜åå¥½è¨­å®š
                </Button>
              </div>
            </Form.Item>
          </Form>
        </div>
      );
    };

    const ProfilePage = ({ themeMode, setThemeMode }) => {
      const [activeTab, setActiveTab] = useState('personal-info');

      return (
        <React.Fragment>
          <div style={{ marginBottom: 'var(--spacing-lg)' }}>
            <Title level={2} className="page-title" style={{ marginBottom: '4px' }}>å€‹äººè³‡æ–™èˆ‡åå¥½è¨­å®š</Title>
            <Paragraph className="page-subtitle" type="secondary" style={{ margin: 0 }}>
              ç®¡ç†æ‚¨çš„å€‹äººè³‡è¨Šã€å¯†ç¢¼èˆ‡é€šçŸ¥åå¥½ã€‚
            </Paragraph>
          </div>
          <Tabs activeKey={activeTab} onChange={setActiveTab}>
            <Tabs.TabPane tab="å€‹äººè³‡è¨Š" key="personal-info">
              <PersonalInfoPage />
            </Tabs.TabPane>
            <Tabs.TabPane tab="å¯†ç¢¼å®‰å…¨" key="password-security">
              <PasswordSecurityPage />
            </Tabs.TabPane>
            <Tabs.TabPane tab="åå¥½è¨­å®š" key="preferences">
              <PreferencesPage themeMode={themeMode} setThemeMode={setThemeMode} />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    const UserPermissionsPage = ({ onNavigate, pageKey }) => {
      const tabKey = ['personnel-management', 'team-management', 'role-management', 'audit-logs'].includes(pageKey) ? pageKey : 'personnel-management';

      // èº«ä»½èˆ‡å­˜å–ç®¡ç†çµ±è¨ˆè³‡æ–™
      const userStats = {
        totalUsers: 156,
        activeUsers: 142,
        totalTeams: 12,
        totalRoles: 8,
        onlineUsers: 89,
        pendingInvitations: 5
      };

      return (
        <React.Fragment>
          <PageHeader
            title="èº«ä»½èˆ‡å­˜å–ç®¡ç†"
            subtitle="çµ±ä¸€ç®¡ç†èº«ä»½èªè­‰ã€å­˜å–æ¬Šé™å’Œçµ„ç¹”æ¶æ§‹é…ç½®"
            icon={<UserOutlined />}
          />

          {/* äººå“¡æ¬Šé™ KPI å„€è¡¨æ¿ */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="ç¸½äººå“¡æ•¸"
                  value={userStats.totalUsers}
                  unit="äºº"
                  trend="+5.2%"
                  status="success"
                  description={`${userStats.activeUsers} å€‹å•Ÿç”¨ä¸­`}
                  icon={<UserOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="åœ¨ç·šäººå“¡"
                  value={userStats.onlineUsers}
                  unit="äºº"
                  trend="+12.1%"
                  status="info"
                  description="ç›®å‰æ´»èºäººå“¡"
                  icon={<SafetyCertificateOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="åœ˜éšŠæ•¸é‡"
                  value={userStats.totalTeams}
                  unit="å€‹"
                  trend="0%"
                  status="success"
                  description="çµ„ç¹”æ¶æ§‹ç©©å®š"
                  icon={<TeamOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} lg={6}>
                <ContextualKPICard
                  title="å¾…è™•ç†é‚€è«‹"
                  value={userStats.pendingInvitations}
                  unit="å€‹"
                  trend="+25%"
                  status="warning"
                  description="éœ€è¦è·Ÿé€²è™•ç†"
                  icon={<BellOutlined />}
                />
              </Col>
            </Row>
          </div>
          <Tabs
            defaultActiveKey={tabKey}
            onChange={(key) => onNavigate(key)}
            style={{
              '--tab-bar-margin': '0 0 var(--spacing-lg) 0'
            }}
          >
            <Tabs.TabPane
              tab={
                <span>
                  <UserOutlined />
                  äººå“¡ç®¡ç†
                </span>
              }
              key="personnel-management"
            >
              <PersonnelManagementPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <TeamOutlined />
                  åœ˜éšŠç®¡ç†
                </span>
              }
              key="team-management"
            >
              <TeamManagementPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <SafetyCertificateOutlined />
                  è§’è‰²ç®¡ç†
                </span>
              }
              key="role-management"
            >
              <RoleManagementPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <AuditOutlined />
                  å¯©è¨ˆæ—¥èªŒ
                </span>
              }
              key="audit-logs"
            >
              <AuditLogsPage />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    const NotificationManagementPage = ({ onNavigate, pageKey }) => {
      const tabKey = ['notification-strategies', 'notification-channels', 'notification-history'].includes(pageKey) ? pageKey : 'notification-strategies';

      // é€šçŸ¥ç³»çµ±çµ±è¨ˆè³‡æ–™
      const notificationStats = {
        totalChannels: 8,
        activeChannels: 6,
        todayNotifications: 47,
        deliveryRate: 97.3,
        failedNotifications: 2,
        avgResponseTime: 1.2
      };

      return (
        <React.Fragment>
          <PageHeader
            title="é€šçŸ¥ç®¡ç†"
            subtitle="é…ç½®é€šçŸ¥ç­–ç•¥å’Œè¨Šæ¯å‚³é€ç®¡é“ï¼Œç¢ºä¿é—œéµè³‡è¨ŠåŠæ™‚å‚³é”"
            icon={<BellOutlined />}
          />

          {/* é€šçŸ¥ç³»çµ± KPI ç¸½è¦½ */}
          <div style={{ marginBottom: 'var(--spacing-xl)' }}>
            <Row gutter={[16, 16]}>
              <Col xs={24} sm={12} md={8}>
                <ContextualKPICard
                  title="é€šçŸ¥ç®¡é“"
                  value={notificationStats.activeChannels}
                  unit={`/${notificationStats.totalChannels}`}
                  trend="stable"
                  status="success"
                  description="å·²å•Ÿç”¨çš„é€šçŸ¥ç®¡é“"
                  icon={<BellOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={8}>
                <ContextualKPICard
                  title="ä»Šæ—¥é€šçŸ¥é‡"
                  value={notificationStats.todayNotifications}
                  unit="å‰‡"
                  trend="up"
                  status="info"
                  description={`${notificationStats.failedNotifications} å‰‡ç™¼é€å¤±æ•—`}
                  icon={<MailOutlined />}
                />
              </Col>
              <Col xs={24} sm={12} md={8}>
                <ContextualKPICard
                  title="é€é”ç‡"
                  value={notificationStats.deliveryRate}
                  unit="%"
                  trend={notificationStats.deliveryRate >= 95 ? 'up' : 'down'}
                  status={notificationStats.deliveryRate >= 95 ? 'success' : 'warning'}
                  description={`å¹³å‡å›æ‡‰æ™‚é–“ ${notificationStats.avgResponseTime}s`}
                  icon={<CheckCircleOutlined />}
                />
              </Col>
            </Row>
          </div>

          {/* å¡ç‰‡å¼åˆ†çµ„ä½ˆå±€ */}
          <div style={{ marginBottom: 'var(--spacing-lg)' }}>
            <Row gutter={[24, 24]}>
              {/* ç®¡é“ç‹€æ…‹æ¦‚è¦½ */}
              <Col xs={24}>
                <Card
                  className="dashboard-card"
                  title={
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                      <MonitorOutlined style={{ color: '#1890ff' }} />
                      <span>ç®¡é“ç‹€æ…‹æ¦‚è¦½</span>
                    </div>
                  }
                  bodyStyle={{ padding: '16px' }}
                >
                  <Row gutter={[16, 16]}>
                    {[
                      { name: 'Email', status: 'active', lastTest: '2å°æ™‚å‰', rate: '99.2%' },
                      { name: 'Slack', status: 'active', lastTest: '1å°æ™‚å‰', rate: '98.7%' },
                      { name: 'Teams', status: 'active', lastTest: '30åˆ†é˜å‰', rate: '97.8%' },
                      { name: 'Webhook', status: 'warning', lastTest: 'å¤±æ•—', rate: '0%' },
                      { name: 'PagerDuty', status: 'active', lastTest: '15åˆ†é˜å‰', rate: '100%' },
                      { name: 'SMS', status: 'inactive', lastTest: 'æœªæ¸¬è©¦', rate: '-' }
                    ].map(channel => (
                      <Col xs={24} sm={8} md={4} key={channel.name}>
                        <div style={{
                          padding: '12px',
                          backgroundColor: 'rgba(255, 255, 255, 0.02)',
                          borderRadius: '6px',
                          border: '1px solid rgba(255, 255, 255, 0.06)'
                        }}>
                          <div style={{ display: 'flex', alignItems: 'center', marginBottom: '8px' }}>
                            <div style={{ marginRight: '8px' }}>
                              {channel.status === 'active' ? (
                                <Badge status="success" />
                              ) : channel.status === 'warning' ? (
                                <Badge status="warning" />
                              ) : (
                                <Badge status="default" />
                              )}
                            </div>
                            <span style={{ fontWeight: 500 }}>{channel.name}</span>
                          </div>
                          <div style={{ fontSize: '12px', color: 'rgba(255, 255, 255, 0.6)' }}>
                            <div>æˆåŠŸç‡: {channel.rate}</div>
                            <div>æœ€å¾Œæ¸¬è©¦: {channel.lastTest}</div>
                          </div>
                        </div>
                      </Col>
                    ))}
                  </Row>
                </Card>
              </Col>
            </Row>
          </div>

          <Tabs
            defaultActiveKey={tabKey}
            onChange={(key) => onNavigate(key)}
            style={{
              '--tab-bar-margin': '0 0 var(--spacing-lg) 0'
            }}
          >
            <Tabs.TabPane
              tab={
                <span>
                  <SettingOutlined />
                  é€šçŸ¥ç­–ç•¥
                </span>
              }
              key="notification-strategies"
            >
              <NotificationStrategiesPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <BellOutlined />
                  é€šçŸ¥ç®¡é“
                </span>
              }
              key="notification-channels"
            >
              <NotificationChannelsPage />
            </Tabs.TabPane>
            <Tabs.TabPane
              tab={
                <span>
                  <HistoryOutlined />
                  é€šçŸ¥æ­·å²
                </span>
              }
              key="notification-history"
            >
              <NotificationHistoryPage />
            </Tabs.TabPane>
          </Tabs>
        </React.Fragment>
      );
    };

    // --- Main App Component ---
    const MainApp = ({ themeMode, setThemeMode }) => {
      const [currentPage, setCurrentPage] = useState('home');
      const [pageParams, setPageParams] = useState({});
      const [collapsed, setCollapsed] = useState(false);
      const [isSearchModalOpen, setIsSearchModalOpen] = useState(false);

      // å¢å¼·çš„å°èˆªå‡½æ•¸ï¼Œæ”¯æŒåƒæ•¸å‚³é
      const navigateToPage = (pageKey, params = {}) => {
        setCurrentPage(pageKey);
        setPageParams(params);
      };

      const { message } = antd.App.useApp();

      // Check for default dashboard on app start
      React.useEffect(() => {
        const defaultDashboard = localStorage.getItem('default-dashboard');
        if (defaultDashboard && currentPage === 'home') {
          // Small delay to ensure smooth transition
          setTimeout(() => {
            setCurrentPage(defaultDashboard);
          }, 100);
        }
      }, []);

      const initialScripts = [
        // è¨»ï¼šæ–°å¢ lastExecuted æ¬„ä½ä»¥ç¬¦åˆæ›´æ–°å¾Œçš„ DB schema
        { key: 's_1', name: 'Auto-scaling for Web Servers', type: 'Python', description: 'è‡ªå‹•æ“´å±• Web ä¼ºæœå™¨å¯¦ä¾‹', creator: 'admin', code: '# Python script to scale web servers\nprint("Scaling up web servers...")', params: [{ name: 'instance_count', type: 'number', label: 'å¯¦ä¾‹æ•¸é‡' }], status: 'active', category: 'deployment', executionCount: 45, last_executed: dayjs().subtract(2, 'hours') },
        { key: 's_2', name: 'Increase Database Disk Volume', type: 'Bash', description: 'å¢åŠ è³‡æ–™åº«ç£ç¢Ÿå€å®¹é‡', creator: 'admin', code: '#!/bin/bash\n# Bash script to increase disk volume\necho "Increasing DB disk size..."', params: [{ name: 'increase_gb', type: 'number', label: 'å¢åŠ å®¹é‡ (GB)' }], status: 'active', category: 'maintenance', executionCount: 32, last_executed: dayjs().subtract(1, 'day') },
        { key: 's_3', name: 'Daily Backup', type: 'Python', description: 'æ¯æ—¥è³‡æ–™åº«å‚™ä»½', creator: 'dev_user', code: '# Python script for daily backup\nprint("Starting daily backup...")', status: 'active', category: 'maintenance', executionCount: 28, last_executed: dayjs().subtract(22, 'hours') },
        { key: 's_4', name: 'System Health Check', type: 'Bash', description: 'ç³»çµ±å¥åº·ç‹€æ…‹æª¢æŸ¥', creator: 'ops_team', code: '#!/bin/bash\n# System health check script\necho "Checking system health..."', params: [{ name: 'check_type', type: 'select', label: 'æª¢æŸ¥é¡å‹', options: ['basic', 'detailed', 'comprehensive'] }], status: 'active', category: 'monitoring', executionCount: 156, last_executed: dayjs().subtract(5, 'minutes') },
        { key: 's_5', name: 'Log Rotation', type: 'Python', description: 'æ‡‰ç”¨ç¨‹å¼æ—¥èªŒè¼ªæ›¿', creator: 'dev_team', code: '# Python script for log rotation\nprint("Rotating application logs...")', params: [{ name: 'retention_days', type: 'number', label: 'ä¿ç•™å¤©æ•¸' }], status: 'active', category: 'maintenance', executionCount: 89, last_executed: dayjs().subtract(6, 'hours') },
        { key: 's_6', name: 'Cache Warmup', type: 'Bash', description: 'å¿«å–é ç†±è…³æœ¬', creator: 'cache_admin', code: '#!/bin/bash\n# Cache warmup script\necho "Warming up cache..."', params: [{ name: 'warmup_urls', type: 'textarea', label: 'é ç†± URL åˆ—è¡¨' }], status: 'active', category: 'performance', executionCount: 67, last_executed: dayjs().subtract(3, 'days') },
      ];

      const initialSchedules = [
        // è¨»ï¼šæ–°å¢ scheduleMode å’Œ frequency æ¬„ä½ä»¥ç¬¦åˆæ›´æ–°å¾Œçš„ DB schema
        { key: 'sch_1', name: 'æ¯æ—¥è³‡æ–™åº«å‚™ä»½', cron: '0 2 * * *', schedule_mode: 'advanced', frequency: 'daily', script_id: 's_3', last_run: dayjs().subtract(1, 'day').hour(2), last_status: 'success', enabled: true, creator: 'admin' },
        { key: 'sch_2', name: 'æ¯å°æ™‚æ¸…ç†è‡¨æ™‚æ–‡ä»¶', cron: '0 * * * *', schedule_mode: 'simple', frequency: 'hourly', script_id: 's_2', last_run: dayjs().subtract(30, 'minute'), last_status: 'failed', enabled: false, creator: 'dev_user' },
      ];
      const initialExecutions = [
        { key: 'e_1', script_name: 'Auto-scaling for Web Servers', trigger: { type: 'Event', event_id: 'i_2', event_summary: 'Disk space low on web-prod-02' }, status: 'success', start_time: dayjs().subtract(2, 'hour'), duration: '5.2s' },
        { key: 'e_2', script_name: 'Increase Database Disk Volume', trigger: { type: 'Manual', user: 'admin' }, status: 'failed', start_time: dayjs().subtract(1, 'day'), duration: '2.1s' },
        { key: 'e_3', script_name: 'Daily Backup', trigger: { type: 'Schedule', id: 'sch_1' }, status: 'success', start_time: dayjs().subtract(1, 'day').hour(2), duration: '15m 30s' },
      ];

      const [scripts, setScripts] = useLocalStorageState('sre-scripts', initialScripts);
      const [executions, setExecutions] = useLocalStorageState('sre-executions', initialExecutions);
      const [schedules, setSchedules] = useLocalStorageState('sre-schedules', initialSchedules);

      const addExecution = (newExecution) => {
        setExecutions(function (prev) { return [newExecution, ...prev] });
      };

      const handleLogout = () => { message.success('å·²æˆåŠŸç™»å‡º'); setTimeout(() => window.location.reload(), 500); }
      const handleMenuClick = ({ key }) => {
        // è™•ç†æ‰€æœ‰é¸å–®é …ç›®é»æ“Šï¼ŒåŒ…æ‹¬çˆ¶é¸å–®å’Œå­é¸å–®
        setCurrentPage(key);
      };

      const handleSubMenuTitleClick = ({ key, domEvent }) => {
        // é˜»æ­¢é è¨­çš„å±•é–‹/æ”¶åˆè¡Œç‚º
        domEvent.stopPropagation();
        // ç›´æ¥å°èˆªåˆ°çˆ¶é¸å–®é é¢
        setCurrentPage(key);
      };
      const getItem = (label, key, icon, children) => {
        const item = {
          key,
          icon,
          children,
          label,
          disabled: false
        };

        // å¦‚æœæœ‰å­é …ç›®ï¼Œç‚ºçˆ¶é¸å–®æ¨™é¡Œæ–°å¢é»æ“Šäº‹ä»¶
        if (children) {
          item.onTitleClick = handleSubMenuTitleClick;
        }

        return item;
      };
      const sideMenuItems = [
        getItem('é¦–é ', 'home', <DashboardOutlined />),
        getItem('äº‹ä»¶ç®¡ç†', 'incidents', <HistoryOutlined />),
        getItem('è³‡æºç®¡ç†', 'resources', <HddOutlined />),
        getItem('å„€è¡¨æ¿', 'dashboard', <BarChartOutlined />),
        getItem('åˆ†æä¸­å¿ƒ', 'analyzing', <BarChartOutlined />),
        getItem('è‡ªå‹•åŒ–ä¸­å¿ƒ', 'automation', <CodeOutlined />),
        getItem('è¨­å®š', 'settings', <SettingOutlined />, [
          getItem('èº«ä»½èˆ‡å­˜å–ç®¡ç†', 'identity-access-management', <UserOutlined />),
          getItem('é€šçŸ¥ç®¡ç†', 'notification-management', <BellOutlined />),
          getItem('å¹³å°è¨­å®š', 'platform-settings', <SettingOutlined />),
        ]),
      ];

      useEffect(() => {
        const handleKeyDown = (e) => {
          if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            setIsSearchModalOpen(true);
          }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, []);

      const PageContent = () => {
        const pageKey = currentPage;

        if (['home'].includes(pageKey)) {
          return <HomePage themeMode={themeMode} onNavigate={navigateToPage} />;
        }
        if (['alerts-insights'].includes(pageKey)) {
          return <AlertsInsightsPage themeMode={themeMode} onNavigate={navigateToPage} />;
        }
        if (['incidents', 'incident-list', 'alerting-rules', 'silences'].includes(pageKey)) {
          return <IncidentsPage onNavigate={navigateToPage} pageKey={pageKey} />;
        }
        if (['resources', 'resource-overview', 'resource-list', 'resource-groups', 'resource-topology'].includes(pageKey)) {
          return <ResourcesPage onNavigate={navigateToPage} pageKey={pageKey} themeMode={themeMode} />;
        }
        // Dashboard administration page with card navigation
        if (pageKey === 'dashboard') {
          return <DashboardAdministrationPage onNavigate={navigateToPage} />;
        }
        if (['analyzing', 'capacity-planning', 'performance-insights', 'cost-analysis', 'incident-trends', 'mttr-analysis', 'sla-reports'].includes(pageKey)) {
          return <AnalyzingPage onNavigate={navigateToPage} pageKey={pageKey} themeMode={themeMode} />;
        }
        if (['automation', 'scripts', 'schedules', 'executions'].includes(pageKey)) {
          return <AutomationCenterPage onNavigate={navigateToPage} pageKey={pageKey} scripts={scripts} setScripts={setScripts} addExecution={addExecution} executions={executions} setExecutions={setExecutions} schedules={schedules} setSchedules={setSchedules} pageParams={pageParams} />;
        }
        if (['identity-access-management', 'personnel-management', 'team-management', 'role-management', 'audit-logs'].includes(pageKey)) {
          return <UserPermissionsPage onNavigate={navigateToPage} pageKey={pageKey} />;
        }
        if (['notification-management', 'notification-strategies', 'notification-channels', 'notification-history'].includes(pageKey)) {
          return <NotificationManagementPage onNavigate={navigateToPage} pageKey={pageKey} />;
        }
        // Settings administration page with card navigation
        if (pageKey === 'settings') {
          return <SettingsAdministrationPage onNavigate={navigateToPage} />;
        }
        if (['platform-settings', 'tag-management', 'email-settings', 'auth-settings', 'identity-access-management'].includes(pageKey)) {
          return <PlatformSettingsPage onNavigate={navigateToPage} pageKey={pageKey} />;
        }
        if (['profile'].includes(pageKey)) {
          return <ProfilePage themeMode={themeMode} setThemeMode={setThemeMode} />;
        }

        // Fallback for any other pages that might have been missed, or for placeholder pages
        switch (pageKey) {
          case 'executive-dashboard': return <PlaceholderPage title="ç®¡ç†å„€è¡¨æ¿" subtitle="ç‚ºç®¡ç†å±¤æä¾›ç¶œåˆæ€§æœ€ä½³åŒ–çš„é‹ç‡Ÿå ±å‘Šã€‚" icon={<PieChartOutlined />} />;
          case 'custom-reports': return <PlaceholderPage title="è‡ªè¨‚å ±å‘Š" subtitle="å»ºç«‹å’Œæ’ç¨‹è‡ªè¨‚å ±å‘Šä»¥æ»¿è¶³ç‰¹å®šéœ€æ±‚ã€‚" icon={<FileTextOutlined />} />;
          default: return <HomePage themeMode={themeMode} onNavigate={navigateToPage} />;
        }
      };

      const findLabel = (key, menu) => {
        for (const item of menu) {
          if (item.key === key) return { parent: null, parentKey: null, child: item.label };
          if (item.children) {
            for (const child of item.children) {
              if (child.key === key) return { parent: item.label, parentKey: item.key, child: child.label };
              if (child.children) {
                for (const grandChild of child.children) {
                  if (grandChild.key === key) return { parent: child.label, parentKey: child.key, child: grandChild.label };
                }
              }
            }
          }
        }
        // Fallback for pages not in the menu, like Profile
        if (key === 'profile') {
          return { parent: null, parentKey: null, child: 'å€‹äººè³‡æ–™' };
        }
        return { parent: null, parentKey: null, child: 'ç¸½è¦½' };
      };

      const { parent, parentKey, child } = findLabel(currentPage, sideMenuItems);
      const breadcrumbItems = [{ title: <a onClick={() => setCurrentPage('home')}>Home</a> }];
      if (parent) {
        breadcrumbItems.push({ title: <a onClick={() => setCurrentPage(parentKey)}>{parent}</a> });
      }
      if (child && child !== 'ç¸½è¦½' && child !== parent) {
        breadcrumbItems.push({ title: child });
      }

      const userMenuItems = [
        {
          key: 'user-info',
          type: 'group',
          label: (
            <div style={{
              padding: '8px 0',
              borderBottom: '1px solid var(--border-light)'
            }}>
              <div style={{ fontWeight: 600, color: 'var(--text-primary)' }}>Admin User</div>
              <div style={{ fontSize: '12px', color: 'var(--text-tertiary)' }}>admin@sre-platform.com</div>
            </div>
          ),
          style: { cursor: 'default' }
        },
        {
          key: 'profile',
          label: (
            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
              <UserOutlined />
              <span>å€‹äººè³‡æ–™</span>
            </div>
          ),
          onClick: () => setCurrentPage('profile')
        },
        {
          key: 'help',
          label: (
            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
              <QuestionCircleOutlined />
              <span>å¹«åŠ©ä¸­å¿ƒ</span>
            </div>
          ),
          onClick: () => message.info('é–‹å•Ÿå¹«åŠ©ä¸­å¿ƒ')
        },
        { type: 'divider' },
        {
          key: 'logout',
          label: (
            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
              <LogoutOutlined style={{ color: 'var(--brand-danger)' }} />
              <span style={{ color: 'var(--brand-danger)' }}>ç™»å‡º</span>
            </div>
          ),
          onClick: handleLogout,
          danger: true
        }
      ];

      const NotificationCenter = () => {
        const [notifications, setNotifications] = useState([
          { id: 1, type: 'error', title: 'CPU high on db-prod-01', description: 'è³‡æº db-prod-01 CPU ä½¿ç”¨ç‡è¶…é 90%', time: dayjs().subtract(5, 'minutes'), read: false, severity: 'critical' },
          { id: 2, type: 'system', title: 'Script "Daily Backup" executed successfully', description: 'æ¯æ—¥å‚™ä»½è…³æœ¬å·²æˆåŠŸåŸ·è¡Œ', time: dayjs().subtract(2, 'hours'), read: false, severity: 'info' },
          { id: 3, type: 'warning', title: 'Disk space low on web-prod-02', description: 'è³‡æº web-prod-02 ç£ç¢Ÿç©ºé–“ä½æ–¼ 15%', time: dayjs().subtract(1, 'day'), read: true, severity: 'warning' },
          { id: 4, type: 'success', title: 'å‚™ä»½ä»»å‹™å®Œæˆ', description: 'æ‰€æœ‰æ•¸æ“šåº«å‚™ä»½å·²æˆåŠŸå®Œæˆ', time: dayjs().subtract(3, 'hours'), read: true, severity: 'success' },
        ]);
        const unreadCount = notifications.filter(n => !n.read).length;

        const handleMarkAllAsRead = () => {
          setNotifications(notifications.map(n => ({ ...n, read: true })));
          message.success('æ‰€æœ‰é€šçŸ¥å·²æ¨™ç‚ºå·²è®€');
        }

        const getNotificationIcon = (type, severity) => {
          const iconMap = {
            error: <ExclamationCircleOutlined />,
            warning: <AlertOutlined />,
            system: <InfoCircleOutlined />,
            success: <CheckCircleOutlined />
          };
          return iconMap[type] || <InfoCircleOutlined />;
        };

        const getNotificationColor = (severity) => {
          const colorMap = {
            critical: 'var(--brand-danger)',
            warning: 'var(--brand-warning)',
            info: 'var(--brand-primary)',
            success: 'var(--brand-success)'
          };
          return colorMap[severity] || 'var(--brand-info)';
        };

        const content = (
          <div className="notification-dropdown" style={{
            width: 380,
            maxHeight: '580px',
            overflow: 'hidden',
            borderRadius: 'var(--radius-lg)',
            background: 'var(--bg-elevated)',
            boxShadow: 'var(--shadow-2xl)'
          }}>
            {/* æ¨™é¡Œå€ */}
            <div style={{
              padding: '12px 16px',
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.05) 100%)',
              borderBottom: '1px solid var(--border-light)',
              backdropFilter: 'blur(10px)',
              position: 'sticky',
              top: 0,
              zIndex: 1
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                  <div style={{
                    width: '32px',
                    height: '32px',
                    borderRadius: 'var(--radius-md)',
                    background: 'linear-gradient(135deg, rgba(24, 144, 255, 0.2) 0%, rgba(24, 144, 255, 0.1) 100%)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center'
                  }}>
                    <BellOutlined style={{ fontSize: '16px', color: 'var(--brand-primary)' }} />
                  </div>
                  <div>
                    <Title level={5} style={{ margin: 0, fontSize: '16px', fontWeight: '600' }}>é€šçŸ¥ä¸­å¿ƒ</Title>
                    <Text type="secondary" style={{ fontSize: '12px' }}>
                      {unreadCount > 0 ? `${unreadCount} å‰‡æœªè®€é€šçŸ¥` : 'æ²’æœ‰æ–°é€šçŸ¥'}
                    </Text>
                  </div>
                </div>
                {unreadCount > 0 && (
                  <Button
                    type="text"
                    size="small"
                    onClick={handleMarkAllAsRead}
                    style={{
                      color: 'var(--brand-primary)',
                      fontSize: '13px',
                      fontWeight: '500'
                    }}
                  >
                    å…¨éƒ¨å·²è®€
                  </Button>
                )}
              </div>
            </div>

            {/* é€šçŸ¥åˆ—è¡¨ */}
            <div style={{
              maxHeight: '450px',
              overflowY: 'auto',
              overflowX: 'hidden'
            }}>
              <List
                dataSource={notifications}
                renderItem={item => (
                  <List.Item
                    onClick={() => {
                      if (!item.read) {
                        setNotifications(notifications.map(n =>
                          n.id === item.id ? { ...n, read: true } : n
                        ));
                      }
                      message.info(`è·³è½‰è‡³ ${item.title || 'æœªçŸ¥é …ç›®'} ç›¸é—œé é¢`);
                    }}
                    style={{
                      cursor: 'pointer',
                      padding: '12px 16px',
                      borderBottom: '1px solid var(--border-light)',
                      background: item.read ? 'transparent' : 'linear-gradient(135deg, rgba(24, 144, 255, 0.04) 0%, rgba(24, 144, 255, 0.02) 100%)',
                      transition: 'all 0.2s ease'
                    }}
                    className="notification-item"
                  >
                    <List.Item.Meta
                      avatar={
                        <div style={{ position: 'relative' }}>
                          <Avatar
                            icon={getNotificationIcon(item.type, item.severity)}
                            style={{
                              backgroundColor: `${getNotificationColor(item.severity)}15`,
                              color: getNotificationColor(item.severity),
                              border: `1px solid ${getNotificationColor(item.severity)}30`,
                              boxShadow: `0 0 12px ${getNotificationColor(item.severity)}20`
                            }}
                            size={36}
                          />
                          {!item.read && (
                            <span style={{
                              position: 'absolute',
                              top: '-2px',
                              right: '-2px',
                              width: '8px',
                              height: '8px',
                              borderRadius: '50%',
                              background: 'var(--brand-primary)',
                              border: '2px solid var(--bg-elevated)',
                              boxShadow: '0 0 4px var(--brand-primary)'
                            }} />
                          )}
                        </div>
                      }
                      title={
                        <div style={{ marginBottom: '2px' }}>
                          <span style={{
                            fontWeight: item.read ? '400' : '600',
                            color: item.read ? 'var(--text-secondary)' : 'var(--text-primary)',
                            fontSize: '14px',
                            lineHeight: '1.4'
                          }}>
                            {item.title || 'æœªå‘½åé€šçŸ¥'}
                          </span>
                        </div>
                      }
                      description={
                        <div>
                          <div style={{
                            color: item.read ? 'var(--text-tertiary)' : 'var(--text-secondary)',
                            fontSize: '13px',
                            marginBottom: '4px',
                            lineHeight: '1.4'
                          }}>
                            {item.description}
                          </div>
                          <div style={{
                            color: 'var(--text-tertiary)',
                            fontSize: '12px',
                            fontWeight: '500'
                          }}>
                            {item.time.fromNow()}
                          </div>
                        </div>
                      }
                    />
                  </List.Item>
                )}
              />
            </div>

            {/* åº•éƒ¨æ“ä½œ */}
            <div style={{
              padding: '12px',
              textAlign: 'center',
              borderTop: '1px solid var(--border-light)',
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.03) 100%)'
            }}>
              <Button
                type="link"
                onClick={() => {
                  // ç„¡ç¸«è·³è½‰åˆ°é€šçŸ¥ç®¡ç†é é¢ï¼Œä¸¦è‡ªå‹•é¸ä¸­ã€Œé€šçŸ¥æ­·å²ã€Tab
                  navigateToPage('notification-history');
                  message.success("å·²è·³è½‰åˆ°é€šçŸ¥ç®¡ç†ä¸­å¿ƒ");
                }}
                style={{
                  color: 'var(--brand-primary)',
                  fontWeight: '500'
                }}
              >
                æŸ¥çœ‹æ‰€æœ‰é€šçŸ¥
              </Button>
            </div>
          </div>
        );

        return (
          <Popover
            content={content}
            trigger="click"
            placement="bottomRight"
            overlayClassName="notification-popover"
          >
            <Button
              type="text"
              style={{
                padding: '4px 8px',
                height: 'auto',
                display: 'flex',
                alignItems: 'center',
                gap: '4px'
              }}
            >
              <Badge count={unreadCount} offset={[-2, 2]} style={{
                '--ant-badge-height': '18px',
                '--ant-badge-dot-size': '8px'
              }}>
                <BellOutlined style={{
                  fontSize: '18px',
                  color: 'var(--text-secondary)'
                }} />
              </Badge>
            </Button>
          </Popover>
        );
      };

      const GlobalSearch = () => {
        const [query, setQuery] = useState('');
        const mockResults = [
          { type: 'è³‡æº', items: [{ key: 'host_1', name: 'db-prod-01', desc: '10.0.0.10' }] },
          { type: 'äº‹ä»¶', items: [{ key: 'i_1', name: 'CPU high on db-prod-01', desc: 'Firing' }] },
          { type: 'è‡ªå‹•åŒ–è…³æœ¬', items: [{ key: 's_1', name: 'Auto-scaling for Web Servers', desc: 'Python Script' }] },
        ];

        const filteredResults = query ? mockResults.map(function (group) {
          return {
            ...group,
            items: group.items.filter(function (item) {
              return item.name.toLowerCase().includes(query.toLowerCase())
            })
          }
        }).filter(function (group) { return group.items.length > 0 }) : [];

        return (
          <Modal open={isSearchModalOpen} onCancel={() => setIsSearchModalOpen(false)} footer={null} closable={false} width={600} style={{ top: 50 }}>
            <Input size="large" placeholder="æœå°‹è³‡æºã€äº‹ä»¶ã€è…³æœ¬..." prefix={<SearchOutlined />} onChange={(e) => setQuery(e.target.value)} autoFocus />
            {query && <List
              style={{ marginTop: 16 }}
              dataSource={filteredResults}
              renderItem={group => (
                <List
                  header={<Divider orientation="left">{group.type}</Divider>}
                  dataSource={group.items}
                  renderItem={item => <List.Item style={{ cursor: 'pointer' }} onClick={() => message.info(`è·³è½‰è‡³ ${item.name} è©³æƒ…`)}>{item.name}</List.Item>}
                />
              )}
            />}
          </Modal>
        );
      };

      return (
        <Layout style={{ minHeight: '100vh' }}>
          <Layout.Sider trigger={null} collapsible collapsed={collapsed} width={220}>
            <div style={{
              height: '48px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: collapsed ? 'center' : 'flex-start',
              cursor: 'pointer',
              gap: '10px',
              padding: '0 16px',
              transition: 'all 0.3s ease',
              borderBottom: '1px solid var(--border-light)'
            }} onClick={() => setCurrentPage('home')}>
              <div style={{
                width: '30px',
                height: '30px',
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                borderRadius: '6px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                boxShadow: '0 4px 16px rgba(102, 126, 234, 0.3)',
                transition: 'all 0.3s ease'
              }}>
                <DeploymentUnitOutlined style={{
                  fontSize: '18px',
                  color: 'white',
                  transition: 'all 0.3s ease'
                }} />
              </div>
              {!collapsed && (
                <Title level={4} style={{
                  margin: 0,
                  color: 'var(--text-primary)',
                  fontWeight: '600',
                  fontSize: '18px',
                  letterSpacing: '-0.3px'
                }}>SRE Platform</Title>
              )}
            </div>
            <Menu
              theme="dark"
              mode="inline"
              selectedKeys={[currentPage]}
              defaultOpenKeys={['dashboard', 'settings']}
              items={sideMenuItems}
              onClick={handleMenuClick}
            />
          </Layout.Sider>
          <Layout>
            <Layout.Header style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0 16px' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                <Button
                  type="text"
                  icon={collapsed ? <MenuUnfoldOutlined /> : <MenuFoldOutlined />}
                  onClick={() => setCollapsed(!collapsed)}
                  style={{
                    color: 'rgba(255, 255, 255, 0.8)',
                    fontSize: '14px',
                    width: '32px',
                    height: '32px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    marginLeft: '-8px'
                  }}
                />
                <Breadcrumb items={breadcrumbItems} />
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
                <Input prefix={<SearchOutlined />} placeholder="Search... (Ctrl+K)" style={{ width: 250 }} onClick={() => setIsSearchModalOpen(true)} readOnly />
                <NotificationCenter />
                <Dropdown
                  menu={{
                    items: userMenuItems,
                    style: {
                      minWidth: 200,
                      borderRadius: 'var(--radius-lg)',
                      padding: '4px'
                    }
                  }}
                  placement="bottomRight"
                  overlayClassName="user-dropdown-menu"
                >
                  <Button
                    type="text"
                    style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px',
                      padding: '4px 12px',
                      height: '36px',
                      borderRadius: 'var(--radius-md)',
                      transition: 'all 0.2s ease'
                    }}
                    className="user-menu-trigger"
                  >
                    <Avatar
                      size={28}
                      icon={<UserOutlined />}
                      style={{
                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        fontSize: '14px'
                      }}
                    />
                    <span style={{
                      color: 'var(--text-primary)',
                      fontWeight: '500',
                      fontSize: '14px'
                    }}>
                      admin
                    </span>
                    <DownOutlined style={{
                      fontSize: '10px',
                      color: 'var(--text-secondary)'
                    }} />
                  </Button>
                </Dropdown>
              </div>
            </Layout.Header>
            <Layout.Content style={{ padding: '24px', background: '#0d1117' }}>
              <PageContent />
            </Layout.Content>
            <GlobalSearch />
          </Layout>
        </Layout>
      );
    };

    const AppWrapper = () => {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [themeMode, setThemeMode] = useLocalStorageState('sre-theme-mode', 'dark');

      const handleLogin = () => setIsAuthenticated(true);

      const currentTheme = {
        algorithm: themeMode === 'dark' ? theme.darkAlgorithm : theme.defaultAlgorithm,
        components: {
          Layout: {
            siderBg: themeMode === 'dark' ? '#161719' : '#ffffff',
            headerBg: themeMode === 'dark' ? '#161719' : '#ffffff',
          },
          Menu: {
            darkItemBg: '#161719',
          },
          Card: {
            colorBgContainer: themeMode === 'dark' ? '#202226' : '#ffffff'
          },
          Modal: {
            contentBg: themeMode === 'dark' ? '#202226' : '#ffffff',
            headerBg: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          Drawer: {
            colorBgElevated: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          Popover: {
            colorBgElevated: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          Dropdown: {
            colorBgElevated: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          Select: {
            colorBgElevated: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          DatePicker: {
            colorBgContainer: themeMode === 'dark' ? '#161719' : '#ffffff',
            colorBgElevated: themeMode === 'dark' ? '#202226' : '#ffffff',
          },
          Tree: {
            colorBgContainer: themeMode === 'dark' ? '#202226' : '#ffffff',
          }
        }
      };

      return (
        <ErrorBoundary>
          <ConfigProvider theme={currentTheme}>
            <antd.App>
              {isAuthenticated ? <MainApp themeMode={themeMode} setThemeMode={setThemeMode} /> : <LoginPage onLogin={handleLogin} />}
            </antd.App>
          </ConfigProvider>
        </ErrorBoundary>
      )
    }

    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<AppWrapper />);
  </script>
</body>

</html>