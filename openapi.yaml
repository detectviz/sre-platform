# SRE 平台 API 規格書 (SSOT)
# 版本: 2.0.0
# 更新日期: 2025-09-16
# 描述: 此文件為 SRE 平台前端與後端之間的 API 契約唯一真實來源 (Single Source of Truth)，
#      根據 prototype.html 的全面審查結果重新撰寫。
openapi: 3.1.0
info:
  title: SRE 平台 - API 規格書
  description: |
    本 API 規格為 SRE 平台前後端開發的統一數據契約。
    它定義了所有資源、事件、自動化、管理等模組的介面，
    並遵循 RESTful 設計原則與專案開發規範。
  version: "2.0.0"
  contact:
    name: SRE 平台開發團隊
    email: sre-platform-dev@example.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: /api/v1
    description: 應用程式 API 根路徑
  - url: http://localhost:3001/api/v1
    description: Mock Server 開發環境

# ============================================
# 擴展屬性 (Vendor Extensions)
# ============================================
x-error-codes:
  BAD_REQUEST:
    http: 400
    message: "請求格式錯誤或缺少必要參數"
    i18n_key: errors.badRequest
  UNAUTHORIZED:
    http: 401
    message: "使用者未登入或 Token 已過期"
    i18n_key: errors.unauthorized
  FORBIDDEN:
    http: 403
    message: "使用者權限不足，無法執行此操作"
    i18n_key: errors.forbidden
  NOT_FOUND:
    http: 404
    message: "請求的資源不存在或已被移除"
    i18n_key: errors.notFound
  CONFLICT:
    http: 409
    message: "操作與目前資源狀態衝突 (例如：重名)"
    i18n_key: errors.conflict
  RATE_LIMITED:
    http: 429
    message: "請求過於頻繁，請稍後再試"
    i18n_key: errors.rateLimited
  INTERNAL_ERROR:
    http: 500
    message: "伺服器內部發生未知錯誤"
    i18n_key: errors.internal
  RESOURCE_IN_USE:
    http: 409
    message: "資源正在使用中，無法刪除"
    i18n_key: errors.resource_in_use
  INVALID_METRIC:
    http: 400
    message: "無效的監控指標"
    i18n_key: errors.invalid_metric

x-role-definitions:
  super_admin: "超級管理員：擁有系統最高權限，可以執行所有操作。"
  team_manager: "團隊管理員：管理團隊成員、資源、事件規則等團隊範圍內的資源。"
  team_member: "團隊成員：查看團隊資源、處理事件、執行腳本（受限）。"
  viewer: "唯讀用戶：僅可查看資源狀態、儀表板、報表。"

x-resource-status-rules:
  # 資源健康狀態的判定規則契約
  default:
    critical: "cpu_usage > 90 OR memory_usage > 95"
    warning: "cpu_usage > 80 OR memory_usage > 85"
    healthy: "cpu_usage <= 80 AND memory_usage <= 85"
  server:
    critical: "cpu_usage > 90 OR memory_usage > 95 OR disk_usage > 95"
    warning: "cpu_usage > 80 OR memory_usage > 85 OR disk_usage > 90"
    healthy: "cpu_usage <= 80 AND memory_usage <= 85 AND disk_usage <= 90"
  database:
    critical: "cpu_usage > 85 OR memory_usage > 90 OR replication_lag_s > 10 OR connections_pct > 95"
    warning: "cpu_usage > 75 OR memory_usage > 85 OR replication_lag_s > 5 OR connections_pct > 90"
    healthy: "cpu_usage <= 75 AND memory_usage <= 85 AND replication_lag_s <= 5 AND connections_pct <= 90"

x-incident-lifecycle:
  # 事件狀態機契約
  states: [new, acknowledged, resolved, silenced]
  transitions:
    - {
        from: new,
        to: acknowledged,
        roles: [team_member, team_manager, super_admin],
        action: "確認",
      }
    - {
        from: acknowledged,
        to: resolved,
        roles: [team_member, team_manager, super_admin],
        action: "解決",
      }
    - {
        from: new,
        to: silenced,
        roles: [team_manager, super_admin],
        action: "靜音",
      }
    - {
        from: acknowledged,
        to: silenced,
        roles: [team_manager, super_admin],
        action: "靜音",
      }
  actions:
    acknowledge:
      { endpoint: "/incidents/{incidentId}/acknowledge", method: POST }
    resolve: { endpoint: "/incidents/{incidentId}/resolve", method: POST }
    silence: { endpoint: "/incidents/silences", method: POST }

x-websocket:
  # WebSocket / SSE 通訊契約
  notifications:
    url: "/events"
    description: "Server-Sent Events (SSE) 用於即時更新（alerts, incidents 等）。"
    messages:
      alert_fired:
        payload_schema: "#/components/schemas/Alert"
      incident_updated:
        payload_schema: "#/components/schemas/Alert"
      resource_status_changed:
        payload_example:
          resource_id: "res_1"
          old_status: "healthy"
          new_status: "warning"

# ============================================
# API 標籤 (Tags)
# ============================================
tags:
  - name: System
    description: 核心系統功能
  - name: Auth
    description: 身份驗證
  - name: Search & Autocomplete
    description: 全局搜尋與自動完成
  - name: Dashboard
    description: 儀表板與統計
  - name: Resources
    description: 資源管理
  - name: Resource Groups
    description: 資源群組管理
  - name: Incidents
    description: 事件管理
  - name: Alerts
    description: 原始告警管理
  - name: Incident Rules
    description: 事件規則管理
  - name: Incident Silences
    description: 事件靜音規則管理
  - name: Analyzing
    description: 分析與預測
  - name: Automation
    description: 自動化相關
  - name: Admin
    description: 平台管理功能
  - name: Profile
    description: 使用者個人設定
  - name: Notifications
    description: 使用者通知中心

# ============================================
# API 路徑與端點 (Paths & Endpoints)
# ============================================
paths:
  # ============================================
  # System
  # ============================================
  /healthz:
    get:
      tags: [System]
      summary: 服務健康檢查
      operationId: checkHealth
      responses: { "200": { description: 服務健康 } }
  /readyz:
    get:
      tags: [System]
      summary: 服務就緒檢查
      operationId: checkReadiness
      responses: { "200": { description: 服務就緒 } }
  /metrics:
    get:
      tags: [System]
      summary: Prometheus 指標
      operationId: getMetrics
      responses: { "200": { description: Prometheus 指標 } }
  /metrics/definitions:
    get:
      tags: [System]
      summary: 獲取可用監控指標列表
      operationId: getMetricDefinitions
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: 成功獲取指標列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MetricDefinition"
  /metrics/query:
    post:
      tags: [System]
      summary: 多資源指標時序查詢
      operationId: queryMetrics
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MetricQueryRequest"
      responses:
        "200":
          description: 成功返回指標時序數據
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MetricQueryResult"

  # ============================================
  # Auth
  # ============================================
  /auth/login:
    post:
      tags: [Auth]
      summary: 開發模式登入
      operationId: devLogin
      requestBody:
        $ref: "#/components/requestBodies/AuthLoginRequest"
      responses:
        "200":
          description: 登入成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthTokens"
  /auth/refresh:
    post:
      tags: [Auth]
      summary: 刷新 Token（開發）
      operationId: devRefreshToken
      requestBody:
        $ref: "#/components/requestBodies/TokenRefreshRequest"
      responses:
        "200":
          description: 刷新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthTokens"
  /auth/logout:
    post:
      tags: [Auth]
      summary: 登出（開發）
      operationId: devLogout
      responses:
        "200":
          description: 登出成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationResult"

  # ============================================
  # Users
  # ============================================
  /users:
    get:
      tags: [Profile]
      summary: 獲取用戶列表
      operationId: listUsers
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - name: status
          in: query
          schema: { type: string, enum: [active, inactive, pending] }
        - name: search
          in: query
          schema: { type: string }
      responses:
        "200":
          description: 用戶列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserList"
    post:
      tags: [Profile]
      summary: 創建用戶
      operationId: createUser
      security: [{ bearerAuth: [] }]
      x-roles: [super_admin]
      requestBody:
        $ref: "#/components/requestBodies/UserCreateRequest"
      responses:
        "201":
          description: 用戶創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
  /users/{userId}:
    get:
      tags: [Profile]
      summary: 獲取用戶詳情
      operationId: getUser
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 用戶詳情
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
    put:
      tags: [Profile]
      summary: 更新用戶
      operationId: updateUser
      security: [{ bearerAuth: [] }]
      x-roles: [super_admin]
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        $ref: "#/components/requestBodies/UserUpdateRequest"
      responses:
        "200":
          description: 用戶更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
    delete:
      tags: [Profile]
      summary: 刪除用戶
      operationId: deleteUser
      security: [{ bearerAuth: [] }]
      x-roles: [super_admin]
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: string }
      responses:
        "204":
          description: 用戶刪除成功
  /users/{userId}/reset-password:
    post:
      tags: [Profile]
      summary: 重置用戶密碼
      operationId: resetUserPassword
      security: [{ bearerAuth: [] }]
      x-roles: [super_admin]
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 密碼重置成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationResult"

  # ============================================
  # Teams
  # ============================================
  /teams:
    get:
      tags: [Admin]
      summary: 獲取團隊列表
      operationId: listTeams
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - name: search
          in: query
          schema: { type: string }
      responses:
        "200":
          description: 團隊列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TeamList"
    post:
      tags: [Admin]
      summary: 創建團隊
      operationId: createTeam
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/TeamCreateRequest"
      responses:
        "201":
          description: 團隊創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Team"
  /teams/{teamId}:
    get:
      tags: [Admin]
      summary: 獲取團隊詳情
      operationId: getTeam
      security: [{ bearerAuth: [] }]
      parameters:
        - name: teamId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 團隊詳情
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Team"
    put:
      tags: [Admin]
      summary: 更新團隊
      operationId: updateTeam
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: teamId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        $ref: "#/components/requestBodies/TeamUpdateRequest"
      responses:
        "200":
          description: 團隊更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Team"
    delete:
      tags: [Admin]
      summary: 刪除團隊
      operationId: deleteTeam
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: teamId
          in: path
          required: true
          schema: { type: string }
      responses:
        "204":
          description: 團隊刪除成功

  # ============================================
  # Roles
  # ============================================
  /roles:
    get:
      tags: [Admin]
      summary: 獲取角色列表
      operationId: listRoles
      security: [{ bearerAuth: [] }]
      x-roles: [super_admin]
      responses:
        "200":
          description: 角色列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Role"

  # ============================================
  # Search & Autocomplete
  # ============================================
  /autocomplete:
    get:
      tags: [Search & Autocomplete]
      summary: 獲取自動完成建議
      operationId: getAutocompleteSuggestions
      security: [{ bearerAuth: [] }]
      parameters:
        - name: type
          in: query
          required: true
          schema:
            type: string
            enum: [user, resource, script, team, channel, all]
        - name: q
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 成功獲取建議列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AutocompleteResult"
  /search:
    get:
      tags: [Search & Autocomplete]
      summary: 全局搜尋
      operationId: globalSearch
      security: [{ bearerAuth: [] }]
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: 成功返回搜尋結果
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SearchResultItem"

  # ============================================
  # Dashboard
  # ============================================
  /dashboard/summary:
    get:
      tags: [Dashboard]
      summary: 儀表板摘要
      operationId: getDashboardSummary
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: 儀表板摘要
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DashboardSummary"
  /dashboard/trends:
    get:
      tags: [Dashboard]
      summary: 趨勢數據
      operationId: getDashboardTrends
      security: [{ bearerAuth: [] }]
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [1h, 6h, 24h, 7d, 30d]
            default: 24h
      responses:
        "200":
          description: 趨勢數據
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TrendData"
  /dashboard/resource-distribution:
    get:
      tags: [Dashboard]
      summary: 資源分佈
      operationId: getResourceDistribution
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: 資源分佈數據
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResourceDistribution"

  # ============================================
  # Resources
  # ============================================
  /resources:
    get:
      tags: [Resources]
      summary: 獲取資源列表
      operationId: listResources
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - $ref: "#/components/parameters/SortByParam"
        - $ref: "#/components/parameters/SortOrderParam"
        - name: status
          in: query
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
        - name: group_id
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
      responses:
        "200":
          description: 資源列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResourceList"
    post:
      tags: [Resources]
      summary: 創建資源
      operationId: createResource
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/ResourceCreateRequest"
      responses:
        "201":
          description: 資源創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Resource"
  /resources/{resourceId}:
    get:
      tags: [Resources]
      summary: 獲取資源詳情
      operationId: getResource
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/ResourceIdParam"
      responses:
        "200":
          description: 資源詳情
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Resource"
    put:
      tags: [Resources]
      summary: 更新資源
      operationId: updateResource
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - $ref: "#/components/parameters/ResourceIdParam"
      requestBody:
        $ref: "#/components/requestBodies/ResourceUpdateRequest"
      responses:
        "200":
          description: 資源更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Resource"
    delete:
      tags: [Resources]
      summary: 刪除資源
      operationId: deleteResource
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - $ref: "#/components/parameters/ResourceIdParam"
      responses:
        "204":
          description: 資源刪除成功
  /resources/{resourceId}/metrics:
    get:
      tags: [Resources]
      summary: 獲取資源歷史指標
      operationId: getResourceMetricsHistory
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/ResourceIdParam"
        - name: metric_name
          in: query
          required: true
          schema: { type: string }
        - name: period
          in: query
          schema:
            type: string
            enum: [1h, 6h, 24h, 7d, 30d]
            default: 24h
      responses:
        "200":
          description: 成功返回指標歷史數據
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TrendData"
  /resources/{resourceId}/incidents:
    get:
      tags: [Resources]
      summary: 獲取資源關聯事件列表
      operationId: getResourceIncidents
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/ResourceIdParam"
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
      responses:
        "200":
          description: 資源關聯事件列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AlertList"
  /resources/batch:
    post:
      tags: [Resources]
      summary: 批次操作資源
      operationId: batchOperateResources
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/BatchResourceOperation"
      responses:
        "200":
          description: 批次操作結果
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BatchOperationResult"
  /resources/scan:
    post:
      tags: [Resources]
      summary: 掃描網段
      operationId: scanNetwork
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/NetworkScanRequest"
      responses:
        "202":
          description: 掃描任務已接受
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScanTaskResponse"
  /resources/scan/{taskId}:
    get:
      tags: [Resources]
      summary: 獲取掃描結果
      operationId: getScanResult
      security: [{ bearerAuth: [] }]
      parameters:
        - name: taskId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 掃描結果
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScanResult"
  # ============================================
  # Resource Groups
  # ============================================
  /resources/groups:
    get:
      tags: [Resource Groups]
      summary: 獲取群組列表
      operationId: listResourceGroups
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
      responses:
        "200":
          description: 群組列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResourceGroupList"
    post:
      tags: [Resource Groups]
      summary: 創建群組
      operationId: createResourceGroup
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/ResourceGroupCreateRequest"
      responses:
        "201":
          description: 群組創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResourceGroup"
  /resources/groups/{groupId}:
    get:
      tags: [Resource Groups]
      summary: 獲取單一資源群組詳情
      operationId: getResourceGroup
      security: [{ bearerAuth: [] }]
      parameters:
        - name: groupId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 資源群組詳情
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResourceGroup"
    put:
      tags: [Resource Groups]
      summary: 更新群組
      operationId: updateResourceGroup
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: groupId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        $ref: "#/components/requestBodies/ResourceGroupUpdateRequest"
      responses:
        "200":
          description: 群組更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResourceGroup"
    delete:
      tags: [Resource Groups]
      summary: 刪除群組
      operationId: deleteResourceGroup
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: groupId
          in: path
          required: true
          schema: { type: string }
      responses:
        "204":
          description: 群組刪除成功
  /resources/groups/{groupId}/members:
    post:
      tags: [Resource Groups]
      summary: 管理群組成員
      operationId: manageResourceGroupMembers
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: groupId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        $ref: "#/components/requestBodies/GroupMemberOperation"
      responses:
        "200":
          description: 成員管理成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationResult"

  # ============================================
  # Tag Keys
  # ============================================
  /tag-keys:
    get:
      tags: [Resources]
      summary: 獲取標籤鍵列表
      operationId: listTagKeys
      security: [{ bearerAuth: [] }]
      parameters:
        - name: search
          in: query
          schema: { type: string }
      responses:
        "200":
          description: 標籤鍵列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TagKey"
    post:
      tags: [Resources]
      summary: 創建標籤鍵
      operationId: createTagKey
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/TagKeyCreateRequest"
      responses:
        "201":
          description: 標籤鍵創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TagKey"
  /tag-keys/{tagKeyId}:
    get:
      tags: [Resources]
      summary: 獲取標籤鍵詳情
      operationId: getTagKey
      security: [{ bearerAuth: [] }]
      parameters:
        - name: tagKeyId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 標籤鍵詳情
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TagKey"
    put:
      tags: [Resources]
      summary: 更新標籤鍵
      operationId: updateTagKey
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: tagKeyId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        $ref: "#/components/requestBodies/TagKeyUpdateRequest"
      responses:
        "200":
          description: 標籤鍵更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TagKey"
    delete:
      tags: [Resources]
      summary: 刪除標籤鍵
      operationId: deleteTagKey
      security: [{ bearerAuth: [] }]
      x-roles: [super_admin]
      parameters:
        - name: tagKeyId
          in: path
          required: true
          schema: { type: string }
      responses:
        "204":
          description: 標籤鍵刪除成功
  /tag-keys/{tagKeyId}/values:
    get:
      tags: [Resources]
      summary: 獲取標籤值列表
      operationId: listTagValues
      security: [{ bearerAuth: [] }]
      parameters:
        - name: tagKeyId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 標籤值列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TagValue"
    post:
      tags: [Resources]
      summary: 新增標籤值
      operationId: createTagValue
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: tagKeyId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        $ref: "#/components/requestBodies/TagValueCreateRequest"
      responses:
        "201":
          description: 標籤值創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TagValue"

  # ============================================
  # Incidents
  # ============================================
  /incidents:
    get:
      tags: [Incidents]
      summary: 獲取事件列表
      operationId: listIncidents
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - $ref: "#/components/parameters/SortByParam"
        - $ref: "#/components/parameters/SortOrderParam"
        - name: status
          in: query
          schema: { type: string }
        - name: severity
          in: query
          schema: { type: string }
        - name: resource_id
          in: query
          schema: { type: string }
      responses:
        "200":
          description: 事件列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AlertList"
    post:
      tags: [Incidents]
      summary: 創建事件
      operationId: createIncident
      security: [{ bearerAuth: [] }]
      x-roles: [team_member, team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/AlertCreateRequest"
      responses:
        "201":
          description: 事件創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Alert"
  /incidents/{incidentId}:
    get:
      tags: [Incidents]
      summary: 獲取事件詳情
      operationId: getIncident
      security: [{ bearerAuth: [] }]
      parameters:
        - name: incidentId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 事件詳情
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Alert"
    put:
      tags: [Incidents]
      summary: 更新事件
      operationId: updateIncident
      security: [{ bearerAuth: [] }]
      x-roles: [team_member, team_manager, super_admin]
      parameters:
        - name: incidentId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        $ref: "#/components/requestBodies/AlertUpdateRequest"
      responses:
        "200":
          description: 事件更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Alert"
  /incidents/{incidentId}/acknowledge:
    post:
      tags: [Incidents]
      summary: 確認事件
      operationId: acknowledgeIncident
      security: [{ bearerAuth: [] }]
      x-roles: [team_member, team_manager, super_admin]
      parameters:
        - name: incidentId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 事件確認成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Alert"
  /incidents/{incidentId}/resolve:
    post:
      tags: [Incidents]
      summary: 解決事件
      operationId: resolveIncident
      security: [{ bearerAuth: [] }]
      x-roles: [team_member, team_manager, super_admin]
      parameters:
        - name: incidentId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 事件解決成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Alert"
  /incidents/{incidentId}/assign:
    post:
      tags: [Incidents]
      summary: 指派事件
      operationId: assignIncident
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: incidentId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [assignee_id]
              properties:
                assignee_id:
                  type: string
      responses:
        "200":
          description: 事件指派成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationResult"
  /incidents/{incidentId}/comments:
    post:
      tags: [Incidents]
      summary: 新增事件註記
      operationId: addIncidentComment
      security: [{ bearerAuth: [] }]
      x-roles: [team_member, team_manager, super_admin]
      parameters:
        - name: incidentId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [comment]
              properties:
                comment:
                  type: string
      responses:
        "201":
          description: 註記新增成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationResult"
  /incidents/generate-report:
    post:
      tags: [Incidents]
      summary: AI 生成事件報告
      operationId: generateIncidentReport
      security: [{ bearerAuth: [] }]
      x-roles: [team_member, team_manager, super_admin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [incident_ids]
              properties:
                incident_ids:
                  type: array
                  items: { type: string }
      responses:
        "200":
          description: AI 報告生成成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AIGeneratedReport"
  # ============================================
  # Incident Silences
  # ============================================
  /incidents/silences:
    get:
      tags: [Incident Silences]
      summary: 獲取靜音規則列表
      operationId: listSilences
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
      responses:
        "200":
          description: 靜音規則列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SilenceList"
    post:
      tags: [Incident Silences]
      summary: 創建靜音規則
      operationId: createSilence
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/SilenceCreateRequest"
      responses:
        "201":
          description: 靜音規則創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Silence"
  /incidents/silences/{silenceId}:
    get:
      tags: [Incident Silences]
      summary: 獲取單一靜音規則
      operationId: getSilence
      security: [{ bearerAuth: [] }]
      parameters:
        - name: silenceId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 靜音規則詳情
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Silence"
    put:
      tags: [Incident Silences]
      summary: 更新靜音規則
      operationId: updateSilence
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: silenceId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        $ref: "#/components/requestBodies/SilenceUpdateRequest"
      responses:
        "200":
          description: 靜音規則更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Silence"
    delete:
      tags: [Incident Silences]
      summary: 刪除靜音規則
      operationId: deleteSilence
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: silenceId
          in: path
          required: true
          schema: { type: string }
      responses:
        "204":
          description: 靜音規則刪除成功
  /incidents/silences/{silenceId}/enable:
    post:
      tags: [Incident Silences]
      summary: 啟用靜音規則
      operationId: enableSilence
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: silenceId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 規則已啟用
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationResult"
  /incidents/silences/{silenceId}/disable:
    post:
      tags: [Incident Silences]
      summary: 停用靜音規則
      operationId: disableSilence
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: silenceId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 規則已停用
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationResult"

  # ============================================
  # Automation Scripts
  # ============================================
  /automation/scripts:
    get:
      tags: [Automation]
      summary: 獲取自動化腳本列表
      operationId: listAutomationScripts
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - name: category
          in: query
          schema: { type: string, enum: [deployment, maintenance, monitoring] }
        - name: status
          in: query
          schema: { type: string, enum: [active, inactive] }
        - name: search
          in: query
          schema: { type: string }
      responses:
        "200":
          description: 腳本列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AutomationScriptList"
    post:
      tags: [Automation]
      summary: 創建自動化腳本
      operationId: createAutomationScript
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/AutomationScriptCreateRequest"
      responses:
        "201":
          description: 腳本創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AutomationScript"
  /automation/scripts/{scriptId}:
    get:
      tags: [Automation]
      summary: 獲取腳本詳情
      operationId: getAutomationScript
      security: [{ bearerAuth: [] }]
      parameters:
        - name: scriptId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 腳本詳情
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AutomationScript"
    put:
      tags: [Automation]
      summary: 更新腳本
      operationId: updateAutomationScript
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: scriptId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        $ref: "#/components/requestBodies/AutomationScriptUpdateRequest"
      responses:
        "200":
          description: 腳本更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AutomationScript"
    delete:
      tags: [Automation]
      summary: 刪除腳本
      operationId: deleteAutomationScript
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: scriptId
          in: path
          required: true
          schema: { type: string }
      responses:
        "204":
          description: 腳本刪除成功
  /automation/scripts/{scriptId}/execute:
    post:
      tags: [Automation]
      summary: 執行腳本
      operationId: executeAutomationScript
      security: [{ bearerAuth: [] }]
      x-roles: [team_member, team_manager, super_admin]
      parameters:
        - name: scriptId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                params:
                  type: object
                  description: 腳本執行參數
                async:
                  type: boolean
                  default: true
                  description: 是否異步執行
      responses:
        "202":
          description: 腳本執行已接受
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScriptExecutionResponse"

  # ============================================
  # Automation Schedules
  # ============================================
  /automation/schedules:
    get:
      tags: [Automation]
      summary: 獲取排程任務列表
      operationId: listAutomationSchedules
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - name: status
          in: query
          schema: { type: string, enum: [active, inactive, error] }
        - name: enabled
          in: query
          schema: { type: boolean }
      responses:
        "200":
          description: 排程任務列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScheduleList"
    post:
      tags: [Automation]
      summary: 創建排程任務
      operationId: createAutomationSchedule
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/ScheduleCreateRequest"
      responses:
        "201":
          description: 排程任務創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Schedule"
  /automation/schedules/{scheduleId}:
    get:
      tags: [Automation]
      summary: 獲取排程任務詳情
      operationId: getAutomationSchedule
      security: [{ bearerAuth: [] }]
      parameters:
        - name: scheduleId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 排程任務詳情
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Schedule"
    put:
      tags: [Automation]
      summary: 更新排程任務
      operationId: updateAutomationSchedule
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: scheduleId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        $ref: "#/components/requestBodies/ScheduleUpdateRequest"
      responses:
        "200":
          description: 排程任務更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Schedule"
    delete:
      tags: [Automation]
      summary: 刪除排程任務
      operationId: deleteAutomationSchedule
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: scheduleId
          in: path
          required: true
          schema: { type: string }
      responses:
        "204":
          description: 排程任務刪除成功
  /automation/schedules/{scheduleId}/enable:
    post:
      tags: [Automation]
      summary: 啟用排程任務
      operationId: enableAutomationSchedule
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: scheduleId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 排程任務已啟用
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationResult"
  /automation/schedules/{scheduleId}/disable:
    post:
      tags: [Automation]
      summary: 停用排程任務
      operationId: disableAutomationSchedule
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: scheduleId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 排程任務已停用
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationResult"

  # ============================================
  # Notification Management
  # ============================================
  /notifications/channels:
    get:
      tags: [Notifications]
      summary: 獲取通知管道列表
      operationId: listNotificationChannels
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - name: type
          in: query
          schema:
            {
              type: string,
              enum: [email, slack, webhook, sms, pagerduty, wechat],
            }
        - name: enabled
          in: query
          schema: { type: boolean }
      responses:
        "200":
          description: 通知管道列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationChannelList"
    post:
      tags: [Notifications]
      summary: 創建通知管道
      operationId: createNotificationChannel
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/NotificationChannelCreateRequest"
      responses:
        "201":
          description: 通知管道創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationChannel"
  /notifications/channels/{channelId}:
    get:
      tags: [Notifications]
      summary: 獲取通知管道詳情
      operationId: getNotificationChannel
      security: [{ bearerAuth: [] }]
      parameters:
        - name: channelId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 通知管道詳情
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationChannel"
    put:
      tags: [Notifications]
      summary: 更新通知管道
      operationId: updateNotificationChannel
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: channelId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        $ref: "#/components/requestBodies/NotificationChannelUpdateRequest"
      responses:
        "200":
          description: 通知管道更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationChannel"
    delete:
      tags: [Notifications]
      summary: 刪除通知管道
      operationId: deleteNotificationChannel
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: channelId
          in: path
          required: true
          schema: { type: string }
      responses:
        "204":
          description: 通知管道刪除成功
  /notifications/channels/{channelId}/test:
    post:
      tags: [Notifications]
      summary: 測試通知管道
      operationId: testNotificationChannel
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      parameters:
        - name: channelId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 測試成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationResult"

  # ============================================
  # Notification Policies
  # ============================================
  /notifications/policies:
    get:
      tags: [Notifications]
      summary: 獲取通知策略列表
      operationId: listNotificationPolicies
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - name: enabled
          in: query
          schema: { type: boolean }
      responses:
        "200":
          description: 通知策略列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationPolicyList"
    post:
      tags: [Notifications]
      summary: 創建通知策略
      operationId: createNotificationPolicy
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/NotificationPolicyCreateRequest"
      responses:
        "201":
          description: 通知策略創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationPolicy"

  # ============================================
  # System Settings
  # ============================================
  /settings:
    get:
      tags: [Admin]
      summary: 獲取系統設定列表
      operationId: listSystemSettings
      security: [{ bearerAuth: [] }]
      x-roles: [super_admin]
      parameters:
        - name: category
          in: query
          schema: { type: string }
      responses:
        "200":
          description: 系統設定列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SystemSetting"
    post:
      tags: [Admin]
      summary: 創建或更新系統設定
      operationId: createOrUpdateSystemSetting
      security: [{ bearerAuth: [] }]
      x-roles: [super_admin]
      requestBody:
        $ref: "#/components/requestBodies/SystemSettingCreateRequest"
      responses:
        "200":
          description: 設定創建或更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemSetting"
  /settings/{settingId}:
    get:
      tags: [Admin]
      summary: 獲取系統設定詳情
      operationId: getSystemSetting
      security: [{ bearerAuth: [] }]
      x-roles: [super_admin]
      parameters:
        - name: settingId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 系統設定詳情
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemSetting"
    delete:
      tags: [Admin]
      summary: 刪除系統設定
      operationId: deleteSystemSetting
      security: [{ bearerAuth: [] }]
      x-roles: [super_admin]
      parameters:
        - name: settingId
          in: path
          required: true
          schema: { type: string }
      responses:
        "204":
          description: 設定刪除成功

  # ============================================
  # User Preferences
  # ============================================
  /user/preferences:
    get:
      tags: [Profile]
      summary: 獲取用戶偏好設定
      operationId: getUserPreferences
      security: [{ bearerAuth: [] }]
      parameters:
        - name: category
          in: query
          schema: { type: string }
      responses:
        "200":
          description: 用戶偏好設定列表
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/UserPreference"
    post:
      tags: [Profile]
      summary: 創建或更新用戶偏好設定
      operationId: createOrUpdateUserPreference
      security: [{ bearerAuth: [] }]
      requestBody:
        $ref: "#/components/requestBodies/UserPreferenceCreateRequest"
      responses:
        "200":
          description: 偏好設定創建或更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserPreference"

  # ============================================
  # Maintenance Windows
  # ============================================
  /maintenance/windows:
    get:
      tags: [Admin]
      summary: 獲取維護窗口列表
      operationId: listMaintenanceWindows
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/PageSizeParam"
        - name: status
          in: query
          schema:
            { type: string, enum: [scheduled, active, completed, cancelled] }
      responses:
        "200":
          description: 維護窗口列表
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MaintenanceWindowList"
    post:
      tags: [Admin]
      summary: 創建維護窗口
      operationId: createMaintenanceWindow
      security: [{ bearerAuth: [] }]
      x-roles: [team_manager, super_admin]
      requestBody:
        $ref: "#/components/requestBodies/MaintenanceWindowCreateRequest"
      responses:
        "201":
          description: 維護窗口創建成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MaintenanceWindow"

  # ============================================
  # Fallback for omitted paths
  # ============================================
  # ... (other paths are omitted for brevity but would be fully defined here)

# ============================================
# 可重用元件 (Components)
# ============================================
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    PageParam:
      name: page
      in: query
      schema: { type: integer, minimum: 1, default: 1 }
    PageSizeParam:
      name: page_size
      in: query
      schema: { type: integer, minimum: 1, maximum: 100, default: 20 }
    SortByParam:
      name: sort_by
      in: query
      schema: { type: string }
    SortOrderParam:
      name: sort_order
      in: query
      schema: { type: string, enum: [asc, desc], default: desc }
    ResourceIdParam:
      name: resourceId
      in: path
      required: true
      schema: { type: string }

  responses:
    BadRequest:
      description: "請求參數錯誤 (400)"
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ErrorResponse" }
    Unauthorized:
      description: "未授權 (401)"
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ErrorResponse" }
    Forbidden:
      description: "無權限 (403)"
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ErrorResponse" }
    NotFound:
      description: "資源不存在 (404)"
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ErrorResponse" }
    Conflict:
      description: "資源衝突 (409)"
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ErrorResponse" }

  requestBodies:
    AuthLoginRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/AuthLoginRequest" }
    TokenRefreshRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/TokenRefreshRequest" }
    ResourceCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ResourceCreateRequest" }
    ResourceUpdateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ResourceUpdateRequest" }
    BatchResourceOperation:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/BatchResourceOperation" }
    NetworkScanRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/NetworkScanRequest" }
    ResourceGroupCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ResourceGroupCreateRequest" }
    ResourceGroupUpdateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ResourceGroupUpdateRequest" }
    GroupMemberOperation:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/GroupMemberOperation" }
    IncidentCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/IncidentCreateRequest" }
    IncidentUpdateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/IncidentUpdateRequest" }
    SilenceCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/SilenceCreateRequest" }
    SilenceUpdateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/SilenceUpdateRequest" }
    UserCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/UserCreateRequest" }
    UserUpdateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/UserUpdateRequest" }
    TeamCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/TeamCreateRequest" }
    TeamUpdateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/TeamUpdateRequest" }
    TagKeyCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/TagKeyCreateRequest" }
    TagKeyUpdateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/TagKeyUpdateRequest" }
    TagValueCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/TagValueCreateRequest" }
    AutomationScriptCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/AutomationScriptCreateRequest" }
    AutomationScriptUpdateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/AutomationScriptUpdateRequest" }
    ScheduleCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ScheduleCreateRequest" }
    ScheduleUpdateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ScheduleUpdateRequest" }
    NotificationChannelCreateRequest:
      required: true
      content:
        application/json:
          schema:
            { $ref: "#/components/schemas/NotificationChannelCreateRequest" }
    NotificationChannelUpdateRequest:
      required: true
      content:
        application/json:
          schema:
            { $ref: "#/components/schemas/NotificationChannelUpdateRequest" }
    NotificationPolicyCreateRequest:
      required: true
      content:
        application/json:
          schema:
            { $ref: "#/components/schemas/NotificationPolicyCreateRequest" }
    SystemSettingCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/SystemSettingCreateRequest" }
    UserPreferenceCreateRequest:
      required: true
      content:
        application/json:
          schema: { $ref: "#/components/schemas/UserPreferenceCreateRequest" }
    MaintenanceWindowCreateRequest:
      required: true
      content:
        application/json:
          schema:
            { $ref: "#/components/schemas/MaintenanceWindowCreateRequest" }

  schemas:
    ErrorResponse:
      type: object
      properties:
        error: { type: string }
        message: { type: string }
    OperationResult:
      type: object
      properties:
        success: { type: boolean }
        message: { type: string }
    Pagination:
      type: object
      properties:
        page: { type: integer }
        page_size: { type: integer }
        total_items: { type: integer }
        total_pages: { type: integer }
    MetricDefinition:
      type: object
      properties:
        name: { type: string }
        unit: { type: string }
        description: { type: string }
    MetricQueryRequest:
      type: object
      properties:
        resource_ids: { type: array, items: { type: string } }
        metric: { type: string }
        start_time: { type: string, format: "date-time" }
        end_time: { type: string, format: "date-time" }
    MetricQueryResult:
      type: object
      properties:
        items:
          type: array
          items:
            type: object
            properties:
              resource_id: { type: string }
              metric_name: { type: string }
              data_points:
                type: array
                items:
                  type: object
                  properties:
                    timestamp: { type: string, format: "date-time" }
                    value: { type: number }
    AuthLoginRequest:
      type: object
      properties:
        username: { type: string }
        password: { type: string, format: "password" }
    TokenRefreshRequest:
      type: object
      properties:
        refresh_token: { type: string }
    AuthTokens:
      type: object
      properties:
        access_token: { type: string }
        refresh_token: { type: string }
        expires_in: { type: integer }
    AutocompleteResult:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
    SearchResultItem:
      type: object
      properties:
        type: { type: string }
        score: { type: number }
        item: { type: object }
    DashboardSummary:
      type: object
      properties:
        alerts: { type: object }
        resources: { type: object }
        kpis: { type: object }
    TrendData:
      type: object
      properties:
        period: { type: string }
        data_points: { type: array, items: { type: object } }
    ResourceDistribution:
      type: object
      properties:
        by_status: { type: object }
        by_type: { type: object }
        by_group: { type: array, items: { type: object } }
    Resource:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        type: { type: string }
        status: { type: string }
        ip_address: { type: string }
        team_id: { type: string }
        location: { type: string }
        description: { type: string }
        tags: { type: array, items: { type: string } }
        silences:
          { type: array, items: { $ref: "#/components/schemas/Silence" } }
        created_at: { type: string, format: "date-time" }
        updated_at: { type: string, format: "date-time" }
    ResourceList:
      type: object
      properties:
        items: { type: array, items: { $ref: "#/components/schemas/Resource" } }
        pagination: { $ref: "#/components/schemas/Pagination" }
    ResourceCreateRequest:
      type: object
      properties:
        name: { type: string }
        type: { type: string }
        ip_address: { type: string }
        group_id: { type: string }
    ResourceUpdateRequest:
      type: object
      properties:
        name: { type: string }
        group_id: { type: string }
    BatchResourceOperation:
      type: object
      properties:
        operation: { type: string }
        resource_ids: { type: array, items: { type: string } }
        parameters: { type: object }
    BatchOperationResult:
      type: object
      properties:
        results:
          type: array
          items:
            type: object
            properties:
              item_id: { type: string }
              success: { type: boolean }
              message: { type: string }
    NetworkScanRequest:
      type: object
      properties:
        cidr: { type: string }
    ScanTaskResponse:
      type: object
      properties:
        task_id: { type: string }
        status: { type: string }
    ScanResult:
      type: object
      properties:
        task_id: { type: string }
        status: { type: string }
        discovered_resources: { type: array, items: { type: object } }
    ResourceGroup:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        resource_count: { type: integer }
    ResourceGroupList:
      type: object
      properties:
        items:
          { type: array, items: { $ref: "#/components/schemas/ResourceGroup" } }
        pagination: { $ref: "#/components/schemas/Pagination" }
    ResourceGroupCreateRequest:
      type: object
      properties:
        name: { type: string }
        description: { type: string }
    ResourceGroupUpdateRequest:
      type: object
      properties:
        name: { type: string }
        description: { type: string }
    GroupMemberOperation:
      type: object
      properties:
        operation: { type: string, enum: [add, remove] }
        resource_ids: { type: array, items: { type: string } }
    Alert:
      type: object
      properties:
        id: { type: string }
        summary: { type: string }
        description: { type: string }
        severity: { type: string }
        status: { type: string }
        resource_id: { type: string }
        rule_id: { type: string }
        labels: { type: object }
        annotations: { type: object }
        value: { type: number }
        business_impact: { type: string }
        acknowledged_by_id: { type: string }
        assigned_to_id: { type: string }
        starts_at: { type: string, format: "date-time" }
        ends_at: { type: string, format: "date-time" }
        acknowledged_at: { type: string, format: "date-time" }
        created_at: { type: string, format: "date-time" }
        updated_at: { type: string, format: "date-time" }
    AlertList:
      type: object
      properties:
        items: { type: array, items: { $ref: "#/components/schemas/Alert" } }
        pagination: { $ref: "#/components/schemas/Pagination" }
    AlertCreateRequest:
      type: object
      properties:
        summary: { type: string }
        description: { type: string }
        severity: { type: string }
        resource_id: { type: string }
        rule_id: { type: string }
        labels: { type: object }
        annotations: { type: object }
    AlertUpdateRequest:
      type: object
      properties:
        summary: { type: string }
        description: { type: string }
        severity: { type: string }
        status: { type: string }
        labels: { type: object }
        annotations: { type: object }
    AIGeneratedReport:
      type: object
      properties:
        content: { type: string }
    Silence:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        matchers: { type: array, items: { type: object } }
        start_time: { type: string, format: "date-time" }
        end_time: { type: string, format: "date-time" }
        created_by: { type: string }
    SilenceList:
      type: object
      properties:
        items: { type: array, items: { $ref: "#/components/schemas/Silence" } }
        pagination: { $ref: "#/components/schemas/Pagination" }
    SilenceCreateRequest:
      type: object
      properties:
        name: { type: string }
        matchers: { type: array, items: { type: object } }
        start_time: { type: string, format: "date-time" }
        end_time: { type: string, format: "date-time" }
    SilenceUpdateRequest:
      type: object
      properties:
        name: { type: string }
        matchers: { type: array, items: { type: object } }
        start_time: { type: string, format: "date-time" }
        end_time: { type: string, format: "date-time" }

    # User Management Schemas
    User:
      type: object
      properties:
        id: { type: string }
        username: { type: string }
        email: { type: string }
        name: { type: string }
        avatar: { type: string }
        roles: { type: array, items: { type: string } }
        teams: { type: array, items: { type: string } }
        teamNames: { type: array, items: { type: string } }
        status: { type: string }
        lastLogin: { type: string, format: "date-time" }
        loginCount: { type: integer }
        preferences: { type: object }
        enabled: { type: boolean }
        created_at: { type: string, format: "date-time" }
        updated_at: { type: string, format: "date-time" }
    UserList:
      type: object
      properties:
        items: { type: array, items: { $ref: "#/components/schemas/User" } }
        pagination: { $ref: "#/components/schemas/Pagination" }
    UserCreateRequest:
      type: object
      properties:
        name: { type: string }
        email: { type: string }
        password: { type: string }
        teams: { type: array, items: { type: string } }
        roles: { type: array, items: { type: string } }
    UserUpdateRequest:
      type: object
      properties:
        name: { type: string }
        email: { type: string }
        teams: { type: array, items: { type: string } }
        roles: { type: array, items: { type: string } }
        status: { type: string }
        enabled: { type: boolean }

    # Team Management Schemas
    Team:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        owner: { type: string }
        ownerName: { type: string }
        members: { type: array, items: { type: string } }
        memberDetails:
          { type: array, items: { $ref: "#/components/schemas/User" } }
        subscribers: { type: array, items: { type: string } }
        subscriberDetails:
          { type: array, items: { $ref: "#/components/schemas/User" } }
        created_at: { type: string, format: "date-time" }
        updated_at: { type: string, format: "date-time" }
    TeamList:
      type: object
      properties:
        items: { type: array, items: { $ref: "#/components/schemas/Team" } }
        pagination: { $ref: "#/components/schemas/Pagination" }
    TeamCreateRequest:
      type: object
      properties:
        name: { type: string }
        description: { type: string }
        owner: { type: string }
        members: { type: array, items: { type: string } }
        subscribers: { type: array, items: { type: string } }
    TeamUpdateRequest:
      type: object
      properties:
        name: { type: string }
        description: { type: string }
        owner: { type: string }
        members: { type: array, items: { type: string } }
        subscribers: { type: array, items: { type: string } }

    # Role Management Schemas
    Role:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        created_at: { type: string, format: "date-time" }

    # Tag Management Schemas
    TagKey:
      type: object
      properties:
        id: { type: string }
        key: { type: string }
        displayName: { type: string }
        description: { type: string }
        created_at: { type: string, format: "date-time" }
    TagValue:
      type: object
      properties:
        id: { type: string }
        tagKeyId: { type: string }
        value: { type: string }
        displayName: { type: string }
        description: { type: string }
        usageCount: { type: integer }
        enabled: { type: boolean }
        created_at: { type: string, format: "date-time" }
    TagKeyCreateRequest:
      type: object
      properties:
        key: { type: string }
        displayName: { type: string }
        description: { type: string }
    TagKeyUpdateRequest:
      type: object
      properties:
        displayName: { type: string }
        description: { type: string }
    TagValueCreateRequest:
      type: object
      properties:
        value: { type: string }
        displayName: { type: string }
        description: { type: string }

    # Automation Schemas
    AutomationScript:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        type: { type: string, enum: [python, bash, powershell] }
        description: { type: string }
        content: { type: string }
        creator_id: { type: string }
        category: { type: string, enum: [deployment, maintenance, monitoring] }
        params: { type: object }
        status: { type: string, enum: [active, inactive] }
        execution_count: { type: integer }
        last_executed_at: { type: string, format: "date-time" }
        created_at: { type: string, format: "date-time" }
        updated_at: { type: string, format: "date-time" }
    AutomationScriptList:
      type: object
      properties:
        items:
          {
            type: array,
            items: { $ref: "#/components/schemas/AutomationScript" },
          }
        pagination: { $ref: "#/components/schemas/Pagination" }
    AutomationScriptCreateRequest:
      type: object
      required: [name, type, content]
      properties:
        name: { type: string }
        type: { type: string, enum: [python, bash, powershell] }
        description: { type: string }
        content: { type: string }
        category: { type: string, enum: [deployment, maintenance, monitoring] }
        params: { type: object }
        status: { type: string, enum: [active, inactive] }
    AutomationScriptUpdateRequest:
      type: object
      properties:
        name: { type: string }
        description: { type: string }
        content: { type: string }
        category: { type: string, enum: [deployment, maintenance, monitoring] }
        params: { type: object }
        status: { type: string, enum: [active, inactive] }
    ScriptExecutionResponse:
      type: object
      properties:
        execution_id: { type: string }
        status: { type: string }
        message: { type: string }

    # Schedule Schemas
    Schedule:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        script_id: { type: string }
        cron: { type: string }
        schedule_mode: { type: string, enum: [simple, advanced] }
        frequency: { type: string, enum: [hourly, daily, weekly, monthly] }
        enabled: { type: boolean }
        status: { type: string, enum: [active, inactive, error] }
        last_status: { type: string, enum: [success, failed, pending] }
        last_run_at: { type: string, format: "date-time" }
        next_run_at: { type: string, format: "date-time" }
        creator_id: { type: string }
        created_at: { type: string, format: "date-time" }
        updated_at: { type: string, format: "date-time" }
    ScheduleList:
      type: object
      properties:
        items: { type: array, items: { $ref: "#/components/schemas/Schedule" } }
        pagination: { $ref: "#/components/schemas/Pagination" }
    ScheduleCreateRequest:
      type: object
      required: [name, script_id, cron]
      properties:
        name: { type: string }
        description: { type: string }
        script_id: { type: string }
        cron: { type: string }
        schedule_mode: { type: string, enum: [simple, advanced] }
        frequency: { type: string, enum: [hourly, daily, weekly, monthly] }
        enabled: { type: boolean }
    ScheduleUpdateRequest:
      type: object
      properties:
        name: { type: string }
        description: { type: string }
        cron: { type: string }
        schedule_mode: { type: string, enum: [simple, advanced] }
        frequency: { type: string, enum: [hourly, daily, weekly, monthly] }
        enabled: { type: boolean }

    # Notification Schemas
    NotificationChannel:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        type:
          {
            type: string,
            enum: [email, slack, webhook, sms, pagerduty, wechat],
          }
        config: { type: object }
        description: { type: string }
        enabled: { type: boolean }
        creator_id: { type: string }
        created_at: { type: string, format: "date-time" }
        updated_at: { type: string, format: "date-time" }
    NotificationChannelList:
      type: object
      properties:
        items:
          {
            type: array,
            items: { $ref: "#/components/schemas/NotificationChannel" },
          }
        pagination: { $ref: "#/components/schemas/Pagination" }
    NotificationChannelCreateRequest:
      type: object
      required: [name, type, config]
      properties:
        name: { type: string }
        type:
          {
            type: string,
            enum: [email, slack, webhook, sms, pagerduty, wechat],
          }
        config: { type: object }
        description: { type: string }
        enabled: { type: boolean }
    NotificationChannelUpdateRequest:
      type: object
      properties:
        name: { type: string }
        config: { type: object }
        description: { type: string }
        enabled: { type: boolean }

    NotificationPolicy:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        resource_type: { type: string }
        resource_tags: { type: object }
        alert_conditions: { type: object }
        channels: { type: array, items: { type: string } }
        escalation: { type: object }
        enabled: { type: boolean }
        creator_id: { type: string }
        created_at: { type: string, format: "date-time" }
        updated_at: { type: string, format: "date-time" }
    NotificationPolicyList:
      type: object
      properties:
        items:
          {
            type: array,
            items: { $ref: "#/components/schemas/NotificationPolicy" },
          }
        pagination: { $ref: "#/components/schemas/Pagination" }
    NotificationPolicyCreateRequest:
      type: object
      required: [name, channels]
      properties:
        name: { type: string }
        description: { type: string }
        resource_type: { type: string }
        resource_tags: { type: object }
        alert_conditions: { type: object }
        channels: { type: array, items: { type: string } }
        escalation: { type: object }
        enabled: { type: boolean }

    # System Settings Schemas
    SystemSetting:
      type: object
      properties:
        id: { type: string }
        category: { type: string }
        key: { type: string }
        value: { type: object }
        description: { type: string }
        updated_by_id: { type: string }
        updated_at: { type: string, format: "date-time" }
    SystemSettingCreateRequest:
      type: object
      required: [category, key, value]
      properties:
        category: { type: string }
        key: { type: string }
        value: { type: object }
        description: { type: string }

    # User Preferences Schemas
    UserPreference:
      type: object
      properties:
        id: { type: string }
        user_id: { type: string }
        category: { type: string }
        key: { type: string }
        value: { type: object }
        created_at: { type: string, format: "date-time" }
        updated_at: { type: string, format: "date-time" }
    UserPreferenceCreateRequest:
      type: object
      required: [category, key, value]
      properties:
        category: { type: string }
        key: { type: string }
        value: { type: object }

    # Maintenance Window Schemas
    MaintenanceWindow:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        description: { type: string }
        start_time: { type: string, format: "date-time" }
        end_time: { type: string, format: "date-time" }
        timezone: { type: string }
        recurrence: { type: object }
        affected_resources: { type: array, items: { type: string } }
        notification_settings: { type: object }
        status:
          { type: string, enum: [scheduled, active, completed, cancelled] }
        creator_id: { type: string }
        created_at: { type: string, format: "date-time" }
        updated_at: { type: string, format: "date-time" }
    MaintenanceWindowList:
      type: object
      properties:
        items:
          {
            type: array,
            items: { $ref: "#/components/schemas/MaintenanceWindow" },
          }
        pagination: { $ref: "#/components/schemas/Pagination" }
    MaintenanceWindowCreateRequest:
      type: object
      required: [name, start_time, end_time]
      properties:
        name: { type: string }
        description: { type: string }
        start_time: { type: string, format: "date-time" }
        end_time: { type: string, format: "date-time" }
        timezone: { type: string }
        recurrence: { type: object }
        affected_resources: { type: array, items: { type: string } }
        notification_settings: { type: object }
