# 「資源拓撲視圖」技術實踐指南

### 1. 核心理念：將「關聯數據」轉化為「視覺節點與連線」
拓撲視圖的本質，是將描述系統架構的**關聯數據**（例如：「服務 A」依賴於「資料庫 B」）進行處理，然後使用圖形化的方式，將每個**實體**渲染為一個**節點 (Node)**，將它們之間的**關係**渲染為一條**連線 (Edge)**。

---

### 2. 階段一：數據來源與模型 (Data Source & Model) - _決定了你能畫出什麼_

這是整個功能的**基石**。您無法視覺化您沒有的數據。因此，第一步是確保您的監控系統或 CMDB 中，儲存了清晰的資源關係數據。

#### A. 數據從何而來？
1.  **服務發現 (Service Discovery) - (最推薦)**：
    * **來源**：從 Kubernetes (K8s), Consul, Istio 等服務網格或容器編排平台自動抓取。
    * **優點**：能**自動、即時**地反映服務之間的真實調用關係和依賴，是雲原生環境下的最佳實踐。例如，K8s 可以清晰地告訴您哪個 `Service` 對應哪些 `Pod`，哪個 `Ingress` 將流量導入了哪個 `Service`。
2.  **APM 追蹤數據 (APM Tracing Data)**：
    * **來源**：從 Jaeger, Zipkin, SkyWalking 等分散式追蹤系統的 Trace 數據中分析得出。
    * **優點**：能反映最真實的**服務間即時請求鏈路**，非常精確。
3.  **CMDB 或手動配置**：
    * **來源**：在您的資源管理系統中，手動定義資源之間的父子或依賴關係。
    * **優點**：實現簡單，適用於架構相對固定的傳統環境。
    * **缺點**：需要手動維護，容易過時。

#### B. 數據模型 (Data Model)
無論來源如何，最終您需要將數據處理成前端圖表函式庫能理解的格式，通常包含兩個核心陣列：

1.  **節點列表 (Nodes Array)**：
    * **作用**：定義圖中的所有獨立實體。
    * **數據範例**：
        ```json
        [
          { "id": "service-A", "name": "人員認證服務", "type": "Service", "status": "Healthy" },
          { "id": "db-prod-01", "name": "主資料庫", "type": "Host", "status": "Critical" },
          { "id": "redis-cache-01", "name": "緩存", "type": "Cache", "status": "Healthy" }
        ]
        ```
2.  **連線列表 (Edges/Links Array)**：
    * **作用**：定義節點之間的關係。
    * **數據範例**：
        ```json
        [
          { "source": "service-A", "target": "db-prod-01", "label": "讀寫" },
          { "source": "service-A", "target": "redis-cache-01", "label": "讀取" }
        ]
        ```

---

### 3. 階段二：前端渲染 (Frontend Rendering) - _決定了你畫得好不好_

有了數據之後，我們需要選擇一個強大的前端函式庫，將這些節點和連線繪製成互動式的圖表。

#### 推薦的函式庫 (Library)
1.  **ECharts (🔥 最推薦)**：
    * **優點**：您目前已經在專案中使用了 ECharts，它內建的**「關係圖 (Graph Chart)」**類型，完美地支援了我們需要的所有功能。這能讓您的技術棧保持統一。ECharts 性能優異，配置項豐富，完全能滿足您的需求。

**實作流程 (以 ECharts 為例)**：
1.  在您的 `拓撲視圖` React 元件中，從後端獲取 Nodes 和 Edges 的 JSON 數據。
2.  將這些數據，填入 ECharts 關係圖的 `option` 設定中。
3.  ECharts 會自動為您計算佈局（例如 `force` 力引導佈局），並將圖表渲染出來。

---

### 4. 階段三：互動設計 (Interaction Design) - _決定了它好不好用_

一個靜態的拓撲圖價值有限，真正的價值來自於豐富的互動。

* **基礎互動 (必備)**：
    * **縮放與拖曳**：允許使用者自由地探索整個拓撲圖。
    * **節點懸停 (Hover)**：滑鼠懸停在任一節點上時，應高亮該節點及其直接關聯的連線，並彈出一個 **Tooltip**，顯示該節點的詳細資訊（如 IP 位址、CPU/記憶體使用率等）。
    * **節點點擊 (Click)**：點擊某個節點後，可以彈出一個側邊欄或 Modal，展示該資源的**完整詳情**，並提供**下鑽連結**（例如「查看儀表板」、「查看日誌」）。

* **進階互動 (可選)**：
    * **狀態視覺化**：節點的顏色應**即時**反映其健康狀態（綠/黃/紅），連線的顏色或動畫，可以反映流量或錯誤率。
    * **故障路徑高亮**：當發生故障時，可以根據告警的關聯性，自動高亮出推測的「故障傳播路徑」。
    * **篩選與佈局切換**：提供按「群組」或「標籤」篩選節點的功能，並允許使用者在「力引導佈局」、「環形佈局」等多種視覺佈局之間切換。

### 總結
實踐「資源拓撲視圖」是一個系統性工程，但遵循以上三個階段，您可以清晰地規劃出實現路徑：
1.  **先搞定數據**：確定您的資源關係數據從何而來，並設計好數據模型。
2.  **再選擇工具**：使用您已經熟悉的 ECharts 快速實現前端渲染。
3.  **最後豐富互動**：逐步為您的拓撲圖增加縮放、點擊、狀態視覺化等互動功能，讓它從一張「靜態地圖」，進化為一個強大的「動態作戰沙盤」。

### 📋 **實現狀態更新 (2025年9月)**
✅ **功能已完全實現** - 按照以上技術指南，資源拓撲視圖功能已成功整合到SRE平台中。

#### **實現亮點**
- **數據來源**: 基於現有的資源管理數據，自動生成拓撲關係
- **前端渲染**: 使用ECharts Graph圖表，支援力引導和環形佈局
- **互動功能**: 完整支援節點點擊、懸停、拖拽、縮放等操作
- **視覺化**: 雙重顏色編碼系統（資源類型 + 健康狀態）
- **人員體驗**: 詳細資訊面板 + 下鑽導航 + 操作說明

#### **技術細節**
- **組件**: `ResourceTopologyTab` (React Hook組件)
- **狀態**: `selectedNode`, `layoutType`, ECharts實例管理
- **資料**: 9個節點，14條連線，涵蓋完整服務架構
- **API**: 預留即時更新端點和WebSocket整合

#### **使用方式**
1. 導航至「資源管理」→「拓撲視圖」Tab
2. 點擊節點查看詳情，拖拽調整佈局
3. 使用下拉選單切換佈局算法
4. 從拓撲圖直接下鑽到資源詳情頁面

**這個實現完美詮釋了技術指南中的三階段方法論，從數據模型到互動設計，每一個環節都得到了精心實現。**
